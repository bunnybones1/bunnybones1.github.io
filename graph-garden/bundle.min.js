!function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var h="function"==typeof require&&require;if(!s&&h)return h(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[a]={exports:{}};t[a][0].call(u.exports,function(e){var r=t[a][1][e];return i(r?r:e)},u,u.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){(function(n){!function(e){if("object"==typeof r&&"undefined"!=typeof t)t.exports=e();else if("function"==typeof define,1){var i;"undefined"!=typeof window?i=window:"undefined"!=typeof n?i=n:"undefined"!=typeof self&&(i=self),i.CANNON=e()}else define([],e)}(function(){return function t(r,n,i){function o(s,h){if(!n[s]){if(!r[s]){var l="function"==typeof e&&e;if(!h&&l)return l(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=n[s]={exports:{}};r[s][0].call(u.exports,function(e){var t=r[s][1][e];return o(t?t:e)},u,u.exports,t,r,n,i)}return n[s].exports}for(var a="function"==typeof e&&e,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,r){t.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(e,t,r){t.exports={version:e("../package.json").version,AABB:e("./collision/AABB"),ArrayCollisionMatrix:e("./collision/ArrayCollisionMatrix"),Body:e("./objects/Body"),Box:e("./shapes/Box"),Broadphase:e("./collision/Broadphase"),Constraint:e("./constraints/Constraint"),ContactEquation:e("./equations/ContactEquation"),Narrowphase:e("./world/Narrowphase"),ConeTwistConstraint:e("./constraints/ConeTwistConstraint"),ContactMaterial:e("./material/ContactMaterial"),ConvexPolyhedron:e("./shapes/ConvexPolyhedron"),Cylinder:e("./shapes/Cylinder"),DistanceConstraint:e("./constraints/DistanceConstraint"),Equation:e("./equations/Equation"),EventTarget:e("./utils/EventTarget"),FrictionEquation:e("./equations/FrictionEquation"),GSSolver:e("./solver/GSSolver"),GridBroadphase:e("./collision/GridBroadphase"),Heightfield:e("./shapes/Heightfield"),HingeConstraint:e("./constraints/HingeConstraint"),LockConstraint:e("./constraints/LockConstraint"),Mat3:e("./math/Mat3"),Material:e("./material/Material"),NaiveBroadphase:e("./collision/NaiveBroadphase"),ObjectCollisionMatrix:e("./collision/ObjectCollisionMatrix"),Pool:e("./utils/Pool"),Particle:e("./shapes/Particle"),Plane:e("./shapes/Plane"),PointToPointConstraint:e("./constraints/PointToPointConstraint"),Quaternion:e("./math/Quaternion"),Ray:e("./collision/Ray"),RaycastVehicle:e("./objects/RaycastVehicle"),RaycastResult:e("./collision/RaycastResult"),RigidVehicle:e("./objects/RigidVehicle"),RotationalEquation:e("./equations/RotationalEquation"),RotationalMotorEquation:e("./equations/RotationalMotorEquation"),SAPBroadphase:e("./collision/SAPBroadphase"),SPHSystem:e("./objects/SPHSystem"),Shape:e("./shapes/Shape"),Solver:e("./solver/Solver"),Sphere:e("./shapes/Sphere"),SplitSolver:e("./solver/SplitSolver"),Spring:e("./objects/Spring"),Trimesh:e("./shapes/Trimesh"),Vec3:e("./math/Vec3"),Vec3Pool:e("./utils/Vec3Pool"),World:e("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(e,t,r){function n(e){e=e||{},this.lowerBound=new i,e.lowerBound&&this.lowerBound.copy(e.lowerBound),this.upperBound=new i,e.upperBound&&this.upperBound.copy(e.upperBound)}var i=e("../math/Vec3");e("../utils/Utils");t.exports=n;var o=new i;n.prototype.setFromPoints=function(e,t,r,n){var i=this.lowerBound,a=this.upperBound,s=r;i.copy(e[0]),s&&s.vmult(i,i),a.copy(i);for(var h=1;h<e.length;h++){var l=e[h];s&&(s.vmult(l,o),l=o),l.x>a.x&&(a.x=l.x),l.x<i.x&&(i.x=l.x),l.y>a.y&&(a.y=l.y),l.y<i.y&&(i.y=l.y),l.z>a.z&&(a.z=l.z),l.z<i.z&&(i.z=l.z)}return t&&(t.vadd(i,i),t.vadd(a,a)),n&&(i.x-=n,i.y-=n,i.z-=n,a.x+=n,a.y+=n,a.z+=n),this},n.prototype.copy=function(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this},n.prototype.clone=function(){return(new n).copy(this)},n.prototype.extend=function(e){var t=e.lowerBound.x;this.lowerBound.x>t&&(this.lowerBound.x=t);var r=e.upperBound.x;this.upperBound.x<r&&(this.upperBound.x=r);var t=e.lowerBound.y;this.lowerBound.y>t&&(this.lowerBound.y=t);var r=e.upperBound.y;this.upperBound.y<r&&(this.upperBound.y=r);var t=e.lowerBound.z;this.lowerBound.z>t&&(this.lowerBound.z=t);var r=e.upperBound.z;this.upperBound.z<r&&(this.upperBound.z=r)},n.prototype.overlaps=function(e){var t=this.lowerBound,r=this.upperBound,n=e.lowerBound,i=e.upperBound;return(n.x<=r.x&&r.x<=i.x||t.x<=i.x&&i.x<=r.x)&&(n.y<=r.y&&r.y<=i.y||t.y<=i.y&&i.y<=r.y)&&(n.z<=r.z&&r.z<=i.z||t.z<=i.z&&i.z<=r.z)},n.prototype.contains=function(e){var t=this.lowerBound,r=this.upperBound,n=e.lowerBound,i=e.upperBound;return t.x<=n.x&&r.x>=i.x&&t.y<=n.y&&r.y>=i.y&&t.z<=n.z&&r.z>=i.z},n.prototype.getCorners=function(e,t,r,n,i,o,a,s){var h=this.lowerBound,l=this.upperBound;e.copy(h),t.set(l.x,h.y,h.z),r.set(l.x,l.y,h.z),n.set(h.x,l.y,l.z),i.set(l.x,h.y,h.z),o.set(h.x,l.y,h.z),a.set(h.x,h.y,l.z),s.copy(l)};var a=[new i,new i,new i,new i,new i,new i,new i,new i];n.prototype.toLocalFrame=function(e,t){var r=a,n=r[0],i=r[1],o=r[2],s=r[3],h=r[4],l=r[5],u=r[6],c=r[7];this.getCorners(n,i,o,s,h,l,u,c);for(var p=0;8!==p;p++){var f=r[p];e.pointToLocal(f,f)}return t.setFromPoints(r)},n.prototype.toWorldFrame=function(e,t){var r=a,n=r[0],i=r[1],o=r[2],s=r[3],h=r[4],l=r[5],u=r[6],c=r[7];this.getCorners(n,i,o,s,h,l,u,c);for(var p=0;8!==p;p++){var f=r[p];e.pointToWorld(f,f)}return t.setFromPoints(r)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(e,t,r){function n(){this.matrix=[]}t.exports=n,n.prototype.get=function(e,t){if(e=e.index,t=t.index,t>e){var r=t;t=e,e=r}return this.matrix[(e*(e+1)>>1)+t-1]},n.prototype.set=function(e,t,r){if(e=e.index,t=t.index,t>e){var n=t;t=e,e=n}this.matrix[(e*(e+1)>>1)+t-1]=r?1:0},n.prototype.reset=function(){for(var e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0},n.prototype.setNumObjects=function(e){this.matrix.length=e*(e-1)>>1}},{}],5:[function(e,t,r){function n(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}var i=e("../objects/Body"),o=e("../math/Vec3"),a=e("../math/Quaternion");e("../shapes/Shape"),e("../shapes/Plane");t.exports=n,n.prototype.collisionPairs=function(e,t,r){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var s=i.STATIC|i.KINEMATIC;n.prototype.needBroadphaseCollision=function(e,t){return 0===(e.collisionFilterGroup&t.collisionFilterMask)||0===(t.collisionFilterGroup&e.collisionFilterMask)?!1:0===(e.type&s)&&e.sleepState!==i.SLEEPING||0===(t.type&s)&&t.sleepState!==i.SLEEPING?!0:!1},n.prototype.intersectionTest=function(e,t,r,n){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,r,n):this.doBoundingSphereBroadphase(e,t,r,n)};var h=new o;new o,new a,new o;n.prototype.doBoundingSphereBroadphase=function(e,t,r,n){var i=h;t.position.vsub(e.position,i);var o=Math.pow(e.boundingRadius+t.boundingRadius,2),a=i.norm2();o>a&&(r.push(e),n.push(t))},n.prototype.doBoundingBoxBroadphase=function(e,t,r,n){e.aabbNeedsUpdate&&e.computeAABB(),t.aabbNeedsUpdate&&t.computeAABB(),e.aabb.overlaps(t.aabb)&&(r.push(e),n.push(t))};var l={keys:[]},u=[],c=[];n.prototype.makePairsUnique=function(e,t){for(var r=l,n=u,i=c,o=e.length,a=0;a!==o;a++)n[a]=e[a],i[a]=t[a];e.length=0,t.length=0;for(var a=0;a!==o;a++){var s=n[a].id,h=i[a].id,p=h>s?s+","+h:h+","+s;r[p]=a,r.keys.push(p)}for(var a=0;a!==r.keys.length;a++){var p=r.keys.pop(),f=r[p];e.push(n[f]),t.push(i[f]),delete r[p]}},n.prototype.setWorld=function(e){};var p=new o;n.boundingSphereCheck=function(e,t){var r=p;return e.position.vsub(t.position,r),Math.pow(e.shape.boundingSphereRadius+t.shape.boundingSphereRadius,2)>r.norm2()},n.prototype.aabbQuery=function(e,t,r){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(e,t,r){function n(e,t,r,n,a){i.apply(this),this.nx=r||10,this.ny=n||10,this.nz=a||10,this.aabbMin=e||new o(100,100,100),this.aabbMax=t||new o(-100,-100,-100);var s=this.nx*this.ny*this.nz;if(0>=s)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=s,this.binLengths.length=s;for(var h=0;s>h;h++)this.bins[h]=[],this.binLengths[h]=0}t.exports=n;var i=e("./Broadphase"),o=e("../math/Vec3"),a=e("../shapes/Shape");n.prototype=new i,n.prototype.constructor=n;var s=new o;new o;n.prototype.collisionPairs=function(e,t,r){function n(e,t,r,n,i,o,a){var s=(e-x)*_|0,h=(t-w)*S|0,l=(r-b)*M|0,v=U((n-x)*_),g=U((i-w)*S),y=U((o-b)*M);0>s?s=0:s>=u&&(s=u-1),0>h?h=0:h>=c&&(h=c-1),0>l?l=0:l>=p&&(l=p-1),0>v?v=0:v>=u&&(v=u-1),0>g?g=0:g>=c&&(g=c-1),0>y?y=0:y>=p&&(y=p-1),s*=f,h*=d,l*=m,v*=f,g*=d,y*=m;for(var E=s;v>=E;E+=f)for(var T=h;g>=T;T+=d)for(var C=l;y>=C;C+=m){var A=E+T+C;B[A][F[A]++]=a}}for(var i=e.numObjects(),o=e.bodies,h=this.aabbMax,l=this.aabbMin,u=this.nx,c=this.ny,p=this.nz,f=c*p,d=p,m=1,v=h.x,g=h.y,y=h.z,x=l.x,w=l.y,b=l.z,_=u/(v-x),S=c/(g-w),M=p/(y-b),E=(v-x)/u,T=(g-w)/c,C=(y-b)/p,A=.5*Math.sqrt(E*E+T*T+C*C),L=a.types,R=L.SPHERE,P=L.PLANE,B=(L.BOX,L.COMPOUND,L.CONVEXPOLYHEDRON,this.bins),F=this.binLengths,k=this.bins.length,D=0;D!==k;D++)F[D]=0;for(var U=Math.ceil,l=Math.min,h=Math.max,D=0;D!==i;D++){var z=o[D],V=z.shape;switch(V.type){case R:var I=z.position.x,N=z.position.y,O=z.position.z,j=V.radius;n(I-j,N-j,O-j,I+j,N+j,O+j,z);break;case P:V.worldNormalNeedsUpdate&&V.computeWorldNormal(z.quaternion);var W=V.worldNormal,H=x+.5*E-z.position.x,G=w+.5*T-z.position.y,q=b+.5*C-z.position.z,X=s;X.set(H,G,q);for(var Y=0,K=0;Y!==u;Y++,K+=f,X.y=G,X.x+=E)for(var Q=0,Z=0;Q!==c;Q++,Z+=d,X.z=q,X.y+=T)for(var J=0,$=0;J!==p;J++,$+=m,X.z+=C)if(X.dot(W)<A){var ee=K+Z+$;B[ee][F[ee]++]=z}break;default:z.aabbNeedsUpdate&&z.computeAABB(),n(z.aabb.lowerBound.x,z.aabb.lowerBound.y,z.aabb.lowerBound.z,z.aabb.upperBound.x,z.aabb.upperBound.y,z.aabb.upperBound.z,z)}}for(var D=0;D!==k;D++){var te=F[D];if(te>1)for(var re=B[D],Y=0;Y!==te;Y++)for(var z=re[Y],Q=0;Q!==Y;Q++){var ne=re[Q];this.needBroadphaseCollision(z,ne)&&this.intersectionTest(z,ne,t,r)}}this.makePairsUnique(t,r)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(e,t,r){function n(){i.apply(this)}t.exports=n;var i=e("./Broadphase"),o=e("./AABB");n.prototype=new i,n.prototype.constructor=n,n.prototype.collisionPairs=function(e,t,r){var n,i,o,a,s=e.bodies,h=s.length;for(n=0;n!==h;n++)for(i=0;i!==n;i++)o=s[n],a=s[i],this.needBroadphaseCollision(o,a)&&this.intersectionTest(o,a,t,r)};new o;n.prototype.aabbQuery=function(e,t,r){r=r||[];for(var n=0;n<e.bodies.length;n++){var i=e.bodies[n];i.aabbNeedsUpdate&&i.computeAABB(),i.aabb.overlaps(t)&&r.push(i)}return r}},{"./AABB":3,"./Broadphase":5}],8:[function(e,t,r){function n(){this.matrix={}}t.exports=n,n.prototype.get=function(e,t){if(e=e.id,t=t.id,t>e){var r=t;t=e,e=r}return e+"-"+t in this.matrix},n.prototype.set=function(e,t,r){if(e=e.id,t=t.id,t>e){var n=t;t=e,e=n}r?this.matrix[e+"-"+t]=!0:delete this.matrix[e+"-"+t]},n.prototype.reset=function(){this.matrix={}},n.prototype.setNumObjects=function(e){}},{}],9:[function(e,t,r){function n(e,t){this.from=e?e.clone():new a,this.to=t?t.clone():new a,this._direction=new a,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=n.ANY,this.result=new l,this.hasHit=!1,this.callback=function(e){}}function i(e,t,r,n){n.vsub(t,D),r.vsub(t,d),e.vsub(t,m);var i,o,a=D.dot(D),s=D.dot(d),h=D.dot(m),l=d.dot(d),u=d.dot(m);return(i=l*h-s*u)>=0&&(o=a*u-s*h)>=0&&a*l-s*s>i+o}function o(e,t,r){r.vsub(e,D);var n=D.dot(t);t.mult(n,U),U.vadd(e,U);var i=r.distanceTo(U);return i}t.exports=n;var a=e("../math/Vec3"),s=e("../math/Quaternion"),h=e("../math/Transform"),l=(e("../shapes/ConvexPolyhedron"),e("../shapes/Box"),e("../collision/RaycastResult")),u=e("../shapes/Shape"),c=e("../collision/AABB");n.prototype.constructor=n,n.CLOSEST=1,n.ANY=2,n.ALL=4;var p=new c,f=[];n.prototype.intersectWorld=function(e,t){return this.mode=t.mode||n.ANY,this.result=t.result||new l,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask="undefined"!=typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup="undefined"!=typeof t.collisionFilterGroup?t.collisionFilterGroup:-1,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(p),f.length=0,e.broadphase.aabbQuery(e,p,f),this.intersectBodies(f),this.hasHit};var d=new a,m=new a;n.pointInTriangle=i;var v=new a,g=new s;n.prototype.intersectBody=function(e,t){t&&(this.result=t,this._updateDirection());var r=this.checkCollisionResponse;if((!r||e.collisionResponse)&&0!==(this.collisionFilterGroup&e.collisionFilterMask)&&0!==(e.collisionFilterGroup&this.collisionFilterMask))for(var n=v,i=g,o=0,a=e.shapes.length;a>o;o++){var s=e.shapes[o];if((!r||s.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],i),e.quaternion.vmult(e.shapeOffsets[o],n),n.vadd(e.position,n),this.intersectShape(s,i,n,e),this.result._shouldStop))break}},n.prototype.intersectBodies=function(e,t){t&&(this.result=t,this._updateDirection());for(var r=0,n=e.length;!this.result._shouldStop&&n>r;r++)this.intersectBody(e[r])},n.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},n.prototype.intersectShape=function(e,t,r,n){var i=this.from,a=o(i,this._direction,r);if(!(a>e.boundingSphereRadius)){var s=this[e.type];s&&s.call(this,e,t,r,n)}};var y=(new a,new a,new a),x=new a,w=new a,b=new a;new a,new l;n.prototype.intersectBox=function(e,t,r,n){return this.intersectConvex(e.convexPolyhedronRepresentation,t,r,n)},n.prototype[u.types.BOX]=n.prototype.intersectBox,n.prototype.intersectPlane=function(e,t,r,n){var i=this.from,o=this.to,s=this._direction,h=new a(0,0,1);t.vmult(h,h);var l=new a;i.vsub(r,l);var u=l.dot(h);o.vsub(r,l);var c=l.dot(h);if(!(u*c>0||i.distanceTo(o)<u)){var p=h.dot(s);if(!(Math.abs(p)<this.precision)){var f=new a,d=new a,m=new a;i.vsub(r,f);var v=-h.dot(f)/p;s.scale(v,d),i.vadd(d,m),this.reportIntersection(h,m,e,n,-1)}}},n.prototype[u.types.PLANE]=n.prototype.intersectPlane,n.prototype.getAABB=function(e){var t=this.to,r=this.from;e.lowerBound.x=Math.min(t.x,r.x),e.lowerBound.y=Math.min(t.y,r.y),e.lowerBound.z=Math.min(t.z,r.z),e.upperBound.x=Math.max(t.x,r.x),e.upperBound.y=Math.max(t.y,r.y),e.upperBound.z=Math.max(t.z,r.z)};var _={faceList:[0]};n.prototype.intersectHeightfield=function(e,t,r,i){var o=(e.data,e.elementSize,new a),s=new n(this.from,this.to);h.pointToLocalFrame(r,t,s.from,s.from),h.pointToLocalFrame(r,t,s.to,s.to);var l=[],u=null,c=null,p=null,f=null,d=e.getIndexOfPosition(s.from.x,s.from.y,l,!1);if(d&&(u=l[0],c=l[1],p=l[0],f=l[1]),d=e.getIndexOfPosition(s.to.x,s.to.y,l,!1),d&&((null===u||l[0]<u)&&(u=l[0]),(null===p||l[0]>p)&&(p=l[0]),(null===c||l[1]<c)&&(c=l[1]),(null===f||l[1]>f)&&(f=l[1])),null!==u){var m=[];e.getRectMinMax(u,c,p,f,m);for(var v=(m[0],m[1],u);p>=v;v++)for(var g=c;f>=g;g++){if(this.result._shouldStop)return;if(e.getConvexTrianglePillar(v,g,!1),h.pointToWorldFrame(r,t,e.pillarOffset,o),this.intersectConvex(e.pillarConvex,t,o,i,_),this.result._shouldStop)return;e.getConvexTrianglePillar(v,g,!0),h.pointToWorldFrame(r,t,e.pillarOffset,o),this.intersectConvex(e.pillarConvex,t,o,i,_)}}},n.prototype[u.types.HEIGHTFIELD]=n.prototype.intersectHeightfield;var S=new a,M=new a;n.prototype.intersectSphere=function(e,t,r,n){var i=this.from,o=this.to,a=e.radius,s=Math.pow(o.x-i.x,2)+Math.pow(o.y-i.y,2)+Math.pow(o.z-i.z,2),h=2*((o.x-i.x)*(i.x-r.x)+(o.y-i.y)*(i.y-r.y)+(o.z-i.z)*(i.z-r.z)),l=Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)+Math.pow(i.z-r.z,2)-Math.pow(a,2),u=Math.pow(h,2)-4*s*l,c=S,p=M;if(!(0>u))if(0===u)i.lerp(o,u,c),c.vsub(r,p),p.normalize(),this.reportIntersection(p,c,e,n,-1);else{var f=(-h-Math.sqrt(u))/(2*s),d=(-h+Math.sqrt(u))/(2*s);if(f>=0&&1>=f&&(i.lerp(o,f,c),c.vsub(r,p),p.normalize(),this.reportIntersection(p,c,e,n,-1)),this.result._shouldStop)return;d>=0&&1>=d&&(i.lerp(o,d,c),c.vsub(r,p),p.normalize(),this.reportIntersection(p,c,e,n,-1))}},n.prototype[u.types.SPHERE]=n.prototype.intersectSphere;var E=new a,T=(new a,new a,new a);n.prototype.intersectConvex=function(e,t,r,n,o){for(var a=E,s=T,h=o&&o.faceList||null,l=e.faces,u=e.vertices,c=e.faceNormals,p=this._direction,f=this.from,d=this.to,m=f.distanceTo(d),v=h?h.length:l.length,g=this.result,_=0;!g._shouldStop&&v>_;_++){var S=h?h[_]:_,M=l[S],C=c[S],A=t,L=r;s.copy(u[M[0]]),A.vmult(s,s),s.vadd(L,s),s.vsub(f,s),A.vmult(C,a);var R=p.dot(a);if(!(Math.abs(R)<this.precision)){var P=a.dot(s)/R;if(!(0>P)){p.mult(P,y),y.vadd(f,y),x.copy(u[M[0]]),A.vmult(x,x),L.vadd(x,x);for(var B=1;!g._shouldStop&&B<M.length-1;B++){w.copy(u[M[B]]),b.copy(u[M[B+1]]),A.vmult(w,w),A.vmult(b,b),L.vadd(w,w),L.vadd(b,b);var F=y.distanceTo(f);!i(y,x,w,b)&&!i(y,w,x,b)||F>m||this.reportIntersection(a,y,e,n,S)}}}}},n.prototype[u.types.CONVEXPOLYHEDRON]=n.prototype.intersectConvex;var C=new a,A=new a,L=new a,R=new a,P=new a,B=new a,F=(new c,[]),k=new h;n.prototype.intersectTrimesh=function(e,t,r,n,o){var a=C,s=F,l=k,u=T,c=A,p=L,f=R,d=B,m=P,v=(o&&o.faceList||null,e.indices),g=(e.vertices,e.faceNormals,this.from),_=this.to,S=this._direction;l.position.copy(r),l.quaternion.copy(t),h.vectorToLocalFrame(r,t,S,c),h.pointToLocalFrame(r,t,g,p),h.pointToLocalFrame(r,t,_,f);var M=p.distanceSquared(f);e.tree.rayQuery(this,l,s);for(var E=0,D=s.length;!this.result._shouldStop&&E!==D;E++){var U=s[E];e.getNormal(U,a),e.getVertex(v[3*U],x),x.vsub(p,u);var z=c.dot(a),V=a.dot(u)/z;if(!(0>V)){c.scale(V,y),y.vadd(p,y),e.getVertex(v[3*U+1],w),e.getVertex(v[3*U+2],b);var I=y.distanceSquared(p);!i(y,w,x,b)&&!i(y,x,w,b)||I>M||(h.vectorToWorldFrame(t,a,m),h.pointToWorldFrame(r,t,y,d),this.reportIntersection(m,d,e,n,U))}}s.length=0},n.prototype[u.types.TRIMESH]=n.prototype.intersectTrimesh,n.prototype.reportIntersection=function(e,t,r,i,o){var a=this.from,s=this.to,h=a.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this._direction)>0))switch(l.hitFaceIndex="undefined"!=typeof o?o:-1,this.mode){case n.ALL:this.hasHit=!0,l.set(a,s,e,t,r,i,h),l.hasHit=!0,this.callback(l);break;case n.CLOSEST:(h<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(a,s,e,t,r,i,h));break;case n.ANY:this.hasHit=!0,l.hasHit=!0,l.set(a,s,e,t,r,i,h),l._shouldStop=!0}};var D=new a,U=new a},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(e,t,r){function n(){this.rayFromWorld=new i,this.rayToWorld=new i,this.hitNormalWorld=new i,this.hitPointWorld=new i,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}var i=e("../math/Vec3");t.exports=n,n.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},n.prototype.abort=function(){this._shouldStop=!0},n.prototype.set=function(e,t,r,n,i,o,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(r),this.hitPointWorld.copy(n),this.shape=i,this.body=o,this.distance=a}},{"../math/Vec3":30}],11:[function(e,t,r){function n(e){i.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var t=this.axisList;this._addBodyHandler=function(e){t.push(e.body)},this._removeBodyHandler=function(e){var r=t.indexOf(e.body);-1!==r&&t.splice(r,1)},e&&this.setWorld(e)}var i=(e("../shapes/Shape"),e("../collision/Broadphase"));t.exports=n,n.prototype=new i,n.prototype.setWorld=function(e){this.axisList.length=0;for(var t=0;t<e.bodies.length;t++)this.axisList.push(e.bodies[t]);e.removeEventListener("addBody",this._addBodyHandler),e.removeEventListener("removeBody",this._removeBodyHandler),e.addEventListener("addBody",this._addBodyHandler),e.addEventListener("removeBody",this._removeBodyHandler),this.world=e,this.dirty=!0},n.insertionSortX=function(e){for(var t=1,r=e.length;r>t;t++){for(var n=e[t],i=t-1;i>=0&&!(e[i].aabb.lowerBound.x<=n.aabb.lowerBound.x);i--)e[i+1]=e[i];e[i+1]=n}return e},n.insertionSortY=function(e){for(var t=1,r=e.length;r>t;t++){for(var n=e[t],i=t-1;i>=0&&!(e[i].aabb.lowerBound.y<=n.aabb.lowerBound.y);i--)e[i+1]=e[i];e[i+1]=n}return e},n.insertionSortZ=function(e){for(var t=1,r=e.length;r>t;t++){for(var n=e[t],i=t-1;i>=0&&!(e[i].aabb.lowerBound.z<=n.aabb.lowerBound.z);i--)e[i+1]=e[i];e[i+1]=n}return e},n.prototype.collisionPairs=function(e,t,r){var i,o,a=this.axisList,s=a.length,h=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),i=0;i!==s;i++){var l=a[i];for(o=i+1;s>o;o++){var u=a[o];if(this.needBroadphaseCollision(l,u)){if(!n.checkBounds(l,u,h))break;this.intersectionTest(l,u,t,r)}}}},n.prototype.sortList=function(){for(var e=this.axisList,t=this.axisIndex,r=e.length,i=0;i!==r;i++){var o=e[i];o.aabbNeedsUpdate&&o.computeAABB()}0===t?n.insertionSortX(e):1===t?n.insertionSortY(e):2===t&&n.insertionSortZ(e)},n.checkBounds=function(e,t,r){var n,i;0===r?(n=e.position.x,i=t.position.x):1===r?(n=e.position.y,i=t.position.y):2===r&&(n=e.position.z,i=t.position.z);var o=e.boundingRadius,a=t.boundingRadius,s=n+o,h=i-a;return s>h},n.prototype.autoDetectAxis=function(){for(var e=0,t=0,r=0,n=0,i=0,o=0,a=this.axisList,s=a.length,h=1/s,l=0;l!==s;l++){var u=a[l],c=u.position.x;e+=c,t+=c*c;var p=u.position.y;r+=p,n+=p*p;var f=u.position.z;i+=f,o+=f*f}var d=t-e*e*h,m=n-r*r*h,v=o-i*i*h;d>m?d>v?this.axisIndex=0:this.axisIndex=2:m>v?this.axisIndex=1:this.axisIndex=2},n.prototype.aabbQuery=function(e,t,r){r=r||[],this.dirty&&(this.sortList(),this.dirty=!1);var n=this.axisIndex,i="x";1===n&&(i="y"),2===n&&(i="z");for(var o=this.axisList,a=(t.lowerBound[i],t.upperBound[i],0);a<o.length;a++){var s=o[a];s.aabbNeedsUpdate&&s.computeAABB(),s.aabb.overlaps(t)&&r.push(s)}return r}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(e,t,r){function n(e,t,r){r=r||{};var n="undefined"!=typeof r.maxForce?r.maxForce:1e6,h=r.pivotA?r.pivotA.clone():new s,l=r.pivotB?r.pivotB.clone():new s;this.axisA=r.axisA?r.axisA.clone():new s,this.axisB=r.axisB?r.axisB.clone():new s,i.call(this,e,h,t,l,n),this.collideConnected=!!r.collideConnected,this.angle="undefined"!=typeof r.angle?r.angle:0;var u=this.coneEquation=new o(e,t,r),c=this.twistEquation=new a(e,t,r);this.twistAngle="undefined"!=typeof r.twistAngle?r.twistAngle:0,u.maxForce=0,u.minForce=-n,c.maxForce=0,c.minForce=-n,this.equations.push(u,c)}t.exports=n;var i=(e("./Constraint"),e("./PointToPointConstraint")),o=e("../equations/ConeEquation"),a=e("../equations/RotationalEquation"),s=(e("../equations/ContactEquation"),e("../math/Vec3"));n.prototype=new i,n.constructor=n;new s,new s;n.prototype.update=function(){var e=this.bodyA,t=this.bodyB,r=this.coneEquation,n=this.twistEquation;i.prototype.update.call(this),e.vectorToWorldFrame(this.axisA,r.axisA),t.vectorToWorldFrame(this.axisB,r.axisB),this.axisA.tangents(n.axisA,n.axisA),e.vectorToWorldFrame(n.axisA,n.axisA),this.axisB.tangents(n.axisB,n.axisB),t.vectorToWorldFrame(n.axisB,n.axisB),r.angle=this.angle,n.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(e,t,r){function n(e,t,r){r=i.defaults(r,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=n.idCounter++,this.collideConnected=r.collideConnected,r.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}t.exports=n;var i=e("../utils/Utils");n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.prototype.enable=function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!0},n.prototype.disable=function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!1},n.idCounter=0},{"../utils/Utils":53}],14:[function(e,t,r){function n(e,t,r,n){i.call(this,e,t),"undefined"==typeof r&&(r=e.position.distanceTo(t.position)),"undefined"==typeof n&&(n=1e6),this.distance=r;var a=this.distanceEquation=new o(e,t);this.equations.push(a),a.minForce=-n,a.maxForce=n}t.exports=n;var i=e("./Constraint"),o=e("../equations/ContactEquation");n.prototype=new i,n.prototype.update=function(){var e=this.bodyA,t=this.bodyB,r=this.distanceEquation,n=.5*this.distance,i=r.ni;t.position.vsub(e.position,i),i.normalize(),i.mult(n,r.ri),i.mult(-n,r.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(e,t,r){function n(e,t,r){r=r||{};var n="undefined"!=typeof r.maxForce?r.maxForce:1e6,h=r.pivotA?r.pivotA.clone():new s,l=r.pivotB?r.pivotB.clone():new s;i.call(this,e,h,t,l,n);var u=this.axisA=r.axisA?r.axisA.clone():new s(1,0,0);u.normalize();var c=this.axisB=r.axisB?r.axisB.clone():new s(1,0,0);c.normalize();var p=this.rotationalEquation1=new o(e,t,r),f=this.rotationalEquation2=new o(e,t,r),d=this.motorEquation=new a(e,t,n);d.enabled=!1,this.equations.push(p,f,d)}t.exports=n;var i=(e("./Constraint"),e("./PointToPointConstraint")),o=e("../equations/RotationalEquation"),a=e("../equations/RotationalMotorEquation"),s=(e("../equations/ContactEquation"),e("../math/Vec3"));n.prototype=new i,n.constructor=n,n.prototype.enableMotor=function(){this.motorEquation.enabled=!0},n.prototype.disableMotor=function(){this.motorEquation.enabled=!1},n.prototype.setMotorSpeed=function(e){this.motorEquation.targetVelocity=e},n.prototype.setMotorMaxForce=function(e){this.motorEquation.maxForce=e,this.motorEquation.minForce=-e};var h=new s,l=new s;n.prototype.update=function(){var e=this.bodyA,t=this.bodyB,r=this.motorEquation,n=this.rotationalEquation1,o=this.rotationalEquation2,a=h,s=l,u=this.axisA,c=this.axisB;i.prototype.update.call(this),e.quaternion.vmult(u,a),t.quaternion.vmult(c,s),a.tangents(n.axisA,o.axisA),n.axisB.copy(s),o.axisB.copy(s),this.motorEquation.enabled&&(e.quaternion.vmult(this.axisA,r.axisA),t.quaternion.vmult(this.axisB,r.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(e,t,r){function n(e,t,r){r=r||{};var n="undefined"!=typeof r.maxForce?r.maxForce:1e6,s=new a,h=new a,l=new a;e.position.vadd(t.position,l),l.scale(.5,l),t.pointToLocalFrame(l,h),e.pointToLocalFrame(l,s),i.call(this,e,s,t,h,n);var u=this.rotationalEquation1=new o(e,t,r),c=this.rotationalEquation2=new o(e,t,r),p=this.rotationalEquation3=new o(e,t,r);this.equations.push(u,c,p)}t.exports=n;var i=(e("./Constraint"),e("./PointToPointConstraint")),o=e("../equations/RotationalEquation"),a=(e("../equations/RotationalMotorEquation"),e("../equations/ContactEquation"),e("../math/Vec3"));n.prototype=new i,n.constructor=n;new a,new a;n.prototype.update=function(){var e=this.bodyA,t=this.bodyB,r=(this.motorEquation,this.rotationalEquation1),n=this.rotationalEquation2,o=this.rotationalEquation3;i.prototype.update.call(this),e.vectorToWorldFrame(a.UNIT_X,r.axisA),t.vectorToWorldFrame(a.UNIT_Y,r.axisB),e.vectorToWorldFrame(a.UNIT_Y,n.axisA),t.vectorToWorldFrame(a.UNIT_Z,n.axisB),e.vectorToWorldFrame(a.UNIT_Z,o.axisA),t.vectorToWorldFrame(a.UNIT_X,o.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(e,t,r){function n(e,t,r,n,s){i.call(this,e,r),s="undefined"!=typeof s?s:1e6,this.pivotA=t?t.clone():new a,this.pivotB=n?n.clone():new a;var h=this.equationX=new o(e,r),l=this.equationY=new o(e,r),u=this.equationZ=new o(e,r);this.equations.push(h,l,u),h.minForce=l.minForce=u.minForce=-s,h.maxForce=l.maxForce=u.maxForce=s,h.ni.set(1,0,0),l.ni.set(0,1,0),u.ni.set(0,0,1)}t.exports=n;var i=e("./Constraint"),o=e("../equations/ContactEquation"),a=e("../math/Vec3");n.prototype=new i,n.prototype.update=function(){var e=this.bodyA,t=this.bodyB,r=this.equationX,n=this.equationY,i=this.equationZ;e.quaternion.vmult(this.pivotA,r.ri),t.quaternion.vmult(this.pivotB,r.rj),n.ri.copy(r.ri),n.rj.copy(r.rj),i.ri.copy(r.ri),i.rj.copy(r.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(e,t,r){function n(e,t,r){r=r||{};var n="undefined"!=typeof r.maxForce?r.maxForce:1e6;o.call(this,e,t,-n,n),this.axisA=r.axisA?r.axisA.clone():new i(1,0,0),this.axisB=r.axisB?r.axisB.clone():new i(0,1,0),this.angle="undefined"!=typeof r.angle?r.angle:0}t.exports=n;var i=e("../math/Vec3"),o=(e("../math/Mat3"),e("./Equation"));n.prototype=new o,n.prototype.constructor=n;var a=new i,s=new i;n.prototype.computeB=function(e){var t=this.a,r=this.b,n=this.axisA,i=this.axisB,o=a,h=s,l=this.jacobianElementA,u=this.jacobianElementB;n.cross(i,o),i.cross(n,h),l.rotational.copy(h),u.rotational.copy(o);var c=Math.cos(this.angle)-n.dot(i),p=this.computeGW(),f=this.computeGiMf(),d=-c*t-p*r-e*f;return d}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(e,t,r){function n(e,t,r){r="undefined"!=typeof r?r:1e6,i.call(this,e,t,0,r),this.restitution=0,this.ri=new o,this.rj=new o,this.ni=new o}t.exports=n;var i=e("./Equation"),o=e("../math/Vec3");e("../math/Mat3");n.prototype=new i,n.prototype.constructor=n;var a=new o,s=new o,h=new o;n.prototype.computeB=function(e){var t=this.a,r=this.b,n=this.bi,i=this.bj,o=this.ri,l=this.rj,u=a,c=s,p=n.velocity,f=n.angularVelocity,d=(n.force,n.torque,i.velocity),m=i.angularVelocity,v=(i.force,i.torque,h),g=this.jacobianElementA,y=this.jacobianElementB,x=this.ni;o.cross(x,u),l.cross(x,c),x.negate(g.spatial),u.negate(g.rotational),y.spatial.copy(x),y.rotational.copy(c),v.copy(i.position),v.vadd(l,v),v.vsub(n.position,v),v.vsub(o,v);var w=x.dot(v),b=this.restitution+1,_=b*d.dot(x)-b*p.dot(x)+m.dot(c)-f.dot(u),S=this.computeGiMf(),M=-w*t-_*r-e*S;
return M};var l=new o,u=new o,c=new o,p=new o,f=new o;n.prototype.getImpactVelocityAlongNormal=function(){var e=l,t=u,r=c,n=p,i=f;return this.bi.position.vadd(this.ri,r),this.bj.position.vadd(this.rj,n),this.bi.getVelocityAtWorldPoint(r,e),this.bj.getVelocityAtWorldPoint(n,t),e.vsub(t,i),this.ni.dot(i)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(e,t,r){function n(e,t,r,o){this.id=n.id++,this.minForce="undefined"==typeof r?-1e6:r,this.maxForce="undefined"==typeof o?1e6:o,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new i,this.jacobianElementB=new i,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}t.exports=n;var i=e("../math/JacobianElement"),o=e("../math/Vec3");n.prototype.constructor=n,n.id=0,n.prototype.setSpookParams=function(e,t,r){var n=t,i=e,o=r;this.a=4/(o*(1+4*n)),this.b=4*n/(1+4*n),this.eps=4/(o*o*i*(1+4*n))},n.prototype.computeB=function(e,t,r){var n=this.computeGW(),i=this.computeGq(),o=this.computeGiMf();return-i*e-n*t-o*r},n.prototype.computeGq=function(){var e=this.jacobianElementA,t=this.jacobianElementB,r=this.bi,n=this.bj,i=r.position,o=n.position;return e.spatial.dot(i)+t.spatial.dot(o)};var a=new o;n.prototype.computeGW=function(){var e=this.jacobianElementA,t=this.jacobianElementB,r=this.bi,n=this.bj,i=r.velocity,o=n.velocity,s=r.angularVelocity||a,h=n.angularVelocity||a;return e.multiplyVectors(i,s)+t.multiplyVectors(o,h)},n.prototype.computeGWlambda=function(){var e=this.jacobianElementA,t=this.jacobianElementB,r=this.bi,n=this.bj,i=r.vlambda,o=n.vlambda,s=r.wlambda||a,h=n.wlambda||a;return e.multiplyVectors(i,s)+t.multiplyVectors(o,h)};var s=new o,h=new o,l=new o,u=new o;n.prototype.computeGiMf=function(){var e=this.jacobianElementA,t=this.jacobianElementB,r=this.bi,n=this.bj,i=r.force,o=r.torque,a=n.force,c=n.torque,p=r.invMassSolve,f=n.invMassSolve;return r.invInertiaWorldSolve?r.invInertiaWorldSolve.vmult(o,l):l.set(0,0,0),n.invInertiaWorldSolve?n.invInertiaWorldSolve.vmult(c,u):u.set(0,0,0),i.mult(p,s),a.mult(f,h),e.multiplyVectors(s,l)+t.multiplyVectors(h,u)};var c=new o;n.prototype.computeGiMGt=function(){var e=this.jacobianElementA,t=this.jacobianElementB,r=this.bi,n=this.bj,i=r.invMassSolve,o=n.invMassSolve,a=r.invInertiaWorldSolve,s=n.invInertiaWorldSolve,h=i+o;return a&&(a.vmult(e.rotational,c),h+=c.dot(e.rotational)),s&&(s.vmult(t.rotational,c),h+=c.dot(t.rotational)),h};var p=new o;new o,new o,new o,new o,new o;n.prototype.addToWlambda=function(e){var t=this.jacobianElementA,r=this.jacobianElementB,n=this.bi,i=this.bj,o=p;t.spatial.mult(n.invMassSolve*e,o),n.vlambda.vadd(o,n.vlambda),r.spatial.mult(i.invMassSolve*e,o),i.vlambda.vadd(o,i.vlambda),n.invInertiaWorldSolve&&(n.invInertiaWorldSolve.vmult(t.rotational,o),o.mult(e,o),n.wlambda.vadd(o,n.wlambda)),i.invInertiaWorldSolve&&(i.invInertiaWorldSolve.vmult(r.rotational,o),o.mult(e,o),i.wlambda.vadd(o,i.wlambda))},n.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(e,t,r){function n(e,t,r){i.call(this,e,t,-r,r),this.ri=new o,this.rj=new o,this.t=new o}t.exports=n;var i=e("./Equation"),o=e("../math/Vec3");e("../math/Mat3");n.prototype=new i,n.prototype.constructor=n;var a=new o,s=new o;n.prototype.computeB=function(e){var t=(this.a,this.b),r=(this.bi,this.bj,this.ri),n=this.rj,i=a,o=s,h=this.t;r.cross(h,i),n.cross(h,o);var l=this.jacobianElementA,u=this.jacobianElementB;h.negate(l.spatial),i.negate(l.rotational),u.spatial.copy(h),u.rotational.copy(o);var c=this.computeGW(),p=this.computeGiMf(),f=-c*t-e*p;return f}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(e,t,r){function n(e,t,r){r=r||{};var n="undefined"!=typeof r.maxForce?r.maxForce:1e6;o.call(this,e,t,-n,n),this.axisA=r.axisA?r.axisA.clone():new i(1,0,0),this.axisB=r.axisB?r.axisB.clone():new i(0,1,0),this.maxAngle=Math.PI/2}t.exports=n;var i=e("../math/Vec3"),o=(e("../math/Mat3"),e("./Equation"));n.prototype=new o,n.prototype.constructor=n;var a=new i,s=new i;n.prototype.computeB=function(e){var t=this.a,r=this.b,n=this.axisA,i=this.axisB,o=a,h=s,l=this.jacobianElementA,u=this.jacobianElementB;n.cross(i,o),i.cross(n,h),l.rotational.copy(h),u.rotational.copy(o);var c=Math.cos(this.maxAngle)-n.dot(i),p=this.computeGW(),f=this.computeGiMf(),d=-c*t-p*r-e*f;return d}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(e,t,r){function n(e,t,r){r="undefined"!=typeof r?r:1e6,o.call(this,e,t,-r,r),this.axisA=new i,this.axisB=new i,this.targetVelocity=0}t.exports=n;var i=e("../math/Vec3"),o=(e("../math/Mat3"),e("./Equation"));n.prototype=new o,n.prototype.constructor=n,n.prototype.computeB=function(e){var t=(this.a,this.b),r=(this.bi,this.bj,this.axisA),n=this.axisB,i=this.jacobianElementA,o=this.jacobianElementB;i.rotational.copy(r),n.negate(o.rotational);var a=this.computeGW()-this.targetVelocity,s=this.computeGiMf(),h=-a*t-e*s;return h}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(e,t,r){function n(e,t,r){r=i.defaults(r,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=n.idCounter++,this.materials=[e,t],this.friction=r.friction,this.restitution=r.restitution,this.contactEquationStiffness=r.contactEquationStiffness,this.contactEquationRelaxation=r.contactEquationRelaxation,this.frictionEquationStiffness=r.frictionEquationStiffness,this.frictionEquationRelaxation=r.frictionEquationRelaxation}var i=e("../utils/Utils");t.exports=n,n.idCounter=0},{"../utils/Utils":53}],25:[function(e,t,r){function n(e){var t="";e=e||{},"string"==typeof e?(t=e,e={}):"object"==typeof e&&(t=""),this.name=t,this.id=n.idCounter++,this.friction="undefined"!=typeof e.friction?e.friction:-1,this.restitution="undefined"!=typeof e.restitution?e.restitution:-1}t.exports=n,n.idCounter=0},{}],26:[function(e,t,r){function n(){this.spatial=new i,this.rotational=new i}t.exports=n;var i=e("./Vec3");n.prototype.multiplyElement=function(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)},n.prototype.multiplyVectors=function(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}},{"./Vec3":30}],27:[function(e,t,r){function n(e){e?this.elements=e:this.elements=[0,0,0,0,0,0,0,0,0]}t.exports=n;var i=e("./Vec3");n.prototype.identity=function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1},n.prototype.setZero=function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0},n.prototype.setTrace=function(e){var t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z},n.prototype.getTrace=function(e){var e=e||new i,t=this.elements;e.x=t[0],e.y=t[4],e.z=t[8]},n.prototype.vmult=function(e,t){t=t||new i;var r=this.elements,n=e.x,o=e.y,a=e.z;return t.x=r[0]*n+r[1]*o+r[2]*a,t.y=r[3]*n+r[4]*o+r[5]*a,t.z=r[6]*n+r[7]*o+r[8]*a,t},n.prototype.smult=function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]*=e},n.prototype.mmult=function(e,t){for(var r=t||new n,i=0;3>i;i++)for(var o=0;3>o;o++){for(var a=0,s=0;3>s;s++)a+=e.elements[i+3*s]*this.elements[s+3*o];r.elements[i+3*o]=a}return r},n.prototype.scale=function(e,t){t=t||new n;for(var r=this.elements,i=t.elements,o=0;3!==o;o++)i[3*o+0]=e.x*r[3*o+0],i[3*o+1]=e.y*r[3*o+1],i[3*o+2]=e.z*r[3*o+2];return t},n.prototype.solve=function(e,t){t=t||new i;for(var r=3,n=4,o=[],a=0;r*n>a;a++)o.push(0);var a,s;for(a=0;3>a;a++)for(s=0;3>s;s++)o[a+n*s]=this.elements[a+3*s];o[3]=e.x,o[7]=e.y,o[11]=e.z;var h,l,u=3,c=u,p=4;do{if(a=c-u,0===o[a+n*a])for(s=a+1;c>s;s++)if(0!==o[a+n*s]){h=p;do l=p-h,o[l+n*a]+=o[l+n*s];while(--h);break}if(0!==o[a+n*a])for(s=a+1;c>s;s++){var f=o[a+n*s]/o[a+n*a];h=p;do l=p-h,o[l+n*s]=a>=l?0:o[l+n*s]-o[l+n*a]*f;while(--h)}}while(--u);if(t.z=o[2*n+3]/o[2*n+2],t.y=(o[1*n+3]-o[1*n+2]*t.z)/o[1*n+1],t.x=(o[0*n+3]-o[0*n+2]*t.z-o[0*n+1]*t.y)/o[0*n+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=["+t.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return t},n.prototype.e=function(e,t,r){return void 0===r?this.elements[t+3*e]:void(this.elements[t+3*e]=r)},n.prototype.copy=function(e){for(var t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this},n.prototype.toString=function(){for(var e="",t=",",r=0;9>r;r++)e+=this.elements[r]+t;return e},n.prototype.reverse=function(e){e=e||new n;for(var t=3,r=6,i=[],o=0;t*r>o;o++)i.push(0);var o,a;for(o=0;3>o;o++)for(a=0;3>a;a++)i[o+r*a]=this.elements[o+3*a];i[3]=1,i[9]=0,i[15]=0,i[4]=0,i[10]=1,i[16]=0,i[5]=0,i[11]=0,i[17]=1;var s,h,l=3,u=l,c=r;do{if(o=u-l,0===i[o+r*o])for(a=o+1;u>a;a++)if(0!==i[o+r*a]){s=c;do h=c-s,i[h+r*o]+=i[h+r*a];while(--s);break}if(0!==i[o+r*o])for(a=o+1;u>a;a++){var p=i[o+r*a]/i[o+r*o];s=c;do h=c-s,i[h+r*a]=o>=h?0:i[h+r*a]-i[h+r*o]*p;while(--s)}}while(--l);o=2;do{a=o-1;do{var p=i[o+r*a]/i[o+r*o];s=r;do h=r-s,i[h+r*a]=i[h+r*a]-i[h+r*o]*p;while(--s)}while(a--)}while(--o);o=2;do{var p=1/i[o+r*o];s=r;do h=r-s,i[h+r*o]=i[h+r*o]*p;while(--s)}while(o--);o=2;do{a=2;do{if(h=i[t+a+r*o],isNaN(h)||h===1/0)throw"Could not reverse! A=["+this.toString()+"]";e.e(o,a,h)}while(a--)}while(o--);return e},n.prototype.setRotationFromQuaternion=function(e){var t=e.x,r=e.y,n=e.z,i=e.w,o=t+t,a=r+r,s=n+n,h=t*o,l=t*a,u=t*s,c=r*a,p=r*s,f=n*s,d=i*o,m=i*a,v=i*s,g=this.elements;return g[0]=1-(c+f),g[1]=l-v,g[2]=u+m,g[3]=l+v,g[4]=1-(h+f),g[5]=p-d,g[6]=u-m,g[7]=p+d,g[8]=1-(h+c),this},n.prototype.transpose=function(e){e=e||new n;for(var t=e.elements,r=this.elements,i=0;3!==i;i++)for(var o=0;3!==o;o++)t[3*i+o]=r[3*o+i];return e}},{"./Vec3":30}],28:[function(e,t,r){function n(e,t,r,n){this.x=void 0!==e?e:0,this.y=void 0!==t?t:0,this.z=void 0!==r?r:0,this.w=void 0!==n?n:1}t.exports=n;var i=e("./Vec3");n.prototype.set=function(e,t,r,n){this.x=e,this.y=t,this.z=r,this.w=n},n.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},n.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},n.prototype.setFromAxisAngle=function(e,t){var r=Math.sin(.5*t);this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(.5*t)},n.prototype.toAxisAngle=function(e){e=e||new i,this.normalize();var t=2*Math.acos(this.w),r=Math.sqrt(1-this.w*this.w);return.001>r?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/r,e.y=this.y/r,e.z=this.z/r),[e,t]};var o=new i,a=new i;n.prototype.setFromVectors=function(e,t){if(e.isAntiparallelTo(t)){var r=o,n=a;e.tangents(r,n),this.setFromAxisAngle(r,Math.PI)}else{var i=e.cross(t);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(Math.pow(e.norm(),2)*Math.pow(t.norm(),2))+e.dot(t),this.normalize()}};var s=new i,h=new i,l=new i;n.prototype.mult=function(e,t){t=t||new n;var r=this.w,i=s,o=h,a=l;return i.set(this.x,this.y,this.z),o.set(e.x,e.y,e.z),t.w=r*e.w-i.dot(o),i.cross(o,a),t.x=r*o.x+e.w*i.x+a.x,t.y=r*o.y+e.w*i.y+a.y,t.z=r*o.z+e.w*i.z+a.z,t},n.prototype.inverse=function(e){var t=this.x,r=this.y,i=this.z,o=this.w;e=e||new n,this.conjugate(e);var a=1/(t*t+r*r+i*i+o*o);return e.x*=a,e.y*=a,e.z*=a,e.w*=a,e},n.prototype.conjugate=function(e){return e=e||new n,e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e},n.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e)},n.prototype.normalizeFast=function(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e)},n.prototype.vmult=function(e,t){t=t||new i;var r=e.x,n=e.y,o=e.z,a=this.x,s=this.y,h=this.z,l=this.w,u=l*r+s*o-h*n,c=l*n+h*r-a*o,p=l*o+a*n-s*r,f=-a*r-s*n-h*o;return t.x=u*l+f*-a+c*-h-p*-s,t.y=c*l+f*-s+p*-a-u*-h,t.z=p*l+f*-h+u*-s-c*-a,t},n.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},n.prototype.toEuler=function(e,t){t=t||"YZX";var r,n,i,o=this.x,a=this.y,s=this.z,h=this.w;switch(t){case"YZX":var l=o*a+s*h;if(l>.499&&(r=2*Math.atan2(o,h),n=Math.PI/2,i=0),-.499>l&&(r=-2*Math.atan2(o,h),n=-Math.PI/2,i=0),isNaN(r)){var u=o*o,c=a*a,p=s*s;r=Math.atan2(2*a*h-2*o*s,1-2*c-2*p),n=Math.asin(2*l),i=Math.atan2(2*o*h-2*a*s,1-2*u-2*p)}break;default:throw new Error("Euler order "+t+" not supported yet.")}e.y=r,e.z=n,e.x=i},n.prototype.setFromEuler=function(e,t,r,n){n=n||"XYZ";var i=Math.cos(e/2),o=Math.cos(t/2),a=Math.cos(r/2),s=Math.sin(e/2),h=Math.sin(t/2),l=Math.sin(r/2);return"XYZ"===n?(this.x=s*o*a+i*h*l,this.y=i*h*a-s*o*l,this.z=i*o*l+s*h*a,this.w=i*o*a-s*h*l):"YXZ"===n?(this.x=s*o*a+i*h*l,this.y=i*h*a-s*o*l,this.z=i*o*l-s*h*a,this.w=i*o*a+s*h*l):"ZXY"===n?(this.x=s*o*a-i*h*l,this.y=i*h*a+s*o*l,this.z=i*o*l+s*h*a,this.w=i*o*a-s*h*l):"ZYX"===n?(this.x=s*o*a-i*h*l,this.y=i*h*a+s*o*l,this.z=i*o*l-s*h*a,this.w=i*o*a+s*h*l):"YZX"===n?(this.x=s*o*a+i*h*l,this.y=i*h*a+s*o*l,this.z=i*o*l-s*h*a,this.w=i*o*a-s*h*l):"XZY"===n&&(this.x=s*o*a-i*h*l,this.y=i*h*a-s*o*l,this.z=i*o*l+s*h*a,this.w=i*o*a+s*h*l),this},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(e,t,r){function n(e){e=e||{},this.position=new i,e.position&&this.position.copy(e.position),this.quaternion=new o,e.quaternion&&this.quaternion.copy(e.quaternion)}var i=e("./Vec3"),o=e("./Quaternion");t.exports=n;var a=new o;n.pointToLocalFrame=function(e,t,r,n){var n=n||new i;return r.vsub(e,n),t.conjugate(a),a.vmult(n,n),n},n.prototype.pointToLocal=function(e,t){return n.pointToLocalFrame(this.position,this.quaternion,e,t)},n.pointToWorldFrame=function(e,t,r,n){var n=n||new i;return t.vmult(r,n),n.vadd(e,n),n},n.prototype.pointToWorld=function(e,t){return n.pointToWorldFrame(this.position,this.quaternion,e,t)},n.prototype.vectorToWorldFrame=function(e,t){var t=t||new i;return this.quaternion.vmult(e,t),t},n.vectorToWorldFrame=function(e,t,r){return e.vmult(t,r),r},n.vectorToLocalFrame=function(e,t,r,n){var n=n||new i;return t.w*=-1,t.vmult(r,n),t.w*=-1,n}},{"./Quaternion":28,"./Vec3":30}],30:[function(e,t,r){function n(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}t.exports=n;var i=e("./Mat3");n.ZERO=new n(0,0,0),n.UNIT_X=new n(1,0,0),n.UNIT_Y=new n(0,1,0),n.UNIT_Z=new n(0,0,1),n.prototype.cross=function(e,t){var r=e.x,i=e.y,o=e.z,a=this.x,s=this.y,h=this.z;return t=t||new n,t.x=s*o-h*i,t.y=h*r-a*o,t.z=a*i-s*r,t},n.prototype.set=function(e,t,r){return this.x=e,this.y=t,this.z=r,this},n.prototype.setZero=function(){this.x=this.y=this.z=0},n.prototype.vadd=function(e,t){return t?(t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z,void 0):new n(this.x+e.x,this.y+e.y,this.z+e.z)},n.prototype.vsub=function(e,t){return t?(t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,void 0):new n(this.x-e.x,this.y-e.y,this.z-e.z)},n.prototype.crossmat=function(){return new i([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},n.prototype.normalize=function(){var e=this.x,t=this.y,r=this.z,n=Math.sqrt(e*e+t*t+r*r);if(n>0){var i=1/n;this.x*=i,this.y*=i,this.z*=i}else this.x=0,this.y=0,this.z=0;return n},n.prototype.unit=function(e){e=e||new n;var t=this.x,r=this.y,i=this.z,o=Math.sqrt(t*t+r*r+i*i);return o>0?(o=1/o,e.x=t*o,e.y=r*o,e.z=i*o):(e.x=1,e.y=0,e.z=0),e},n.prototype.norm=function(){var e=this.x,t=this.y,r=this.z;return Math.sqrt(e*e+t*t+r*r)},n.prototype.length=n.prototype.norm,n.prototype.norm2=function(){return this.dot(this)},n.prototype.lengthSquared=n.prototype.norm2,n.prototype.distanceTo=function(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z;return Math.sqrt((i-t)*(i-t)+(o-r)*(o-r)+(a-n)*(a-n))},n.prototype.distanceSquared=function(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z;return(i-t)*(i-t)+(o-r)*(o-r)+(a-n)*(a-n)},n.prototype.mult=function(e,t){t=t||new n;var r=this.x,i=this.y,o=this.z;return t.x=e*r,t.y=e*i,t.z=e*o,t},n.prototype.scale=n.prototype.mult,n.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},n.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},n.prototype.negate=function(e){return e=e||new n,e.x=-this.x,e.y=-this.y,e.z=-this.z,e};var o=new n,a=new n;n.prototype.tangents=function(e,t){var r=this.norm();if(r>0){var n=o,i=1/r;n.set(this.x*i,this.y*i,this.z*i);var s=a;Math.abs(n.x)<.9?(s.set(1,0,0),n.cross(s,e)):(s.set(0,1,0),n.cross(s,e)),n.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)},n.prototype.toString=function(){return this.x+","+this.y+","+this.z},n.prototype.toArray=function(){return[this.x,this.y,this.z]},n.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},n.prototype.lerp=function(e,t,r){var n=this.x,i=this.y,o=this.z;r.x=n+(e.x-n)*t,r.y=i+(e.y-i)*t,r.z=o+(e.z-o)*t},n.prototype.almostEquals=function(e,t){return void 0===t&&(t=1e-6),Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t?!1:!0},n.prototype.almostZero=function(e){return void 0===e&&(e=1e-6),Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e?!1:!0};var s=new n;n.prototype.isAntiparallelTo=function(e,t){return this.negate(s),s.almostEquals(e,t)},n.prototype.clone=function(){return new n(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(e,t,r){function n(e){e=e||{},i.apply(this),this.id=n.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new o,this.collisionFilterGroup="number"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof e.collisionFilterMask?e.collisionFilterMask:1,this.collisionResponse=!0,this.position=new o,e.position&&this.position.copy(e.position),this.previousPosition=new o,this.initPosition=new o,this.velocity=new o,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new o,this.force=new o;var t="number"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping="number"==typeof e.linearDamping?e.linearDamping:.01,this.type=0>=t?n.STATIC:n.DYNAMIC,typeof e.type==typeof n.STATIC&&(this.type=e.type),this.allowSleep="undefined"!=typeof e.allowSleep?e.allowSleep:!0,this.sleepState=0,this.sleepSpeedLimit="undefined"!=typeof e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit="undefined"!=typeof e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new o,this.quaternion=new s,e.quaternion&&this.quaternion.copy(e.quaternion),this.initQuaternion=new s,this.angularVelocity=new o,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new o,this.interpolatedPosition=new o,this.interpolatedQuaternion=new s,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new o,this.invInertia=new o,this.invInertiaWorld=new a,this.invMassSolve=0,this.invInertiaSolve=new o,this.invInertiaWorldSolve=new a,this.fixedRotation="undefined"!=typeof e.fixedRotation?e.fixedRotation:!1,this.angularDamping="undefined"!=typeof e.angularDamping?e.angularDamping:.01,this.aabb=new h,this.aabbNeedsUpdate=!0,this.wlambda=new o,e.shape&&this.addShape(e.shape),this.updateMassProperties(),this.resistGravity=e.resistGravity}t.exports=n;var i=e("../utils/EventTarget"),o=(e("../shapes/Shape"),e("../math/Vec3")),a=e("../math/Mat3"),s=e("../math/Quaternion"),h=(e("../material/Material"),e("../collision/AABB")),l=e("../shapes/Box");n.prototype=new i,n.prototype.constructor=n,n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2,n.idCounter=0,n.prototype.wakeUp=function(){var e=this.sleepState;this.sleepState=0,e===n.SLEEPING&&this.dispatchEvent({type:"wakeup"})},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.prototype.sleepTick=function(e){if(this.allowSleep){var t=this.sleepState,r=this.velocity.norm2()+this.angularVelocity.norm2(),i=Math.pow(this.sleepSpeedLimit,2);t===n.AWAKE&&i>r?(this.sleepState=n.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(n.sleepyEvent)):t===n.SLEEPY&&r>i?this.wakeUp():t===n.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(n.sleepEvent))}},n.prototype.updateSolveMassProperties=function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},n.prototype.pointToLocalFrame=function(e,t){var t=t||new o;return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t},n.prototype.vectorToLocalFrame=function(e,t){var t=t||new o;return this.quaternion.conjugate().vmult(e,t),t},n.prototype.pointToWorldFrame=function(e,t){var t=t||new o;return this.quaternion.vmult(e,t),t.vadd(this.position,t),t},n.prototype.vectorToWorldFrame=function(e,t){var t=t||new o;return this.quaternion.vmult(e,t),t};var u=new o,c=new s;n.prototype.addShape=function(e,t,r){var n=new o,i=new s;return t&&n.copy(t),r&&i.copy(r),this.shapes.push(e),this.shapeOffsets.push(n),this.shapeOrientations.push(i),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},n.prototype.updateBoundingRadius=function(){for(var e=this.shapes,t=this.shapeOffsets,r=e.length,n=0,i=0;i!==r;i++){var o=e[i];o.updateBoundingSphereRadius();var a=t[i].norm(),s=o.boundingSphereRadius;a+s>n&&(n=a+s)}this.boundingRadius=n};var p=new h;n.prototype.computeAABB=function(){for(var e=this.shapes,t=this.shapeOffsets,r=this.shapeOrientations,n=e.length,i=u,o=c,a=this.quaternion,s=this.aabb,h=p,l=0;l!==n;l++){var f=e[l];r[l].mult(a,o),o.vmult(t[l],i),i.vadd(this.position,i),f.calculateWorldAABB(i,o,h.lowerBound,h.upperBound),0===l?s.copy(h):s.extend(h)}this.aabbNeedsUpdate=!1};var f=new a,d=new a;new a;n.prototype.updateInertiaWorld=function(e){var t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){var r=f,n=d;r.setRotationFromQuaternion(this.quaternion),r.transpose(n),r.scale(t,r),r.mmult(n,this.invInertiaWorld)}else;};var m=new o,v=new o;n.prototype.applyForce=function(e,t){if(this.type===n.DYNAMIC){var r=m;t.vsub(this.position,r);var i=v;r.cross(e,i),this.force.vadd(e,this.force),this.torque.vadd(i,this.torque)}};var g=new o,y=new o;n.prototype.applyLocalForce=function(e,t){if(this.type===n.DYNAMIC){var r=g,i=y;this.vectorToWorldFrame(e,r),this.pointToWorldFrame(t,i),this.applyForce(r,i)}};var x=new o,w=new o,b=new o;n.prototype.applyImpulse=function(e,t){if(this.type===n.DYNAMIC){var r=x;t.vsub(this.position,r);var i=w;i.copy(e),i.mult(this.invMass,i),this.velocity.vadd(i,this.velocity);var o=b;r.cross(e,o),this.invInertiaWorld.vmult(o,o),this.angularVelocity.vadd(o,this.angularVelocity)}};var _=new o,S=new o;n.prototype.applyLocalImpulse=function(e,t){if(this.type===n.DYNAMIC){var r=_,i=S;this.vectorToWorldFrame(e,r),this.pointToWorldFrame(t,i),this.applyImpulse(r,i)}};var M=new o;n.prototype.updateMassProperties=function(){var e=M;this.invMass=this.mass>0?1/this.mass:0;var t=this.inertia,r=this.fixedRotation;this.computeAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),l.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!r?1/t.x:0,t.y>0&&!r?1/t.y:0,t.z>0&&!r?1/t.z:0),this.updateInertiaWorld(!0)},n.prototype.getVelocityAtWorldPoint=function(e,t){var r=new o;return e.vsub(this.position,r),this.angularVelocity.cross(r,t),this.velocity.vadd(t,t),t}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(e,t,r){function n(e){this.chassisBody=e.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis="undefined"!=typeof e.indexRightAxis?e.indexRightAxis:1,this.indexForwardAxis="undefined"!=typeof e.indexForwardAxis?e.indexForwardAxis:0,this.indexUpAxis="undefined"!=typeof e.indexUpAxis?e.indexUpAxis:2}function i(e,t,r,n,i){var a=0,s=r,h=b,l=_,u=S;e.getVelocityAtWorldPoint(s,h),t.getVelocityAtWorldPoint(s,l),h.vsub(l,u);var c=n.dot(u),p=o(e,r,n),f=o(t,r,n),d=1,m=d/(p+f);return a=-c*m,a>i&&(a=i),-i>a&&(a=-i),a}function o(e,t,r){var n=M,i=E,o=T,a=C;return t.vsub(e.position,n),n.cross(r,i),e.invInertiaWorld.vmult(i,a),a.cross(n,o),e.invMass+r.dot(o)}function a(e,t,r,n,i,o){var a=i.norm2();if(a>1.1)return 0;var s=A,h=L,l=R;e.getVelocityAtWorldPoint(t,s),r.getVelocityAtWorldPoint(n,h),s.vsub(h,l);var u=i.dot(l),c=.2,p=1/(e.invMass+r.invMass),o=-c*u*p;return o}var s=(e("./Body"),e("../math/Vec3")),h=e("../math/Quaternion"),l=(e("../collision/RaycastResult"),e("../collision/Ray")),u=e("../objects/WheelInfo");t.exports=n;var c=(new s,new s,new s,new s),p=new s,f=new s;new l;n.prototype.addWheel=function(e){e=e||{};var t=new u(e),r=this.wheelInfos.length;return this.wheelInfos.push(t),r},n.prototype.setSteeringValue=function(e,t){var r=this.wheelInfos[t];r.steering=e};new s;n.prototype.applyEngineForce=function(e,t){this.wheelInfos[t].engineForce=e},n.prototype.setBrake=function(e,t){this.wheelInfos[t].brake=e},n.prototype.addToWorld=function(e){this.constraints;e.add(this.chassisBody);var t=this;this.preStepCallback=function(){t.updateVehicle(e.dt)},e.addEventListener("preStep",this.preStepCallback),this.world=e},n.prototype.getVehicleAxisWorld=function(e,t){t.set(0===e?1:0,1===e?1:0,2===e?1:0),this.chassisBody.vectorToWorldFrame(t,t)},n.prototype.updateVehicle=function(e){for(var t=this.wheelInfos,r=t.length,n=this.chassisBody,i=0;r>i;i++)this.updateWheelTransform(i);this.currentVehicleSpeedKmHour=3.6*n.velocity.norm();var o=new s;this.getVehicleAxisWorld(this.indexForwardAxis,o),o.dot(n.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var i=0;r>i;i++)this.castRay(t[i]);this.updateSuspension(e);for(var a=new s,h=new s,i=0;r>i;i++){var l=t[i],u=l.suspensionForce;u>l.maxSuspensionForce&&(u=l.maxSuspensionForce),l.raycastResult.hitNormalWorld.scale(u*e,a),l.raycastResult.hitPointWorld.vsub(n.position,h),n.applyImpulse(a,l.raycastResult.hitPointWorld)}this.updateFriction(e);var c=new s,p=new s,f=new s;for(i=0;r>i;i++){var l=t[i];n.getVelocityAtWorldPoint(l.chassisConnectionPointWorld,f);var d=1;switch(this.indexUpAxis){case 1:d=-1}if(l.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,p);var m=p.dot(l.raycastResult.hitNormalWorld);l.raycastResult.hitNormalWorld.scale(m,c),p.vsub(c,p);var v=p.dot(f);l.deltaRotation=d*v*e/l.radius}!l.sliding&&l.isInContact||0===l.engineForce||!l.useCustomSlidingRotationalSpeed||(l.deltaRotation=(l.engineForce>0?1:-1)*l.customSlidingRotationalSpeed*e),Math.abs(l.brake)>Math.abs(l.engineForce)&&(l.deltaRotation=0),l.rotation+=l.deltaRotation,l.deltaRotation*=.99}},n.prototype.updateSuspension=function(e){for(var t=this.chassisBody,r=t.mass,n=this.wheelInfos,i=n.length,o=0;i>o;o++){var a=n[o];if(a.isInContact){var s,h=a.suspensionRestLength,l=a.suspensionLength,u=h-l;s=a.suspensionStiffness*u*a.clippedInvContactDotSuspension;var c,p=a.suspensionRelativeVelocity;c=0>p?a.dampingCompression:a.dampingRelaxation,s-=c*p,a.suspensionForce=s*r,a.suspensionForce<0&&(a.suspensionForce=0)}else a.suspensionForce=0}},n.prototype.removeFromWorld=function(e){this.constraints;e.remove(this.chassisBody),e.removeEventListener("preStep",this.preStepCallback),this.world=null};var d=new s,m=new s;n.prototype.castRay=function(e){var t=d,r=m;this.updateWheelTransformWorld(e);var n=this.chassisBody,i=-1,o=e.suspensionRestLength+e.radius;e.directionWorld.scale(o,t);var a=e.chassisConnectionPointWorld;a.vadd(t,r);var h=e.raycastResult;h.reset();var l=n.collisionResponse;n.collisionResponse=!1,this.world.rayTest(a,r,h),n.collisionResponse=l;var u=h.body;if(e.raycastResult.groundObject=0,u){i=h.distance,e.raycastResult.hitNormalWorld=h.hitNormalWorld,e.isInContact=!0;var c=h.distance;e.suspensionLength=c-e.radius;var p=e.suspensionRestLength-e.maxSuspensionTravel,f=e.suspensionRestLength+e.maxSuspensionTravel;e.suspensionLength<p&&(e.suspensionLength=p),e.suspensionLength>f&&(e.suspensionLength=f,e.raycastResult.reset());var v=e.raycastResult.hitNormalWorld.dot(e.directionWorld),g=new s;n.getVelocityAtWorldPoint(e.raycastResult.hitPointWorld,g);var y=e.raycastResult.hitNormalWorld.dot(g);if(v>=-.1)e.suspensionRelativeVelocity=0,e.clippedInvContactDotSuspension=10;else{var x=-1/v;e.suspensionRelativeVelocity=y*x,e.clippedInvContactDotSuspension=x}}else e.suspensionLength=e.suspensionRestLength+0*e.maxSuspensionTravel,e.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.raycastResult.hitNormalWorld),e.clippedInvContactDotSuspension=1;return i},n.prototype.updateWheelTransformWorld=function(e){e.isInContact=!1;var t=this.chassisBody;t.pointToWorldFrame(e.chassisConnectionPointLocal,e.chassisConnectionPointWorld),t.vectorToWorldFrame(e.directionLocal,e.directionWorld),t.vectorToWorldFrame(e.axleLocal,e.axleWorld)},n.prototype.updateWheelTransform=function(e){var t=c,r=p,n=f,i=this.wheelInfos[e];this.updateWheelTransformWorld(i),i.directionLocal.scale(-1,t),r.copy(i.axleLocal),t.cross(r,n),n.normalize(),r.normalize();var o=i.steering,a=new h;a.setFromAxisAngle(t,o);var s=new h;s.setFromAxisAngle(r,i.rotation);var l=i.worldTransform.quaternion;this.chassisBody.quaternion.mult(a,l),l.mult(s,l),l.normalize();var u=i.worldTransform.position;u.copy(i.directionWorld),u.scale(i.suspensionLength,u),u.vadd(i.chassisConnectionPointWorld,u)};var v=[new s(1,0,0),new s(0,1,0),new s(0,0,1)];n.prototype.getWheelTransformWorld=function(e){return this.wheelInfos[e].worldTransform};var g=new s,y=[],x=[],w=1;n.prototype.updateFriction=function(e){for(var t=g,r=this.wheelInfos,n=r.length,o=this.chassisBody,h=x,l=y,u=0,c=0;n>c;c++){var p=r[c],f=p.raycastResult.body;f&&u++,p.sideImpulse=0,p.forwardImpulse=0,h[c]||(h[c]=new s),l[c]||(l[c]=new s)}for(var c=0;n>c;c++){var p=r[c],f=p.raycastResult.body;if(f){var d=l[c],m=this.getWheelTransformWorld(c);m.vectorToWorldFrame(v[this.indexRightAxis],d);var b=p.raycastResult.hitNormalWorld,_=d.dot(b);b.scale(_,t),d.vsub(t,d),d.normalize(),b.cross(d,h[c]),h[c].normalize(),p.sideImpulse=a(o,p.raycastResult.hitPointWorld,f,p.raycastResult.hitPointWorld,d),p.sideImpulse*=w}}var S=1,M=.5;this.sliding=!1;for(var c=0;n>c;c++){var p=r[c],f=p.raycastResult.body,E=0;if(p.slipInfo=1,f){var T=0,C=p.brake?p.brake:T;E=i(o,f,p.raycastResult.hitPointWorld,h[c],C),E+=p.engineForce*e;var A=C/E;p.slipInfo*=A}if(p.forwardImpulse=0,p.skidInfo=1,f){p.skidInfo=1;var L=p.suspensionForce*e*p.frictionSlip,R=L,P=L*R;p.forwardImpulse=E;var B=p.forwardImpulse*M,F=p.sideImpulse*S,k=B*B+F*F;if(p.sliding=!1,k>P){this.sliding=!0,p.sliding=!0;var A=L/Math.sqrt(k);p.skidInfo*=A}}}if(this.sliding)for(var c=0;n>c;c++){var p=r[c];0!==p.sideImpulse&&p.skidInfo<1&&(p.forwardImpulse*=p.skidInfo,p.sideImpulse*=p.skidInfo)}for(var c=0;n>c;c++){var p=r[c],D=new s;if(D.copy(p.raycastResult.hitPointWorld),0!==p.forwardImpulse){var U=new s;h[c].scale(p.forwardImpulse,U),o.applyImpulse(U,D)}if(0!==p.sideImpulse){var f=p.raycastResult.body,z=new s;z.copy(p.raycastResult.hitPointWorld);var V=new s;l[c].scale(p.sideImpulse,V),o.pointToLocalFrame(D,D),D["xyz"[this.indexUpAxis]]*=p.rollInfluence,o.pointToWorldFrame(D,D),o.applyImpulse(V,D),V.scale(-1,V),f.applyImpulse(V,z)}}};var b=new s,_=new s,S=new s,M=new s,E=new s,T=new s,C=new s,A=new s,L=new s,R=new s},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(e,t,r){function n(e){if(this.wheelBodies=[],this.coordinateSystem="undefined"==typeof e.coordinateSystem?new s(1,2,3):e.coordinateSystem.clone(),this.chassisBody=e.chassisBody,!this.chassisBody){var t=new a(new s(5,2,.5));this.chassisBody=new i(1,t)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}var i=e("./Body"),o=e("../shapes/Sphere"),a=e("../shapes/Box"),s=e("../math/Vec3"),h=e("../constraints/HingeConstraint");t.exports=n,n.prototype.addWheel=function(e){e=e||{};var t=e.body;t||(t=new i(1,new o(1.2))),this.wheelBodies.push(t),
this.wheelForces.push(0);var r=(new s,"undefined"!=typeof e.position?e.position.clone():new s),n=new s;this.chassisBody.pointToWorldFrame(r,n),t.position.set(n.x,n.y,n.z);var a="undefined"!=typeof e.axis?e.axis.clone():new s(0,1,0);this.wheelAxes.push(a);var l=new h(this.chassisBody,t,{pivotA:r,axisA:a,pivotB:s.ZERO,axisB:a,collideConnected:!1});return this.constraints.push(l),this.wheelBodies.length-1},n.prototype.setSteeringValue=function(e,t){var r=this.wheelAxes[t],n=Math.cos(e),i=Math.sin(e),o=r.x,a=r.y;this.constraints[t].axisA.set(n*o-i*a,i*o+n*a,0)},n.prototype.setMotorSpeed=function(e,t){var r=this.constraints[t];r.enableMotor(),r.motorTargetVelocity=e},n.prototype.disableMotor=function(e){var t=this.constraints[e];t.disableMotor()};var l=new s;n.prototype.setWheelForce=function(e,t){this.wheelForces[t]=e},n.prototype.applyWheelForce=function(e,t){var r=this.wheelAxes[t],n=this.wheelBodies[t],i=n.torque;r.scale(e,l),n.vectorToWorldFrame(l,l),i.vadd(l,i)},n.prototype.addToWorld=function(e){for(var t=this.constraints,r=this.wheelBodies.concat([this.chassisBody]),n=0;n<r.length;n++)e.add(r[n]);for(var n=0;n<t.length;n++)e.addConstraint(t[n]);e.addEventListener("preStep",this._update.bind(this))},n.prototype._update=function(){for(var e=this.wheelForces,t=0;t<e.length;t++)this.applyWheelForce(e[t],t)},n.prototype.removeFromWorld=function(e){for(var t=this.constraints,r=this.wheelBodies.concat([this.chassisBody]),n=0;n<r.length;n++)e.remove(r[n]);for(var n=0;n<t.length;n++)e.removeConstraint(t[n])};var u=new s;n.prototype.getWheelSpeed=function(e){var t=this.wheelAxes[e],r=this.wheelBodies[e],n=r.angularVelocity;return this.chassisBody.vectorToWorldFrame(t,u),n.dot(u)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(e,t,r){function n(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}t.exports=n;var i=(e("../shapes/Shape"),e("../math/Vec3"));e("../math/Quaternion"),e("../shapes/Particle"),e("../objects/Body"),e("../material/Material");n.prototype.add=function(e){this.particles.push(e),this.neighbors.length<this.particles.length&&this.neighbors.push([])},n.prototype.remove=function(e){var t=this.particles.indexOf(e);-1!==t&&(this.particles.splice(t,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var o=new i;n.prototype.getNeighbors=function(e,t){for(var r=this.particles.length,n=e.id,i=this.smoothingRadius*this.smoothingRadius,a=o,s=0;s!==r;s++){var h=this.particles[s];h.position.vsub(e.position,a),n!==h.id&&a.norm2()<i&&t.push(h)}};var a=new i,s=new i,h=new i,l=new i,u=new i,c=new i;n.prototype.update=function(){for(var e=this.particles.length,t=a,r=this.speedOfSound,n=this.eps,i=0;i!==e;i++){var o=this.particles[i],p=this.neighbors[i];p.length=0,this.getNeighbors(o,p),p.push(this.particles[i]);for(var f=p.length,d=0,m=0;m!==f;m++){o.position.vsub(p[m].position,t);var v=t.norm(),g=this.w(v);d+=p[m].mass*g}this.densities[i]=d,this.pressures[i]=r*r*(this.densities[i]-this.density)}for(var y=s,x=h,w=l,b=u,_=c,i=0;i!==e;i++){var S=this.particles[i];y.set(0,0,0),x.set(0,0,0);for(var M,E,p=this.neighbors[i],f=p.length,m=0;m!==f;m++){var T=p[m];S.position.vsub(T.position,b);var C=b.norm();M=-T.mass*(this.pressures[i]/(this.densities[i]*this.densities[i]+n)+this.pressures[m]/(this.densities[m]*this.densities[m]+n)),this.gradw(b,w),w.mult(M,w),y.vadd(w,y),T.velocity.vsub(S.velocity,_),_.mult(1/(1e-4+this.densities[i]*this.densities[m])*this.viscosity*T.mass,_),E=this.nablaw(C),_.mult(E,_),x.vadd(_,x)}x.mult(S.mass,x),y.mult(S.mass,y),S.force.vadd(x,S.force),S.force.vadd(y,S.force)}},n.prototype.w=function(e){var t=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(t,9))*Math.pow(t*t-e*e,3)},n.prototype.gradw=function(e,t){var r=e.norm(),n=this.smoothingRadius;e.mult(945/(32*Math.PI*Math.pow(n,9))*Math.pow(n*n-r*r,2),t)},n.prototype.nablaw=function(e){var t=this.smoothingRadius,r=945/(32*Math.PI*Math.pow(t,9))*(t*t-e*e)*(7*e*e-3*t*t);return r}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(e,t,r){function n(e,t,r){r=r||{},this.restLength="number"==typeof r.restLength?r.restLength:1,this.stiffness=r.stiffness||100,this.damping=r.damping||1,this.bodyA=e,this.bodyB=t,this.localAnchorA=new i,this.localAnchorB=new i,r.localAnchorA&&this.localAnchorA.copy(r.localAnchorA),r.localAnchorB&&this.localAnchorB.copy(r.localAnchorB),r.worldAnchorA&&this.setWorldAnchorA(r.worldAnchorA),r.worldAnchorB&&this.setWorldAnchorB(r.worldAnchorB)}var i=e("../math/Vec3");t.exports=n,n.prototype.setWorldAnchorA=function(e){this.bodyA.pointToLocalFrame(e,this.localAnchorA)},n.prototype.setWorldAnchorB=function(e){this.bodyB.pointToLocalFrame(e,this.localAnchorB)},n.prototype.getWorldAnchorA=function(e){this.bodyA.pointToWorldFrame(this.localAnchorA,e)},n.prototype.getWorldAnchorB=function(e){this.bodyB.pointToWorldFrame(this.localAnchorB,e)};var o=new i,a=new i,s=new i,h=new i,l=new i,u=new i,c=new i,p=new i,f=new i,d=new i,m=new i;n.prototype.applyForce=function(){var e=this.stiffness,t=this.damping,r=this.restLength,n=this.bodyA,i=this.bodyB,v=o,g=a,y=s,x=h,w=m,b=l,_=u,S=c,M=p,E=f,T=d;this.getWorldAnchorA(b),this.getWorldAnchorB(_),b.vsub(n.position,S),_.vsub(i.position,M),_.vsub(b,v);var C=v.norm();g.copy(v),g.normalize(),i.velocity.vsub(n.velocity,y),i.angularVelocity.cross(M,w),y.vadd(w,y),n.angularVelocity.cross(S,w),y.vsub(w,y),g.mult(-e*(C-r)-t*y.dot(g),x),n.force.vsub(x,n.force),i.force.vadd(x,i.force),S.cross(x,E),M.cross(x,T),n.torque.vsub(E,n.torque),i.torque.vadd(T,i.torque)}},{"../math/Vec3":30}],36:[function(e,t,r){function n(e){e=s.defaults(e,{chassisConnectionPointLocal:new i,chassisConnectionPointWorld:new i,directionLocal:new i,directionWorld:new i,axleLocal:new i,axleWorld:new i,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=e.maxSuspensionTravel,this.customSlidingRotationalSpeed=e.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=e.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=e.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=e.chassisConnectionPointWorld.clone(),this.directionLocal=e.directionLocal.clone(),this.directionWorld=e.directionWorld.clone(),this.axleLocal=e.axleLocal.clone(),this.axleWorld=e.axleWorld.clone(),this.suspensionRestLength=e.suspensionRestLength,this.suspensionMaxLength=e.suspensionMaxLength,this.radius=e.radius,this.suspensionStiffness=e.suspensionStiffness,this.dampingCompression=e.dampingCompression,this.dampingRelaxation=e.dampingRelaxation,this.frictionSlip=e.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=e.rollInfluence,this.maxSuspensionForce=e.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=e.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new a,this.worldTransform=new o,this.isInContact=!1}var i=e("../math/Vec3"),o=e("../math/Transform"),a=e("../collision/RaycastResult"),s=e("../utils/Utils");t.exports=n;var h=new i,l=new i,h=new i;n.prototype.updateWheel=function(e){var t=this.raycastResult;if(this.isInContact){var r=t.hitNormalWorld.dot(t.directionWorld);t.hitPointWorld.vsub(e.position,l),e.getVelocityAtWorldPoint(l,h);var n=t.hitNormalWorld.dot(h);if(r>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var i=-1/r;this.suspensionRelativeVelocity=n*i,this.clippedInvContactDotSuspension=i}}else t.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(e,t,r){function n(e){i.call(this),this.type=i.types.BOX,this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}t.exports=n;var i=e("./Shape"),o=e("../math/Vec3"),a=e("./ConvexPolyhedron");n.prototype=new i,n.prototype.constructor=n,n.prototype.updateConvexPolyhedronRepresentation=function(){var e=this.halfExtents.x,t=this.halfExtents.y,r=this.halfExtents.z,n=o,i=[new n(-e,-t,-r),new n(e,-t,-r),new n(e,t,-r),new n(-e,t,-r),new n(-e,-t,r),new n(e,-t,r),new n(e,t,r),new n(-e,t,r)],s=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],h=([new n(0,0,1),new n(0,1,0),new n(1,0,0)],new a(i,s));this.convexPolyhedronRepresentation=h,h.material=this.material},n.prototype.calculateLocalInertia=function(e,t){return t=t||new o,n.calculateInertia(this.halfExtents,e,t),t},n.calculateInertia=function(e,t,r){var n=e;r.x=1/12*t*(2*n.y*2*n.y+2*n.z*2*n.z),r.y=1/12*t*(2*n.x*2*n.x+2*n.z*2*n.z),r.z=1/12*t*(2*n.y*2*n.y+2*n.x*2*n.x)},n.prototype.getSideNormals=function(e,t){var r=e,n=this.halfExtents;if(r[0].set(n.x,0,0),r[1].set(0,n.y,0),r[2].set(0,0,n.z),r[3].set(-n.x,0,0),r[4].set(0,-n.y,0),r[5].set(0,0,-n.z),void 0!==t)for(var i=0;i!==r.length;i++)t.vmult(r[i],r[i]);return r},n.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var s=new o;new o;n.prototype.forEachWorldCorner=function(e,t,r){for(var n=this.halfExtents,i=[[n.x,n.y,n.z],[-n.x,n.y,n.z],[-n.x,-n.y,n.z],[-n.x,-n.y,-n.z],[n.x,-n.y,-n.z],[n.x,n.y,-n.z],[-n.x,n.y,-n.z],[n.x,-n.y,n.z]],o=0;o<i.length;o++)s.set(i[o][0],i[o][1],i[o][2]),t.vmult(s,s),e.vadd(s,s),r(s.x,s.y,s.z)};var h=[new o,new o,new o,new o,new o,new o,new o,new o];n.prototype.calculateWorldAABB=function(e,t,r,n){var i=this.halfExtents;h[0].set(i.x,i.y,i.z),h[1].set(-i.x,i.y,i.z),h[2].set(-i.x,-i.y,i.z),h[3].set(-i.x,-i.y,-i.z),h[4].set(i.x,-i.y,-i.z),h[5].set(i.x,i.y,-i.z),h[6].set(-i.x,i.y,-i.z),h[7].set(i.x,-i.y,i.z);var o=h[0];t.vmult(o,o),e.vadd(o,o),n.copy(o),r.copy(o);for(var a=1;8>a;a++){var o=h[a];t.vmult(o,o),e.vadd(o,o);var s=o.x,l=o.y,u=o.z;s>n.x&&(n.x=s),l>n.y&&(n.y=l),u>n.z&&(n.z=u),s<r.x&&(r.x=s),l<r.y&&(r.y=l),u<r.z&&(r.z=u)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(e,t,r){function n(e,t,r){i.call(this),this.type=i.types.CONVEXPOLYHEDRON,this.vertices=e||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=t||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=r?r.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}t.exports=n;var i=e("./Shape"),o=e("../math/Vec3"),a=(e("../math/Quaternion"),e("../math/Transform"));n.prototype=new i,n.prototype.constructor=n;var s=new o;n.prototype.computeEdges=function(){var e=this.faces,t=this.vertices,r=(t.length,this.uniqueEdges);r.length=0;for(var n=s,i=0;i!==e.length;i++)for(var o=e[i],a=o.length,h=0;h!==a;h++){var l=(h+1)%a;t[o[h]].vsub(t[o[l]],n),n.normalize();for(var u=!1,c=0;c!==r.length;c++)if(r[c].almostEquals(n)||r[c].almostEquals(n)){u=!0;break}u||r.push(n.clone())}},n.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var e=0;e<this.faces.length;e++){for(var t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error("Vertex "+this.faces[e][t]+" not found!");var r=this.faceNormals[e]||new o;this.getFaceNormal(e,r),r.negate(r),this.faceNormals[e]=r;var n=this.vertices[this.faces[e][0]];if(r.dot(n)<0){console.error(".faceNormals["+e+"] = Vec3("+r.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var t=0;t<this.faces[e].length;t++)console.warn(".vertices["+this.faces[e][t]+"] = Vec3("+this.vertices[this.faces[e][t]].toString()+")")}}};var h=new o,l=new o;n.computeNormal=function(e,t,r,n){t.vsub(e,l),r.vsub(t,h),h.cross(l,n),n.isZero()||n.normalize()},n.prototype.getFaceNormal=function(e,t){var r=this.faces[e],i=this.vertices[r[0]],o=this.vertices[r[1]],a=this.vertices[r[2]];return n.computeNormal(i,o,a,t)};var u=new o;n.prototype.clipAgainstHull=function(e,t,r,n,i,a,s,h,l){for(var c=u,p=-1,f=-Number.MAX_VALUE,d=0;d<r.faces.length;d++){c.copy(r.faceNormals[d]),i.vmult(c,c);var m=c.dot(a);m>f&&(f=m,p=d)}for(var v=[],g=r.faces[p],y=g.length,x=0;y>x;x++){var w=r.vertices[g[x]],b=new o;b.copy(w),i.vmult(b,b),n.vadd(b,b),v.push(b)}p>=0&&this.clipFaceAgainstHull(a,e,t,v,s,h,l)};var c=new o,p=new o,f=new o,d=new o,m=new o,v=new o;n.prototype.findSeparatingAxis=function(e,t,r,n,i,o,a,s){var h=c,l=p,u=f,g=d,y=m,x=v,w=Number.MAX_VALUE,b=this,_=0;if(b.uniqueAxes)for(var S=0;S!==b.uniqueAxes.length;S++){r.vmult(b.uniqueAxes[S],h);var M=b.testSepAxis(h,e,t,r,n,i);if(M===!1)return!1;w>M&&(w=M,o.copy(h))}else for(var E=a?a.length:b.faces.length,S=0;E>S;S++){var T=a?a[S]:S;h.copy(b.faceNormals[T]),r.vmult(h,h);var M=b.testSepAxis(h,e,t,r,n,i);if(M===!1)return!1;w>M&&(w=M,o.copy(h))}if(e.uniqueAxes)for(var S=0;S!==e.uniqueAxes.length;S++){i.vmult(e.uniqueAxes[S],l),_++;var M=b.testSepAxis(l,e,t,r,n,i);if(M===!1)return!1;w>M&&(w=M,o.copy(l))}else for(var C=s?s.length:e.faces.length,S=0;C>S;S++){var T=s?s[S]:S;l.copy(e.faceNormals[T]),i.vmult(l,l),_++;var M=b.testSepAxis(l,e,t,r,n,i);if(M===!1)return!1;w>M&&(w=M,o.copy(l))}for(var A=0;A!==b.uniqueEdges.length;A++){r.vmult(b.uniqueEdges[A],g);for(var L=0;L!==e.uniqueEdges.length;L++)if(i.vmult(e.uniqueEdges[L],y),g.cross(y,x),!x.almostZero()){x.normalize();var R=b.testSepAxis(x,e,t,r,n,i);if(R===!1)return!1;w>R&&(w=R,o.copy(x))}}return n.vsub(t,u),u.dot(o)>0&&o.negate(o),!0};var g=[],y=[];n.prototype.testSepAxis=function(e,t,r,i,o,a){var s=this;n.project(s,e,r,i,g),n.project(t,e,o,a,y);var h=g[0],l=g[1],u=y[0],c=y[1];if(c>h||l>u)return!1;var p=h-c,f=u-l,d=f>p?p:f;return d};var x=new o,w=new o;n.prototype.calculateLocalInertia=function(e,t){this.computeLocalAABB(x,w);var r=w.x-x.x,n=w.y-x.y,i=w.z-x.z;t.x=1/12*e*(2*n*2*n+2*i*2*i),t.y=1/12*e*(2*r*2*r+2*i*2*i),t.z=1/12*e*(2*n*2*n+2*r*2*r)},n.prototype.getPlaneConstantOfFace=function(e){var t=this.faces[e],r=this.faceNormals[e],n=this.vertices[t[0]],i=-r.dot(n);return i};var b=new o,_=new o,S=new o,M=new o,E=new o,T=new o,C=new o,A=new o;n.prototype.clipFaceAgainstHull=function(e,t,r,n,i,o,a){for(var s=b,h=_,l=S,u=M,c=E,p=T,f=C,d=A,m=this,v=[],g=n,y=v,x=-1,w=Number.MAX_VALUE,L=0;L<m.faces.length;L++){s.copy(m.faceNormals[L]),r.vmult(s,s);var R=s.dot(e);w>R&&(w=R,x=L)}if(!(0>x)){var P=m.faces[x];P.connectedFaces=[];for(var B=0;B<m.faces.length;B++)for(var F=0;F<m.faces[B].length;F++)-1!==P.indexOf(m.faces[B][F])&&B!==x&&-1===P.connectedFaces.indexOf(B)&&P.connectedFaces.push(B);for(var k=(g.length,P.length),D=0;k>D;D++){var U=m.vertices[P[D]],z=m.vertices[P[(D+1)%k]];U.vsub(z,h),l.copy(h),r.vmult(l,l),t.vadd(l,l),u.copy(this.faceNormals[x]),r.vmult(u,u),t.vadd(u,u),l.cross(u,c),c.negate(c),p.copy(U),r.vmult(p,p),t.vadd(p,p);var V,I=(-p.dot(c),P.connectedFaces[D]);f.copy(this.faceNormals[I]);var N=this.getPlaneConstantOfFace(I);d.copy(f),r.vmult(d,d);var V=N-d.dot(t);for(this.clipFaceAgainstPlane(g,y,d,V);g.length;)g.shift();for(;y.length;)g.push(y.shift())}f.copy(this.faceNormals[x]);var N=this.getPlaneConstantOfFace(x);d.copy(f),r.vmult(d,d);for(var V=N-d.dot(t),B=0;B<g.length;B++){var O=d.dot(g[B])+V;if(i>=O&&(console.log("clamped: depth="+O+" to minDist="+(i+"")),O=i),o>=O){var j=g[B];if(0>=O){var W={point:j,normal:d,depth:O};a.push(W)}}}}},n.prototype.clipFaceAgainstPlane=function(e,t,r,n){var i,a,s=e.length;if(2>s)return t;var h=e[e.length-1],l=e[0];i=r.dot(h)+n;for(var u=0;s>u;u++){if(l=e[u],a=r.dot(l)+n,0>i)if(0>a){var c=new o;c.copy(l),t.push(c)}else{var c=new o;h.lerp(l,i/(i-a),c),t.push(c)}else if(0>a){var c=new o;h.lerp(l,i/(i-a),c),t.push(c),t.push(l)}h=l,i=a}return t},n.prototype.computeWorldVertices=function(e,t){for(var r=this.vertices.length;this.worldVertices.length<r;)this.worldVertices.push(new o);for(var n=this.vertices,i=this.worldVertices,a=0;a!==r;a++)t.vmult(n[a],i[a]),e.vadd(i[a],i[a]);this.worldVerticesNeedsUpdate=!1};new o;n.prototype.computeLocalAABB=function(e,t){var r=this.vertices.length,n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var i=0;r>i;i++){var o=n[i];o.x<e.x?e.x=o.x:o.x>t.x&&(t.x=o.x),o.y<e.y?e.y=o.y:o.y>t.y&&(t.y=o.y),o.z<e.z?e.z=o.z:o.z>t.z&&(t.z=o.z)}},n.prototype.computeWorldFaceNormals=function(e){for(var t=this.faceNormals.length;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new o);for(var r=this.faceNormals,n=this.worldFaceNormals,i=0;i!==t;i++)e.vmult(r[i],n[i]);this.worldFaceNormalsNeedsUpdate=!1},n.prototype.updateBoundingSphereRadius=function(){for(var e=0,t=this.vertices,r=0,n=t.length;r!==n;r++){var i=t[r].norm2();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)};var L=new o;n.prototype.calculateWorldAABB=function(e,t,r,n){for(var i,o,a,s,h,l,u=this.vertices.length,c=this.vertices,p=0;u>p;p++){L.copy(c[p]),t.vmult(L,L),e.vadd(L,L);var f=L;f.x<i||void 0===i?i=f.x:(f.x>s||void 0===s)&&(s=f.x),f.y<o||void 0===o?o=f.y:(f.y>h||void 0===h)&&(h=f.y),f.z<a||void 0===a?a=f.z:(f.z>l||void 0===l)&&(l=f.z)}r.set(i,o,a),n.set(s,h,l)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.prototype.getAveragePointLocal=function(e){e=e||new o;for(var t=this.vertices.length,r=this.vertices,n=0;t>n;n++)e.vadd(r[n],e);return e.mult(1/t,e),e},n.prototype.transformAllPoints=function(e,t){var r=this.vertices.length,n=this.vertices;if(t){for(var i=0;r>i;i++){var o=n[i];t.vmult(o,o)}for(var i=0;i<this.faceNormals.length;i++){var o=this.faceNormals[i];t.vmult(o,o)}}if(e)for(var i=0;r>i;i++){var o=n[i];o.vadd(e,o)}};var R=new o,P=new o,B=new o;n.prototype.pointIsInside=function(e){var t=this.vertices.length,r=this.vertices,n=this.faces,i=this.faceNormals,o=null,a=this.faces.length,s=R;this.getAveragePointLocal(s);for(var h=0;a>h;h++){var t=(this.faces[h].length,i[h]),l=r[n[h][0]],u=P;e.vsub(l,u);var c=t.dot(u),p=B;s.vsub(l,p);var f=t.dot(p);if(0>c&&f>0||c>0&&0>f)return!1}return o?1:-1};var F=(new o,new o),k=new o;n.project=function(e,t,r,n,i){var o=e.vertices.length,s=F,h=0,l=0,u=k,c=e.vertices;u.setZero(),a.vectorToLocalFrame(r,n,t,s),a.pointToLocalFrame(r,n,u,u);var p=u.dot(s);l=h=c[0].dot(s);for(var f=1;o>f;f++){var d=c[f].dot(s);d>h&&(h=d),l>d&&(l=d)}if(l-=p,h-=p,l>h){var m=l;l=h,h=m}i[0]=h,i[1]=l}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(e,t,r){function n(e,t,r,n){var s=n,h=[],l=[],u=[],c=[],p=[],f=Math.cos,d=Math.sin;h.push(new o(t*f(0),t*d(0),.5*-r)),c.push(0),h.push(new o(e*f(0),e*d(0),.5*r)),p.push(1);for(var m=0;s>m;m++){var v=2*Math.PI/s*(m+1),g=2*Math.PI/s*(m+.5);s-1>m?(h.push(new o(t*f(v),t*d(v),.5*-r)),c.push(2*m+2),h.push(new o(e*f(v),e*d(v),.5*r)),p.push(2*m+3),u.push([2*m+2,2*m+3,2*m+1,2*m])):u.push([0,1,2*m+1,2*m]),(s%2===1||s/2>m)&&l.push(new o(f(g),d(g),0))}u.push(p),l.push(new o(0,0,1));for(var y=[],m=0;m<c.length;m++)y.push(c[c.length-m-1]);u.push(y),this.type=i.types.CONVEXPOLYHEDRON,a.call(this,h,u,l)}t.exports=n;var i=e("./Shape"),o=e("../math/Vec3"),a=(e("../math/Quaternion"),e("./ConvexPolyhedron"));n.prototype=new a},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(e,t,r){function n(e,t){t=s.defaults(t,{maxValue:null,minValue:null,elementSize:1}),this.data=e,this.maxValue=t.maxValue,this.minValue=t.minValue,this.elementSize=t.elementSize,null===t.minValue&&this.updateMinValue(),null===t.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,i.call(this),this.pillarConvex=new o,this.pillarOffset=new a,this.type=i.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}var i=e("./Shape"),o=e("./ConvexPolyhedron"),a=e("../math/Vec3"),s=e("../utils/Utils");t.exports=n,n.prototype=new i,n.prototype.update=function(){this._cachedPillars={}},n.prototype.updateMinValue=function(){for(var e=this.data,t=e[0][0],r=0;r!==e.length;r++)for(var n=0;n!==e[r].length;n++){var i=e[r][n];t>i&&(t=i)}this.minValue=t},n.prototype.updateMaxValue=function(){for(var e=this.data,t=e[0][0],r=0;r!==e.length;r++)for(var n=0;n!==e[r].length;n++){var i=e[r][n];i>t&&(t=i)}this.maxValue=t},n.prototype.setHeightValueAtIndex=function(e,t,r){var n=this.data;n[e][t]=r,this.clearCachedConvexTrianglePillar(e,t,!1),e>0&&(this.clearCachedConvexTrianglePillar(e-1,t,!0),this.clearCachedConvexTrianglePillar(e-1,t,!1)),t>0&&(this.clearCachedConvexTrianglePillar(e,t-1,!0),this.clearCachedConvexTrianglePillar(e,t-1,!1)),t>0&&e>0&&this.clearCachedConvexTrianglePillar(e-1,t-1,!0)},n.prototype.getRectMinMax=function(e,t,r,n,i){i=i||[];for(var o=this.data,a=this.minValue,s=e;r>=s;s++)for(var h=t;n>=h;h++){var l=o[s][h];l>a&&(a=l)}i[0]=this.minValue,i[1]=a},n.prototype.getIndexOfPosition=function(e,t,r,n){var i=this.elementSize,o=this.data,a=Math.floor(e/i),s=Math.floor(t/i);return r[0]=a,r[1]=s,n&&(0>a&&(a=0),0>s&&(s=0),a>=o.length-1&&(a=o.length-1),s>=o[0].length-1&&(s=o[0].length-1)),0>a||0>s||a>=o.length-1||s>=o[0].length-1?!1:!0},n.prototype.getHeightAt=function(e,t,r){var n=[];this.getIndexOfPosition(e,t,n,r);var i=[];return this.getRectMinMax(n[0],n[1]+1,n[0],n[1]+1,i),(i[0]+i[1])/2},n.prototype.getCacheConvexTrianglePillarKey=function(e,t,r){return e+"_"+t+"_"+(r?1:0)},n.prototype.getCachedConvexTrianglePillar=function(e,t,r){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,r)]},n.prototype.setCachedConvexTrianglePillar=function(e,t,r,n,i){this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,r)]={convex:n,offset:i}},n.prototype.clearCachedConvexTrianglePillar=function(e,t,r){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,r)]},n.prototype.getConvexTrianglePillar=function(e,t,r){var n=this.pillarConvex,i=this.pillarOffset;if(this.cacheEnabled){var s=this.getCachedConvexTrianglePillar(e,t,r);if(s)return this.pillarConvex=s.convex,void(this.pillarOffset=s.offset);n=new o,i=new a,this.pillarConvex=n,this.pillarOffset=i}var s=this.data,h=this.elementSize,l=n.faces;n.vertices.length=6;for(var u=0;6>u;u++)n.vertices[u]||(n.vertices[u]=new a);l.length=5;for(var u=0;5>u;u++)l[u]||(l[u]=[]);var c=n.vertices,p=(Math.min(s[e][t],s[e+1][t],s[e][t+1],s[e+1][t+1])-this.minValue)/2+this.minValue;r?(i.set((e+.75)*h,(t+.75)*h,p),c[0].set(.25*h,.25*h,s[e+1][t+1]-p),c[1].set(-.75*h,.25*h,s[e][t+1]-p),c[2].set(.25*h,-.75*h,s[e+1][t]-p),c[3].set(.25*h,.25*h,-p-1),c[4].set(-.75*h,.25*h,-p-1),c[5].set(.25*h,-.75*h,-p-1),l[0][0]=0,l[0][1]=1,l[0][2]=2,l[1][0]=5,l[1][1]=4,l[1][2]=3,l[2][0]=2,l[2][1]=5,l[2][2]=3,l[2][3]=0,l[3][0]=3,l[3][1]=4,l[3][2]=1,l[3][3]=0,l[4][0]=1,l[4][1]=4,l[4][2]=5,l[4][3]=2):(i.set((e+.25)*h,(t+.25)*h,p),c[0].set(-.25*h,-.25*h,s[e][t]-p),c[1].set(.75*h,-.25*h,s[e+1][t]-p),c[2].set(-.25*h,.75*h,s[e][t+1]-p),c[3].set(-.25*h,-.25*h,-p-1),c[4].set(.75*h,-.25*h,-p-1),c[5].set(-.25*h,.75*h,-p-1),l[0][0]=0,l[0][1]=1,l[0][2]=2,l[1][0]=5,l[1][1]=4,l[1][2]=3,l[2][0]=0,l[2][1]=2,l[2][2]=5,l[2][3]=3,l[3][0]=1,l[3][1]=0,l[3][2]=3,l[3][3]=4,l[4][0]=4,l[4][1]=5,l[4][2]=2,l[4][3]=1),n.computeNormals(),n.computeEdges(),n.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(e,t,r,n,i)},n.prototype.calculateLocalInertia=function(e,t){return t=t||new a,t.set(0,0,0),t},n.prototype.volume=function(){return Number.MAX_VALUE},n.prototype.calculateWorldAABB=function(e,t,r,n){r.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},n.prototype.updateBoundingSphereRadius=function(){var e=this.data,t=this.elementSize;this.boundingSphereRadius=new a(e.length*t,e[0].length*t,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(e,t,r){function n(){i.call(this),this.type=i.types.PARTICLE}t.exports=n;var i=e("./Shape"),o=e("../math/Vec3");n.prototype=new i,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(e,t){return t=t||new o,t.set(0,0,0),t},n.prototype.volume=function(){return 0},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},n.prototype.calculateWorldAABB=function(e,t,r,n){r.copy(e),n.copy(e)}},{"../math/Vec3":30,"./Shape":43}],42:[function(e,t,r){function n(){i.call(this),this.type=i.types.PLANE,this.worldNormal=new o,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}t.exports=n;var i=e("./Shape"),o=e("../math/Vec3");n.prototype=new i,n.prototype.constructor=n,n.prototype.computeWorldNormal=function(e){var t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1},n.prototype.calculateLocalInertia=function(e,t){return t=t||new o},n.prototype.volume=function(){return Number.MAX_VALUE};var a=new o;n.prototype.calculateWorldAABB=function(e,t,r,n){a.set(0,0,1),t.vmult(a,a);var i=Number.MAX_VALUE;r.set(-i,-i,-i),n.set(i,i,i),1===a.x&&(n.x=e.x),1===a.y&&(n.y=e.y),1===a.z&&(n.z=e.z),-1===a.x&&(r.x=e.x),-1===a.y&&(r.y=e.y),-1===a.z&&(r.z=e.z)},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(e,t,r){function n(){this.id=n.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}t.exports=n;var n=e("./Shape");e("../math/Vec3"),e("../math/Quaternion"),e("../material/Material");n.prototype.constructor=n,n.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},n.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},n.prototype.calculateLocalInertia=function(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type},n.idCounter=0,n.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(e,t,r){function n(e){if(i.call(this),this.radius=void 0!==e?Number(e):1,this.type=i.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}t.exports=n;var i=e("./Shape"),o=e("../math/Vec3");n.prototype=new i,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(e,t){t=t||new o;var r=2*e*this.radius*this.radius/5;return t.x=r,t.y=r,t.z=r,t},n.prototype.volume=function(){return 4*Math.PI*this.radius/3},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},n.prototype.calculateWorldAABB=function(e,t,r,n){for(var i=this.radius,o=["x","y","z"],a=0;a<o.length;a++){var s=o[a];r[s]=e[s]-i,n[s]=e[s]+i}}},{"../math/Vec3":30,"./Shape":43}],45:[function(e,t,r){function n(e,t){i.call(this),this.type=i.types.TRIMESH,this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new s,this.edges=null,this.scale=new o(1,1,1),this.tree=new h,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}t.exports=n;var i=e("./Shape"),o=e("../math/Vec3"),a=(e("../math/Quaternion"),e("../math/Transform")),s=e("../collision/AABB"),h=e("../utils/Octree");n.prototype=new i,n.prototype.constructor=n;var l=new o;n.prototype.updateTree=function(){var e=this.tree;e.reset(),e.aabb.copy(this.aabb);var t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;for(var r=new s,n=new o,i=new o,a=new o,h=[n,i,a],l=0;l<this.indices.length/3;l++){var u=3*l;this._getUnscaledVertex(this.indices[u],n),this._getUnscaledVertex(this.indices[u+1],i),this._getUnscaledVertex(this.indices[u+2],a),r.setFromPoints(h),e.insert(r,l)}e.removeEmptyNodes()};var u=new s;n.prototype.getTrianglesInAABB=function(e,t){u.copy(e);var r=this.scale,n=r.x,i=r.y,o=r.z,a=u.lowerBound,s=u.upperBound;return a.x/=n,a.y/=i,a.z/=o,s.x/=n,s.y/=i,s.z/=o,this.tree.aabbQuery(u,t)},n.prototype.setScale=function(e){var t=this.scale.x===this.scale.y===this.scale.z,r=e.x===e.y===e.z;t&&r||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()},n.prototype.updateNormals=function(){for(var e=l,t=this.normals,r=0;r<this.indices.length/3;r++){var i=3*r,o=this.indices[i],a=this.indices[i+1],s=this.indices[i+2];this.getVertex(o,m),this.getVertex(a,v),this.getVertex(s,g),n.computeNormal(v,m,g,e),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z}},n.prototype.updateEdges=function(){for(var e={},t=function(t,r){var n=o>i?i+"_"+o:o+"_"+i;e[n]=!0},r=0;r<this.indices.length/3;r++){var n=3*r,i=this.indices[n],o=this.indices[n+1],a=this.indices[n+2];t(i,o),t(o,a),t(a,i)}var s=Object.keys(e);this.edges=new Int16Array(2*s.length);for(var r=0;r<s.length;r++){var h=s[r].split("_");this.edges[2*r]=parseInt(h[0],10),this.edges[2*r+1]=parseInt(h[1],10)}},n.prototype.getEdgeVertex=function(e,t,r){var n=this.edges[2*e+(t?1:0)];this.getVertex(n,r)};var c=new o,p=new o;n.prototype.getEdgeVector=function(e,t){var r=c,n=p;this.getEdgeVertex(e,0,r),this.getEdgeVertex(e,1,n),n.vsub(r,t)};var f=new o,d=new o;n.computeNormal=function(e,t,r,n){t.vsub(e,d),r.vsub(t,f),f.cross(d,n),n.isZero()||n.normalize()};var m=new o,v=new o,g=new o;n.prototype.getVertex=function(e,t){var r=this.scale;return this._getUnscaledVertex(e,t),t.x*=r.x,t.y*=r.y,t.z*=r.z,t},n.prototype._getUnscaledVertex=function(e,t){var r=3*e,n=this.vertices;return t.set(n[r],n[r+1],n[r+2])},n.prototype.getWorldVertex=function(e,t,r,n){return this.getVertex(e,n),a.pointToWorldFrame(t,r,n,n),n},n.prototype.getTriangleVertices=function(e,t,r,n){var i=3*e;this.getVertex(this.indices[i],t),this.getVertex(this.indices[i+1],r),this.getVertex(this.indices[i+2],n)},n.prototype.getNormal=function(e,t){var r=3*e;return t.set(this.normals[r],this.normals[r+1],this.normals[r+2])};var y=new s;n.prototype.calculateLocalInertia=function(e,t){this.computeLocalAABB(y);var r=y.upperBound.x-y.lowerBound.x,n=y.upperBound.y-y.lowerBound.y,i=y.upperBound.z-y.lowerBound.z;return t.set(1/12*e*(2*n*2*n+2*i*2*i),1/12*e*(2*r*2*r+2*i*2*i),1/12*e*(2*n*2*n+2*r*2*r))};var x=new o;n.prototype.computeLocalAABB=function(e){var t=e.lowerBound,r=e.upperBound,n=this.vertices.length,i=(this.vertices,x);this.getVertex(0,i),t.copy(i),r.copy(i);for(var o=0;o!==n;o++)this.getVertex(o,i),i.x<t.x?t.x=i.x:i.x>r.x&&(r.x=i.x),i.y<t.y?t.y=i.y:i.y>r.y&&(r.y=i.y),i.z<t.z?t.z=i.z:i.z>r.z&&(r.z=i.z)},n.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},n.prototype.updateBoundingSphereRadius=function(){for(var e=0,t=this.vertices,r=new o,n=0,i=t.length/3;n!==i;n++){this.getVertex(n,r);var a=r.norm2();a>e&&(e=a)}this.boundingSphereRadius=Math.sqrt(e)};var w=(new o,new a),b=new s;n.prototype.calculateWorldAABB=function(e,t,r,n){var i=w,o=b;i.position=e,i.quaternion=t,this.aabb.toWorldFrame(i,o),r.copy(o.lowerBound),n.copy(o.upperBound)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.createTorus=function(e,t,r,i,o){e=e||1,t=t||.5,r=r||8,i=i||6,o=o||2*Math.PI;for(var a=[],s=[],h=0;r>=h;h++)for(var l=0;i>=l;l++){var u=l/i*o,c=h/r*Math.PI*2,p=(e+t*Math.cos(c))*Math.cos(u),f=(e+t*Math.cos(c))*Math.sin(u),d=t*Math.sin(c);
a.push(p,f,d)}for(var h=1;r>=h;h++)for(var l=1;i>=l;l++){var m=(i+1)*h+l-1,v=(i+1)*(h-1)+l-1,g=(i+1)*(h-1)+l,y=(i+1)*h+l;s.push(m,v,y),s.push(v,g,y)}return new n(a,s)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(e,t,r){function n(){i.call(this),this.iterations=10,this.tolerance=1e-7}t.exports=n;var i=(e("../math/Vec3"),e("../math/Quaternion"),e("./Solver"));n.prototype=new i;var o=[],a=[],s=[];n.prototype.solve=function(e,t){var r,n,i,h,l,u,c=0,p=this.iterations,f=this.tolerance*this.tolerance,d=this.equations,m=d.length,v=t.bodies,g=v.length,y=e;if(0!==m)for(var x=0;x!==g;x++)v[x].updateSolveMassProperties();var w=a,b=s,_=o;w.length=m,b.length=m,_.length=m;for(var x=0;x!==m;x++){var S=d[x];_[x]=0,b[x]=S.computeB(y),w[x]=1/S.computeC()}if(0!==m){for(var x=0;x!==g;x++){var M=v[x],E=M.vlambda,T=M.wlambda;E.set(0,0,0),T&&T.set(0,0,0)}for(c=0;c!==p;c++){h=0;for(var C=0;C!==m;C++){var S=d[C];r=b[C],n=w[C],u=_[C],l=S.computeGWlambda(),i=n*(r-l-S.eps*u),u+i<S.minForce?i=S.minForce-u:u+i>S.maxForce&&(i=S.maxForce-u),_[C]+=i,h+=i>0?i:-i,S.addToWlambda(i)}if(f>h*h)break}for(var x=0;x!==g;x++){var M=v[x],A=M.velocity,L=M.angularVelocity;A.vadd(M.vlambda,A),L&&L.vadd(M.wlambda,L)}}return c}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(e,t,r){function n(){this.equations=[]}t.exports=n,n.prototype.solve=function(e,t){return 0},n.prototype.addEquation=function(e){e.enabled&&this.equations.push(e)},n.prototype.removeEquation=function(e){var t=this.equations,r=t.indexOf(e);-1!==r&&t.splice(r,1)},n.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(e,t,r){function n(e){for(h.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=e,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}function i(e){for(var t=e.length,r=0;r!==t;r++){var n=e[r];if(!(n.visited||n.body.type&f))return n}return!1}function o(e,t,r,n){for(d.push(e),e.visited=!0,t(e,r,n);d.length;)for(var o,a=d.pop();o=i(a.children);)o.visited=!0,t(o,r,n),d.push(o)}function a(e,t,r){t.push(e.body);for(var n=e.eqs.length,i=0;i!==n;i++){var o=e.eqs[i];-1===r.indexOf(o)&&r.push(o)}}function s(e,t){return t.id-e.id}t.exports=n;var h=(e("../math/Vec3"),e("../math/Quaternion"),e("./Solver")),l=e("../objects/Body");n.prototype=new h;var u=[],c=[],p={bodies:[]},f=l.STATIC,d=[];n.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},n.prototype.solve=function(e,t){for(var r=u,n=this.nodePool,h=t.bodies,l=this.equations,f=l.length,d=h.length,m=this.subsolver;n.length<d;)n.push(this.createNode());r.length=d;for(var v=0;d>v;v++)r[v]=n[v];for(var v=0;v!==d;v++){var g=r[v];g.body=h[v],g.children.length=0,g.eqs.length=0,g.visited=!1}for(var y=0;y!==f;y++){var x=l[y],v=h.indexOf(x.bi),w=h.indexOf(x.bj),b=r[v],_=r[w];b.children.push(_),b.eqs.push(x),_.children.push(b),_.eqs.push(x)}var S,M=0,E=c;m.tolerance=this.tolerance,m.iterations=this.iterations;for(var T=p;S=i(r);){E.length=0,T.bodies.length=0,o(S,a,T.bodies,E);var C=E.length;E=E.sort(s);for(var v=0;v!==C;v++)m.addEquation(E[v]);m.solve(e,T);m.removeAllEquations(),M++}return M}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(e,t,r){var n=function(){};t.exports=n,n.prototype={constructor:n,addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;return void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t),this},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0===this._listeners)return this;var r=this._listeners;if(void 0===r[e])return this;var n=r[e].indexOf(t);return-1!==n&&r[e].splice(n,1),this},dispatchEvent:function(e){if(void 0===this._listeners)return this;var t=this._listeners,r=t[e.type];if(void 0!==r){e.target=this;for(var n=0,i=r.length;i>n;n++)r[n].call(this,e)}return this}}},{}],50:[function(e,t,r){function n(e){e=e||{},this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new o,this.data=[],this.children=[]}function i(e,t){t=t||{},t.root=null,t.aabb=e,n.call(this,t),this.maxDepth="undefined"!=typeof t.maxDepth?t.maxDepth:8}var o=e("../collision/AABB"),a=e("../math/Vec3");t.exports=i,i.prototype=new n,n.prototype.reset=function(e,t){this.children.length=this.data.length=0},n.prototype.insert=function(e,t,r){var n=this.data;if(r=r||0,!this.aabb.contains(e))return!1;var i=this.children;if(r<(this.maxDepth||this.root.maxDepth)){var o=!1;i.length||(this.subdivide(),o=!0);for(var a=0;8!==a;a++)if(i[a].insert(e,t,r+1))return!0;o&&(i.length=0)}return n.push(t),!0};var s=new a;n.prototype.subdivide=function(){var e=this.aabb,t=e.lowerBound,r=e.upperBound,i=this.children;i.push(new n({aabb:new o({lowerBound:new a(0,0,0)})}),new n({aabb:new o({lowerBound:new a(1,0,0)})}),new n({aabb:new o({lowerBound:new a(1,1,0)})}),new n({aabb:new o({lowerBound:new a(1,1,1)})}),new n({aabb:new o({lowerBound:new a(0,1,1)})}),new n({aabb:new o({lowerBound:new a(0,0,1)})}),new n({aabb:new o({lowerBound:new a(1,0,1)})}),new n({aabb:new o({lowerBound:new a(0,1,0)})})),r.vsub(t,s),s.scale(.5,s);for(var h=this.root||this,l=0;8!==l;l++){var u=i[l];u.root=h;var c=u.aabb.lowerBound;c.x*=s.x,c.y*=s.y,c.z*=s.z,c.vadd(t,c),c.vadd(s,u.aabb.upperBound)}},n.prototype.aabbQuery=function(e,t){for(var r=(this.data,this.children,[this]);r.length;){var n=r.pop();n.aabb.overlaps(e)&&Array.prototype.push.apply(t,n.data),Array.prototype.push.apply(r,n.children)}return t};var h=new o;n.prototype.rayQuery=function(e,t,r){return e.getAABB(h),h.toLocalFrame(t,h),this.aabbQuery(h,r),r},n.prototype.removeEmptyNodes=function(){for(var e=[this];e.length;){for(var t=e.pop(),r=t.children.length-1;r>=0;r--)t.children[r].data.length||t.children.splice(r,1);Array.prototype.push.apply(e,t.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(e,t,r){function n(){this.objects=[],this.type=Object}t.exports=n,n.prototype.release=function(){for(var e=arguments.length,t=0;t!==e;t++)this.objects.push(arguments[t])},n.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},n.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(e,t,r){function n(){this.data={keys:[]}}t.exports=n,n.prototype.get=function(e,t){if(e>t){var r=t;t=e,e=r}return this.data[e+"-"+t]},n.prototype.set=function(e,t,r){if(e>t){var n=t;t=e,e=n}var i=e+"-"+t;this.get(e,t)||this.data.keys.push(i),this.data[i]=r},n.prototype.reset=function(){for(var e=this.data,t=e.keys;t.length>0;){var r=t.pop();delete e[r]}}},{}],53:[function(e,t,r){function n(){}t.exports=n,n.defaults=function(e,t){e=e||{};for(var r in t)r in e||(e[r]=t[r]);return e}},{}],54:[function(e,t,r){function n(){o.call(this),this.type=i}t.exports=n;var i=e("../math/Vec3"),o=e("./Pool");n.prototype=new o,n.prototype.constructObject=function(){return new i}},{"../math/Vec3":30,"./Pool":51}],55:[function(e,t,r){function n(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new c,this.world=e,this.currentContactMaterial=null,this.enableFrictionReduction=!1}function i(e,t,r){for(var n=null,i=e.length,o=0;o!==i;o++){var a=e[o],s=O;e[(o+1)%i].vsub(a,s);var h=j;s.cross(t,h);var l=W;r.vsub(a,l);var u=h.dot(l);if(!(null===n||u>0&&n===!0||0>=u&&n===!1))return!1;null===n&&(n=u>0)}return!0}t.exports=n;var o=e("../collision/AABB"),a=e("../shapes/Shape"),s=e("../collision/Ray"),h=e("../math/Vec3"),l=e("../math/Transform"),u=(e("../shapes/ConvexPolyhedron"),e("../math/Quaternion")),c=(e("../solver/Solver"),e("../utils/Vec3Pool")),p=e("../equations/ContactEquation"),f=e("../equations/FrictionEquation");n.prototype.createContactEquation=function(e,t,r,n,i,o){var a;this.contactPointPool.length?(a=this.contactPointPool.pop(),a.bi=e,a.bj=t):a=new p(e,t),a.enabled=e.collisionResponse&&t.collisionResponse&&r.collisionResponse&&n.collisionResponse;var s=this.currentContactMaterial;a.restitution=s.restitution,a.setSpookParams(s.contactEquationStiffness,s.contactEquationRelaxation,this.world.dt);var h=r.material||e.material,l=n.material||t.material;return h&&l&&h.restitution>=0&&l.restitution>=0&&(a.restitution=h.restitution*l.restitution),a.si=i||r,a.sj=o||n,a},n.prototype.createFrictionEquationsFromContact=function(e,t){var r=e.bi,n=e.bj,i=e.si,o=e.sj,a=this.world,s=this.currentContactMaterial,h=s.friction,l=i.material||r.material,u=o.material||n.material;if(l&&u&&l.friction>=0&&u.friction>=0&&(h=l.friction*u.friction),h>0){var c=h*a.gravity.length(),p=r.invMass+n.invMass;p>0&&(p=1/p);var d=this.frictionEquationPool,m=d.length?d.pop():new f(r,n,c*p),v=d.length?d.pop():new f(r,n,c*p);return m.bi=v.bi=r,m.bj=v.bj=n,m.minForce=v.minForce=-c*p,m.maxForce=v.maxForce=c*p,m.ri.copy(e.ri),m.rj.copy(e.rj),v.ri.copy(e.ri),v.rj.copy(e.rj),e.ni.tangents(m.t,v.t),m.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),v.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),m.enabled=v.enabled=e.enabled,t.push(m,v),!0}return!1};var d=new h,m=new h,v=new h;n.prototype.createFrictionFromAverage=function(e){var t=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(t,this.frictionResult)&&1!==e){var r=this.frictionResult[this.frictionResult.length-2],n=this.frictionResult[this.frictionResult.length-1];d.setZero(),m.setZero(),v.setZero();for(var i=t.bi,o=(t.bj,0);o!==e;o++)t=this.result[this.result.length-1-o],t.bodyA!==i?(d.vadd(t.ni,d),m.vadd(t.ri,m),v.vadd(t.rj,v)):(d.vsub(t.ni,d),m.vadd(t.rj,m),v.vadd(t.ri,v));var a=1/e;m.scale(a,r.ri),v.scale(a,r.rj),n.ri.copy(r.ri),n.rj.copy(r.rj),d.normalize(),d.tangents(r.t,n.t)}};var g=new h,y=new h,x=new u,w=new u;n.prototype.getContacts=function(e,t,r,n,i,o,a){this.contactPointPool=i,this.frictionEquationPool=a,this.result=n,this.frictionResult=o;for(var s=x,h=w,l=g,u=y,c=0,p=e.length;c!==p;c++){var f=e[c],d=t[c],m=null;f.material&&d.material&&(m=r.getContactMaterial(f.material,d.material)||null);for(var v=0;v<f.shapes.length;v++){f.quaternion.mult(f.shapeOrientations[v],s),f.quaternion.vmult(f.shapeOffsets[v],l),l.vadd(f.position,l);for(var b=f.shapes[v],_=0;_<d.shapes.length;_++){d.quaternion.mult(d.shapeOrientations[_],h),d.quaternion.vmult(d.shapeOffsets[_],u),u.vadd(d.position,u);var S=d.shapes[_];if(!(l.distanceTo(u)>b.boundingSphereRadius+S.boundingSphereRadius)){var M=null;b.material&&S.material&&(M=r.getContactMaterial(b.material,S.material)||null),this.currentContactMaterial=M||m||r.defaultContactMaterial;var E=this[b.type|S.type];E&&(b.type<S.type?E.call(this,b,S,l,u,s,h,f,d,b,S):E.call(this,S,b,u,l,h,s,d,f,b,S))}}}}};n.prototype[a.types.BOX|a.types.BOX]=n.prototype.boxBox=function(e,t,r,n,i,o,a,s){e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,r,n,i,o,a,s,e,t)},n.prototype[a.types.BOX|a.types.CONVEXPOLYHEDRON]=n.prototype.boxConvex=function(e,t,r,n,i,o,a,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,r,n,i,o,a,s,e,t)},n.prototype[a.types.BOX|a.types.PARTICLE]=n.prototype.boxParticle=function(e,t,r,n,i,o,a,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,r,n,i,o,a,s,e,t)},n.prototype[a.types.SPHERE]=n.prototype.sphereSphere=function(e,t,r,n,i,o,a,s){var h=this.createContactEquation(a,s,e,t);n.vsub(r,h.ni),h.ni.normalize(),h.ri.copy(h.ni),h.rj.copy(h.ni),h.ri.mult(e.radius,h.ri),h.rj.mult(-t.radius,h.rj),h.ri.vadd(r,h.ri),h.ri.vsub(a.position,h.ri),h.rj.vadd(n,h.rj),h.rj.vsub(s.position,h.rj),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)};var b=new h,_=new h,S=new h;n.prototype[a.types.PLANE|a.types.TRIMESH]=n.prototype.planeTrimesh=function(e,t,r,n,i,o,a,s){var u=new h,c=b;c.set(0,0,1),i.vmult(c,c);for(var p=0;p<t.vertices.length/3;p++){t.getVertex(p,u);var f=new h;f.copy(u),l.pointToWorldFrame(n,o,f,u);var d=_;u.vsub(r,d);var m=c.dot(d);if(0>=m){var v=this.createContactEquation(a,s,e,t);v.ni.copy(c);var g=S;c.scale(d.dot(c),g),u.vsub(g,g),v.ri.copy(g),v.ri.vsub(a.position,v.ri),v.rj.copy(u),v.rj.vsub(s.position,v.rj),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}};var M=new h,E=new h,T=(new h,new h),C=new h,A=new h,L=new h,R=new h,P=new h,B=new h,F=new h,k=new h,D=new h,U=new h,z=new o,V=[];n.prototype[a.types.SPHERE|a.types.TRIMESH]=n.prototype.sphereTrimesh=function(e,t,r,n,i,o,a,h){var u=A,c=L,p=R,f=P,d=B,m=F,v=z,g=C,y=E,x=V;l.pointToLocalFrame(n,o,r,d);var w=e.radius;v.lowerBound.set(d.x-w,d.y-w,d.z-w),v.upperBound.set(d.x+w,d.y+w,d.z+w),t.getTrianglesInAABB(v,x);for(var b=T,_=e.radius*e.radius,S=0;S<x.length;S++)for(var I=0;3>I;I++)if(t.getVertex(t.indices[3*x[S]+I],b),b.vsub(d,y),y.norm2()<=_){g.copy(b),l.pointToWorldFrame(n,o,g,b),b.vsub(r,y);var N=this.createContactEquation(a,h,e,t);N.ni.copy(y),N.ni.normalize(),N.ri.copy(N.ni),N.ri.scale(e.radius,N.ri),N.ri.vadd(r,N.ri),N.ri.vsub(a.position,N.ri),N.rj.copy(b),N.rj.vsub(h.position,N.rj),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult)}for(var S=0;S<x.length;S++)for(var I=0;3>I;I++){t.getVertex(t.indices[3*x[S]+I],u),t.getVertex(t.indices[3*x[S]+(I+1)%3],c),c.vsub(u,p),d.vsub(c,m);var O=m.dot(p);d.vsub(u,m);var j=m.dot(p);if(j>0&&0>O){d.vsub(u,m),f.copy(p),f.normalize(),j=m.dot(f),f.scale(j,m),m.vadd(u,m);var W=m.distanceTo(d);if(W<e.radius){var N=this.createContactEquation(a,h,e,t);m.vsub(d,N.ni),N.ni.normalize(),N.ni.scale(e.radius,N.ri),l.pointToWorldFrame(n,o,m,m),m.vsub(h.position,N.rj),l.vectorToWorldFrame(o,N.ni,N.ni),l.vectorToWorldFrame(o,N.ri,N.ri),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult)}}}for(var H=k,G=D,q=U,X=M,S=0,Y=x.length;S!==Y;S++){t.getTriangleVertices(x[S],H,G,q),t.getNormal(x[S],X),d.vsub(H,m);var W=m.dot(X);if(X.scale(W,m),d.vsub(m,m),W=m.distanceTo(d),s.pointInTriangle(m,H,G,q)&&W<e.radius){var N=this.createContactEquation(a,h,e,t);m.vsub(d,N.ni),N.ni.normalize(),N.ni.scale(e.radius,N.ri),l.pointToWorldFrame(n,o,m,m),m.vsub(h.position,N.rj),l.vectorToWorldFrame(o,N.ni,N.ni),l.vectorToWorldFrame(o,N.ri,N.ri),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult)}}x.length=0};var I=new h,N=new h;n.prototype[a.types.SPHERE|a.types.PLANE]=n.prototype.spherePlane=function(e,t,r,n,i,o,a,s){var h=this.createContactEquation(a,s,e,t);if(h.ni.set(0,0,1),o.vmult(h.ni,h.ni),h.ni.negate(h.ni),h.ni.normalize(),h.ni.mult(e.radius,h.ri),r.vsub(n,I),h.ni.mult(h.ni.dot(I),N),I.vsub(N,h.rj),-I.dot(h.ni)<=e.radius){var l=h.ri,u=h.rj;l.vadd(r,l),l.vsub(a.position,l),u.vadd(n,u),u.vsub(s.position,u),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}};var O=new h,j=new h,W=new h,H=new h,G=new h,q=new h,X=new h,Y=[new h,new h,new h,new h,new h,new h],K=new h,Q=new h,Z=new h,J=new h;n.prototype[a.types.SPHERE|a.types.BOX]=n.prototype.sphereBox=function(e,t,r,n,i,o,a,s){var h=this.v3pool,l=Y;r.vsub(n,H),t.getSideNormals(l,o);for(var u=e.radius,c=!1,p=Q,f=Z,d=J,m=null,v=0,g=0,y=0,x=null,w=0,b=l.length;w!==b&&c===!1;w++){var _=G;_.copy(l[w]);var S=_.norm();_.normalize();var M=H.dot(_);if(S+u>M&&M>0){var E=q,T=X;E.copy(l[(w+1)%3]),T.copy(l[(w+2)%3]);var C=E.norm(),A=T.norm();E.normalize(),T.normalize();var L=H.dot(E),R=H.dot(T);if(C>L&&L>-C&&A>R&&R>-A){var P=Math.abs(M-S-u);(null===x||x>P)&&(x=P,g=L,y=R,m=S,p.copy(_),f.copy(E),d.copy(T),v++)}}}if(v){c=!0;var B=this.createContactEquation(a,s,e,t);p.mult(-u,B.ri),B.ni.copy(p),B.ni.negate(B.ni),p.mult(m,p),f.mult(g,f),p.vadd(f,p),d.mult(y,d),p.vadd(d,B.rj),B.ri.vadd(r,B.ri),B.ri.vsub(a.position,B.ri),B.rj.vadd(n,B.rj),B.rj.vsub(s.position,B.rj),this.result.push(B),this.createFrictionEquationsFromContact(B,this.frictionResult)}for(var F=h.get(),k=K,D=0;2!==D&&!c;D++)for(var U=0;2!==U&&!c;U++)for(var z=0;2!==z&&!c;z++)if(F.set(0,0,0),D?F.vadd(l[0],F):F.vsub(l[0],F),U?F.vadd(l[1],F):F.vsub(l[1],F),z?F.vadd(l[2],F):F.vsub(l[2],F),n.vadd(F,k),k.vsub(r,k),k.norm2()<u*u){c=!0;var B=this.createContactEquation(a,s,e,t);B.ri.copy(k),B.ri.normalize(),B.ni.copy(B.ri),B.ri.mult(u,B.ri),B.rj.copy(F),B.ri.vadd(r,B.ri),B.ri.vsub(a.position,B.ri),B.rj.vadd(n,B.rj),B.rj.vsub(s.position,B.rj),this.result.push(B),this.createFrictionEquationsFromContact(B,this.frictionResult)}h.release(F),F=null;for(var V=h.get(),I=h.get(),B=h.get(),N=h.get(),P=h.get(),O=l.length,D=0;D!==O&&!c;D++)for(var U=0;U!==O&&!c;U++)if(D%3!==U%3){l[U].cross(l[D],V),V.normalize(),l[D].vadd(l[U],I),B.copy(r),B.vsub(I,B),B.vsub(n,B);var j=B.dot(V);V.mult(j,N);for(var z=0;z===D%3||z===U%3;)z++;P.copy(r),P.vsub(N,P),P.vsub(I,P),P.vsub(n,P);var W=Math.abs(j),$=P.norm();if(W<l[z].norm()&&u>$){c=!0;var ee=this.createContactEquation(a,s,e,t);I.vadd(N,ee.rj),ee.rj.copy(ee.rj),P.negate(ee.ni),ee.ni.normalize(),ee.ri.copy(ee.rj),ee.ri.vadd(n,ee.ri),ee.ri.vsub(r,ee.ri),ee.ri.normalize(),ee.ri.mult(u,ee.ri),ee.ri.vadd(r,ee.ri),ee.ri.vsub(a.position,ee.ri),ee.rj.vadd(n,ee.rj),ee.rj.vsub(s.position,ee.rj),this.result.push(ee),this.createFrictionEquationsFromContact(ee,this.frictionResult)}}h.release(V,I,B,N,P)};var $=new h,ee=new h,te=new h,re=new h,ne=new h,ie=new h,oe=new h,ae=new h,se=new h,he=new h;n.prototype[a.types.SPHERE|a.types.CONVEXPOLYHEDRON]=n.prototype.sphereConvex=function(e,t,r,n,o,a,s,h){var l=this.v3pool;r.vsub(n,$);for(var u=t.faceNormals,c=t.faces,p=t.vertices,f=e.radius,d=0;d!==p.length;d++){var m=p[d],v=ne;a.vmult(m,v),n.vadd(v,v);var g=re;if(v.vsub(r,g),g.norm2()<f*f){x=!0;var y=this.createContactEquation(s,h,e,t);return y.ri.copy(g),y.ri.normalize(),y.ni.copy(y.ri),y.ri.mult(f,y.ri),v.vsub(n,y.rj),y.ri.vadd(r,y.ri),y.ri.vsub(s.position,y.ri),y.rj.vadd(n,y.rj),y.rj.vsub(h.position,y.rj),this.result.push(y),void this.createFrictionEquationsFromContact(y,this.frictionResult)}}for(var x=!1,d=0,w=c.length;d!==w&&x===!1;d++){var b=u[d],_=c[d],S=ie;a.vmult(b,S);var M=oe;a.vmult(p[_[0]],M),M.vadd(n,M);var E=ae;S.mult(-f,E),r.vadd(E,E);var T=se;E.vsub(M,T);var C=T.dot(S),A=he;if(r.vsub(M,A),0>C&&A.dot(S)>0){for(var L=[],R=0,P=_.length;R!==P;R++){var B=l.get();a.vmult(p[_[R]],B),n.vadd(B,B),L.push(B)}if(i(L,S,r)){x=!0;var y=this.createContactEquation(s,h,e,t);S.mult(-f,y.ri),S.negate(y.ni);var F=l.get();S.mult(-C,F);var k=l.get();S.mult(-f,k),r.vsub(n,y.rj),y.rj.vadd(k,y.rj),y.rj.vadd(F,y.rj),y.rj.vadd(n,y.rj),y.rj.vsub(h.position,y.rj),y.ri.vadd(r,y.ri),y.ri.vsub(s.position,y.ri),l.release(F),l.release(k),this.result.push(y),this.createFrictionEquationsFromContact(y,this.frictionResult);for(var R=0,D=L.length;R!==D;R++)l.release(L[R]);return}for(var R=0;R!==_.length;R++){var U=l.get(),z=l.get();a.vmult(p[_[(R+1)%_.length]],U),a.vmult(p[_[(R+2)%_.length]],z),n.vadd(U,U),n.vadd(z,z);var V=ee;z.vsub(U,V);var I=te;V.unit(I);var N=l.get(),O=l.get();r.vsub(U,O);var j=O.dot(I);I.mult(j,N),N.vadd(U,N);var W=l.get();if(N.vsub(r,W),j>0&&j*j<V.norm2()&&W.norm2()<f*f){var y=this.createContactEquation(s,h,e,t);N.vsub(n,y.rj),N.vsub(r,y.ni),y.ni.normalize(),y.ni.mult(f,y.ri),y.rj.vadd(n,y.rj),y.rj.vsub(h.position,y.rj),y.ri.vadd(r,y.ri),y.ri.vsub(s.position,y.ri),this.result.push(y),this.createFrictionEquationsFromContact(y,this.frictionResult);for(var R=0,D=L.length;R!==D;R++)l.release(L[R]);return l.release(U),l.release(z),l.release(N),l.release(W),void l.release(O)}l.release(U),l.release(z),l.release(N),l.release(W),l.release(O)}for(var R=0,D=L.length;R!==D;R++)l.release(L[R])}}};new h,new h;n.prototype[a.types.PLANE|a.types.BOX]=n.prototype.planeBox=function(e,t,r,n,i,o,a,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.planeConvex(e,t.convexPolyhedronRepresentation,r,n,i,o,a,s)};var le=new h,ue=new h,ce=new h,pe=new h;n.prototype[a.types.PLANE|a.types.CONVEXPOLYHEDRON]=n.prototype.planeConvex=function(e,t,r,n,i,o,a,s){var h=le,l=ue;l.set(0,0,1),i.vmult(l,l);for(var u=0,c=ce,p=0;p!==t.vertices.length;p++){h.copy(t.vertices[p]),o.vmult(h,h),n.vadd(h,h),h.vsub(r,c);var f=l.dot(c);if(0>=f){var d=this.createContactEquation(a,s,e,t),m=pe;l.mult(l.dot(c),m),h.vsub(m,m),m.vsub(r,d.ri),d.ni.copy(l),h.vsub(n,d.rj),d.ri.vadd(r,d.ri),d.ri.vsub(a.position,d.ri),d.rj.vadd(n,d.rj),d.rj.vsub(s.position,d.rj),this.result.push(d),u++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(d,this.frictionResult)}}this.enableFrictionReduction&&u&&this.createFrictionFromAverage(u)};var fe=new h,de=new h;n.prototype[a.types.CONVEXPOLYHEDRON]=n.prototype.convexConvex=function(e,t,r,n,i,o,a,s,h,l,u,c){var p=fe;if(!(r.distanceTo(n)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,r,i,n,o,p,u,c)){var f=[],d=de;e.clipAgainstHull(r,i,t,n,o,p,-100,100,f);for(var m=0,v=0;v!==f.length;v++){var g=this.createContactEquation(a,s,e,t,h,l),y=g.ri,x=g.rj;p.negate(g.ni),f[v].normal.negate(d),d.mult(f[v].depth,d),f[v].point.vadd(d,y),x.copy(f[v].point),y.vsub(r,y),x.vsub(n,x),y.vadd(r,y),y.vsub(a.position,y),x.vadd(n,x),x.vsub(s.position,x),this.result.push(g),m++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(g,this.frictionResult)}this.enableFrictionReduction&&m&&this.createFrictionFromAverage(m)}};var me=new h,ve=new h,ge=new h;n.prototype[a.types.PLANE|a.types.PARTICLE]=n.prototype.planeParticle=function(e,t,r,n,i,o,a,s){var h=me;h.set(0,0,1),a.quaternion.vmult(h,h);var l=ve;n.vsub(a.position,l);var u=h.dot(l);if(0>=u){var c=this.createContactEquation(s,a,t,e);c.ni.copy(h),c.ni.negate(c.ni),c.ri.set(0,0,0);var p=ge;h.mult(h.dot(n),p),n.vsub(p,p),c.rj.copy(p),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}};var ye=new h;n.prototype[a.types.PARTICLE|a.types.SPHERE]=n.prototype.sphereParticle=function(e,t,r,n,i,o,a,s){var h=ye;h.set(0,0,1),n.vsub(r,h);var l=h.norm2();if(l<=e.radius*e.radius){var u=this.createContactEquation(s,a,t,e);h.normalize(),u.rj.copy(h),u.rj.mult(e.radius,u.rj),u.ni.copy(h),u.ni.negate(u.ni),u.ri.set(0,0,0),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}};var xe=new u,we=new h,be=(new h,new h),_e=new h,Se=new h;n.prototype[a.types.PARTICLE|a.types.CONVEXPOLYHEDRON]=n.prototype.convexParticle=function(e,t,r,n,i,o,a,s){var h=-1,l=be,u=Se,c=null,p=0,f=we;if(f.copy(n),f.vsub(r,f),i.conjugate(xe),xe.vmult(f,f),e.pointIsInside(f)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(r,i),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(i);for(var d=0,m=e.faces.length;d!==m;d++){var v=[e.worldVertices[e.faces[d][0]]],g=e.worldFaceNormals[d];n.vsub(v[0],_e);var y=-g.dot(_e);(null===c||Math.abs(y)<Math.abs(c))&&(c=y,h=d,l.copy(g),p++)}if(-1!==h){var x=this.createContactEquation(s,a,t,e);l.mult(c,u),u.vadd(n,u),u.vsub(r,u),x.rj.copy(u),l.negate(x.ni),x.ri.set(0,0,0);var w=x.ri,b=x.rj;w.vadd(n,w),w.vsub(s.position,w),b.vadd(r,b),b.vsub(a.position,b),this.result.push(x),this.createFrictionEquationsFromContact(x,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},n.prototype[a.types.BOX|a.types.HEIGHTFIELD]=n.prototype.boxHeightfield=function(e,t,r,n,i,o,a,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,r,n,i,o,a,s)};var Me=new h,Ee=new h,Te=[0];n.prototype[a.types.CONVEXPOLYHEDRON|a.types.HEIGHTFIELD]=n.prototype.convexHeightfield=function(e,t,r,n,i,o,a,s){var h=t.data,u=t.elementSize,c=e.boundingSphereRadius,p=Ee,f=Te,d=Me;l.pointToLocalFrame(n,o,r,d);var m=Math.floor((d.x-c)/u)-1,v=Math.ceil((d.x+c)/u)+1,g=Math.floor((d.y-c)/u)-1,y=Math.ceil((d.y+c)/u)+1;if(!(0>v||0>y||m>h.length||g>h[0].length)){0>m&&(m=0),0>v&&(v=0),0>g&&(g=0),0>y&&(y=0),m>=h.length&&(m=h.length-1),v>=h.length&&(v=h.length-1),y>=h[0].length&&(y=h[0].length-1),g>=h[0].length&&(g=h[0].length-1);var x=[];t.getRectMinMax(m,g,v,y,x);var w=x[0],b=x[1];if(!(d.z-c>b||d.z+c<w))for(var _=m;v>_;_++)for(var S=g;y>S;S++)t.getConvexTrianglePillar(_,S,!1),l.pointToWorldFrame(n,o,t.pillarOffset,p),r.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.convexConvex(e,t.pillarConvex,r,p,i,o,a,s,null,null,f,null),t.getConvexTrianglePillar(_,S,!0),l.pointToWorldFrame(n,o,t.pillarOffset,p),r.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.convexConvex(e,t.pillarConvex,r,p,i,o,a,s,null,null,f,null)}};var Ce=new h,Ae=new h;n.prototype[a.types.SPHERE|a.types.HEIGHTFIELD]=n.prototype.sphereHeightfield=function(e,t,r,n,i,o,a,s){var h=t.data,u=e.radius,c=t.elementSize,p=Ae,f=Ce;l.pointToLocalFrame(n,o,r,f);var d=Math.floor((f.x-u)/c)-1,m=Math.ceil((f.x+u)/c)+1,v=Math.floor((f.y-u)/c)-1,g=Math.ceil((f.y+u)/c)+1;if(!(0>m||0>g||d>h.length||g>h[0].length)){0>d&&(d=0),0>m&&(m=0),0>v&&(v=0),0>g&&(g=0),d>=h.length&&(d=h.length-1),m>=h.length&&(m=h.length-1),g>=h[0].length&&(g=h[0].length-1),v>=h[0].length&&(v=h[0].length-1);var y=[];t.getRectMinMax(d,v,m,g,y);var x=y[0],w=y[1];if(!(f.z-u>w||f.z+u<x))for(var b=this.result,_=d;m>_;_++)for(var S=v;g>S;S++){var M=b.length;t.getConvexTrianglePillar(_,S,!1),l.pointToWorldFrame(n,o,t.pillarOffset,p),r.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.sphereConvex(e,t.pillarConvex,r,p,i,o,a,s),t.getConvexTrianglePillar(_,S,!0),l.pointToWorldFrame(n,o,t.pillarOffset,p),r.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.sphereConvex(e,t.pillarConvex,r,p,i,o,a,s);var E=b.length-M;if(E>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(e,t,r){function n(){l.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new o,this.broadphase=new y,this.bodies=[],this.solver=new s,this.constraints=[],this.narrowphase=new h(this),this.collisionMatrix=new u,this.collisionMatrixPrevious=new u,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new d,this.defaultMaterial=new c("default"),this.defaultContactMaterial=new p(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}t.exports=n;var i=e("../shapes/Shape"),o=e("../math/Vec3"),a=e("../math/Quaternion"),s=e("../solver/GSSolver"),h=(e("../utils/Vec3Pool"),e("../equations/ContactEquation"),e("../equations/FrictionEquation"),e("./Narrowphase")),l=e("../utils/EventTarget"),u=e("../collision/ArrayCollisionMatrix"),c=e("../material/Material"),p=e("../material/ContactMaterial"),f=e("../objects/Body"),d=e("../utils/TupleDictionary"),m=e("../collision/RaycastResult"),v=e("../collision/AABB"),g=e("../collision/Ray"),y=e("../collision/NaiveBroadphase");n.prototype=new l;var x=(new v,new g);if(n.prototype.getContactMaterial=function(e,t){return this.contactMaterialTable.get(e.id,t.id)},n.prototype.numObjects=function(){return this.bodies.length},n.prototype.collisionMatrixTick=function(){var e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset()},n.prototype.add=n.prototype.addBody=function(e){-1===this.bodies.indexOf(e)&&(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof f&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.dispatchEvent(this.addBodyEvent))},n.prototype.addConstraint=function(e){this.constraints.push(e)},n.prototype.removeConstraint=function(e){var t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)},n.prototype.rayTest=function(e,t,r){r instanceof m?this.raycastClosest(e,t,{skipBackfaces:!0},r):this.raycastAll(e,t,{skipBackfaces:!0},r)},n.prototype.raycastAll=function(e,t,r,n){return r.mode=g.ALL,r.from=e,r.to=t,r.callback=n,x.intersectWorld(this,r)},n.prototype.raycastAny=function(e,t,r,n){return r.mode=g.ANY,r.from=e,r.to=t,r.result=n,x.intersectWorld(this,r)},n.prototype.raycastClosest=function(e,t,r,n){return r.mode=g.CLOSEST,r.from=e,r.to=t,r.result=n,x.intersectWorld(this,r)},n.prototype.remove=function(e){e.world=null;var t=this.bodies.length-1,r=this.bodies,n=r.indexOf(e);if(-1!==n){r.splice(n,1);for(var i=0;i!==r.length;i++)r[i].index=i;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,this.dispatchEvent(this.removeBodyEvent)}},n.prototype.removeBody=n.prototype.remove,n.prototype.addMaterial=function(e){this.materials.push(e)},n.prototype.addContactMaterial=function(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)},"undefined"==typeof performance&&(performance={}),!performance.now){var w=Date.now();performance.timing&&performance.timing.navigationStart&&(w=performance.timing.navigationStart),performance.now=function(){return Date.now()-w}}var b=new o;n.prototype.step=function(e,t,r){if(r=r||10,t=t||0,0===t)this.internalStep(e),this.time+=e;else{var n=Math.floor((this.time+t)/e)-Math.floor(this.time/e);n=Math.min(n,r);for(var i=performance.now(),o=0;o!==n&&(this.internalStep(e),!(performance.now()-i>1e3*e));o++);this.time+=t;for(var a=this.time%e,s=a/e,h=b,l=this.bodies,u=0;u!==l.length;u++){var c=l[u];c.type!==f.STATIC&&c.sleepState!==f.SLEEPING?(c.position.vsub(c.previousPosition,h),h.scale(s,h),c.position.vadd(h,c.interpolatedPosition)):(c.interpolatedPosition.copy(c.position),c.interpolatedQuaternion.copy(c.quaternion))}}};var _={type:"postStep"},S={type:"preStep"},M={type:"collide",body:null,contact:null},E=[],T=[],C=[],A=[],L=(new o,new o,new o,new o,new o,new o,new o,new o,new o,new a,new a),R=new a,P=new o,B=new o;n.prototype.internalStep=function(e){this.dt=e;var t,r=this.contacts,n=C,o=A,a=this.numObjects(),s=this.bodies,h=this.solver,l=this.gravity,u=this.doProfiling,c=this.profile,p=f.DYNAMIC,d=this.constraints,m=T,v=0;for(u&&(t=performance.now()),v=0;v!==a;v++){var g=s[v];if(g.type&p&&!g.resistGravity){var y=g.force,x=g.mass;P.copy(g.position),P.vsub(l,P),P.scale(l.w,P),y.x-=x*P.x,y.y-=x*P.y,y.z-=x*P.z}}for(var v=0,w=this.subsystems.length;v!==w;v++)this.subsystems[v].update();u&&(t=performance.now()),n.length=0,o.length=0,this.broadphase.collisionPairs(this,n,o),u&&(c.broadphase=performance.now()-t);var b=d.length;for(v=0;v!==b;v++){var F=d[v];if(!F.collideConnected)for(var k=n.length-1;k>=0;k-=1)(F.bodyA===n[k]&&F.bodyB===o[k]||F.bodyB===n[k]&&F.bodyA===o[k])&&(n.splice(k,1),o.splice(k,1))}this.collisionMatrixTick(),u&&(t=performance.now());var D=E,U=r.length;for(v=0;v!==U;v++)D.push(r[v]);r.length=0;var z=this.frictionEquations.length;for(v=0;v!==z;v++)m.push(this.frictionEquations[v]);this.frictionEquations.length=0,this.narrowphase.getContacts(n,o,this,r,D,this.frictionEquations,m),
u&&(c.narrowphase=performance.now()-t),u&&(t=performance.now());for(var v=0;v<this.frictionEquations.length;v++)h.addEquation(this.frictionEquations[v]);for(var V=r.length,I=0;I!==V;I++){var N,F=r[I],g=F.bi,O=F.bj;F.si,F.sj;N=g.material&&O.material?this.getContactMaterial(g.material,O.material)||this.defaultContactMaterial:this.defaultContactMaterial;var j=N.friction;if(g.material&&O.material&&(g.material.friction>=0&&O.material.friction>=0&&(j=g.material.friction*O.material.friction),g.material.restitution>=0&&O.material.restitution>=0&&(F.restitution=g.material.restitution*O.material.restitution)),h.addEquation(F),g.allowSleep&&g.type===f.DYNAMIC&&g.sleepState===f.SLEEPING&&O.sleepState===f.AWAKE&&O.type!==f.STATIC){var W=O.velocity.norm2()+O.angularVelocity.norm2(),H=Math.pow(O.sleepSpeedLimit,2);W>=2*H&&(g._wakeUpAfterNarrowphase=!0)}if(O.allowSleep&&O.type===f.DYNAMIC&&O.sleepState===f.SLEEPING&&g.sleepState===f.AWAKE&&g.type!==f.STATIC){var G=g.velocity.norm2()+g.angularVelocity.norm2(),q=Math.pow(g.sleepSpeedLimit,2);G>=2*q&&(O._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(g,O,!0),this.collisionMatrixPrevious.get(g,O)||(M.body=O,M.contact=F,g.dispatchEvent(M),M.body=g,O.dispatchEvent(M))}for(u&&(c.makeContactConstraints=performance.now()-t,t=performance.now()),v=0;v!==a;v++){var g=s[v];g._wakeUpAfterNarrowphase&&(g.wakeUp(),g._wakeUpAfterNarrowphase=!1)}var b=d.length;for(v=0;v!==b;v++){var F=d[v];F.update();for(var k=0,X=F.equations.length;k!==X;k++){var Y=F.equations[k];h.addEquation(Y)}}h.solve(e,this),u&&(c.solve=performance.now()-t),h.removeAllEquations();var K=Math.pow;for(v=0;v!==a;v++){var g=s[v];if(g.type&p){var Q=K(1-g.linearDamping,e),Z=g.velocity;Z.mult(Q,Z);var J=g.angularVelocity;if(J){var $=K(1-g.angularDamping,e);J.mult($,J)}}}for(this.dispatchEvent(S),v=0;v!==a;v++){var g=s[v];g.preStep&&g.preStep.call(g)}u&&(t=performance.now());var ee=L,te=R,re=this.stepnumber,ne=f.DYNAMIC|f.KINEMATIC,ie=re%(this.quatNormalizeSkip+1)===0,oe=this.quatNormalizeFast,ae=.5*e;i.types.PLANE,i.types.CONVEXPOLYHEDRON;for(v=0;v!==a;v++){var se=s[v],he=se.force,le=se.torque;if(se.type&ne&&se.sleepState!==f.SLEEPING){var ue=se.velocity,ce=se.angularVelocity,pe=se.position,fe=se.quaternion,de=se.invMass,me=se.invInertiaWorld;ue.x+=he.x*de*e,ue.y+=he.y*de*e,ue.z+=he.z*de*e,se.angularVelocity&&(me.vmult(le,B),B.mult(e,B),B.vadd(ce,ce)),pe.x+=ue.x*e,pe.y+=ue.y*e,pe.z+=ue.z*e,se.angularVelocity&&(ee.set(ce.x,ce.y,ce.z,0),ee.mult(fe,te),fe.x+=ae*te.x,fe.y+=ae*te.y,fe.z+=ae*te.z,fe.w+=ae*te.w,ie&&(oe?fe.normalizeFast():fe.normalize())),se.aabb&&(se.aabbNeedsUpdate=!0),se.updateInertiaWorld&&se.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,u&&(c.integrate=performance.now()-t),this.time+=e,this.stepnumber+=1,this.dispatchEvent(_),v=0;v!==a;v++){var g=s[v],ve=g.postStep;ve&&ve.call(g)}if(this.allowSleep)for(v=0;v!==a;v++)s[v].sleepTick(this.time)},n.prototype.clearForces=function(){for(var e=this.bodies,t=e.length,r=0;r!==t;r++){var n=e[r];n.force,n.torque;n.force.set(0,0,0),n.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){function n(e,t,r){return r>t?t>e?t:e>r?r:e:r>e?r:e>t?t:e}t.exports=n},{}],3:[function(e,t,r){"use strict";function n(e,t,r){this.vertices=e,this.adjacent=t,this.boundary=r,this.lastVisited=-1}function i(e,t,r){this.vertices=e,this.cell=t,this.index=r}function o(e,t){return u(e.vertices,t.vertices)}function a(e){for(var t=["function orient(){var tuple=this.tuple;return test("],r=0;e>=r;++r)r>0&&t.push(","),t.push("tuple[",r,"]");t.push(")}return orient");var n=new Function("test",t.join("")),i=l[e+1];return i||(i=l),n(i)}function s(e,t,r){this.dimension=e,this.vertices=t,this.simplices=r,this.interior=r.filter(function(e){return!e.boundary}),this.tuple=new Array(e+1);for(var n=0;e>=n;++n)this.tuple[n]=this.vertices[n];var i=c[e];i||(i=c[e]=a(e)),this.orient=i}function h(e,t){var r=e.length;if(0===r)throw new Error("Must have at least d+1 points");var i=e[0].length;if(i>=r)throw new Error("Must input at least d+1 points");var o=e.slice(0,i+1),a=l.apply(void 0,o);if(0===a)throw new Error("Input not in general position");for(var h=new Array(i+1),u=0;i>=u;++u)h[u]=u;0>a&&(h[0]=1,h[1]=0);for(var c=new n(h,new Array(i+1),!1),p=c.adjacent,f=new Array(i+2),u=0;i>=u;++u){for(var d=h.slice(),m=0;i>=m;++m)m===u&&(d[m]=-1);var v=d[0];d[0]=d[1],d[1]=v;var g=new n(d,new Array(i+1),!0);p[u]=g,f[u]=g}f[i+1]=c;for(var u=0;i>=u;++u)for(var d=p[u].vertices,y=p[u].adjacent,m=0;i>=m;++m){var x=d[m];if(0>x)y[m]=c;else for(var w=0;i>=w;++w)p[w].vertices.indexOf(x)<0&&(y[m]=p[w])}for(var b=new s(i,o,f),_=!!t,u=i+1;r>u;++u)b.insert(e[u],_);return b.boundary()}t.exports=h;var l=e("robust-orientation"),u=e("simplicial-complex").compareCells;n.prototype.flip=function(){var e=this.vertices[0];this.vertices[0]=this.vertices[1],this.vertices[1]=e;var t=this.adjacent[0];this.adjacent[0]=this.adjacent[1],this.adjacent[1]=t};var c=[],p=s.prototype;p.handleBoundaryDegeneracy=function(e,t){var r=this.dimension,n=this.vertices.length-1,i=this.tuple,o=this.vertices,a=[e];for(e.lastVisited=-n;a.length>0;){e=a.pop();for(var s=(e.vertices,e.adjacent),h=0;r>=h;++h){var l=s[h];if(l.boundary&&!(l.lastVisited<=-n)){for(var u=l.vertices,c=0;r>=c;++c){var p=u[c];0>p?i[c]=t:i[c]=o[p]}var f=this.orient();if(f>0)return l;l.lastVisited=-n,0===f&&a.push(l)}}}return null},p.walk=function(e,t){var r=this.vertices.length-1,n=this.dimension,i=this.vertices,o=this.tuple,a=t?this.interior.length*Math.random()|0:this.interior.length-1,s=this.interior[a];e:for(;!s.boundary;){for(var h=s.vertices,l=s.adjacent,u=0;n>=u;++u)o[u]=i[h[u]];s.lastVisited=r;for(var u=0;n>=u;++u){var c=l[u];if(!(c.lastVisited>=r)){var p=o[u];o[u]=e;var f=this.orient();if(o[u]=p,0>f){s=c;continue e}c.boundary?c.lastVisited=-r:c.lastVisited=r}}return}return s},p.addPeaks=function(e,t){var r=this.vertices.length-1,a=this.dimension,s=this.vertices,h=this.tuple,l=this.interior,u=this.simplices,c=[t];t.lastVisited=r,t.vertices[t.vertices.indexOf(-1)]=r,t.boundary=!1,l.push(t);for(var p=[];c.length>0;){var t=c.pop(),f=t.vertices,d=t.adjacent,m=f.indexOf(r);if(!(0>m))for(var v=0;a>=v;++v)if(v!==m){var g=d[v];if(g.boundary&&!(g.lastVisited>=r)){var y=g.vertices;if(g.lastVisited!==-r){for(var x=0,w=0;a>=w;++w)y[w]<0?(x=w,h[w]=e):h[w]=s[y[w]];var b=this.orient();if(b>0){y[x]=r,g.boundary=!1,l.push(g),c.push(g),g.lastVisited=r;continue}g.lastVisited=-r}var _=g.adjacent,S=f.slice(),M=d.slice(),E=new n(S,M,!0);u.push(E);var T=_.indexOf(t);if(!(0>T)){_[T]=E,M[m]=g,S[v]=-1,M[v]=t,d[v]=E,E.flip();for(var w=0;a>=w;++w){var C=S[w];if(!(0>C||C===r)){for(var A=new Array(a-1),L=0,R=0;a>=R;++R){var P=S[R];0>P||R===w||(A[L++]=P)}p.push(new i(A,E,w))}}}}}}p.sort(o);for(var v=0;v+1<p.length;v+=2){var B=p[v],F=p[v+1],k=B.index,D=F.index;0>k||0>D||(B.cell.adjacent[B.index]=F.cell,F.cell.adjacent[F.index]=B.cell)}},p.insert=function(e,t){var r=this.vertices;r.push(e);var n=this.walk(e,t);if(n){for(var i=this.dimension,o=this.tuple,a=0;i>=a;++a){var s=n.vertices[a];0>s?o[a]=e:o[a]=r[s]}var h=this.orient(o);0>h||(0!==h||(n=this.handleBoundaryDegeneracy(n,e)))&&this.addPeaks(e,n)}},p.boundary=function(){for(var e=this.dimension,t=[],r=this.simplices,n=r.length,i=0;n>i;++i){var o=r[i];if(o.boundary){for(var a=new Array(e),s=o.vertices,h=0,l=0,u=0;e>=u;++u)s[u]>=0?a[h++]=s[u]:l=1&u;if(l===(1&e)){var c=a[0];a[0]=a[1],a[1]=c}t.push(a)}}return t}},{"robust-orientation":9,"simplicial-complex":12}],4:[function(e,t,r){"use strict";function n(e,t,r){var n=e+t,i=n-e,o=n-i,a=t-i,s=e-o;return r?(r[0]=s+a,r[1]=n,r):[s+a,n]}t.exports=n},{}],5:[function(e,t,r){"use strict";function n(e,t){var r=e.length;if(1===r){var n=i(e[0],t);return n[0]?n:[n[1]]}var a=new Array(2*r),s=[.1,.1],h=[.1,.1],l=0;i(e[0],t,s),s[0]&&(a[l++]=s[0]);for(var u=1;r>u;++u){i(e[u],t,h);var c=s[1];o(c,h[0],s),s[0]&&(a[l++]=s[0]);var p=h[1],f=s[1],d=p+f,m=d-p,v=f-m;s[1]=d,v&&(a[l++]=v)}return s[1]&&(a[l++]=s[1]),0===l&&(a[l++]=0),a.length=l,a}var i=e("two-product"),o=e("two-sum");t.exports=n},{"two-product":8,"two-sum":4}],6:[function(e,t,r){"use strict";function n(e,t){var r=e+t,n=r-e,i=r-n,o=t-n,a=e-i,s=a+o;return s?[s,r]:[r]}function i(e,t){var r=0|e.length,i=0|t.length;if(1===r&&1===i)return n(e[0],-t[0]);var o,a,s=r+i,h=new Array(s),l=0,u=0,c=0,p=Math.abs,f=e[u],d=p(f),m=-t[c],v=p(m);v>d?(a=f,u+=1,r>u&&(f=e[u],d=p(f))):(a=m,c+=1,i>c&&(m=-t[c],v=p(m))),r>u&&v>d||c>=i?(o=f,u+=1,r>u&&(f=e[u],d=p(f))):(o=m,c+=1,i>c&&(m=-t[c],v=p(m)));for(var g,y,x,w,b,_=o+a,S=_-o,M=a-S,E=M,T=_;r>u&&i>c;)v>d?(o=f,u+=1,r>u&&(f=e[u],d=p(f))):(o=m,c+=1,i>c&&(m=-t[c],v=p(m))),a=E,_=o+a,S=_-o,M=a-S,M&&(h[l++]=M),g=T+_,y=g-T,x=g-y,w=_-y,b=T-x,E=b+w,T=g;for(;r>u;)o=f,a=E,_=o+a,S=_-o,M=a-S,M&&(h[l++]=M),g=T+_,y=g-T,x=g-y,w=_-y,b=T-x,E=b+w,T=g,u+=1,r>u&&(f=e[u]);for(;i>c;)o=m,a=E,_=o+a,S=_-o,M=a-S,M&&(h[l++]=M),g=T+_,y=g-T,x=g-y,w=_-y,b=T-x,E=b+w,T=g,c+=1,i>c&&(m=-t[c]);return E&&(h[l++]=E),T&&(h[l++]=T),l||(h[l++]=0),h.length=l,h}t.exports=i},{}],7:[function(e,t,r){"use strict";function n(e,t){var r=e+t,n=r-e,i=r-n,o=t-n,a=e-i,s=a+o;return s?[s,r]:[r]}function i(e,t){var r=0|e.length,i=0|t.length;if(1===r&&1===i)return n(e[0],t[0]);var o,a,s=r+i,h=new Array(s),l=0,u=0,c=0,p=Math.abs,f=e[u],d=p(f),m=t[c],v=p(m);v>d?(a=f,u+=1,r>u&&(f=e[u],d=p(f))):(a=m,c+=1,i>c&&(m=t[c],v=p(m))),r>u&&v>d||c>=i?(o=f,u+=1,r>u&&(f=e[u],d=p(f))):(o=m,c+=1,i>c&&(m=t[c],v=p(m)));for(var g,y,x,w,b,_=o+a,S=_-o,M=a-S,E=M,T=_;r>u&&i>c;)v>d?(o=f,u+=1,r>u&&(f=e[u],d=p(f))):(o=m,c+=1,i>c&&(m=t[c],v=p(m))),a=E,_=o+a,S=_-o,M=a-S,M&&(h[l++]=M),g=T+_,y=g-T,x=g-y,w=_-y,b=T-x,E=b+w,T=g;for(;r>u;)o=f,a=E,_=o+a,S=_-o,M=a-S,M&&(h[l++]=M),g=T+_,y=g-T,x=g-y,w=_-y,b=T-x,E=b+w,T=g,u+=1,r>u&&(f=e[u]);for(;i>c;)o=m,a=E,_=o+a,S=_-o,M=a-S,M&&(h[l++]=M),g=T+_,y=g-T,x=g-y,w=_-y,b=T-x,E=b+w,T=g,c+=1,i>c&&(m=t[c]);return E&&(h[l++]=E),T&&(h[l++]=T),l||(h[l++]=0),h.length=l,h}t.exports=i},{}],8:[function(e,t,r){"use strict";function n(e,t,r){var n=e*t,o=i*e,a=o-e,s=o-a,h=e-s,l=i*t,u=l-t,c=l-u,p=t-c,f=n-s*c,d=f-h*c,m=d-s*p,v=h*p-m;return r?(r[0]=v,r[1]=n,r):[v,n]}t.exports=n;var i=+(Math.pow(2,27)+1)},{}],9:[function(e,t,r){"use strict";function n(e,t){for(var r=new Array(e.length-1),n=1;n<e.length;++n)for(var i=r[n-1]=new Array(e.length-1),o=0,a=0;o<e.length;++o)o!==t&&(i[a++]=e[n][o]);return r}function i(e){for(var t=new Array(e),r=0;e>r;++r){t[r]=new Array(e);for(var n=0;e>n;++n)t[r][n]=["m",n,"[",e-r-1,"]"].join("")}return t}function o(e){return 1&e?"-":""}function a(e){if(1===e.length)return e[0];if(2===e.length)return["sum(",e[0],",",e[1],")"].join("");var t=e.length>>1;return["sum(",a(e.slice(0,t)),",",a(e.slice(t)),")"].join("")}function s(e){if(2===e.length)return[["sum(prod(",e[0][0],",",e[1][1],"),prod(-",e[0][1],",",e[1][0],"))"].join("")];for(var t=[],r=0;r<e.length;++r)t.push(["scale(",a(s(n(e,r))),",",o(r),e[0][r],")"].join(""));return t}function h(e){for(var t=[],r=[],o=i(e),h=[],l=0;e>l;++l)0===(1&l)?t.push.apply(t,s(n(o,l))):r.push.apply(r,s(n(o,l))),h.push("m"+l);var u=a(t),m=a(r),v="orientation"+e+"Exact",g=["function ",v,"(",h.join(),"){var p=",u,",n=",m,",d=sub(p,n);return d[d.length-1];};return ",v].join(""),y=new Function("sum","prod","scale","sub",g);return y(p,c,f,d)}function l(e){var t=b[e.length];return t||(t=b[e.length]=h(e.length)),t.apply(void 0,e)}function u(){for(;b.length<=m;)b.push(h(b.length));for(var e=[],r=["slow"],n=0;m>=n;++n)e.push("a"+n),r.push("o"+n);for(var i=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"],n=2;m>=n;++n)i.push("case ",n,":return o",n,"(",e.slice(0,n).join(),");");i.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),r.push(i.join(""));var o=Function.apply(void 0,r);t.exports=o.apply(void 0,[l].concat(b));for(var n=0;m>=n;++n)t.exports[n]=b[n]}var c=e("two-product"),p=e("robust-sum"),f=e("robust-scale"),d=e("robust-subtract"),m=5,v=1.1102230246251565e-16,g=(3+16*v)*v,y=(7+56*v)*v,x=h(3),w=h(4),b=[function(){return 0},function(){return 0},function(e,t){return t[0]-e[0]},function(e,t,r){var n,i=(e[1]-r[1])*(t[0]-r[0]),o=(e[0]-r[0])*(t[1]-r[1]),a=i-o;if(i>0){if(0>=o)return a;n=i+o}else{if(!(0>i))return a;if(o>=0)return a;n=-(i+o)}var s=g*n;return a>=s||-s>=a?a:x(e,t,r)},function(e,t,r,n){var i=e[0]-n[0],o=t[0]-n[0],a=r[0]-n[0],s=e[1]-n[1],h=t[1]-n[1],l=r[1]-n[1],u=e[2]-n[2],c=t[2]-n[2],p=r[2]-n[2],f=o*l,d=a*h,m=a*s,v=i*l,g=i*h,x=o*s,b=u*(f-d)+c*(m-v)+p*(g-x),_=(Math.abs(f)+Math.abs(d))*Math.abs(u)+(Math.abs(m)+Math.abs(v))*Math.abs(c)+(Math.abs(g)+Math.abs(x))*Math.abs(p),S=y*_;return b>S||-b>S?b:w(e,t,r,n)}];u()},{"robust-scale":5,"robust-subtract":6,"robust-sum":7,"two-product":8}],10:[function(e,t,r){"use strict";"use restrict";function n(e){var t=32;return e&=-e,e&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}var i=32;r.INT_BITS=i,r.INT_MAX=2147483647,r.INT_MIN=-1<<i-1,r.sign=function(e){return(e>0)-(0>e)},r.abs=function(e){var t=e>>i-1;return(e^t)-t},r.min=function(e,t){return t^(e^t)&-(t>e)},r.max=function(e,t){return e^(e^t)&-(t>e)},r.isPow2=function(e){return!(e&e-1||!e)},r.log2=function(e){var t,r;return t=(e>65535)<<4,e>>>=t,r=(e>255)<<3,e>>>=r,t|=r,r=(e>15)<<2,e>>>=r,t|=r,r=(e>3)<<1,e>>>=r,t|=r,t|e>>1},r.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},r.popCount=function(e){return e-=e>>>1&1431655765,e=(858993459&e)+(e>>>2&858993459),16843009*(e+(e>>>4)&252645135)>>>24},r.countTrailingZeros=n,r.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1},r.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e-(e>>>1)},r.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,e&=15,27030>>>e&1};var o=new Array(256);!function(e){for(var t=0;256>t;++t){var r=t,n=t,i=7;for(r>>>=1;r;r>>>=1)n<<=1,n|=1&r,--i;e[t]=n<<i&255}}(o),r.reverse=function(e){return o[255&e]<<24|o[e>>>8&255]<<16|o[e>>>16&255]<<8|o[e>>>24&255]},r.interleave2=function(e,t){return e&=65535,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t&=65535,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1},r.deinterleave2=function(e,t){return e=e>>>t&1431655765,e=858993459&(e|e>>>1),e=252645135&(e|e>>>2),e=16711935&(e|e>>>4),e=65535&(e|e>>>16),e<<16>>16},r.interleave3=function(e,t,r){return e&=1023,e=4278190335&(e|e<<16),e=251719695&(e|e<<8),e=3272356035&(e|e<<4),e=1227133513&(e|e<<2),t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),e|=t<<1,r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),e|r<<2},r.deinterleave3=function(e,t){return e=e>>>t&1227133513,e=3272356035&(e|e>>>2),e=251719695&(e|e>>>4),e=4278190335&(e|e>>>8),e=1023&(e|e>>>16),e<<22>>22},r.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>n(e)+1}},{}],11:[function(e,t,r){"use strict";"use restrict";function n(e){this.roots=new Array(e),this.ranks=new Array(e);for(var t=0;e>t;++t)this.roots[t]=t,this.ranks[t]=0}t.exports=n;var i=n.prototype;Object.defineProperty(i,"length",{get:function(){return this.roots.length}}),i.makeSet=function(){var e=this.roots.length;return this.roots.push(e),this.ranks.push(0),e},i.find=function(e){for(var t=e,r=this.roots;r[e]!==e;)e=r[e];for(;r[t]!==e;){var n=r[t];r[t]=e,t=n}return e},i.link=function(e,t){var r=this.find(e),n=this.find(t);if(r!==n){var i=this.ranks,o=this.roots,a=i[r],s=i[n];s>a?o[r]=n:a>s?o[n]=r:(o[n]=r,++i[r])}}},{}],12:[function(e,t,r){"use strict";"use restrict";function n(e){for(var t=0,r=Math.max,n=0,i=e.length;i>n;++n)t=r(t,e[n].length);return t-1}function i(e){for(var t=-1,r=Math.max,n=0,i=e.length;i>n;++n)for(var o=e[n],a=0,s=o.length;s>a;++a)t=r(t,o[a]);return t+1}function o(e){for(var t=new Array(e.length),r=0,n=e.length;n>r;++r)t[r]=e[r].slice(0);return t}function a(e,t){var r=e.length,n=e.length-t.length,i=Math.min;if(n)return n;switch(r){case 0:return 0;case 1:return e[0]-t[0];case 2:var o=e[0]+e[1]-t[0]-t[1];return o?o:i(e[0],e[1])-i(t[0],t[1]);case 3:var a=e[0]+e[1],s=t[0]+t[1];if(o=a+e[2]-(s+t[2]))return o;var h=i(e[0],e[1]),l=i(t[0],t[1]),o=i(h,e[2])-i(l,t[2]);return o?o:i(h+e[2],a)-i(l+t[2],s);default:var u=e.slice(0);u.sort();var c=t.slice(0);c.sort();for(var p=0;r>p;++p)if(n=u[p]-c[p])return n;return 0}}function s(e,t){return a(e[0],t[0])}function h(e,t){if(t){for(var r=e.length,n=new Array(r),i=0;r>i;++i)n[i]=[e[i],t[i]];n.sort(s);for(var i=0;r>i;++i)e[i]=n[i][0],t[i]=n[i][1];return e}return e.sort(a),e}function l(e){if(0===e.length)return[];for(var t=1,r=e.length,n=1;r>n;++n){var i=e[n];if(a(i,e[n-1])){if(n===t){t++;continue}e[t++]=i}}return e.length=t,e}function u(e,t){for(var r=0,n=e.length-1,i=-1;n>=r;){var o=r+n>>1,s=a(e[o],t);0>=s?(0===s&&(i=o),r=o+1):s>0&&(n=o-1)}return i}function c(e,t){for(var r=new Array(e.length),n=0,i=r.length;i>n;++n)r[n]=[];for(var o=[],n=0,s=t.length;s>n;++n)for(var h=t[n],l=h.length,c=1,p=1<<l;p>c;++c){o.length=x.popCount(c);for(var f=0,d=0;l>d;++d)c&1<<d&&(o[f++]=h[d]);var m=u(e,o);if(!(0>m))for(;;)if(r[m++].push(n),m>=e.length||0!==a(e[m],o))break}return r}function p(e,t){if(!t)return c(l(d(e,0)),e,0);for(var r=new Array(t),n=0;t>n;++n)r[n]=[];for(var n=0,i=e.length;i>n;++n)for(var o=e[n],a=0,s=o.length;s>a;++a)r[o[a]].push(n);return r}function f(e){for(var t=[],r=0,n=e.length;n>r;++r)for(var i=e[r],o=0|i.length,a=1,s=1<<o;s>a;++a){for(var l=[],u=0;o>u;++u)a>>>u&1&&l.push(i[u]);t.push(l)}return h(t)}function d(e,t){if(0>t)return[];for(var r=[],n=(1<<t+1)-1,i=0;i<e.length;++i)for(var o=e[i],a=n;a<1<<o.length;a=x.nextCombination(a)){for(var s=new Array(t+1),l=0,u=0;u<o.length;++u)a&1<<u&&(s[l++]=o[u]);r.push(s)}return h(r)}function m(e){for(var t=[],r=0,n=e.length;n>r;++r)for(var i=e[r],o=0,a=i.length;a>o;++o){for(var s=new Array(i.length-1),l=0,u=0;a>l;++l)l!==o&&(s[u++]=i[l]);t.push(s)}return h(t)}function v(e,t){for(var r=new w(t),n=0;n<e.length;++n)for(var i=e[n],o=0;o<i.length;++o)for(var a=o+1;a<i.length;++a)r.link(i[o],i[a]);for(var s=[],h=r.ranks,n=0;n<h.length;++n)h[n]=-1;for(var n=0;n<e.length;++n){var l=r.find(e[n][0]);h[l]<0?(h[l]=s.length,s.push([e[n].slice(0)])):s[h[l]].push(e[n].slice(0))}return s}function g(e){for(var t=l(h(d(e,0))),r=new w(t.length),n=0;n<e.length;++n)for(var i=e[n],o=0;o<i.length;++o)for(var a=u(t,[i[o]]),s=o+1;s<i.length;++s)r.link(a,u(t,[i[s]]));for(var c=[],p=r.ranks,n=0;n<p.length;++n)p[n]=-1;for(var n=0;n<e.length;++n){var f=r.find(u(t,[e[n][0]]));p[f]<0?(p[f]=c.length,c.push([e[n].slice(0)])):c[p[f]].push(e[n].slice(0))}return c}function y(e,t){return t?v(e,t):g(e)}var x=e("bit-twiddle"),w=e("union-find");r.dimension=n,r.countVertices=i,r.cloneCells=o,r.compareCells=a,r.normalize=h,r.unique=l,r.findCell=u,r.incidence=c,r.dual=p,r.explode=f,r.skeleton=d,r.boundary=m,r.connectedComponents=y},{"bit-twiddle":10,"union-find":11}],13:[function(e,t,r){"use strict";function n(e,t){for(var r=1,n=e.length,i=e[0],o=e[0],a=1;n>a;++a)if(o=i,i=e[a],t(i,o)){if(a===r){r++;continue}e[r++]=i}return e.length=r,e}function i(e){for(var t=1,r=e.length,n=e[0],i=e[0],o=1;r>o;++o,i=n)if(i=n,n=e[o],n!==i){if(o===t){t++;continue}e[t++]=n}return e.length=t,e}function o(e,t,r){return 0===e.length?e:t?(r||e.sort(t),n(e,t)):(r||e.sort(),i(e))}t.exports=o},{}],14:[function(e,t,r){"use strict";function n(e,t){this.point=e,this.index=t}function i(e,t){for(var r=e.point,n=t.point,i=r.length,o=0;i>o;++o){var a=n[o]-r[o];if(a)return a}return 0}function o(e,t,r){if(1===e)return r?[[-1,0]]:[];var n=t.map(function(e,t){return[e[0],t]});n.sort(function(e,t){return e[0]-t[0]});for(var i=new Array(e-1),o=1;e>o;++o){var a=n[o-1],s=n[o];i[o-1]=[a[1],s[1]]}return r&&i.push([-1,i[0][1]],[i[e-1][1],-1]),i}function a(e,t){var r=e.length;if(0===r)return[];var a=e[0].length;if(1>a)return[];if(1===a)return o(r,e,t);for(var l=new Array(r),u=1,c=0;r>c;++c){for(var p=e[c],f=new Array(a+1),d=0,m=0;a>m;++m){var v=p[m];f[m]=v,d+=v*v}f[a]=d,l[c]=new n(f,c),u=Math.max(d,u)}h(l,i),r=l.length;for(var g=new Array(r+a+1),y=new Array(r+a+1),x=(a+1)*(a+1)*u,w=new Array(a+1),c=0;a>=c;++c)w[c]=0;w[a]=x,g[0]=w.slice(),y[0]=-1;for(var c=0;a>=c;++c){var f=w.slice();f[c]=1,g[c+1]=f,y[c+1]=-1}for(var c=0;r>c;++c){var b=l[c];g[c+a+1]=b.point,y[c+a+1]=b.index}var _=s(g,!1);if(_=t?_.filter(function(e){for(var t=0,r=0;a>=r;++r){var n=y[e[r]];if(0>n&&++t>=2)return!1;e[r]=n}return!0}):_.filter(function(e){for(var t=0;a>=t;++t){var r=y[e[t]];if(0>r)return!1;e[t]=r}return!0}),1&a)for(var c=0;c<_.length;++c){var b=_[c],f=b[0];b[0]=b[1],b[1]=f}return _}var s=e("incremental-convex-hull"),h=e("uniq");t.exports=a},{"incremental-convex-hull":3,uniq:13}],15:[function(e,t,r){!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["exports"],t):t("undefined"!=typeof r?r:e.esprima={})}(this,function(e){"use strict";function t(e,t){if(!e)throw new Error("ASSERT: "+t)}function r(e){return e>=48&&57>=e}function n(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function i(e){return"01234567".indexOf(e)>=0}function o(e){var t="0"!==e,r="01234567".indexOf(e);return dr>nr&&i(er[nr])&&(t=!0,r=8*r+"01234567".indexOf(er[nr++]),"0123".indexOf(e)>=0&&dr>nr&&i(er[nr])&&(r=8*r+"01234567".indexOf(er[nr++]))),{code:r,octal:t}}function a(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function s(e){return 10===e||13===e||8232===e||8233===e}function h(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||92===e||e>=128&&$t.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function l(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||e>=48&&57>=e||92===e||e>=128&&$t.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function u(e){switch(e){case"enum":case"export":case"import":case"super":return!0;default:return!1}}function c(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function p(e){return"eval"===e||"arguments"===e}function f(e){switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function d(e,r,n,i,o){var a;t("number"==typeof n,"Comment must have valid position"),vr.lastCommentStart=n,a={type:e,value:r},gr.range&&(a.range=[n,i]),gr.loc&&(a.loc=o),gr.comments.push(a),gr.attachComment&&(gr.leadingComments.push(a),gr.trailingComments.push(a))}function m(e){var t,r,n,i;for(t=nr-e,r={start:{line:ir,column:nr-or-e}};dr>nr;)if(n=er.charCodeAt(nr),++nr,s(n))return ar=!0,gr.comments&&(i=er.slice(t+e,nr-1),r.end={line:ir,column:nr-or-1},d("Line",i,t,nr-1,r)),13===n&&10===er.charCodeAt(nr)&&++nr,++ir,void(or=nr);gr.comments&&(i=er.slice(t+e,nr),r.end={line:ir,column:nr-or},d("Line",i,t,nr,r))}function v(){var e,t,r,n;for(gr.comments&&(e=nr-2,t={start:{line:ir,column:nr-or-2}});dr>nr;)if(r=er.charCodeAt(nr),s(r))13===r&&10===er.charCodeAt(nr+1)&&++nr,ar=!0,++ir,++nr,or=nr;else if(42===r){if(47===er.charCodeAt(nr+1))return++nr,++nr,void(gr.comments&&(n=er.slice(e+2,nr-2),t.end={line:ir,column:nr-or},d("Block",n,e,nr,t)));++nr}else++nr;gr.comments&&(t.end={line:ir,column:nr-or},n=er.slice(e+2,nr),d("Block",n,e,nr,t)),$()}function g(){var e,t;for(ar=!1,t=0===nr;dr>nr;)if(e=er.charCodeAt(nr),a(e))++nr;else if(s(e))ar=!0,++nr,13===e&&10===er.charCodeAt(nr)&&++nr,++ir,or=nr,t=!0;else if(47===e)if(e=er.charCodeAt(nr+1),47===e)++nr,++nr,m(2),t=!0;else{if(42!==e)break;++nr,++nr,v()}else if(t&&45===e){if(45!==er.charCodeAt(nr+1)||62!==er.charCodeAt(nr+2))break;nr+=3,m(3)}else{if(60!==e)break;if("!--"!==er.slice(nr+1,nr+4))break;++nr,++nr,++nr,++nr,m(4)}}function y(e){var t,r,i,o=0;for(r="u"===e?4:2,t=0;r>t;++t){if(!(dr>nr&&n(er[nr])))return"";i=er[nr++],o=16*o+"0123456789abcdef".indexOf(i.toLowerCase())}return String.fromCharCode(o)}function x(){var e,t,r,i;for(e=er[nr],t=0,"}"===e&&J();dr>nr&&(e=er[nr++],n(e));)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&J(),65535>=t?String.fromCharCode(t):(r=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(r,i))}function w(){var e,t;for(e=er.charCodeAt(nr++),t=String.fromCharCode(e),92===e&&(117!==er.charCodeAt(nr)&&J(),++nr,e=y("u"),e&&"\\"!==e&&h(e.charCodeAt(0))||J(),t=e);dr>nr&&(e=er.charCodeAt(nr),l(e));)++nr,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==er.charCodeAt(nr)&&J(),++nr,e=y("u"),e&&"\\"!==e&&l(e.charCodeAt(0))||J(),t+=e);return t}function b(){var e,t;for(e=nr++;dr>nr;){if(t=er.charCodeAt(nr),92===t)return nr=e,w();if(!l(t))break;++nr}return er.slice(e,nr)}function _(){var e,t,r;return e=nr,t=92===er.charCodeAt(nr)?w():b(),r=1===t.length?Xt.Identifier:f(t)?Xt.Keyword:"null"===t?Xt.NullLiteral:"true"===t||"false"===t?Xt.BooleanLiteral:Xt.Identifier,{type:r,value:t,lineNumber:ir,lineStart:or,start:e,end:nr}}function S(){var e,t;switch(e={type:Xt.Punctuator,value:"",lineNumber:ir,lineStart:or,start:nr,end:nr},t=er[nr]){case"(":gr.tokenize&&(gr.openParenToken=gr.tokens.length),++nr;break;case"{":gr.tokenize&&(gr.openCurlyToken=gr.tokens.length),vr.curlyStack.push("{"),++nr;break;case".":++nr,"."===er[nr]&&"."===er[nr+1]&&(nr+=2,t="...");break;case"}":++nr,vr.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++nr;break;default:t=er.substr(nr,4),">>>="===t?nr+=4:(t=t.substr(0,3),"==="===t||"!=="===t||">>>"===t||"<<="===t||">>="===t?nr+=3:(t=t.substr(0,2),"&&"===t||"||"===t||"=="===t||"!="===t||"+="===t||"-="===t||"*="===t||"/="===t||"++"===t||"--"===t||"<<"===t||">>"===t||"&="===t||"|="===t||"^="===t||"%="===t||"<="===t||">="===t||"=>"===t?nr+=2:(t=er[nr],"<>=!+-*%&|^/".indexOf(t)>=0&&++nr)))}return nr===e.start&&J(),e.end=nr,e.value=t,e}function M(e){for(var t="";dr>nr&&n(er[nr]);)t+=er[nr++];return 0===t.length&&J(),h(er.charCodeAt(nr))&&J(),{type:Xt.NumericLiteral,value:parseInt("0x"+t,16),lineNumber:ir,lineStart:or,start:e,end:nr}}function E(e){var t,n;for(n="";dr>nr&&(t=er[nr],"0"===t||"1"===t);)n+=er[nr++];return 0===n.length&&J(),dr>nr&&(t=er.charCodeAt(nr),(h(t)||r(t))&&J()),{type:Xt.NumericLiteral,value:parseInt(n,2),lineNumber:ir,lineStart:or,start:e,end:nr}}function T(e,t){var n,o;for(i(e)?(o=!0,n="0"+er[nr++]):(o=!1,++nr,n="");dr>nr&&i(er[nr]);)n+=er[nr++];return o||0!==n.length||J(),(h(er.charCodeAt(nr))||r(er.charCodeAt(nr)))&&J(),{type:Xt.NumericLiteral,value:parseInt(n,8),octal:o,lineNumber:ir,lineStart:or,start:t,end:nr}}function C(){var e,t;for(e=nr+1;dr>e;++e){if(t=er[e],"8"===t||"9"===t)return!1;if(!i(t))return!0}return!0}function A(){var e,n,o;if(o=er[nr],t(r(o.charCodeAt(0))||"."===o,"Numeric literal must start with a decimal digit or a decimal point"),n=nr,e="","."!==o){if(e=er[nr++],o=er[nr],"0"===e){if("x"===o||"X"===o)return++nr,M(n);if("b"===o||"B"===o)return++nr,E(n);if("o"===o||"O"===o)return T(o,n);if(i(o)&&C())return T(o,n)}for(;r(er.charCodeAt(nr));)e+=er[nr++];o=er[nr]}if("."===o){for(e+=er[nr++];r(er.charCodeAt(nr));)e+=er[nr++];o=er[nr]}if("e"===o||"E"===o)if(e+=er[nr++],o=er[nr],("+"===o||"-"===o)&&(e+=er[nr++]),r(er.charCodeAt(nr)))for(;r(er.charCodeAt(nr));)e+=er[nr++];else J();return h(er.charCodeAt(nr))&&J(),{type:Xt.NumericLiteral,value:parseFloat(e),lineNumber:ir,lineStart:or,start:n,end:nr}}function L(){var e,r,n,a,h,l="",u=!1;for(e=er[nr],t("'"===e||'"'===e,"String literal must starts with a quote"),r=nr,++nr;dr>nr;){if(n=er[nr++],n===e){e="";break}if("\\"===n)if(n=er[nr++],n&&s(n.charCodeAt(0)))++ir,"\r"===n&&"\n"===er[nr]&&++nr,or=nr;else switch(n){case"u":case"x":if("{"===er[nr])++nr,l+=x();else{if(a=y(n),!a)throw J();l+=a}break;case"n":l+="\n";break;case"r":l+="\r";break;case"t":l+="	";break;case"b":l+="\b";break;case"f":l+="\f";break;case"v":l+="";break;case"8":case"9":throw J();default:i(n)?(h=o(n),u=h.octal||u,l+=String.fromCharCode(h.code)):l+=n}else{if(s(n.charCodeAt(0)))break;l+=n}}return""!==e&&J(),{type:Xt.StringLiteral,value:l,octal:u,lineNumber:cr,lineStart:pr,start:r,end:nr}}function R(){var e,t,n,o,a,h,l,u,c="";for(o=!1,h=!1,t=nr,a="`"===er[nr],n=2,++nr;dr>nr;){if(e=er[nr++],"`"===e){n=1,h=!0,o=!0;break}if("$"===e){if("{"===er[nr]){vr.curlyStack.push("${"),++nr,o=!0;break}c+=e}else if("\\"===e)if(e=er[nr++],s(e.charCodeAt(0)))++ir,"\r"===e&&"\n"===er[nr]&&++nr,or=nr;else switch(e){case"n":c+="\n";break;case"r":c+="\r";break;case"t":c+="	";break;case"u":case"x":"{"===er[nr]?(++nr,c+=x()):(l=nr,u=y(e),u?c+=u:(nr=l,c+=e));break;case"b":c+="\b";break;case"f":c+="\f";break;case"v":c+="";break;default:"0"===e?(r(er.charCodeAt(nr))&&K(Jt.TemplateOctalLiteral),c+="\x00"):i(e)?K(Jt.TemplateOctalLiteral):c+=e}else s(e.charCodeAt(0))?(++ir,"\r"===e&&"\n"===er[nr]&&++nr,or=nr,c+="\n"):c+=e}return o||J(),a||vr.curlyStack.pop(),{type:Xt.Template,value:{cooked:c,raw:er.slice(t+1,nr-n)},head:a,tail:h,lineNumber:ir,lineStart:or,start:t,end:nr}}function P(e,t){var r="￿",n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,function(e,t,n){var i=parseInt(t||n,16);return i>1114111&&J(null,Jt.InvalidRegExp),65535>=i?String.fromCharCode(i):r}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,r));try{RegExp(n)}catch(i){J(null,Jt.InvalidRegExp)}try{return new RegExp(e,t)}catch(o){return null}}function B(){var e,r,n,i,o;for(e=er[nr],t("/"===e,"Regular expression literal must start with a slash"),r=er[nr++],n=!1,i=!1;dr>nr;)if(e=er[nr++],r+=e,"\\"===e)e=er[nr++],s(e.charCodeAt(0))&&J(null,Jt.UnterminatedRegExp),r+=e;else if(s(e.charCodeAt(0)))J(null,Jt.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){i=!0;break}"["===e&&(n=!0)}return i||J(null,Jt.UnterminatedRegExp),o=r.substr(1,r.length-2),{value:o,literal:r}}function F(){var e,t,r,n;for(t="",r="";dr>nr&&(e=er[nr],l(e.charCodeAt(0)));)if(++nr,"\\"===e&&dr>nr)if(e=er[nr],"u"===e){if(++nr,n=nr,e=y("u"))for(r+=e,t+="\\u";nr>n;++n)t+=er[n];else nr=n,r+="u",t+="\\u";$()}else t+="\\",$();else r+=e,t+=e;return{value:r,literal:t}}function k(){fr=!0;var e,t,r,n;return mr=null,g(),e=nr,t=B(),r=F(),n=P(t.value,r.value),fr=!1,gr.tokenize?{type:Xt.RegularExpression,value:n,regex:{pattern:t.value,flags:r.value},lineNumber:ir,lineStart:or,start:e,end:nr}:{literal:t.literal+r.literal,value:n,regex:{pattern:t.value,flags:r.value},start:e,end:nr}}function D(){var e,t,r,n;return g(),e=nr,t={start:{line:ir,column:nr-or}},r=k(),t.end={line:ir,column:nr-or},gr.tokenize||(gr.tokens.length>0&&(n=gr.tokens[gr.tokens.length-1],n.range[0]===e&&"Punctuator"===n.type&&("/"===n.value||"/="===n.value)&&gr.tokens.pop()),gr.tokens.push({type:"RegularExpression",value:r.literal,regex:r.regex,range:[e,nr],loc:t})),r}function U(e){return e.type===Xt.Identifier||e.type===Xt.Keyword||e.type===Xt.BooleanLiteral||e.type===Xt.NullLiteral}function z(){var e,t;if(e=gr.tokens[gr.tokens.length-1],!e)return D();if("Punctuator"===e.type){
if("]"===e.value)return S();if(")"===e.value)return t=gr.tokens[gr.openParenToken-1],!t||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?S():D();if("}"===e.value){if(gr.tokens[gr.openCurlyToken-3]&&"Keyword"===gr.tokens[gr.openCurlyToken-3].type){if(t=gr.tokens[gr.openCurlyToken-4],!t)return S()}else{if(!gr.tokens[gr.openCurlyToken-4]||"Keyword"!==gr.tokens[gr.openCurlyToken-4].type)return S();if(t=gr.tokens[gr.openCurlyToken-5],!t)return D()}return Kt.indexOf(t.value)>=0?S():D()}return D()}return"Keyword"===e.type&&"this"!==e.value?D():S()}function V(){var e,t;return nr>=dr?{type:Xt.EOF,lineNumber:ir,lineStart:or,start:nr,end:nr}:(e=er.charCodeAt(nr),h(e)?(t=_(),tr&&c(t.value)&&(t.type=Xt.Keyword),t):40===e||41===e||59===e?S():39===e||34===e?L():46===e?r(er.charCodeAt(nr+1))?A():S():r(e)?A():gr.tokenize&&47===e?z():96===e||125===e&&"${"===vr.curlyStack[vr.curlyStack.length-1]?R():S())}function I(){var e,t,r,n;return e={start:{line:ir,column:nr-or}},t=V(),e.end={line:ir,column:nr-or},t.type!==Xt.EOF&&(r=er.slice(t.start,t.end),n={type:Yt[t.type],value:r,range:[t.start,t.end],loc:e},t.regex&&(n.regex={pattern:t.regex.pattern,flags:t.regex.flags}),gr.tokens.push(n)),t}function N(){var e;return fr=!0,sr=nr,hr=ir,lr=or,g(),e=mr,ur=nr,cr=ir,pr=or,mr="undefined"!=typeof gr.tokens?I():V(),fr=!1,e}function O(){fr=!0,g(),sr=nr,hr=ir,lr=or,ur=nr,cr=ir,pr=or,mr="undefined"!=typeof gr.tokens?I():V(),fr=!1}function j(){this.line=cr,this.column=ur-pr}function W(){this.start=new j,this.end=null}function H(e){this.start={line:e.lineNumber,column:e.start-e.lineStart},this.end=null}function G(){gr.range&&(this.range=[ur,0]),gr.loc&&(this.loc=new W)}function q(e){gr.range&&(this.range=[e.start,0]),gr.loc&&(this.loc=new H(e))}function X(e){var t,r;for(t=0;t<gr.errors.length;t++)if(r=gr.errors[t],r.index===e.index&&r.message===e.message)return;gr.errors.push(e)}function Y(e,t,r){var n=new Error("Line "+e+": "+r);return n.index=t,n.lineNumber=e,n.column=t-(fr?or:lr)+1,n.description=r,n}function K(e){var r,n;throw r=Array.prototype.slice.call(arguments,1),n=e.replace(/%(\d)/g,function(e,n){return t(n<r.length,"Message reference must be in range"),r[n]}),Y(hr,sr,n)}function Q(e){var r,n,i;if(r=Array.prototype.slice.call(arguments,1),n=e.replace(/%(\d)/g,function(e,n){return t(n<r.length,"Message reference must be in range"),r[n]}),i=Y(ir,sr,n),!gr.errors)throw i;X(i)}function Z(e,t){var r,n=t||Jt.UnexpectedToken;return e?(t||(n=e.type===Xt.EOF?Jt.UnexpectedEOS:e.type===Xt.Identifier?Jt.UnexpectedIdentifier:e.type===Xt.NumericLiteral?Jt.UnexpectedNumber:e.type===Xt.StringLiteral?Jt.UnexpectedString:e.type===Xt.Template?Jt.UnexpectedTemplate:Jt.UnexpectedToken,e.type===Xt.Keyword&&(u(e.value)?n=Jt.UnexpectedReserved:tr&&c(e.value)&&(n=Jt.StrictReservedWord))),r=e.type===Xt.Template?e.value.raw:e.value):r="ILLEGAL",n=n.replace("%0",r),e&&"number"==typeof e.lineNumber?Y(e.lineNumber,e.start,n):Y(fr?ir:hr,fr?nr:sr,n)}function J(e,t){throw Z(e,t)}function $(e,t){var r=Z(e,t);if(!gr.errors)throw r;X(r)}function ee(e){var t=N();(t.type!==Xt.Punctuator||t.value!==e)&&J(t)}function te(){var e;gr.errors?(e=mr,e.type===Xt.Punctuator&&","===e.value?N():e.type===Xt.Punctuator&&";"===e.value?(N(),$(e)):$(e,Jt.UnexpectedToken)):ee(",")}function re(e){var t=N();(t.type!==Xt.Keyword||t.value!==e)&&J(t)}function ne(e){return mr.type===Xt.Punctuator&&mr.value===e}function ie(e){return mr.type===Xt.Keyword&&mr.value===e}function oe(e){return mr.type===Xt.Identifier&&mr.value===e}function ae(){var e;return mr.type!==Xt.Punctuator?!1:(e=mr.value,"="===e||"*="===e||"/="===e||"%="===e||"+="===e||"-="===e||"<<="===e||">>="===e||">>>="===e||"&="===e||"^="===e||"|="===e)}function se(){return 59===er.charCodeAt(ur)||ne(";")?void N():void(ar||(sr=ur,hr=cr,lr=pr,mr.type===Xt.EOF||ne("}")||J(mr)))}function he(e){var t,r=yr,n=xr,i=wr;return yr=!0,xr=!0,wr=null,t=e(),null!==wr&&J(wr),yr=r,xr=n,wr=i,t}function le(e){var t,r=yr,n=xr,i=wr;return yr=!0,xr=!0,wr=null,t=e(),yr=yr&&r,xr=xr&&n,wr=i||wr,t}function ue(e){var t,r,n=new G,i=[];for(ee("[");!ne("]");)if(ne(","))N(),i.push(null);else{if(ne("...")){r=new G,N(),e.push(mr),t=Ze(e),i.push(r.finishRestElement(t));break}i.push(de(e)),ne("]")||ee(",")}return ee("]"),n.finishArrayPattern(i)}function ce(e){var t,r,n,i=new G,o=ne("[");if(mr.type===Xt.Identifier){if(r=mr,t=Ze(),ne("="))return e.push(r),N(),n=qe(),i.finishProperty("init",t,!1,new q(r).finishAssignmentPattern(t,n),!1,!1);if(!ne(":"))return e.push(r),i.finishProperty("init",t,!1,t,!1,!0)}else t=ye(e);return ee(":"),n=de(e),i.finishProperty("init",t,o,n,!1,!1)}function pe(e){var t=new G,r=[];for(ee("{");!ne("}");)r.push(ce(e)),ne("}")||ee(",");return N(),t.finishObjectPattern(r)}function fe(e){var t;return mr.type===Xt.Identifier?(e.push(mr),t=Ze()):ne("[")?ue(e):ne("{")?pe(e):void J(mr)}function de(e){var t,r,n=mr;return t=fe(e),ne("=")&&(N(),r=he(qe),t=new q(n).finishAssignmentPattern(t,r)),t}function me(){var e,t=[],r=new G;for(ee("[");!ne("]");)ne(",")?(N(),t.push(null)):ne("...")?(e=new G,N(),e.finishSpreadElement(le(qe)),ne("]")||(xr=yr=!1,ee(",")),t.push(e)):(t.push(le(qe)),ne("]")||ee(","));return N(),r.finishArrayExpression(t)}function ve(e,t,r){var n,i;return xr=yr=!1,n=tr,i=he(_t),tr&&t.firstRestricted&&$(t.firstRestricted,t.message),tr&&t.stricted&&$(t.stricted,t.message),tr=n,e.finishFunctionExpression(null,t.params,t.defaults,i,r)}function ge(){var e,t,r=new G,n=vr.allowYield;return vr.allowYield=!1,e=Et(),vr.allowYield=n,vr.allowYield=!1,t=ve(r,e,!1),vr.allowYield=n,t}function ye(){var e,t,r=new G;switch(e=N(),e.type){case Xt.StringLiteral:case Xt.NumericLiteral:return tr&&e.octal&&$(e,Jt.StrictOctalLiteral),r.finishLiteral(e);case Xt.Identifier:case Xt.BooleanLiteral:case Xt.NullLiteral:case Xt.Keyword:return r.finishIdentifier(e.value);case Xt.Punctuator:if("["===e.value)return t=he(qe),ee("]"),t}J(e)}function xe(){switch(mr.type){case Xt.Identifier:case Xt.StringLiteral:case Xt.BooleanLiteral:case Xt.NullLiteral:case Xt.NumericLiteral:case Xt.Keyword:return!0;case Xt.Punctuator:return"["===mr.value}return!1}function we(e,t,r,n){var i,o,a,s,h=vr.allowYield;if(e.type===Xt.Identifier){if("get"===e.value&&xe())return r=ne("["),t=ye(),a=new G,ee("("),ee(")"),vr.allowYield=!1,i=ve(a,{params:[],defaults:[],stricted:null,firstRestricted:null,message:null},!1),vr.allowYield=h,n.finishProperty("get",t,r,i,!1,!1);if("set"===e.value&&xe())return r=ne("["),t=ye(),a=new G,ee("("),o={params:[],defaultCount:0,defaults:[],firstRestricted:null,paramSet:{}},ne(")")?$(mr):(vr.allowYield=!1,Mt(o),vr.allowYield=h,0===o.defaultCount&&(o.defaults=[])),ee(")"),vr.allowYield=!1,i=ve(a,o,!1),vr.allowYield=h,n.finishProperty("set",t,r,i,!1,!1)}else if(e.type===Xt.Punctuator&&"*"===e.value&&xe())return r=ne("["),t=ye(),a=new G,vr.allowYield=!1,s=Et(),vr.allowYield=h,vr.allowYield=!0,i=ve(a,s,!0),vr.allowYield=h,n.finishProperty("init",t,r,i,!0,!1);return t&&ne("(")?(i=ge(),n.finishProperty("init",t,r,i,!0,!1)):null}function be(e,t,r){t===!1&&(e.type===Qt.Identifier&&"__proto__"===e.name||e.type===Qt.Literal&&"__proto__"===e.value)&&(r.value?Q(Jt.DuplicateProtoProperty):r.value=!0)}function _e(e){var t,r,n,i,o=mr,a=new G;return t=ne("["),ne("*")?N():r=ye(),(n=we(o,r,t,a))?(be(n.key,n.computed,e),n):(r||J(mr),be(r,t,e),ne(":")?(N(),i=le(qe),a.finishProperty("init",r,t,i,!1,!1)):o.type===Xt.Identifier?ne("=")?(wr=mr,N(),i=he(qe),a.finishProperty("init",r,t,new q(o).finishAssignmentPattern(r,i),!1,!0)):a.finishProperty("init",r,t,r,!1,!0):void J(mr))}function Se(){var e=[],t={value:!1},r=new G;for(ee("{");!ne("}");)e.push(_e(t)),ne("}")||te();return ee("}"),r.finishObjectExpression(e)}function Me(e){var t;switch(e.type){case Qt.Identifier:case Qt.MemberExpression:case Qt.RestElement:case Qt.AssignmentPattern:break;case Qt.SpreadElement:e.type=Qt.RestElement,Me(e.argument);break;case Qt.ArrayExpression:for(e.type=Qt.ArrayPattern,t=0;t<e.elements.length;t++)null!==e.elements[t]&&Me(e.elements[t]);break;case Qt.ObjectExpression:for(e.type=Qt.ObjectPattern,t=0;t<e.properties.length;t++)Me(e.properties[t].value);break;case Qt.AssignmentExpression:e.type=Qt.AssignmentPattern,Me(e.left)}}function Ee(e){var t,r;return(mr.type!==Xt.Template||e.head&&!mr.head)&&J(),t=new G,r=N(),t.finishTemplateElement({raw:r.value.raw,cooked:r.value.cooked},r.tail)}function Te(){var e,t,r,n=new G;for(e=Ee({head:!0}),t=[e],r=[];!e.tail;)r.push(Xe()),e=Ee({head:!1}),t.push(e);return n.finishTemplateLiteral(t,r)}function Ce(){var e,t,r,n,i=[];if(ee("("),ne(")"))return N(),ne("=>")||ee("=>"),{type:Zt.ArrowParameterPlaceHolder,params:[],rawParams:[]};if(r=mr,ne("..."))return e=it(i),ee(")"),ne("=>")||ee("=>"),{type:Zt.ArrowParameterPlaceHolder,params:[e]};if(yr=!0,e=le(qe),ne(",")){for(xr=!1,t=[e];dr>ur&&ne(",");){if(N(),ne("...")){for(yr||J(mr),t.push(it(i)),ee(")"),ne("=>")||ee("=>"),yr=!1,n=0;n<t.length;n++)Me(t[n]);return{type:Zt.ArrowParameterPlaceHolder,params:t}}t.push(le(qe))}e=new q(r).finishSequenceExpression(t)}if(ee(")"),ne("=>")){if(yr||J(mr),e.type===Qt.SequenceExpression)for(n=0;n<e.expressions.length;n++)Me(e.expressions[n]);else Me(e);e={type:Zt.ArrowParameterPlaceHolder,params:e.type===Qt.SequenceExpression?e.expressions:[e]}}return yr=!1,e}function Ae(){var e,t,r,n;if(ne("("))return yr=!1,le(Ce);if(ne("["))return le(me);if(ne("{"))return le(Se);if(e=mr.type,n=new G,e===Xt.Identifier)r=n.finishIdentifier(N().value);else if(e===Xt.StringLiteral||e===Xt.NumericLiteral)xr=yr=!1,tr&&mr.octal&&$(mr,Jt.StrictOctalLiteral),r=n.finishLiteral(N());else if(e===Xt.Keyword){if(xr=yr=!1,ie("function"))return Ct();if(ie("this"))return N(),n.finishThisExpression();if(ie("class"))return Rt();J(N())}else e===Xt.BooleanLiteral?(xr=yr=!1,t=N(),t.value="true"===t.value,r=n.finishLiteral(t)):e===Xt.NullLiteral?(xr=yr=!1,t=N(),t.value=null,r=n.finishLiteral(t)):ne("/")||ne("/=")?(xr=yr=!1,nr=ur,t="undefined"!=typeof gr.tokens?D():k(),N(),r=n.finishLiteral(t)):e===Xt.Template?r=Te():J(N());return r}function Le(){var e,t=[];if(ee("("),!ne(")"))for(;dr>ur&&(ne("...")?(e=new G,N(),e.finishSpreadElement(he(qe))):e=he(qe),t.push(e),!ne(")"));)te();return ee(")"),t}function Re(){var e,t=new G;return e=N(),U(e)||J(e),t.finishIdentifier(e.value)}function Pe(){return ee("."),Re()}function Be(){var e;return ee("["),e=he(Xe),ee("]"),e}function Fe(){var e,t,r=new G;return re("new"),e=he(De),t=ne("(")?Le():[],xr=yr=!1,r.finishNewExpression(e,t)}function ke(){var e,t,r,n,i,o=vr.allowIn;for(i=mr,vr.allowIn=!0,ie("super")&&vr.inFunctionBody?(t=new G,N(),t=t.finishSuper(),ne("(")||ne(".")||ne("[")||J(mr)):t=le(ie("new")?Fe:Ae);;)if(ne("."))yr=!1,xr=!0,n=Pe(),t=new q(i).finishMemberExpression(".",t,n);else if(ne("("))yr=!1,xr=!1,r=Le(),t=new q(i).finishCallExpression(t,r);else if(ne("["))yr=!1,xr=!0,n=Be(),t=new q(i).finishMemberExpression("[",t,n);else{if(mr.type!==Xt.Template||!mr.head)break;e=Te(),t=new q(i).finishTaggedTemplateExpression(t,e)}return vr.allowIn=o,t}function De(){var e,r,n,i;for(t(vr.allowIn,"callee of new expression always allow in keyword."),i=mr,ie("super")&&vr.inFunctionBody?(r=new G,N(),r=r.finishSuper(),ne("[")||ne(".")||J(mr)):r=le(ie("new")?Fe:Ae);;)if(ne("["))yr=!1,xr=!0,n=Be(),r=new q(i).finishMemberExpression("[",r,n);else if(ne("."))yr=!1,xr=!0,n=Pe(),r=new q(i).finishMemberExpression(".",r,n);else{if(mr.type!==Xt.Template||!mr.head)break;e=Te(),r=new q(i).finishTaggedTemplateExpression(r,e)}return r}function Ue(){var e,t,r=mr;return e=le(ke),ar||mr.type!==Xt.Punctuator||(ne("++")||ne("--"))&&(tr&&e.type===Qt.Identifier&&p(e.name)&&Q(Jt.StrictLHSPostfix),xr||Q(Jt.InvalidLHSInAssignment),xr=yr=!1,t=N(),e=new q(r).finishPostfixExpression(t.value,e)),e}function ze(){var e,t,r;return mr.type!==Xt.Punctuator&&mr.type!==Xt.Keyword?t=Ue():ne("++")||ne("--")?(r=mr,e=N(),t=le(ze),tr&&t.type===Qt.Identifier&&p(t.name)&&Q(Jt.StrictLHSPrefix),xr||Q(Jt.InvalidLHSInAssignment),t=new q(r).finishUnaryExpression(e.value,t),xr=yr=!1):ne("+")||ne("-")||ne("~")||ne("!")?(r=mr,e=N(),t=le(ze),t=new q(r).finishUnaryExpression(e.value,t),xr=yr=!1):ie("delete")||ie("void")||ie("typeof")?(r=mr,e=N(),t=le(ze),t=new q(r).finishUnaryExpression(e.value,t),tr&&"delete"===t.operator&&t.argument.type===Qt.Identifier&&Q(Jt.StrictDelete),xr=yr=!1):t=Ue(),t}function Ve(e,t){var r=0;if(e.type!==Xt.Punctuator&&e.type!==Xt.Keyword)return 0;switch(e.value){case"||":r=1;break;case"&&":r=2;break;case"|":r=3;break;case"^":r=4;break;case"&":r=5;break;case"==":case"!=":case"===":case"!==":r=6;break;case"<":case">":case"<=":case">=":case"instanceof":r=7;break;case"in":r=t?7:0;break;case"<<":case">>":case">>>":r=8;break;case"+":case"-":r=9;break;case"*":case"/":case"%":r=11}return r}function Ie(){var e,t,r,n,i,o,a,s,h,l;if(e=mr,h=le(ze),n=mr,i=Ve(n,vr.allowIn),0===i)return h;for(xr=yr=!1,n.prec=i,N(),t=[e,mr],a=he(ze),o=[h,n,a];(i=Ve(mr,vr.allowIn))>0;){for(;o.length>2&&i<=o[o.length-2].prec;)a=o.pop(),s=o.pop().value,h=o.pop(),t.pop(),r=new q(t[t.length-1]).finishBinaryExpression(s,h,a),o.push(r);n=N(),n.prec=i,o.push(n),t.push(mr),r=he(ze),o.push(r)}for(l=o.length-1,r=o[l],t.pop();l>1;)r=new q(t.pop()).finishBinaryExpression(o[l-1].value,o[l-2],r),l-=2;return r}function Ne(){var e,t,r,n,i;return i=mr,e=le(Ie),ne("?")&&(N(),t=vr.allowIn,vr.allowIn=!0,r=he(qe),vr.allowIn=t,ee(":"),n=he(qe),e=new q(i).finishConditionalExpression(e,r,n),xr=yr=!1),e}function Oe(){return ne("{")?_t():he(qe)}function je(e,r){var n;switch(r.type){case Qt.Identifier:St(e,r,r.name);break;case Qt.RestElement:je(e,r.argument);break;case Qt.AssignmentPattern:je(e,r.left);break;case Qt.ArrayPattern:for(n=0;n<r.elements.length;n++)null!==r.elements[n]&&je(e,r.elements[n]);break;default:for(t(r.type===Qt.ObjectPattern,"Invalid type"),n=0;n<r.properties.length;n++)je(e,r.properties[n].value)}}function We(e){var t,r,n,i,o,a,s,h;switch(o=[],a=0,i=[e],e.type){case Qt.Identifier:break;case Zt.ArrowParameterPlaceHolder:i=e.params;break;default:return null}for(s={paramSet:{}},t=0,r=i.length;r>t;t+=1)switch(n=i[t],n.type){case Qt.AssignmentPattern:i[t]=n.left,o.push(n.right),++a,je(s,n.left);break;default:je(s,n),i[t]=n,o.push(null)}return s.message===Jt.StrictParamDupe&&(h=tr?s.stricted:s.firstRestricted,J(h,s.message)),0===a&&(o=[]),{params:i,defaults:o,stricted:s.stricted,firstRestricted:s.firstRestricted,message:s.message}}function He(e,t){var r,n;return ar&&$(mr),ee("=>"),r=tr,n=Oe(),tr&&e.firstRestricted&&J(e.firstRestricted,e.message),tr&&e.stricted&&$(e.stricted,e.message),tr=r,t.finishArrowFunctionExpression(e.params,e.defaults,n,n.type!==Qt.BlockStatement)}function Ge(){var e,t,r;return t=new G,vr.allowYield||$(mr,Jt.IllegalYield),re("yield"),ar||(r=ne("*"),r?(N(),e=Xe()):ne(";")||ne("}")||mr.type===Xt.EOF||(e=Xe())),t.finishYieldExpression(e,r)}function qe(){var e,t,r,n,i;return i=mr,e=mr,ie("yield")?Ge():(t=Ne(),t.type===Zt.ArrowParameterPlaceHolder||ne("=>")?(xr=yr=!1,n=We(t),n?(wr=null,He(n,new q(i))):t):(ae()&&(xr||Q(Jt.InvalidLHSInAssignment),tr&&t.type===Qt.Identifier&&p(t.name)&&$(e,Jt.StrictLHSAssignment),ne("=")?Me(t):xr=yr=!1,e=N(),r=he(qe),t=new q(i).finishAssignmentExpression(e.value,t,r),wr=null),t))}function Xe(){var e,t,r=mr;if(e=he(qe),ne(",")){for(t=[e];dr>ur&&ne(",");)N(),t.push(he(qe));e=new q(r).finishSequenceExpression(t)}return e}function Ye(){if(mr.type===Xt.Keyword)switch(mr.value){case"export":return"module"!==rr&&$(mr,Jt.IllegalExportDeclaration),Ut();case"import":return"module"!==rr&&$(mr,Jt.IllegalImportDeclaration),Ot();case"const":case"let":return nt({inFor:!1});case"function":return Tt(new G);case"class":return Lt()}return bt()}function Ke(){for(var e=[];dr>ur&&!ne("}");)e.push(Ye());return e}function Qe(){var e,t=new G;return ee("{"),e=Ke(),ee("}"),t.finishBlockStatement(e)}function Ze(){var e,t=new G;return e=N(),e.type!==Xt.Identifier&&(tr&&e.type===Xt.Keyword&&c(e.value)?$(e,Jt.StrictReservedWord):J(e)),t.finishIdentifier(e.value)}function Je(){var e,t=null,r=new G,n=[];return e=fe(n),tr&&p(e.name)&&Q(Jt.StrictVarName),ne("=")?(N(),t=he(qe)):e.type!==Qt.Identifier&&ee("="),r.finishVariableDeclarator(e,t)}function $e(){var e=[];do{if(e.push(Je()),!ne(","))break;N()}while(dr>ur);return e}function et(e){var t;return re("var"),t=$e(),se(),e.finishVariableDeclaration(t)}function tt(e,t){var r,n=null,i=new G,o=[];return r=fe(o),tr&&r.type===Qt.Identifier&&p(r.name)&&Q(Jt.StrictVarName),"const"===e?ie("in")||oe("of")||(ee("="),n=he(qe)):(!t.inFor&&r.type!==Qt.Identifier||ne("="))&&(ee("="),n=he(qe)),i.finishVariableDeclarator(r,n)}function rt(e,t){var r=[];do{if(r.push(tt(e,t)),!ne(","))break;N()}while(dr>ur);return r}function nt(e){var r,n,i=new G;return r=N().value,t("let"===r||"const"===r,"Lexical declaration must be either let or const"),n=rt(r,e),se(),i.finishLexicalDeclaration(n,r)}function it(e){var t,r=new G;return N(),ne("{")&&K(Jt.ObjectPatternAsRestParameter),e.push(mr),t=Ze(),ne("=")&&K(Jt.DefaultRestParameter),ne(")")||K(Jt.ParameterAfterRestParameter),r.finishRestElement(t)}function ot(e){return ee(";"),e.finishEmptyStatement()}function at(e){var t=Xe();return se(),e.finishExpressionStatement(t)}function st(e){var t,r,n;return re("if"),ee("("),t=Xe(),ee(")"),r=bt(),ie("else")?(N(),n=bt()):n=null,e.finishIfStatement(t,r,n)}function ht(e){var t,r,n;return re("do"),n=vr.inIteration,vr.inIteration=!0,t=bt(),vr.inIteration=n,re("while"),ee("("),r=Xe(),ee(")"),ne(";")&&N(),e.finishDoWhileStatement(t,r)}function lt(e){var t,r,n;return re("while"),ee("("),t=Xe(),ee(")"),n=vr.inIteration,vr.inIteration=!0,r=bt(),vr.inIteration=n,e.finishWhileStatement(t,r)}function ut(e){var t,r,n,i,o,a,s,h,l,u,c,p,f=vr.allowIn;if(t=o=a=null,r=!0,re("for"),ee("("),ne(";"))N();else if(ie("var"))t=new G,N(),vr.allowIn=!1,t=t.finishVariableDeclaration($e()),vr.allowIn=f,1===t.declarations.length&&ie("in")?(N(),s=t,h=Xe(),t=null):1===t.declarations.length&&null===t.declarations[0].init&&oe("of")?(N(),s=t,h=qe(),t=null,r=!1):ee(";");else if(ie("const")||ie("let"))t=new G,l=N().value,vr.allowIn=!1,u=rt(l,{inFor:!0}),vr.allowIn=f,1===u.length&&null===u[0].init&&ie("in")?(t=t.finishLexicalDeclaration(u,l),N(),s=t,h=Xe(),t=null):1===u.length&&null===u[0].init&&oe("of")?(t=t.finishLexicalDeclaration(u,l),N(),s=t,h=qe(),t=null,r=!1):(se(),t=t.finishLexicalDeclaration(u,l));else if(i=mr,vr.allowIn=!1,t=le(qe),vr.allowIn=f,ie("in"))xr||Q(Jt.InvalidLHSInForIn),N(),Me(t),s=t,h=Xe(),t=null;else if(oe("of"))xr||Q(Jt.InvalidLHSInForLoop),N(),Me(t),s=t,h=qe(),t=null,r=!1;else{if(ne(",")){for(n=[t];ne(",");)N(),n.push(he(qe));t=new q(i).finishSequenceExpression(n)}ee(";")}return"undefined"==typeof s&&(ne(";")||(o=Xe()),ee(";"),ne(")")||(a=Xe())),ee(")"),p=vr.inIteration,vr.inIteration=!0,c=he(bt),vr.inIteration=p,"undefined"==typeof s?e.finishForStatement(t,o,a,c):r?e.finishForInStatement(s,h,c):e.finishForOfStatement(s,h,c)}function ct(e){var t,r=null;return re("continue"),59===er.charCodeAt(ur)?(N(),vr.inIteration||K(Jt.IllegalContinue),e.finishContinueStatement(null)):ar?(vr.inIteration||K(Jt.IllegalContinue),e.finishContinueStatement(null)):(mr.type===Xt.Identifier&&(r=Ze(),t="$"+r.name,Object.prototype.hasOwnProperty.call(vr.labelSet,t)||K(Jt.UnknownLabel,r.name)),se(),null!==r||vr.inIteration||K(Jt.IllegalContinue),e.finishContinueStatement(r))}function pt(e){var t,r=null;return re("break"),59===er.charCodeAt(sr)?(N(),vr.inIteration||vr.inSwitch||K(Jt.IllegalBreak),e.finishBreakStatement(null)):ar?(vr.inIteration||vr.inSwitch||K(Jt.IllegalBreak),e.finishBreakStatement(null)):(mr.type===Xt.Identifier&&(r=Ze(),t="$"+r.name,Object.prototype.hasOwnProperty.call(vr.labelSet,t)||K(Jt.UnknownLabel,r.name)),se(),null!==r||vr.inIteration||vr.inSwitch||K(Jt.IllegalBreak),e.finishBreakStatement(r))}function ft(e){var t=null;return re("return"),vr.inFunctionBody||Q(Jt.IllegalReturn),32===er.charCodeAt(sr)&&h(er.charCodeAt(sr+1))?(t=Xe(),se(),e.finishReturnStatement(t)):ar?e.finishReturnStatement(null):(ne(";")||ne("}")||mr.type===Xt.EOF||(t=Xe()),se(),e.finishReturnStatement(t))}function dt(e){var t,r;return tr&&Q(Jt.StrictModeWith),re("with"),ee("("),t=Xe(),ee(")"),r=bt(),e.finishWithStatement(t,r)}function mt(){var e,t,r=[],n=new G;for(ie("default")?(N(),e=null):(re("case"),e=Xe()),ee(":");dr>ur&&!(ne("}")||ie("default")||ie("case"));)t=Ye(),r.push(t);return n.finishSwitchCase(e,r)}function vt(e){var t,r,n,i,o;if(re("switch"),ee("("),t=Xe(),ee(")"),ee("{"),r=[],ne("}"))return N(),e.finishSwitchStatement(t,r);for(i=vr.inSwitch,vr.inSwitch=!0,o=!1;dr>ur&&!ne("}");)n=mt(),null===n.test&&(o&&K(Jt.MultipleDefaultsInSwitch),o=!0),r.push(n);return vr.inSwitch=i,ee("}"),e.finishSwitchStatement(t,r)}function gt(e){var t;return re("throw"),ar&&K(Jt.NewlineAfterThrow),t=Xe(),se(),e.finishThrowStatement(t)}function yt(){var e,t,r,n,i=[],o={},a=new G;for(re("catch"),ee("("),ne(")")&&J(mr),e=fe(i),r=0;r<i.length;r++)t="$"+i[r].value,Object.prototype.hasOwnProperty.call(o,t)&&Q(Jt.DuplicateBinding,i[r].value),o[t]=!0;return tr&&p(e.name)&&Q(Jt.StrictCatchVariable),ee(")"),n=Qe(),a.finishCatchClause(e,n)}function xt(e){var t,r=null,n=null;return re("try"),t=Qe(),ie("catch")&&(r=yt()),ie("finally")&&(N(),n=Qe()),r||n||K(Jt.NoCatchOrFinally),e.finishTryStatement(t,r,n)}function wt(e){return re("debugger"),se(),e.finishDebuggerStatement()}function bt(){var e,t,r,n,i=mr.type;if(i===Xt.EOF&&J(mr),i===Xt.Punctuator&&"{"===mr.value)return Qe();if(xr=yr=!0,n=new G,i===Xt.Punctuator)switch(mr.value){case";":return ot(n);case"(":return at(n)}else if(i===Xt.Keyword)switch(mr.value){case"break":return pt(n);case"continue":return ct(n);case"debugger":return wt(n);case"do":return ht(n);case"for":return ut(n);case"function":return Tt(n);case"if":return st(n);case"return":return ft(n);case"switch":return vt(n);case"throw":return gt(n);case"try":return xt(n);case"var":return et(n);case"while":return lt(n);case"with":return dt(n)}return e=Xe(),e.type===Qt.Identifier&&ne(":")?(N(),r="$"+e.name,Object.prototype.hasOwnProperty.call(vr.labelSet,r)&&K(Jt.Redeclaration,"Label",e.name),vr.labelSet[r]=!0,t=bt(),delete vr.labelSet[r],n.finishLabeledStatement(e,t)):(se(),n.finishExpressionStatement(e))}function _t(){var e,t,r,n,i,o,a,s,h,l=[],u=new G;for(ee("{");dr>ur&&mr.type===Xt.StringLiteral&&(t=mr,e=Ye(),l.push(e),e.expression.type===Qt.Literal);)r=er.slice(t.start+1,t.end-1),"use strict"===r?(tr=!0,n&&$(n,Jt.StrictOctalLiteral)):!n&&t.octal&&(n=t);for(i=vr.labelSet,o=vr.inIteration,a=vr.inSwitch,s=vr.inFunctionBody,h=vr.parenthesizedCount,vr.labelSet={},vr.inIteration=!1,vr.inSwitch=!1,vr.inFunctionBody=!0,vr.parenthesizedCount=0;dr>ur&&!ne("}");)l.push(Ye());return ee("}"),vr.labelSet=i,vr.inIteration=o,vr.inSwitch=a,vr.inFunctionBody=s,vr.parenthesizedCount=h,u.finishBlockStatement(l)}function St(e,t,r){var n="$"+r;tr?(p(r)&&(e.stricted=t,e.message=Jt.StrictParamName),Object.prototype.hasOwnProperty.call(e.paramSet,n)&&(e.stricted=t,e.message=Jt.StrictParamDupe)):e.firstRestricted||(p(r)?(e.firstRestricted=t,e.message=Jt.StrictParamName):c(r)?(e.firstRestricted=t,e.message=Jt.StrictReservedWord):Object.prototype.hasOwnProperty.call(e.paramSet,n)&&(e.stricted=t,e.message=Jt.StrictParamDupe)),e.paramSet[n]=!0}function Mt(e){var t,r,n,i,o=[];if(t=mr,"..."===t.value)return r=it(o),St(e,r.argument,r.argument.name),e.params.push(r),e.defaults.push(null),!1;for(r=de(o),n=0;n<o.length;n++)St(e,o[n],o[n].value);return r.type===Qt.AssignmentPattern&&(i=r.right,r=r.left,++e.defaultCount),e.params.push(r),e.defaults.push(i),!ne(")")}function Et(e){var t;if(t={params:[],defaultCount:0,defaults:[],firstRestricted:e},ee("("),!ne(")"))for(t.paramSet={};dr>ur&&Mt(t);)ee(",");return ee(")"),0===t.defaultCount&&(t.defaults=[]),{params:t.params,defaults:t.defaults,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}}function Tt(e,t){var r,n,i,o,a,s,h,l,u,f=null,d=[],m=[];return re("function"),l=ne("*"),l&&N(),t&&ne("(")||(n=mr,f=Ze(),tr?p(n.value)&&$(n,Jt.StrictFunctionName):p(n.value)?(a=n,s=Jt.StrictFunctionName):c(n.value)&&(a=n,s=Jt.StrictReservedWord)),u=vr.allowYield,vr.allowYield=!1,o=Et(a),vr.allowYield=u,d=o.params,m=o.defaults,i=o.stricted,a=o.firstRestricted,o.message&&(s=o.message),u=vr.allowYield,h=tr,vr.allowYield=l,r=_t(),tr&&a&&J(a,s),tr&&i&&$(i,s),tr=h,vr.allowYield=u,e.finishFunctionDeclaration(f,d,m,r,l)}function Ct(){var e,t,r,n,i,o,a,s,h,l=null,u=[],f=[],d=new G;return re("function"),s=ne("*"),s&&N(),ne("(")||(e=mr,l=Ze(),tr?p(e.value)&&$(e,Jt.StrictFunctionName):p(e.value)?(r=e,n=Jt.StrictFunctionName):c(e.value)&&(r=e,n=Jt.StrictReservedWord)),h=vr.allowYield,vr.allowYield=!1,i=Et(r),vr.allowYield=h,u=i.params,f=i.defaults,t=i.stricted,r=i.firstRestricted,i.message&&(n=i.message),a=tr,h=vr.allowYield,vr.allowYield=s,o=_t(),tr&&r&&J(r,n),tr&&t&&$(t,n),tr=a,vr.allowYield=h,d.finishFunctionExpression(l,u,f,o,s)}function At(){var e,t,r,n,i,o,a,s=!1;for(e=new G,ee("{"),n=[];!ne("}");)ne(";")?N():(i=new G,t=mr,r=!1,o=ne("["),ne("*")?N():(a=ye(),"static"===a.name&&(xe()||ne("*"))&&(t=mr,r=!0,o=ne("["),ne("*")?N():a=ye())),i=we(t,a,o,i),i?(i["static"]=r,"init"===i.kind&&(i.kind="method"),r?i.computed||"prototype"!==(i.key.name||i.key.value.toString())||J(t,Jt.StaticPrototype):i.computed||"constructor"!==(i.key.name||i.key.value.toString())||(("method"!==i.kind||!i.method||i.value.generator)&&J(t,Jt.ConstructorSpecialMethod),s?J(t,Jt.DuplicateConstructor):s=!0,i.kind="constructor"),i.type=Qt.MethodDefinition,delete i.method,delete i.shorthand,n.push(i)):J(mr));return N(),e.finishClassBody(n)}function Lt(e){var t,r=null,n=null,i=new G,o=tr;return tr=!0,re("class"),e&&mr.type!==Xt.Identifier||(r=Ze()),ie("extends")&&(N(),n=he(ke)),t=At(),tr=o,i.finishClassDeclaration(r,n,t)}function Rt(){var e,t=null,r=null,n=new G,i=tr;return tr=!0,re("class"),mr.type===Xt.Identifier&&(t=Ze()),ie("extends")&&(N(),r=he(ke)),e=At(),tr=i,n.finishClassExpression(t,r,e)}function Pt(){var e=new G;return mr.type!==Xt.StringLiteral&&K(Jt.InvalidModuleSpecifier),e.finishLiteral(N())}function Bt(){var e,t,r,n=new G;return ie("default")?(r=new G,N(),t=r.finishIdentifier("default")):t=Ze(),oe("as")&&(N(),e=Re()),n.finishExportSpecifier(t,e)}function Ft(e){var t,r=null,n=null,i=[];if(mr.type===Xt.Keyword)switch(mr.value){case"let":case"const":case"var":case"class":case"function":return r=Ye(),e.finishExportNamedDeclaration(r,i,null)}if(ee("{"),!ne("}"))do t=t||ie("default"),i.push(Bt());while(ne(",")&&N());return ee("}"),oe("from")?(N(),n=Pt(),se()):t?K(mr.value?Jt.UnexpectedToken:Jt.MissingFromClause,mr.value):se(),e.finishExportNamedDeclaration(r,i,n)}function kt(e){var t=null,r=null;return re("default"),ie("function")?(t=Tt(new G,!0),e.finishExportDefaultDeclaration(t)):ie("class")?(t=Lt(!0),e.finishExportDefaultDeclaration(t)):(oe("from")&&K(Jt.UnexpectedToken,mr.value),r=ne("{")?Se():ne("[")?me():qe(),se(),e.finishExportDefaultDeclaration(r))}function Dt(e){var t;return ee("*"),oe("from")||K(mr.value?Jt.UnexpectedToken:Jt.MissingFromClause,mr.value),N(),t=Pt(),se(),e.finishExportAllDeclaration(t)}function Ut(){var e=new G;return vr.inFunctionBody&&K(Jt.IllegalExportDeclaration),re("export"),ie("default")?kt(e):ne("*")?Dt(e):Ft(e)}function zt(){var e,t,r=new G;return t=Re(),oe("as")&&(N(),e=Ze()),r.finishImportSpecifier(e,t)}function Vt(){var e=[];if(ee("{"),!ne("}"))do e.push(zt());while(ne(",")&&N());return ee("}"),e}function It(){var e,t=new G;return e=Re(),t.finishImportDefaultSpecifier(e)}function Nt(){var e,t=new G;return ee("*"),oe("as")||K(Jt.NoAsAfterImportNamespace),N(),e=Re(),t.finishImportNamespaceSpecifier(e)}function Ot(){var e,t,r=new G;return vr.inFunctionBody&&K(Jt.IllegalImportDeclaration),re("import"),e=[],mr.type===Xt.StringLiteral?(t=Pt(),se(),r.finishImportDeclaration(e,t)):(!ie("default")&&U(mr)&&(e.push(It()),ne(",")&&N()),ne("*")?e.push(Nt()):ne("{")&&(e=e.concat(Vt())),oe("from")||K(mr.value?Jt.UnexpectedToken:Jt.MissingFromClause,mr.value),N(),t=Pt(),se(),r.finishImportDeclaration(e,t))}function jt(){for(var e,t,r,n,i=[];dr>ur&&(t=mr,t.type===Xt.StringLiteral)&&(e=Ye(),i.push(e),e.expression.type===Qt.Literal);)r=er.slice(t.start+1,t.end-1),"use strict"===r?(tr=!0,n&&$(n,Jt.StrictOctalLiteral)):!n&&t.octal&&(n=t);for(;dr>ur&&(e=Ye(),"undefined"!=typeof e);)i.push(e);return i}function Wt(){var e,t;return O(),t=new G,e=jt(),t.finishProgram(e)}function Ht(){var e,t,r,n=[];for(e=0;e<gr.tokens.length;++e)t=gr.tokens[e],r={type:t.type,value:t.value},t.regex&&(r.regex={pattern:t.regex.pattern,flags:t.regex.flags}),gr.range&&(r.range=t.range),gr.loc&&(r.loc=t.loc),n.push(r);gr.tokens=n}function Gt(e,t){var r,n;r=String,"string"==typeof e||e instanceof String||(e=r(e)),er=e,nr=0,ir=er.length>0?1:0,or=0,ur=nr,cr=ir,pr=or,dr=er.length,mr=null,vr={allowIn:!0,allowYield:!1,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1,curlyStack:[]},gr={},t=t||{},t.tokens=!0,gr.tokens=[],gr.tokenize=!0,gr.openParenToken=-1,gr.openCurlyToken=-1,gr.range="boolean"==typeof t.range&&t.range,gr.loc="boolean"==typeof t.loc&&t.loc,"boolean"==typeof t.comment&&t.comment&&(gr.comments=[]),"boolean"==typeof t.tolerant&&t.tolerant&&(gr.errors=[]);try{if(O(),mr.type===Xt.EOF)return gr.tokens;for(N();mr.type!==Xt.EOF;)try{N()}catch(i){if(gr.errors){X(i);break}throw i}Ht(),n=gr.tokens,"undefined"!=typeof gr.comments&&(n.comments=gr.comments),"undefined"!=typeof gr.errors&&(n.errors=gr.errors)}catch(o){throw o}finally{gr={}}return n}function qt(e,t){var r,n;n=String,"string"==typeof e||e instanceof String||(e=n(e)),er=e,nr=0,ir=er.length>0?1:0,or=0,ur=nr,cr=ir,pr=or,dr=er.length,mr=null,vr={allowIn:!0,allowYield:!1,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1,curlyStack:[]},rr="script",tr=!1,gr={},"undefined"!=typeof t&&(gr.range="boolean"==typeof t.range&&t.range,gr.loc="boolean"==typeof t.loc&&t.loc,gr.attachComment="boolean"==typeof t.attachComment&&t.attachComment,gr.loc&&null!==t.source&&void 0!==t.source&&(gr.source=n(t.source)),"boolean"==typeof t.tokens&&t.tokens&&(gr.tokens=[]),"boolean"==typeof t.comment&&t.comment&&(gr.comments=[]),"boolean"==typeof t.tolerant&&t.tolerant&&(gr.errors=[]),gr.attachComment&&(gr.range=!0,gr.comments=[],gr.bottomRightStack=[],gr.trailingComments=[],gr.leadingComments=[]),"module"===t.sourceType&&(rr=t.sourceType,tr=!0));try{r=Wt(),"undefined"!=typeof gr.comments&&(r.comments=gr.comments),"undefined"!=typeof gr.tokens&&(Ht(),r.tokens=gr.tokens),"undefined"!=typeof gr.errors&&(r.errors=gr.errors)}catch(i){throw i}finally{gr={}}return r}var Xt,Yt,Kt,Qt,Zt,Jt,$t,er,tr,rr,nr,ir,or,ar,sr,hr,lr,ur,cr,pr,fr,dr,mr,vr,gr,yr,xr,wr;Xt={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9,Template:10},Yt={},Yt[Xt.BooleanLiteral]="Boolean",Yt[Xt.EOF]="<end>",Yt[Xt.Identifier]="Identifier",Yt[Xt.Keyword]="Keyword",Yt[Xt.NullLiteral]="Null",Yt[Xt.NumericLiteral]="Numeric",Yt[Xt.Punctuator]="Punctuator",Yt[Xt.StringLiteral]="String",Yt[Xt.RegularExpression]="RegularExpression",Yt[Xt.Template]="Template",Kt=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],Qt={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",
ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},Zt={ArrowParameterPlaceHolder:"ArrowParameterPlaceHolder"},Jt={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",IllegalYield:"Unexpected token yield",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",DefaultRestParameter:"Unexpected token =",ObjectPatternAsRestParameter:"Unexpected token {",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ConstructorSpecialMethod:"Class constructor may not be an accessor",DuplicateConstructor:"A class may only have one constructor",StaticPrototype:"Classes may not have static property named prototype",MissingFromClause:"Unexpected token",NoAsAfterImportNamespace:"Unexpected token",InvalidModuleSpecifier:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalExportDeclaration:"Unexpected token",DuplicateBinding:"Duplicate binding %0"},$t={NonAsciiIdentifierStart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢲऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),NonAsciiIdentifierPart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԯԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠ-ࢲࣤ-ॣ०-९ॱ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఀ-ఃఅ-ఌఎ-ఐఒ-నప-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಁ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲഁ-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟ෦-෯ෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤞᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧ᪰-᪽ᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶ᳸᳹ᴀ-᷵᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚝꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꧠ-ꧾꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︭︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]")},q.prototype=G.prototype={processComment:function(){var e,t,r,n,i,o=gr.bottomRightStack,a=o[o.length-1];if(!(this.type===Qt.Program&&this.body.length>0)){if(gr.trailingComments.length>0){for(r=[],n=gr.trailingComments.length-1;n>=0;--n)i=gr.trailingComments[n],i.range[0]>=this.range[1]&&(r.unshift(i),gr.trailingComments.splice(n,1));gr.trailingComments=[]}else a&&a.trailingComments&&a.trailingComments[0].range[0]>=this.range[1]&&(r=a.trailingComments,delete a.trailingComments);for(;a&&a.range[0]>=this.range[0];)e=o.pop(),a=o[o.length-1];if(e){if(e.leadingComments){for(t=[],n=e.leadingComments.length-1;n>=0;--n)i=e.leadingComments[n],i.range[1]<=this.range[0]&&(t.unshift(i),e.leadingComments.splice(n,1));e.leadingComments.length||(e.leadingComments=void 0)}}else if(gr.leadingComments.length>0)for(t=[],n=gr.leadingComments.length-1;n>=0;--n)i=gr.leadingComments[n],i.range[1]<=this.range[0]&&(t.unshift(i),gr.leadingComments.splice(n,1));t&&t.length>0&&(this.leadingComments=t),r&&r.length>0&&(this.trailingComments=r),o.push(this)}},finish:function(){gr.range&&(this.range[1]=sr),gr.loc&&(this.loc.end={line:hr,column:sr-lr},gr.source&&(this.loc.source=gr.source)),gr.attachComment&&this.processComment()},finishArrayExpression:function(e){return this.type=Qt.ArrayExpression,this.elements=e,this.finish(),this},finishArrayPattern:function(e){return this.type=Qt.ArrayPattern,this.elements=e,this.finish(),this},finishArrowFunctionExpression:function(e,t,r,n){return this.type=Qt.ArrowFunctionExpression,this.id=null,this.params=e,this.defaults=t,this.body=r,this.generator=!1,this.expression=n,this.finish(),this},finishAssignmentExpression:function(e,t,r){return this.type=Qt.AssignmentExpression,this.operator=e,this.left=t,this.right=r,this.finish(),this},finishAssignmentPattern:function(e,t){return this.type=Qt.AssignmentPattern,this.left=e,this.right=t,this.finish(),this},finishBinaryExpression:function(e,t,r){return this.type="||"===e||"&&"===e?Qt.LogicalExpression:Qt.BinaryExpression,this.operator=e,this.left=t,this.right=r,this.finish(),this},finishBlockStatement:function(e){return this.type=Qt.BlockStatement,this.body=e,this.finish(),this},finishBreakStatement:function(e){return this.type=Qt.BreakStatement,this.label=e,this.finish(),this},finishCallExpression:function(e,t){return this.type=Qt.CallExpression,this.callee=e,this.arguments=t,this.finish(),this},finishCatchClause:function(e,t){return this.type=Qt.CatchClause,this.param=e,this.body=t,this.finish(),this},finishClassBody:function(e){return this.type=Qt.ClassBody,this.body=e,this.finish(),this},finishClassDeclaration:function(e,t,r){return this.type=Qt.ClassDeclaration,this.id=e,this.superClass=t,this.body=r,this.finish(),this},finishClassExpression:function(e,t,r){return this.type=Qt.ClassExpression,this.id=e,this.superClass=t,this.body=r,this.finish(),this},finishConditionalExpression:function(e,t,r){return this.type=Qt.ConditionalExpression,this.test=e,this.consequent=t,this.alternate=r,this.finish(),this},finishContinueStatement:function(e){return this.type=Qt.ContinueStatement,this.label=e,this.finish(),this},finishDebuggerStatement:function(){return this.type=Qt.DebuggerStatement,this.finish(),this},finishDoWhileStatement:function(e,t){return this.type=Qt.DoWhileStatement,this.body=e,this.test=t,this.finish(),this},finishEmptyStatement:function(){return this.type=Qt.EmptyStatement,this.finish(),this},finishExpressionStatement:function(e){return this.type=Qt.ExpressionStatement,this.expression=e,this.finish(),this},finishForStatement:function(e,t,r,n){return this.type=Qt.ForStatement,this.init=e,this.test=t,this.update=r,this.body=n,this.finish(),this},finishForOfStatement:function(e,t,r){return this.type=Qt.ForOfStatement,this.left=e,this.right=t,this.body=r,this.finish(),this},finishForInStatement:function(e,t,r){return this.type=Qt.ForInStatement,this.left=e,this.right=t,this.body=r,this.each=!1,this.finish(),this},finishFunctionDeclaration:function(e,t,r,n,i){return this.type=Qt.FunctionDeclaration,this.id=e,this.params=t,this.defaults=r,this.body=n,this.generator=i,this.expression=!1,this.finish(),this},finishFunctionExpression:function(e,t,r,n,i){return this.type=Qt.FunctionExpression,this.id=e,this.params=t,this.defaults=r,this.body=n,this.generator=i,this.expression=!1,this.finish(),this},finishIdentifier:function(e){return this.type=Qt.Identifier,this.name=e,this.finish(),this},finishIfStatement:function(e,t,r){return this.type=Qt.IfStatement,this.test=e,this.consequent=t,this.alternate=r,this.finish(),this},finishLabeledStatement:function(e,t){return this.type=Qt.LabeledStatement,this.label=e,this.body=t,this.finish(),this},finishLiteral:function(e){return this.type=Qt.Literal,this.value=e.value,this.raw=er.slice(e.start,e.end),e.regex&&(this.regex=e.regex),this.finish(),this},finishMemberExpression:function(e,t,r){return this.type=Qt.MemberExpression,this.computed="["===e,this.object=t,this.property=r,this.finish(),this},finishNewExpression:function(e,t){return this.type=Qt.NewExpression,this.callee=e,this.arguments=t,this.finish(),this},finishObjectExpression:function(e){return this.type=Qt.ObjectExpression,this.properties=e,this.finish(),this},finishObjectPattern:function(e){return this.type=Qt.ObjectPattern,this.properties=e,this.finish(),this},finishPostfixExpression:function(e,t){return this.type=Qt.UpdateExpression,this.operator=e,this.argument=t,this.prefix=!1,this.finish(),this},finishProgram:function(e){return this.type=Qt.Program,this.body=e,"module"===rr&&(this.sourceType=rr),this.finish(),this},finishProperty:function(e,t,r,n,i,o){return this.type=Qt.Property,this.key=t,this.computed=r,this.value=n,this.kind=e,this.method=i,this.shorthand=o,this.finish(),this},finishRestElement:function(e){return this.type=Qt.RestElement,this.argument=e,this.finish(),this},finishReturnStatement:function(e){return this.type=Qt.ReturnStatement,this.argument=e,this.finish(),this},finishSequenceExpression:function(e){return this.type=Qt.SequenceExpression,this.expressions=e,this.finish(),this},finishSpreadElement:function(e){return this.type=Qt.SpreadElement,this.argument=e,this.finish(),this},finishSwitchCase:function(e,t){return this.type=Qt.SwitchCase,this.test=e,this.consequent=t,this.finish(),this},finishSuper:function(){return this.type=Qt.Super,this.finish(),this},finishSwitchStatement:function(e,t){return this.type=Qt.SwitchStatement,this.discriminant=e,this.cases=t,this.finish(),this},finishTaggedTemplateExpression:function(e,t){return this.type=Qt.TaggedTemplateExpression,this.tag=e,this.quasi=t,this.finish(),this},finishTemplateElement:function(e,t){return this.type=Qt.TemplateElement,this.value=e,this.tail=t,this.finish(),this},finishTemplateLiteral:function(e,t){return this.type=Qt.TemplateLiteral,this.quasis=e,this.expressions=t,this.finish(),this},finishThisExpression:function(){return this.type=Qt.ThisExpression,this.finish(),this},finishThrowStatement:function(e){return this.type=Qt.ThrowStatement,this.argument=e,this.finish(),this},finishTryStatement:function(e,t,r){return this.type=Qt.TryStatement,this.block=e,this.guardedHandlers=[],this.handlers=t?[t]:[],this.handler=t,this.finalizer=r,this.finish(),this},finishUnaryExpression:function(e,t){return this.type="++"===e||"--"===e?Qt.UpdateExpression:Qt.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0,this.finish(),this},finishVariableDeclaration:function(e){return this.type=Qt.VariableDeclaration,this.declarations=e,this.kind="var",this.finish(),this},finishLexicalDeclaration:function(e,t){return this.type=Qt.VariableDeclaration,this.declarations=e,this.kind=t,this.finish(),this},finishVariableDeclarator:function(e,t){return this.type=Qt.VariableDeclarator,this.id=e,this.init=t,this.finish(),this},finishWhileStatement:function(e,t){return this.type=Qt.WhileStatement,this.test=e,this.body=t,this.finish(),this},finishWithStatement:function(e,t){return this.type=Qt.WithStatement,this.object=e,this.body=t,this.finish(),this},finishExportSpecifier:function(e,t){return this.type=Qt.ExportSpecifier,this.exported=t||e,this.local=e,this.finish(),this},finishImportDefaultSpecifier:function(e){return this.type=Qt.ImportDefaultSpecifier,this.local=e,this.finish(),this},finishImportNamespaceSpecifier:function(e){return this.type=Qt.ImportNamespaceSpecifier,this.local=e,this.finish(),this},finishExportNamedDeclaration:function(e,t,r){return this.type=Qt.ExportNamedDeclaration,this.declaration=e,this.specifiers=t,this.source=r,this.finish(),this},finishExportDefaultDeclaration:function(e){return this.type=Qt.ExportDefaultDeclaration,this.declaration=e,this.finish(),this},finishExportAllDeclaration:function(e){return this.type=Qt.ExportAllDeclaration,this.source=e,this.finish(),this},finishImportSpecifier:function(e,t){return this.type=Qt.ImportSpecifier,this.local=e||t,this.imported=t,this.finish(),this},finishImportDeclaration:function(e,t){return this.type=Qt.ImportDeclaration,this.specifiers=e,this.source=t,this.finish(),this},finishYieldExpression:function(e,t){return this.type=Qt.YieldExpression,this.argument=e,this.delegate=t,this.finish(),this}},e.version="2.4.1",e.tokenize=Gt,e.parse=qt,e.Syntax=function(){var e,t={};"function"==typeof Object.create&&(t=Object.create(null));for(e in Qt)Qt.hasOwnProperty(e)&&(t[e]=Qt[e]);return"function"==typeof Object.freeze&&Object.freeze(t),t}()})},{}],16:[function(e,t,r){function n(e,t,r){for(var n=0;c>n;n++)if(d=u[n],d.x==~~e&&d.y==~~t&&r-d.time<l)return!0}function i(e,t,r){p=(p+1)%c,d=u[p],d.x=~~e,d.y=~~t,d.time=r}function o(e,t){function r(e,t,r){var o=(new Date).getTime();n(e,t,o)||l.onPointerSelectSignal.dispatch(e,t,r),i(e,t,o)}this.touch=new s(e),this.mouse=new a(e,void 0,t),this.onPointerSelectSignal=new h.Signal,this.onPointerDownSignal=new h.Signal,this.onPointerUpSignal=new h.Signal,this.onPointerMoveSignal=new h.Signal,this.onPointerHoverSignal=new h.Signal,this.onPointerDragSignal=new h.Signal,this.mouseID=10,this.positionsById=[];for(var o=0;o<=this.mouseID;o++)this.positionsById[o]={x:0,y:0};var l=this;this.touch.onTouchStartSignal.add(this.onPointerDownSignal.dispatch),this.touch.onTouchMoveSignal.add(function(e,t,r){l.positionsById[r].x=e,l.positionsById[r].y=t,l.onPointerDragSignal.dispatch(e,t,r)}),this.touch.onTouchEndSignal.add(this.onPointerUpSignal.dispatch),this.touch.onTouchTapSignal.add(r),this.mouse.onDownSignal.add(function(e,t){l.onPointerDownSignal.dispatch(e,t,l.mouseID)}),this.mouse.onUpSignal.add(function(e,t){l.onPointerUpSignal.dispatch(e,t,l.mouseID)}),this.mouse.onDragSignal.add(function(e,t){l.onPointerDragSignal.dispatch(e,t,l.mouseID)}),this.mouse.onHoverSignal.add(function(e,t){l.onPointerHoverSignal.dispatch(e,t,l.mouseID)}),this.mouse.onMoveSignal.add(function(e,t){l.positionsById[l.mouseID].x=e,l.positionsById[l.mouseID].y=t,l.onPointerMoveSignal.dispatch(e,t,l.mouseID)}),this.mouse.onClickSignal.add(function(e,t){r(e,t,l.mouseID)})}for(var a=e("input-mouse"),s=e("input-touch"),h=e("signals"),l=60,u=[],c=10,p=0,f=0;c>f;f++)u[f]={x:0,y:0,time:0};var d;t.exports=o},{"input-mouse":17,"input-touch":19,signals:21}],17:[function(e,t,r){function n(e){return e===window||e===document||e===document.body?a:e.getBoundingClientRect()}var i=e("signals"),o=e("browser-event-adder"),a={left:0,top:0},s=function(e,t,r){this.targetElement=e,this.offsetRelativeToTarget=void 0===t?!0:t,this.x=0,this.y=0,this.lastX=0,this.lastY=0,this.relX=0,this.relY=0,this.downX=0,this.downY=0,this.isDown=!1,this.onMoveSignal=new i.Signal,this.onMoveRelativeSignal=new i.Signal,this.onDragSignal=new i.Signal,this.onDragRelativeSignal=new i.Signal,this.onHoverSignal=new i.Signal,this.onHoverRelativeSignal=new i.Signal,this.onDownSignal=new i.Signal,this.onUpSignal=new i.Signal,this.onClickSignal=new i.Signal,this.onOutSignal=new i.Signal,this.start=!0,this.clickDistanceThreshPixels=5,this.clickDistanceThreshPixelsSquared=this.clickDistanceThreshPixels*this.clickDistanceThreshPixels,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseOut=this.onMouseOut.bind(this),o.addEvent(e,"mousemove",this.onMouseMove),o.addEvent(e,"mousedown",this.onMouseDown),o.addEvent(r?r:e,"mouseup",this.onMouseUp),o.addEvent(e,"mouseout",this.onMouseOut)};s.prototype={testMovedSinceDown:function(){var e=this.downX-this.x,t=this.downY-this.y;return e*e+t*t>this.clickDistanceThreshPixelsSquared},onMouseMove:function(e){this.computeCustomOffset(e),this.x=e.offsetX2,this.y=e.offsetY2,isNaN(this.x)&&this.computeCustomOffset(e),this.onMoveSignal.dispatch(this.x,this.y),this.isDown?this.onDragSignal.dispatch(this.x,this.y):this.onHoverSignal.dispatch(this.x,this.y),this.start?this.start=!1:(this.relX=this.x-this.lastX,this.relY=this.y-this.lastY,this.onMoveRelativeSignal.dispatch(this.relX,this.relY),this.isDown?this.onDragRelativeSignal.dispatch(this.relX,this.relY):this.onHoverRelativeSignal.dispatch(this.relX,this.relY)),this.lastX=this.x,this.lastY=this.y},onMouseDown:function(e){this.isDown=!0,this.downX=this.x,this.downY=this.y,this.onDownSignal.dispatch(this.x,this.y)},onMouseUp:function(e){this.testMovedSinceDown()||this.onClickSignal.dispatch(this.x,this.y),this.isDown=!1,this.onUpSignal.dispatch(this.x,this.y)},onMouseOut:function(e){this.isDown=!1,this.onOutSignal.dispatch()},computeCustomOffset:function(e){if(this.offsetRelativeToTarget){var t=n(this.targetElement);e.offsetX2=e.clientX-t.left,e.offsetY2=e.clientY-t.top}else e.offsetX2=e.clientX,e.offsetY2=e.clientY},testDown:function(e,t){this.onMouseDown({target:this.targetElement,offsetX:e,offsetY:t,clientX:e,clientY:t})},testMove:function(e,t){this.onMouseMove({target:this.targetElement,offsetX:e,offsetY:t,clientX:e,clientY:t})},testUp:function(e,t){this.onMouseUp({target:this.targetElement,offsetX:e,offsetY:t,clientX:e,clientY:t})}},t.exports=s},{"browser-event-adder":18,signals:21}],18:[function(e,t,r){var n={addEvent:function(e,t,r){null!=e&&"undefined"!=typeof e&&(e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r)}};t.exports=n},{}],19:[function(e,t,r){function n(e){var t=e.downX-e.x,r=e.downY-e.y;return t*t+r*r>p}function i(e,t,r){return{changedTouches:[{clientX:e,clientY:t,identifier:r}],preventDefault:function(){}}}function o(e){this.targetElement=e,this.isDocument=this.targetElement===document,this.touches=new Array(100),this.touchPool=new Array(100);for(var t=0;t<this.touchPool.length;t++)this.touchPool[t]=-1;this.testStart=this.testStart.bind(this),this.testMove=this.testMove.bind(this),this.testEnd=this.testEnd.bind(this),this._touchstart=this._touchstart.bind(this),this._touchmove=this._touchmove.bind(this),this._touchend=this._touchend.bind(this),l.addEvent(e,"touchstart",this._touchstart),l.addEvent(e,"touchmove",this._touchmove),l.addEvent(e,"touchend",this._touchend),this.onTouchStartSignal=new u.Signal,this.onTouchEndSignal=new u.Signal,this.onTouchMoveSignal=new u.Signal,this.onTouchTapSignal=new u.Signal}var a="start",s="move",h="end",l=e("browser-event-adder"),u=e("signals"),c=5,p=c*c;o.prototype={testStart:function(e,t,r){this._touchstart(i(e,t,r))},testMove:function(e,t,r){this._touchmove(i(e,t,r))},testEnd:function(e,t,r){this._touchend(i(e,t,r))},poolIdentifier:function(e){return this.touchPool.indexOf(e)},addTouchToPool:function(e){var t=this.touchPool.indexOf(-1);this.touchPool[t]=e},releaseTouchFromPool:function(e){var t=this.touchPool.indexOf(e);this.touchPool[t]=-1},_processTouchEvent:function(e,t){this.isDocument?(e.offsetX=e.clientX,e.offsetY=e.clientY):(e.offsetX=e.clientX-this.targetElement.offsetLeft,e.offsetY=e.clientY-this.targetElement.offsetTop);var r=e.identifier||0;r=this.poolIdentifier(r);var i=this.touches[r];switch(t){case a:i={downX:e.offsetX,downY:e.offsetY,x:e.offsetX,y:e.offsetY},this.touches[r]=i,this.onTouchStartSignal.dispatch(i.x,i.y,r);break;case s:var i=this.touches[r];if(!i)return;i.x=e.offsetX,i.y=e.offsetY,this.onTouchMoveSignal.dispatch(i.x,i.y,r);break;case h:var i=this.touches[r];this.touches[r]=null,this.onTouchEndSignal.dispatch(i.x,i.y,r),n(i)||this.onTouchTapSignal.dispatch(i.x,i.y,r)}},_processTouchEventList:function(e,t){for(var r=e.length-1;r>=0;r--)this._processTouchEvent(e[r],t)},_touchstart:function(e){e.preventDefault();for(var t=e.changedTouches.length-1;t>=0;t--)this.addTouchToPool(e.changedTouches[t].identifier);this._processTouchEventList(e.changedTouches,a)},_touchmove:function(e){e.preventDefault(),this._processTouchEventList(e.changedTouches,s)},_touchend:function(e){e.preventDefault(),this._processTouchEventList(e.changedTouches,h);for(var t=e.changedTouches.length-1;t>=0;t--)this.releaseTouchFromPool(e.changedTouches[t].identifier)}},t.exports=o},{"browser-event-adder":20,signals:21}],20:[function(e,t,r){arguments[4][18][0].apply(r,arguments)},{dup:18}],21:[function(e,t,r){!function(e){function r(e,t,r,n,i){this._listener=t,this._isOnce=r,this.context=n,this._signal=e,this._priority=i||0}function n(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function i(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){i.prototype.dispatch.apply(e,arguments)}}r.prototype={active:!0,params:null,execute:function(e){var t,r;return this.active&&this._listener&&(r=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,r),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},i.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,n,i){var o,a=this._indexOfListener(e,n);if(-1!==a){if(o=this._bindings[a],o.isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else o=new r(this,e,t,n,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var r,n=this._bindings.length;n--;)if(r=this._bindings[n],r._listener===e&&r.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,r){return n(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return n(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){n(e,"remove");var r=this._indexOfListener(e,t);return-1!==r&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,r=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=r),n){t=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(t[n]&&this._shouldPropagate&&t[n].execute(r)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var o=i;o.Signal=i,"function"==typeof define&&define.amd?define(function(){return o}):"undefined"!=typeof t&&t.exports?t.exports=o:e.signals=o}(this)},{}],22:[function(e,t,r){arguments[4][21][0].apply(r,arguments)},{dup:21}],23:[function(e,t,r){var n=n||{},i={REVISION:"71"};"object"==typeof t&&(t.exports=i),void 0===Math.sign&&(Math.sign=function(e){return 0>e?-1:e>0?1:+e}),i.log=function(){console.log.apply(console,arguments)},i.warn=function(){console.warn.apply(console,arguments)},i.error=function(){console.error.apply(console,arguments)},i.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},i.CullFaceNone=0,i.CullFaceBack=1,i.CullFaceFront=2,i.CullFaceFrontBack=3,i.FrontFaceDirectionCW=0,i.FrontFaceDirectionCCW=1,i.BasicShadowMap=0,i.PCFShadowMap=1,i.PCFSoftShadowMap=2,i.FrontSide=0,i.BackSide=1,i.DoubleSide=2,i.NoShading=0,i.FlatShading=1,i.SmoothShading=2,i.NoColors=0,i.FaceColors=1,i.VertexColors=2,i.NoBlending=0,i.NormalBlending=1,i.AdditiveBlending=2,i.SubtractiveBlending=3,i.MultiplyBlending=4,i.CustomBlending=5,i.AddEquation=100,i.SubtractEquation=101,i.ReverseSubtractEquation=102,i.MinEquation=103,i.MaxEquation=104,i.ZeroFactor=200,i.OneFactor=201,i.SrcColorFactor=202,i.OneMinusSrcColorFactor=203,i.SrcAlphaFactor=204,i.OneMinusSrcAlphaFactor=205,i.DstAlphaFactor=206,i.OneMinusDstAlphaFactor=207,i.DstColorFactor=208,i.OneMinusDstColorFactor=209,i.SrcAlphaSaturateFactor=210,i.MultiplyOperation=0,i.MixOperation=1,i.AddOperation=2,i.UVMapping=300,i.CubeReflectionMapping=301,i.CubeRefractionMapping=302,i.EquirectangularReflectionMapping=303,i.EquirectangularRefractionMapping=304,i.SphericalReflectionMapping=305,i.RepeatWrapping=1e3,i.ClampToEdgeWrapping=1001,i.MirroredRepeatWrapping=1002,i.NearestFilter=1003,i.NearestMipMapNearestFilter=1004,i.NearestMipMapLinearFilter=1005,i.LinearFilter=1006,i.LinearMipMapNearestFilter=1007,i.LinearMipMapLinearFilter=1008,i.UnsignedByteType=1009,i.ByteType=1010,i.ShortType=1011,i.UnsignedShortType=1012,i.IntType=1013,i.UnsignedIntType=1014,i.FloatType=1015,i.HalfFloatType=1025,i.UnsignedShort4444Type=1016,i.UnsignedShort5551Type=1017,i.UnsignedShort565Type=1018,i.AlphaFormat=1019,i.RGBFormat=1020,i.RGBAFormat=1021,i.LuminanceFormat=1022,i.LuminanceAlphaFormat=1023,i.RGBEFormat=i.RGBAFormat,i.RGB_S3TC_DXT1_Format=2001,i.RGBA_S3TC_DXT1_Format=2002,i.RGBA_S3TC_DXT3_Format=2003,i.RGBA_S3TC_DXT5_Format=2004,i.RGB_PVRTC_4BPPV1_Format=2100,i.RGB_PVRTC_2BPPV1_Format=2101,i.RGBA_PVRTC_4BPPV1_Format=2102,i.RGBA_PVRTC_2BPPV1_Format=2103,i.Projector=function(){i.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){i.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){i.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){i.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},i.CanvasRenderer=function(){i.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},i.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},i.Color.prototype={constructor:i.Color,r:1,g:1,b:1,set:function(e){return e instanceof i.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(0===t)this.r=this.g=this.b=r;else{var n=function(e,t,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?e+6*(t-e)*r:.5>r?t:2/3>r?e+6*(t-e)*(2/3-r):e},i=.5>=r?r*(1+t):r+t-r*t,o=2*r-i;this.r=n(o,i,e+1/3),this.g=n(o,i,e),this.b=n(o,i,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}return/^(\w+)$/i.test(e)?(this.setHex(i.ColorKeywords[e]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,r,n=e||{h:0,s:0,l:0},i=this.r,o=this.g,a=this.b,s=Math.max(i,o,a),h=Math.min(i,o,a),l=(h+s)/2;if(h===s)t=0,r=0;else{var u=s-h;switch(r=.5>=l?u/(s+h):u/(2-s-h),s){case i:t=(o-a)/u+(a>o?6:0);break;case o:t=(a-i)/u+2;
break;case a:t=(i-o)/u+4}t/=6}return n.h=t,n.s=r,n.l=l,n},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var n=this.getHSL();return n.h+=e,n.s+=t,n.l+=r,this.setHSL(n.h,n.s,n.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},clone:function(){return(new i.Color).setRGB(this.r,this.g,this.b)}},i.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},i.Quaternion=function(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1},i.Quaternion.prototype={constructor:i.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this.onChangeCallback(),this},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof i.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=Math.cos(e._x/2),n=Math.cos(e._y/2),o=Math.cos(e._z/2),a=Math.sin(e._x/2),s=Math.sin(e._y/2),h=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=a*n*o+r*s*h,this._y=r*s*o-a*n*h,this._z=r*n*h+a*s*o,this._w=r*n*o-a*s*h):"YXZ"===e.order?(this._x=a*n*o+r*s*h,this._y=r*s*o-a*n*h,this._z=r*n*h-a*s*o,this._w=r*n*o+a*s*h):"ZXY"===e.order?(this._x=a*n*o-r*s*h,this._y=r*s*o+a*n*h,this._z=r*n*h+a*s*o,this._w=r*n*o-a*s*h):"ZYX"===e.order?(this._x=a*n*o-r*s*h,this._y=r*s*o+a*n*h,this._z=r*n*h-a*s*o,this._w=r*n*o+a*s*h):"YZX"===e.order?(this._x=a*n*o+r*s*h,this._y=r*s*o+a*n*h,this._z=r*n*h-a*s*o,this._w=r*n*o-a*s*h):"XZY"===e.order&&(this._x=a*n*o-r*s*h,this._y=r*s*o-a*n*h,this._z=r*n*h+a*s*o,this._w=r*n*o+a*s*h),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,n=r[0],i=r[4],o=r[8],a=r[1],s=r[5],h=r[9],l=r[2],u=r[6],c=r[10],p=n+s+c;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(u-h)*t,this._y=(o-l)*t,this._z=(a-i)*t):n>s&&n>c?(t=2*Math.sqrt(1+n-s-c),this._w=(u-h)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(o+l)/t):s>c?(t=2*Math.sqrt(1+s-n-c),this._w=(o-l)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(h+u)/t):(t=2*Math.sqrt(1+c-n-s),this._w=(a-i)/t,this._x=(o+l)/t,this._y=(h+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t,r=1e-6;return function(n,o){return void 0===e&&(e=new i.Vector3),t=n.dot(o)+1,r>t?(t=0,Math.abs(n.x)>Math.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):e.crossVectors(n,o),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(i.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,o=e._w,a=t._x,s=t._y,h=t._z,l=t._w;return this._x=r*l+o*a+n*h-i*s,this._y=n*l+o*s+i*a-r*h,this._z=i*l+o*h+r*s-n*a,this._w=o*l-r*a-n*s-i*h,this.onChangeCallback(),this},multiplyVector3:function(e){return i.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,o=this._w,a=o*e._w+r*e._x+n*e._y+i*e._z;if(0>a?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var s=Math.acos(a),h=Math.sqrt(1-a*a);if(Math.abs(h)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this;var l=Math.sin((1-t)*s)/h,u=Math.sin(t*s)/h;return this._w=o*l+this._w*u,this._x=r*l+this._x*u,this._y=n*l+this._y*u,this._z=i*l+this._z*u,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new i.Quaternion(this._x,this._y,this._z,this._w)}},i.Quaternion.slerp=function(e,t,r,n){return r.copy(e).slerp(t,n)},i.Vector2=function(e,t){this.x=e||0,this.y=t||0},i.Vector2.prototype={constructor:i.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(i.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},sub:function(e,t){return void 0!==t?(i.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(){var e,t;return function(r,n){return void 0===e&&(e=new i.Vector2,t=new i.Vector2),e.set(r,r),t.set(n,n),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this},clone:function(){return new i.Vector2(this.x,this.y)}},i.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},i.Vector3.prototype={constructor:i.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(i.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(i.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(i.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return t instanceof i.Euler==!1&&i.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===e&&(e=new i.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,r){return void 0===e&&(e=new i.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,r)),this}}(),applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n+i[12],this.y=i[1]*t+i[5]*r+i[9]*n+i[13],this.z=i[2]*t+i[6]*r+i[10]*n+i[14],this},applyProjection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements,o=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z,s=e.w,h=s*t+o*n-a*r,l=s*r+a*t-i*n,u=s*n+i*r-o*t,c=-i*t-o*r-a*n;return this.x=h*s+c*-i+l*-a-u*-o,this.y=l*s+c*-o+u*-i-h*-a,this.z=u*s+c*-a+h*-o-l*-i,this},project:function(){var e;return function(t){return void 0===e&&(e=new i.Matrix4),e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(t){return void 0===e&&(e=new i.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(r,n){return void 0===e&&(e=new i.Vector3,t=new i.Vector3),e.set(r,r,r),t.set(n,n,n),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},cross:function(e,t){if(void 0!==t)return i.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,n=this.y,o=this.z;return this.x=n*e.z-o*e.y,this.y=o*e.x-r*e.z,this.z=r*e.y-n*e.x,this},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this},projectOnVector:function(){var e,t;return function(r){return void 0===e&&(e=new i.Vector3),e.copy(r).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new i.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new i.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(i.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},setEulerFromRotationMatrix:function(e,t){i.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){i.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return i.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return i.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return i.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),n=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){var r=4*e,n=t.elements;return this.x=n[r],this.y=n[r+1],this.z=n[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this},clone:function(){return new i.Vector3(this.x,this.y,this.z)}},i.Vector4=function(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1},i.Vector4.prototype={constructor:i.Vector4,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(i.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(i.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*t+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*t+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*t+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,o=.01,a=.1,s=e.elements,h=s[0],l=s[4],u=s[8],c=s[1],p=s[5],f=s[9],d=s[2],m=s[6],v=s[10];if(Math.abs(l-c)<o&&Math.abs(u-d)<o&&Math.abs(f-m)<o){if(Math.abs(l+c)<a&&Math.abs(u+d)<a&&Math.abs(f+m)<a&&Math.abs(h+p+v-3)<a)return this.set(1,0,0,0),this;t=Math.PI;var g=(h+1)/2,y=(p+1)/2,x=(v+1)/2,w=(l+c)/4,b=(u+d)/4,_=(f+m)/4;return g>y&&g>x?o>g?(r=0,n=.707106781,i=.707106781):(r=Math.sqrt(g),n=w/r,i=b/r):y>x?o>y?(r=.707106781,n=0,i=.707106781):(n=Math.sqrt(y),r=w/n,i=_/n):o>x?(r=.707106781,n=.707106781,i=0):(i=Math.sqrt(x),r=b/i,n=_/i),this.set(r,n,i,t),this}var S=Math.sqrt((m-f)*(m-f)+(u-d)*(u-d)+(c-l)*(c-l));return Math.abs(S)<.001&&(S=1),this.x=(m-f)/S,this.y=(u-d)/S,this.z=(c-l)/S,this.w=Math.acos((h+p+v-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(r,n){return void 0===e&&(e=new i.Vector4,t=new i.Vector4),e.set(r,r,r,r),t.set(n,n,n,n),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this},clone:function(){return new i.Vector4(this.x,this.y,this.z,this.w)}},i.Euler=function(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||i.Euler.DefaultOrder},i.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],i.Euler.DefaultOrder="XYZ",i.Euler.prototype={constructor:i.Euler,_x:0,_y:0,_z:0,_order:i.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var n=i.Math.clamp,o=e.elements,a=o[0],s=o[4],h=o[8],l=o[1],u=o[5],c=o[9],p=o[2],f=o[6],d=o[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(f,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(h,d),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-p,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(f,-1,1)),Math.abs(f)<.99999?(this._y=Math.atan2(-p,d),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===t?(this._y=Math.asin(-n(p,-1,1)),Math.abs(p)<.99999?(this._x=Math.atan2(f,d),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-s,u))):"YZX"===t?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-p,a)):(this._x=0,this._y=Math.atan2(h,d))):"XZY"===t?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(f,u),this._y=Math.atan2(h,a)):(this._x=Math.atan2(-c,d),this._y=0)):i.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,r!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,r,n){return void 0===e&&(e=new i.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,n),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new i.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new i.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new i.Euler(this._x,this._y,this._z,this._order)}},i.Line3=function(e,t){this.start=void 0!==e?e:new i.Vector3,this.end=void 0!==t?t:new i.Vector3},i.Line3.prototype={constructor:i.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new i.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new i.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new i.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new i.Vector3,t=new i.Vector3;return function(r,n){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var o=t.dot(t),a=t.dot(e),s=a/o;return n&&(s=i.Math.clamp(s,0,1)),s}}(),closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t),o=r||new i.Vector3;return this.delta(o).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new i.Line3).copy(this)}},i.Box2=function(e,t){this.min=void 0!==e?e:new i.Vector2(1/0,1/0),this.max=void 0!==t?t:new i.Vector2(-(1/0),-(1/0))},i.Box2.prototype={constructor:i.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;r>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new i.Vector2;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new i.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new i.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){var r=t||new i.Vector2;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var r=t||new i.Vector2;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i.Vector2;return function(t){var r=e.copy(t).clamp(this.min,this.max);
return r.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new i.Box2).copy(this)}},i.Box3=function(e,t){this.min=void 0!==e?e:new i.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new i.Vector3(-(1/0),-(1/0),-(1/0))},i.Box3.prototype={constructor:i.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;r>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new i.Vector3;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(){var e=new i.Vector3;return function(t){var r=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){var n=t.geometry;if(void 0!==n)if(n instanceof i.Geometry)for(var o=n.vertices,a=0,s=o.length;s>a;a++)e.copy(o[a]),e.applyMatrix4(t.matrixWorld),r.expandByPoint(e);else if(n instanceof i.BufferGeometry&&void 0!==n.attributes.position)for(var h=n.attributes.position.array,a=0,s=h.length;s>a;a+=3)e.set(h[a],h[a+1],h[a+2]),e.applyMatrix4(t.matrixWorld),r.expandByPoint(e)}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new i.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new i.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e,t){var r=t||new i.Vector3;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var r=t||new i.Vector3;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i.Vector3;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new i.Vector3;return function(t){var r=t||new i.Sphere;return r.center=this.center(),r.radius=.5*this.size(e).length(),r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new i.Box3).copy(this)}},i.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&i.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},i.Matrix3.prototype={constructor:i.Matrix3,set:function(e,t,r,n,i,o,a,s,h){var l=this.elements;return l[0]=e,l[3]=t,l[6]=r,l[1]=n,l[4]=i,l[7]=o,l[2]=a,l[5]=s,l[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return i.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return i.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new i.Vector3;return function(t,r,n){void 0===r&&(r=0),void 0===n&&(n=t.length);for(var i=0,o=r;n>i;i+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix3(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],h=e[7],l=e[8];return t*o*l-t*a*h-r*i*l+r*a*s+n*i*h-n*o*s},getInverse:function(e,t){var r=e.elements,n=this.elements;n[0]=r[10]*r[5]-r[6]*r[9],n[1]=-r[10]*r[1]+r[2]*r[9],n[2]=r[6]*r[1]-r[2]*r[5],n[3]=-r[10]*r[4]+r[6]*r[8],n[4]=r[10]*r[0]-r[2]*r[8],n[5]=-r[6]*r[0]+r[2]*r[4],n[6]=r[9]*r[4]-r[5]*r[8],n[7]=-r[9]*r[0]+r[1]*r[8],n[8]=r[5]*r[0]-r[1]*r[4];var o=r[0]*n[0]+r[1]*n[3]+r[2]*n[6];if(0===o){var a="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(a);return i.warn(a),this.identity(),this}return this.multiplyScalar(1/o),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new i.Matrix3).fromArray(this.elements)}},i.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&i.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},i.Matrix4.prototype={constructor:i.Matrix4,set:function(e,t,r,n,i,o,a,s,h,l,u,c,p,f,d,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=n,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=h,v[6]=l,v[10]=u,v[14]=c,v[3]=p,v[7]=f,v[11]=d,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return i.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){var n=this.elements;return e.set(n[0],n[1],n[2]),t.set(n[4],n[5],n[6]),r.set(n[8],n[9],n[10]),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e=new i.Vector3;return function(t){var r=this.elements,n=t.elements,i=1/e.set(n[0],n[1],n[2]).length(),o=1/e.set(n[4],n[5],n[6]).length(),a=1/e.set(n[8],n[9],n[10]).length();return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[4]=n[4]*o,r[5]=n[5]*o,r[6]=n[6]*o,r[8]=n[8]*a,r[9]=n[9]*a,r[10]=n[10]*a,this}}(),makeRotationFromEuler:function(e){e instanceof i.Euler==!1&&i.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,o=e.z,a=Math.cos(r),s=Math.sin(r),h=Math.cos(n),l=Math.sin(n),u=Math.cos(o),c=Math.sin(o);if("XYZ"===e.order){var p=a*u,f=a*c,d=s*u,m=s*c;t[0]=h*u,t[4]=-h*c,t[8]=l,t[1]=f+d*l,t[5]=p-m*l,t[9]=-s*h,t[2]=m-p*l,t[6]=d+f*l,t[10]=a*h}else if("YXZ"===e.order){var v=h*u,g=h*c,y=l*u,x=l*c;t[0]=v+x*s,t[4]=y*s-g,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-s,t[2]=g*s-y,t[6]=x+v*s,t[10]=a*h}else if("ZXY"===e.order){var v=h*u,g=h*c,y=l*u,x=l*c;t[0]=v-x*s,t[4]=-a*c,t[8]=y+g*s,t[1]=g+y*s,t[5]=a*u,t[9]=x-v*s,t[2]=-a*l,t[6]=s,t[10]=a*h}else if("ZYX"===e.order){var p=a*u,f=a*c,d=s*u,m=s*c;t[0]=h*u,t[4]=d*l-f,t[8]=p*l+m,t[1]=h*c,t[5]=m*l+p,t[9]=f*l-d,t[2]=-l,t[6]=s*h,t[10]=a*h}else if("YZX"===e.order){var w=a*h,b=a*l,_=s*h,S=s*l;t[0]=h*u,t[4]=S-w*c,t[8]=_*c+b,t[1]=c,t[5]=a*u,t[9]=-s*u,t[2]=-l*u,t[6]=b*c+_,t[10]=w-S*c}else if("XZY"===e.order){var w=a*h,b=a*l,_=s*h,S=s*l;t[0]=h*u,t[4]=-c,t[8]=l*u,t[1]=w*c+S,t[5]=a*u,t[9]=b*c-_,t[2]=_*c-b,t[6]=s*u,t[10]=S*c+w}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return i.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z,o=e.w,a=r+r,s=n+n,h=i+i,l=r*a,u=r*s,c=r*h,p=n*s,f=n*h,d=i*h,m=o*a,v=o*s,g=o*h;return t[0]=1-(p+d),t[4]=u-g,t[8]=c+v,t[1]=u+g,t[5]=1-(l+d),t[9]=f-m,t[2]=c-v,t[6]=f+m,t[10]=1-(l+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new i.Vector3,t=new i.Vector3,r=new i.Vector3;return function(n,i,o){var a=this.elements;return r.subVectors(n,i).normalize(),0===r.length()&&(r.z=1),e.crossVectors(o,r).normalize(),0===e.length()&&(r.x+=1e-4,e.crossVectors(o,r).normalize()),t.crossVectors(r,e),a[0]=e.x,a[4]=t.x,a[8]=r.x,a[1]=e.y,a[5]=t.y,a[9]=r.y,a[2]=e.z,a[6]=t.z,a[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(i.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],a=r[4],s=r[8],h=r[12],l=r[1],u=r[5],c=r[9],p=r[13],f=r[2],d=r[6],m=r[10],v=r[14],g=r[3],y=r[7],x=r[11],w=r[15],b=n[0],_=n[4],S=n[8],M=n[12],E=n[1],T=n[5],C=n[9],A=n[13],L=n[2],R=n[6],P=n[10],B=n[14],F=n[3],k=n[7],D=n[11],U=n[15];return i[0]=o*b+a*E+s*L+h*F,i[4]=o*_+a*T+s*R+h*k,i[8]=o*S+a*C+s*P+h*D,i[12]=o*M+a*A+s*B+h*U,i[1]=l*b+u*E+c*L+p*F,i[5]=l*_+u*T+c*R+p*k,i[9]=l*S+u*C+c*P+p*D,i[13]=l*M+u*A+c*B+p*U,i[2]=f*b+d*E+m*L+v*F,i[6]=f*_+d*T+m*R+v*k,i[10]=f*S+d*C+m*P+v*D,i[14]=f*M+d*A+m*B+v*U,i[3]=g*b+y*E+x*L+w*F,i[7]=g*_+y*T+x*R+w*k,i[11]=g*S+y*C+x*P+w*D,i[15]=g*M+y*A+x*B+w*U,this},multiplyToArray:function(e,t,r){var n=this.elements;return this.multiplyMatrices(e,t),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return i.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return i.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return i.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new i.Vector3;return function(t,r,n){void 0===r&&(r=0),void 0===n&&(n=t.length);for(var i=0,o=r;n>i;i+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix4(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),rotateAxis:function(e){i.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return i.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],o=e[1],a=e[5],s=e[9],h=e[13],l=e[2],u=e[6],c=e[10],p=e[14],f=e[3],d=e[7],m=e[11],v=e[15];return f*(+i*s*u-n*h*u-i*a*c+r*h*c+n*a*p-r*s*p)+d*(+t*s*p-t*h*c+i*o*c-n*o*p+n*h*l-i*s*l)+m*(+t*h*u-t*a*p-i*o*u+r*o*p+i*a*l-r*h*l)+v*(-n*a*l-t*s*u+t*a*c+n*o*u-r*o*c+r*s*l)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e=new i.Vector3;return function(){i.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,n=e.elements,o=n[0],a=n[4],s=n[8],h=n[12],l=n[1],u=n[5],c=n[9],p=n[13],f=n[2],d=n[6],m=n[10],v=n[14],g=n[3],y=n[7],x=n[11],w=n[15];r[0]=c*v*y-p*m*y+p*d*x-u*v*x-c*d*w+u*m*w,r[4]=h*m*y-s*v*y-h*d*x+a*v*x+s*d*w-a*m*w,r[8]=s*p*y-h*c*y+h*u*x-a*p*x-s*u*w+a*c*w,r[12]=h*c*d-s*p*d-h*u*m+a*p*m+s*u*v-a*c*v,r[1]=p*m*g-c*v*g-p*f*x+l*v*x+c*f*w-l*m*w,r[5]=s*v*g-h*m*g+h*f*x-o*v*x-s*f*w+o*m*w,r[9]=h*c*g-s*p*g-h*l*x+o*p*x+s*l*w-o*c*w,r[13]=s*p*f-h*c*f+h*l*m-o*p*m-s*l*v+o*c*v,r[2]=u*v*g-p*d*g+p*f*y-l*v*y-u*f*w+l*d*w,r[6]=h*d*g-a*v*g-h*f*y+o*v*y+a*f*w-o*d*w,r[10]=a*p*g-h*u*g+h*l*y-o*p*y-a*l*w+o*u*w,r[14]=h*u*f-a*p*f-h*l*d+o*p*d+a*l*v-o*u*v,r[3]=c*d*g-u*m*g-c*f*y+l*m*y+u*f*x-l*d*x,r[7]=a*m*g-s*d*g+s*f*y-o*m*y-a*f*x+o*d*x,r[11]=s*u*g-a*c*g-s*l*y+o*c*y+a*l*x-o*u*x,r[15]=a*c*f-s*u*f+s*l*d-o*c*d-a*l*m+o*u*m;var b=o*r[0]+l*r[4]+f*r[8]+g*r[12];if(0==b){var _="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(_);return i.warn(_),this.identity(),this}return this.multiplyScalar(1/b),this},translate:function(e){i.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){i.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){i.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){i.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){i.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,n)))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,o=e.x,a=e.y,s=e.z,h=i*o,l=i*a;return this.set(h*o+r,h*a-n*s,h*s+n*a,0,h*a+n*s,l*a+r,l*s-n*o,0,h*s-n*a,l*s+n*o,i*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var e=new i.Vector3,t=new i.Matrix4;return function(r,n,i){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),h=e.set(o[8],o[9],o[10]).length(),l=this.determinant();0>l&&(a=-a),r.x=o[12],r.y=o[13],r.z=o[14],t.elements.set(this.elements);var u=1/a,c=1/s,p=1/h;return t.elements[0]*=u,t.elements[1]*=u,t.elements[2]*=u,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=p,t.elements[9]*=p,t.elements[10]*=p,n.setFromRotationMatrix(t),i.x=a,i.y=s,i.z=h,this}}(),makeFrustum:function(e,t,r,n,i,o){var a=this.elements,s=2*i/(t-e),h=2*i/(n-r),l=(t+e)/(t-e),u=(n+r)/(n-r),c=-(o+i)/(o-i),p=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=h,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,r,n){var o=r*Math.tan(i.Math.degToRad(.5*e)),a=-o,s=a*t,h=o*t;return this.makeFrustum(s,h,a,o,r,n)},makeOrthographic:function(e,t,r,n,i,o){var a=this.elements,s=t-e,h=r-n,l=o-i,u=(t+e)/s,c=(r+n)/h,p=(o+i)/l;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2/h,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2/l,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new i.Matrix4).fromArray(this.elements)}},i.Ray=function(e,t){this.origin=void 0!==e?e:new i.Vector3,this.direction=void 0!==t?t:new i.Vector3},i.Ray.prototype={constructor:i.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var r=t||new i.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new i.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new i.Vector3;r.subVectors(e,this.origin);var n=r.dot(this.direction);return 0>n?r.copy(this.origin):r.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(){var e=new i.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return 0>r?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(){var e=new i.Vector3,t=new i.Vector3,r=new i.Vector3;return function(n,i,o,a){e.copy(n).add(i).multiplyScalar(.5),t.copy(i).sub(n).normalize(),r.copy(this.origin).sub(e);var s,h,l,u,c=.5*n.distanceTo(i),p=-this.direction.dot(t),f=r.dot(this.direction),d=-r.dot(t),m=r.lengthSq(),v=Math.abs(1-p*p);if(v>0)if(s=p*d-f,h=p*f-d,u=c*v,s>=0)if(h>=-u)if(u>=h){var g=1/v;s*=g,h*=g,l=s*(s+p*h+2*f)+h*(p*s+h+2*d)+m}else h=c,s=Math.max(0,-(p*h+f)),l=-s*s+h*(h+2*d)+m;else h=-c,s=Math.max(0,-(p*h+f)),l=-s*s+h*(h+2*d)+m;else-u>=h?(s=Math.max(0,-(-p*c+f)),h=s>0?-c:Math.min(Math.max(-c,-d),c),l=-s*s+h*(h+2*d)+m):u>=h?(s=0,h=Math.min(Math.max(-c,-d),c),l=h*(h+2*d)+m):(s=Math.max(0,-(p*c+f)),h=s>0?c:Math.min(Math.max(-c,-d),c),l=-s*s+h*(h+2*d)+m);else h=p>0?-c:c,s=Math.max(0,-(p*h+f)),l=-s*s+h*(h+2*d)+m;return o&&o.copy(this.direction).multiplyScalar(s).add(this.origin),a&&a.copy(t).multiplyScalar(h).add(e),l}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new i.Vector3;return function(t,r){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),i=e.dot(e)-n*n,o=t.radius*t.radius;if(i>o)return null;var a=Math.sqrt(o-i),s=n-a,h=n+a;return 0>s&&0>h?null:0>s?this.at(h,r):this.at(s,r)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var r=e.normal.dot(this.direction);return 0>r*t?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},isIntersectionBox:function(){var e=new i.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var r,n,i,o,a,s,h=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,c=this.origin;return h>=0?(r=(e.min.x-c.x)*h,n=(e.max.x-c.x)*h):(r=(e.max.x-c.x)*h,n=(e.min.x-c.x)*h),l>=0?(i=(e.min.y-c.y)*l,o=(e.max.y-c.y)*l):(i=(e.max.y-c.y)*l,o=(e.min.y-c.y)*l),r>o||i>n?null:((i>r||r!==r)&&(r=i),(n>o||n!==n)&&(n=o),u>=0?(a=(e.min.z-c.z)*u,s=(e.max.z-c.z)*u):(a=(e.max.z-c.z)*u,s=(e.min.z-c.z)*u),r>s||a>n?null:((a>r||r!==r)&&(r=a),(n>s||n!==n)&&(n=s),0>n?null:this.at(r>=0?r:n,t)))},intersectTriangle:function(){var e=new i.Vector3,t=new i.Vector3,r=new i.Vector3,n=new i.Vector3;return function(i,o,a,s,h){t.subVectors(o,i),r.subVectors(a,i),n.crossVectors(t,r);var l,u=this.direction.dot(n);if(u>0){if(s)return null;l=1}else{if(!(0>u))return null;l=-1,u=-u}e.subVectors(this.origin,i);var c=l*this.direction.dot(r.crossVectors(e,r));if(0>c)return null;var p=l*this.direction.dot(t.cross(e));if(0>p)return null;if(c+p>u)return null;var f=-l*e.dot(n);return 0>f?null:this.at(f/u,h)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new i.Ray).copy(this)}},i.Sphere=function(e,t){this.center=void 0!==e?e:new i.Vector3,this.radius=void 0!==t?t:0},i.Sphere.prototype={constructor:i.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new i.Box3;return function(t,r){var n=this.center;void 0!==r?n.copy(r):e.setFromPoints(t).center(n);for(var i=0,o=0,a=t.length;a>o;o++)i=Math.max(i,n.distanceToSquared(t[o]));return this.radius=Math.sqrt(i),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),n=t||new i.Vector3;return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(e){var t=e||new i.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new i.Sphere).copy(this)}},i.Frustum=function(e,t,r,n,o,a){this.planes=[void 0!==e?e:new i.Plane,void 0!==t?t:new i.Plane,void 0!==r?r:new i.Plane,void 0!==n?n:new i.Plane,void 0!==o?o:new i.Plane,void 0!==a?a:new i.Plane]},i.Frustum.prototype={constructor:i.Frustum,set:function(e,t,r,n,i,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(o),this},copy:function(e){for(var t=this.planes,r=0;6>r;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],h=r[5],l=r[6],u=r[7],c=r[8],p=r[9],f=r[10],d=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return t[0].setComponents(a-n,u-s,d-c,y-m).normalize(),t[1].setComponents(a+n,u+s,d+c,y+m).normalize(),t[2].setComponents(a+i,u+h,d+p,y+v).normalize(),t[3].setComponents(a-i,u-h,d-p,y-v).normalize(),t[4].setComponents(a-o,u-l,d-f,y-g).normalize(),t[5].setComponents(a+o,u+l,d+f,y+g).normalize(),this},intersectsObject:function(){var e=new i.Sphere;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;6>i;i++){var o=t[i].distanceToPoint(r);if(n>o)return!1}return!0},intersectsBox:function(){var e=new i.Vector3,t=new i.Vector3;return function(r){for(var n=this.planes,i=0;6>i;i++){var o=n[i];e.x=o.normal.x>0?r.min.x:r.max.x,t.x=o.normal.x>0?r.max.x:r.min.x,e.y=o.normal.y>0?r.min.y:r.max.y,t.y=o.normal.y>0?r.max.y:r.min.y,e.z=o.normal.z>0?r.min.z:r.max.z,t.z=o.normal.z>0?r.max.z:r.min.z;var a=o.distanceToPoint(e),s=o.distanceToPoint(t);if(0>a&&0>s)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;6>r;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new i.Frustum).copy(this)}},i.Plane=function(e,t){this.normal=void 0!==e?e:new i.Vector3(1,0,0),this.constant=void 0!==t?t:0},i.Plane.prototype={constructor:i.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new i.Vector3,t=new i.Vector3;return function(r,n,i){var o=e.subVectors(i,n).cross(t.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e),n=t||new i.Vector3;return n.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return 0>t&&r>0||0>r&&t>0},intersectLine:function(){var e=new i.Vector3;return function(t,r){var n=r||new i.Vector3,o=t.delta(e),a=this.normal.dot(o);if(0==a)return 0==this.distanceToPoint(t.start)?n.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/a;return 0>s||s>1?void 0:n.copy(o).multiplyScalar(s).add(t.start)}}(),coplanarPoint:function(e){var t=e||new i.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new i.Vector3,t=new i.Vector3,r=new i.Matrix3;return function(n,i){var o=i||r.getNormalMatrix(n),a=e.copy(this.normal).applyMatrix3(o),s=this.coplanarPoint(t);return s.applyMatrix4(n),this.setFromNormalAndCoplanarPoint(a,s),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new i.Plane).copy(this)}},i.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),n=0;return function(){for(var i=0;36>i;i++)8==i||13==i||18==i||23==i?r[i]="-":14==i?r[i]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,r[i]=t[19==i?3&e|8:e]);return r.join("")}}(),clamp:function(e,t,r){return t>e?t:e>r?r:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},smoothstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return Math.floor(this.randFloat(e,t))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}},i.Spline=function(e){function t(e,t,r,n,i,o,a){var s=.5*(r-e),h=.5*(n-t);return(2*(t-r)+s+h)*a+(-3*(t-r)-2*s-h)*o+s*i+t}this.points=e;var r,n,o,a,s,h,l,u,c,p=[],f={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return r=(this.points.length-1)*e,n=Math.floor(r),o=r-n,p[0]=0===n?n:n-1,p[1]=n,p[2]=n>this.points.length-2?this.points.length-1:n+1,p[3]=n>this.points.length-3?this.points.length-1:n+2,h=this.points[p[0]],l=this.points[p[1]],u=this.points[p[2]],c=this.points[p[3]],a=o*o,s=o*a,f.x=t(h.x,l.x,u.x,c.x,o,a,s),f.y=t(h.y,l.y,u.y,c.y,o,a,s),f.z=t(h.z,l.z,u.z,c.z,o,a,s),f},this.getControlPointsArray=function(){var e,t,r=this.points.length,n=[];for(e=0;r>e;e++)t=this.points[e],n[e]=[t.x,t.y,t.z];return n},this.getLength=function(e){var t,r,n,o,a=0,s=0,h=0,l=new i.Vector3,u=new i.Vector3,c=[],p=0;for(c[0]=0,e||(e=100),n=this.points.length*e,l.copy(this.points[0]),t=1;n>t;t++)r=t/n,o=this.getPoint(r),u.copy(o),p+=u.distanceTo(l),l.copy(o),a=(this.points.length-1)*r,s=Math.floor(a),s!=h&&(c[s]=p,h=s);return c[c.length]=p,{chunks:c,total:p}},this.reparametrizeByArcLength=function(e){var t,r,n,o,a,s,h,l,u=[],c=new i.Vector3,p=this.getLength();for(u.push(c.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(s=p.chunks[t]-p.chunks[t-1],h=Math.ceil(e*s/p.total),o=(t-1)/(this.points.length-1),a=t/(this.points.length-1),r=1;h-1>r;r++)n=o+r*(1/h)*(a-o),l=this.getPoint(n),u.push(c.copy(l).clone());u.push(c.copy(this.points[t]).clone())}this.points=u}},i.Triangle=function(e,t,r){this.a=void 0!==e?e:new i.Vector3,this.b=void 0!==t?t:new i.Vector3,this.c=void 0!==r?r:new i.Vector3},i.Triangle.normal=function(){var e=new i.Vector3;return function(t,r,n,o){var a=o||new i.Vector3;a.subVectors(n,r),e.subVectors(t,r),a.cross(e);var s=a.lengthSq();return s>0?a.multiplyScalar(1/Math.sqrt(s)):a.set(0,0,0)}}(),i.Triangle.barycoordFromPoint=function(){var e=new i.Vector3,t=new i.Vector3,r=new i.Vector3;return function(n,o,a,s,h){e.subVectors(s,o),t.subVectors(a,o),r.subVectors(n,o);var l=e.dot(e),u=e.dot(t),c=e.dot(r),p=t.dot(t),f=t.dot(r),d=l*p-u*u,m=h||new i.Vector3;if(0==d)return m.set(-2,-1,-1);var v=1/d,g=(p*c-u*f)*v,y=(l*f-u*c)*v;return m.set(1-g-y,y,g)}}(),i.Triangle.containsPoint=function(){var e=new i.Vector3;return function(t,r,n,o){var a=i.Triangle.barycoordFromPoint(t,r,n,o,e);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}(),i.Triangle.prototype={constructor:i.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new i.Vector3,t=new i.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new i.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return i.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new i.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return i.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t);
},containsPoint:function(e){return i.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new i.Triangle).copy(this)}},i.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},i.Clock.prototype={constructor:i.Clock,start:function(){this.startTime=void 0!==n.performance&&void 0!==n.performance.now?n.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==n.performance&&void 0!==n.performance.now?n.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},i.EventDispatcher=function(){},i.EventDispatcher.prototype={constructor:i.EventDispatcher,apply:function(e){e.addEventListener=i.EventDispatcher.prototype.addEventListener,e.hasEventListener=i.EventDispatcher.prototype.hasEventListener,e.removeEventListener=i.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=i.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners,n=r[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,r=t[e.type];if(void 0!==r){e.target=this;for(var n=[],i=r.length,o=0;i>o;o++)n[o]=r[o];for(var o=0;i>o;o++)n[o].call(this,e)}}}},function(e){e.Raycaster=function(t,r,n,i){this.ray=new e.Ray(t,r),this.near=n||0,this.far=i||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var t=function(e,t){return e.distance-t.distance},r=function(e,t,n,i){if(e.raycast(t,n),i===!0)for(var o=e.children,a=0,s=o.length;s>a;a++)r(o[a],t,n,!0)};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,r){r instanceof e.PerspectiveCamera?(this.ray.origin.copy(r.position),this.ray.direction.set(t.x,t.y,.5).unproject(r).sub(r.position).normalize()):r instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(r),this.ray.direction.set(0,0,-1).transformDirection(r.matrixWorld)):e.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,n){var i=[];return r(e,this,i,n),i.sort(t),i},intersectObjects:function(n,i){var o=[];if(n instanceof Array==!1)return e.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(var a=0,s=n.length;s>a;a++)r(n[a],this,o,i);return o.sort(t),o}}}(i),i.Object3D=function(){Object.defineProperty(this,"id",{value:i.Object3DIdCount++}),this.uuid=i.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=void 0,this.children=[],this.up=i.Object3D.DefaultUp.clone();var e=new i.Vector3,t=new i.Euler,r=new i.Quaternion,n=new i.Vector3(1,1,1),o=function(){r.setFromEuler(t,!1)},a=function(){t.setFromQuaternion(r,void 0,!1)};t.onChange(o),r.onChange(a),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n}}),this.rotationAutoUpdate=!0,this.matrix=new i.Matrix4,this.matrixWorld=new i.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},i.Object3D.DefaultUp=new i.Vector3(0,1,0),i.Object3D.prototype={constructor:i.Object3D,get eulerOrder(){return i.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){i.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){i.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){i.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new i.Quaternion;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new i.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new i.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new i.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new i.Vector3;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translate:function(e,t){return i.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new i.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new i.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new i.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new i.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new i.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(i.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof i.Object3D?(void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):i.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var r=this.children.indexOf(e);-1!==r&&(e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(r,1))},getChildByName:function(e){return i.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;n>r;r++){var i=this.children[r],o=i.getObjectByProperty(e,t);if(void 0!==o)return o}return void 0},getWorldPosition:function(e){var t=e||new i.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new i.Vector3,t=new i.Vector3;return function(r){var n=r||new i.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,n,t),n}}(),getWorldRotation:function(){var e=new i.Quaternion;return function(t){var r=t||new i.Euler;return this.getWorldQuaternion(e),r.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new i.Vector3,t=new i.Quaternion;return function(r){var n=r||new i.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,n),n}}(),getWorldDirection:function(){var e=new i.Quaternion;return function(t){var r=t||new i.Vector3;return this.getWorldQuaternion(e),r.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=0,r=this.children.length;r>t;t++)this.children[t].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=0,r=this.children.length;r>t;t++)this.children[t].traverseVisible(e)}},traverseAncestors:function(e){this.parent&&(e(this.parent),this.parent.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;r>t;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},t={},r=function(r){if(void 0===e.geometries&&(e.geometries=[]),void 0===t[r.uuid]){var n=r.toJSON();delete n.metadata,t[r.uuid]=n,e.geometries.push(n)}return r.uuid},n={},o=function(t){if(void 0===e.materials&&(e.materials=[]),void 0===n[t.uuid]){var r=t.toJSON();delete r.metadata,n[t.uuid]=r,e.materials.push(r)}return t.uuid},a=function(e){var t={};if(t.uuid=e.uuid,t.type=e.type,""!==e.name&&(t.name=e.name),"{}"!==JSON.stringify(e.userData)&&(t.userData=e.userData),e.visible!==!0&&(t.visible=e.visible),e instanceof i.PerspectiveCamera?(t.fov=e.fov,t.aspect=e.aspect,t.near=e.near,t.far=e.far):e instanceof i.OrthographicCamera?(t.left=e.left,t.right=e.right,t.top=e.top,t.bottom=e.bottom,t.near=e.near,t.far=e.far):e instanceof i.AmbientLight?t.color=e.color.getHex():e instanceof i.DirectionalLight?(t.color=e.color.getHex(),t.intensity=e.intensity):e instanceof i.PointLight?(t.color=e.color.getHex(),t.intensity=e.intensity,t.distance=e.distance,t.decay=e.decay):e instanceof i.SpotLight?(t.color=e.color.getHex(),t.intensity=e.intensity,t.distance=e.distance,t.angle=e.angle,t.exponent=e.exponent,t.decay=e.decay):e instanceof i.HemisphereLight?(t.color=e.color.getHex(),t.groundColor=e.groundColor.getHex()):e instanceof i.Mesh||e instanceof i.Line||e instanceof i.PointCloud?(t.geometry=r(e.geometry),t.material=o(e.material),e instanceof i.Line&&(t.mode=e.mode)):e instanceof i.Sprite&&(t.material=o(e.material)),t.matrix=e.matrix.toArray(),e.children.length>0){t.children=[];for(var n=0;n<e.children.length;n++)t.children.push(a(e.children[n]))}return t};return e.object=a(this),e},clone:function(e,t){if(void 0===e&&(e=new i.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),t===!0)for(var r=0;r<this.children.length;r++){var n=this.children[r];e.add(n.clone())}return e}},i.EventDispatcher.prototype.apply(i.Object3D.prototype),i.Object3DIdCount=0,i.Face3=function(e,t,r,n,o,a){this.a=e,this.b=t,this.c=r,this.normal=n instanceof i.Vector3?n:new i.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=o instanceof i.Color?o:new i.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=void 0!==a?a:0},i.Face3.prototype={constructor:i.Face3,clone:function(){var e=new i.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;for(var t=0,r=this.vertexNormals.length;r>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(var t=0,r=this.vertexColors.length;r>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(var t=0,r=this.vertexTangents.length;r>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},i.Face4=function(e,t,r,n,o,a,s){return i.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new i.Face3(e,t,r,o,a,s)},i.BufferAttribute=function(e,t){this.array=e,this.itemSize=t,this.needsUpdate=!1},i.BufferAttribute.prototype={constructor:i.BufferAttribute,get length(){return this.array.length},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,i=this.itemSize;i>n;n++)this.array[e+n]=t.array[r+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},setX:function(e,t){return this.array[e*this.itemSize]=t,this},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},clone:function(){return new i.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}},i.Int8Attribute=function(e,t){return i.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Uint8Attribute=function(e,t){return i.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Uint8ClampedAttribute=function(e,t){return i.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Int16Attribute=function(e,t){return i.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Uint16Attribute=function(e,t){return i.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Int32Attribute=function(e,t){return i.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Uint32Attribute=function(e,t){return i.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Float32Attribute=function(e,t){return i.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Float64Attribute=function(e,t){return i.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.DynamicBufferAttribute=function(e,t){i.BufferAttribute.call(this,e,t),this.updateRange={offset:0,count:-1}},i.DynamicBufferAttribute.prototype=Object.create(i.BufferAttribute.prototype),i.DynamicBufferAttribute.prototype.constructor=i.DynamicBufferAttribute,i.DynamicBufferAttribute.prototype.clone=function(){return new i.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)},i.BufferGeometry=function(){Object.defineProperty(this,"id",{value:i.GeometryIdCount++}),this.uuid=i.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},i.BufferGeometry.prototype={constructor:i.BufferGeometry,addAttribute:function(e,t){return t instanceof i.BufferAttribute==!1?(i.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void(this.attributes[e]={array:arguments[1],itemSize:arguments[2]})):(this.attributes[e]=t,void(this.attributesKeys=Object.keys(this.attributes)))},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,r){this.drawcalls.push({start:e,count:t,index:void 0!==r?r:0})},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var n=(new i.Matrix3).getNormalMatrix(e);n.applyToVector3Array(r.array),r.needsUpdate=!0}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.applyMatrix((new i.Matrix4).setPosition(e)),e},fromGeometry:function(e,t){t=t||{vertexColors:i.NoColors};var r=e.vertices,n=e.faces,o=e.faceVertexUvs,a=t.vertexColors,s=o[0].length>0,h=3==n[0].vertexNormals.length,l=new Float32Array(3*n.length*3);this.addAttribute("position",new i.BufferAttribute(l,3));var u=new Float32Array(3*n.length*3);if(this.addAttribute("normal",new i.BufferAttribute(u,3)),a!==i.NoColors){var c=new Float32Array(3*n.length*3);this.addAttribute("color",new i.BufferAttribute(c,3))}if(s===!0){var p=new Float32Array(3*n.length*2);this.addAttribute("uv",new i.BufferAttribute(p,2))}for(var f=0,d=0,m=0;f<n.length;f++,d+=6,m+=9){var v=n[f],g=r[v.a],y=r[v.b],x=r[v.c];if(l[m]=g.x,l[m+1]=g.y,l[m+2]=g.z,l[m+3]=y.x,l[m+4]=y.y,l[m+5]=y.z,l[m+6]=x.x,l[m+7]=x.y,l[m+8]=x.z,h===!0){var w=v.vertexNormals[0],b=v.vertexNormals[1],_=v.vertexNormals[2];u[m]=w.x,u[m+1]=w.y,u[m+2]=w.z,u[m+3]=b.x,u[m+4]=b.y,u[m+5]=b.z,u[m+6]=_.x,u[m+7]=_.y,u[m+8]=_.z}else{var S=v.normal;u[m]=S.x,u[m+1]=S.y,u[m+2]=S.z,u[m+3]=S.x,u[m+4]=S.y,u[m+5]=S.z,u[m+6]=S.x,u[m+7]=S.y,u[m+8]=S.z}if(a===i.FaceColors){var M=v.color;c[m]=M.r,c[m+1]=M.g,c[m+2]=M.b,c[m+3]=M.r,c[m+4]=M.g,c[m+5]=M.b,c[m+6]=M.r,c[m+7]=M.g,c[m+8]=M.b}else if(a===i.VertexColors){var E=v.vertexColors[0],T=v.vertexColors[1],C=v.vertexColors[2];c[m]=E.r,c[m+1]=E.g,c[m+2]=E.b,c[m+3]=T.r,c[m+4]=T.g,c[m+5]=T.b,c[m+6]=C.r,c[m+7]=C.g,c[m+8]=C.b}if(s===!0){var A=o[0][f][0],L=o[0][f][1],R=o[0][f][2];p[d]=A.x,p[d+1]=A.y,p[d+2]=L.x,p[d+3]=L.y,p[d+4]=R.x,p[d+5]=R.y}}return this.computeBoundingSphere(),this},computeBoundingBox:function(){var e=new i.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new i.Box3);var t=this.attributes.position.array;if(t){var r=this.boundingBox;r.makeEmpty();for(var n=0,o=t.length;o>n;n+=3)e.set(t[n],t[n+1],t[n+2]),r.expandByPoint(e)}(void 0===t||0===t.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&i.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var e=new i.Box3,t=new i.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new i.Sphere);var r=this.attributes.position.array;if(r){e.makeEmpty();for(var n=this.boundingSphere.center,o=0,a=r.length;a>o;o+=3)t.set(r[o],r[o+1],r[o+2]),e.expandByPoint(t);e.center(n);for(var s=0,o=0,a=r.length;a>o;o+=3)t.set(r[o],r[o+1],r[o+2]),s=Math.max(s,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&i.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new i.BufferAttribute(new Float32Array(t.length),3));else for(var r=e.normal.array,n=0,o=r.length;o>n;n++)r[n]=0;var a,s,h,r=e.normal.array,l=new i.Vector3,u=new i.Vector3,c=new i.Vector3,p=new i.Vector3,f=new i.Vector3;if(e.index)for(var d=e.index.array,m=this.offsets.length>0?this.offsets:[{start:0,count:d.length,index:0}],v=0,g=m.length;g>v;++v)for(var y=m[v].start,x=m[v].count,w=m[v].index,n=y,o=y+x;o>n;n+=3)a=3*(w+d[n]),s=3*(w+d[n+1]),h=3*(w+d[n+2]),l.fromArray(t,a),u.fromArray(t,s),c.fromArray(t,h),p.subVectors(c,u),f.subVectors(l,u),p.cross(f),r[a]+=p.x,r[a+1]+=p.y,r[a+2]+=p.z,r[s]+=p.x,r[s+1]+=p.y,r[s+2]+=p.z,r[h]+=p.x,r[h+1]+=p.y,r[h+2]+=p.z;else for(var n=0,o=t.length;o>n;n+=9)l.fromArray(t,n),u.fromArray(t,n+3),c.fromArray(t,n+6),p.subVectors(c,u),f.subVectors(l,u),p.cross(f),r[n]=p.x,r[n+1]=p.y,r[n+2]=p.z,r[n+3]=p.x,r[n+4]=p.y,r[n+5]=p.z,r[n+6]=p.x,r[n+7]=p.y,r[n+8]=p.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},computeTangents:function(){function e(e,t,r){R.fromArray(n,3*e),P.fromArray(n,3*t),B.fromArray(n,3*r),F.fromArray(a,2*e),k.fromArray(a,2*t),D.fromArray(a,2*r),p=P.x-R.x,f=B.x-R.x,d=P.y-R.y,m=B.y-R.y,v=P.z-R.z,g=B.z-R.z,y=k.x-F.x,x=D.x-F.x,w=k.y-F.y,b=D.y-F.y,_=1/(y*b-x*w),U.set((b*p-w*f)*_,(b*d-w*m)*_,(b*v-w*g)*_),z.set((y*f-x*p)*_,(y*m-x*d)*_,(y*g-x*v)*_),l[e].add(U),l[t].add(U),l[r].add(U),u[e].add(z),u[t].add(z),u[r].add(z)}function t(e){X.fromArray(o,3*e),Y.copy(X),W=l[e],G.copy(W),G.sub(X.multiplyScalar(X.dot(W))).normalize(),q.crossVectors(Y,W),H=q.dot(u[e]),j=0>H?-1:1,h[4*e]=G.x,h[4*e+1]=G.y,h[4*e+2]=G.z,h[4*e+3]=j}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)return void i.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var r=this.attributes.index.array,n=this.attributes.position.array,o=this.attributes.normal.array,a=this.attributes.uv.array,s=n.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new i.BufferAttribute(new Float32Array(4*s),4));for(var h=this.attributes.tangent.array,l=[],u=[],c=0;s>c;c++)l[c]=new i.Vector3,u[c]=new i.Vector3;var p,f,d,m,v,g,y,x,w,b,_,S,M,E,T,C,A,L,R=new i.Vector3,P=new i.Vector3,B=new i.Vector3,F=new i.Vector2,k=new i.Vector2,D=new i.Vector2,U=new i.Vector3,z=new i.Vector3;0===this.drawcalls.length&&this.addDrawCall(0,r.length,0);var V=this.drawcalls;for(E=0,T=V.length;T>E;++E){var I=V[E].start,N=V[E].count,O=V[E].index;for(S=I,M=I+N;M>S;S+=3)C=O+r[S],A=O+r[S+1],L=O+r[S+2],e(C,A,L)}var j,W,H,G=new i.Vector3,q=new i.Vector3,X=new i.Vector3,Y=new i.Vector3;for(E=0,T=V.length;T>E;++E){var I=V[E].start,N=V[E].count,O=V[E].index;for(S=I,M=I+N;M>S;S+=3)C=O+r[S],A=O+r[S+1],L=O+r[S+2],t(C),t(A),t(L)}},computeOffsets:function(e){void 0===e&&(e=65535);for(var t=this.attributes.index.array,r=this.attributes.position.array,n=t.length/3,i=new Uint16Array(t.length),o=0,a=0,s=[{start:0,count:0,index:0}],h=s[0],l=0,u=0,c=new Int32Array(6),p=new Int32Array(r.length),f=new Int32Array(r.length),d=0;d<r.length;d++)p[d]=-1,f[d]=-1;for(var m=0;n>m;m++){u=0;for(var v=0;3>v;v++){var g=t[3*m+v];-1==p[g]?(c[2*v]=g,c[2*v+1]=-1,u++):p[g]<h.index?(c[2*v]=g,c[2*v+1]=-1,l++):(c[2*v]=g,c[2*v+1]=p[g])}var y=a+u;if(y>h.index+e){var x={start:o,count:0,index:a};s.push(x),h=x;for(var w=0;6>w;w+=2){var b=c[w+1];b>-1&&b<h.index&&(c[w+1]=-1)}}for(var w=0;6>w;w+=2){var g=c[w],b=c[w+1];-1===b&&(b=a++),p[g]=b,f[b]=g,i[o++]=b-h.index,h.count++}}return this.reorderBuffers(i,f,a),this.offsets=s,this.drawcalls=s,s},merge:function(e,t){if(e instanceof i.BufferGeometry==!1)return void i.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0);var r=this.attributes;for(var n in r)if(void 0!==e.attributes[n])for(var o=r[n],a=o.array,s=e.attributes[n],h=s.array,l=s.itemSize,u=0,c=l*t;u<h.length;u++,c++)a[c]=h[u];return this},normalizeNormals:function(){for(var e,t,r,n,i=this.attributes.normal.array,o=0,a=i.length;a>o;o+=3)e=i[o],t=i[o+1],r=i[o+2],n=1/Math.sqrt(e*e+t*t+r*r),i[o]*=n,i[o+1]*=n,i[o+2]*=n},reorderBuffers:function(e,t,r){var n={};for(var i in this.attributes)if("index"!=i){var o=this.attributes[i].array;n[i]=new o.constructor(this.attributes[i].itemSize*r)}for(var a=0;r>a;a++){var s=t[a];for(var i in this.attributes)if("index"!=i)for(var h=this.attributes[i].array,l=this.attributes[i].itemSize,u=n[i],c=0;l>c;c++)u[a*l+c]=h[s*l+c]}this.attributes.index.array=e;for(var i in this.attributes)"index"!=i&&(this.attributes[i].array=n[i],this.attributes[i].numItems=this.attributes[i].itemSize*r)},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},t=this.attributes,r=this.offsets,n=this.boundingSphere;for(var i in t){var o=t[i],a=Array.prototype.slice.call(o.array);e.data.attributes[i]={itemSize:o.itemSize,type:o.array.constructor.name,array:a}}return r.length>0&&(e.data.offsets=JSON.parse(JSON.stringify(r))),null!==n&&(e.data.boundingSphere={center:n.center.toArray(),radius:n.radius}),e},clone:function(){var e=new i.BufferGeometry;for(var t in this.attributes){var r=this.attributes[t];e.addAttribute(t,r.clone())}for(var n=0,o=this.offsets.length;o>n;n++){var a=this.offsets[n];e.offsets.push({start:a.start,index:a.index,count:a.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},i.EventDispatcher.prototype.apply(i.BufferGeometry.prototype),i.Geometry=function(){Object.defineProperty(this,"id",{value:i.GeometryIdCount++}),this.uuid=i.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},i.Geometry.prototype={constructor:i.Geometry,applyMatrix:function(e){for(var t=(new i.Matrix3).getNormalMatrix(e),r=0,n=this.vertices.length;n>r;r++){var o=this.vertices[r];o.applyMatrix4(e)}for(var r=0,n=this.faces.length;n>r;r++){var a=this.faces[r];a.normal.applyMatrix3(t).normalize();for(var s=0,h=a.vertexNormals.length;h>s;s++)a.vertexNormals[s].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},fromBufferGeometry:function(e){for(var t=this,r=e.attributes,n=r.position.array,o=void 0!==r.index?r.index.array:void 0,a=void 0!==r.normal?r.normal.array:void 0,s=void 0!==r.color?r.color.array:void 0,h=void 0!==r.uv?r.uv.array:void 0,l=[],u=[],c=0,p=0;c<n.length;c+=3,p+=2)t.vertices.push(new i.Vector3(n[c],n[c+1],n[c+2])),void 0!==a&&l.push(new i.Vector3(a[c],a[c+1],a[c+2])),void 0!==s&&t.colors.push(new i.Color(s[c],s[c+1],s[c+2])),void 0!==h&&u.push(new i.Vector2(h[p],h[p+1]));var f=function(e,r,n){var o=void 0!==a?[l[e].clone(),l[r].clone(),l[n].clone()]:[],c=void 0!==s?[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()]:[];t.faces.push(new i.Face3(e,r,n,o,c)),void 0!==h&&t.faceVertexUvs[0].push([u[e].clone(),u[r].clone(),u[n].clone()])};if(void 0!==o){var d=e.drawcalls;if(d.length>0)for(var c=0;c<d.length;c++)for(var m=d[c],v=m.start,g=m.count,y=m.index,p=v,x=v+g;x>p;p+=3)f(y+o[p],y+o[p+1],y+o[p+2]);else for(var c=0;c<o.length;c+=3)f(o[c],o[c+1],o[c+2])}else for(var c=0;c<n.length/3;c+=3)f(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.applyMatrix((new i.Matrix4).setPosition(e)),e},computeFaceNormals:function(){for(var e=new i.Vector3,t=new i.Vector3,r=0,n=this.faces.length;n>r;r++){var o=this.faces[r],a=this.vertices[o.a],s=this.vertices[o.b],h=this.vertices[o.c];e.subVectors(h,s),t.subVectors(a,s),e.cross(t),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,o,a,s;for(s=new Array(this.vertices.length),t=0,r=this.vertices.length;r>t;t++)s[t]=new i.Vector3;if(e){var h,l,u,c=new i.Vector3,p=new i.Vector3;for(n=0,o=this.faces.length;o>n;n++)a=this.faces[n],h=this.vertices[a.a],l=this.vertices[a.b],u=this.vertices[a.c],c.subVectors(u,l),p.subVectors(h,l),c.cross(p),s[a.a].add(c),s[a.b].add(c),s[a.c].add(c)}else for(n=0,o=this.faces.length;o>n;n++)a=this.faces[n],s[a.a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal);for(t=0,r=this.vertices.length;r>t;t++)s[t].normalize();for(n=0,o=this.faces.length;o>n;n++)a=this.faces[n],a.vertexNormals[0]=s[a.a].clone(),a.vertexNormals[1]=s[a.b].clone(),a.vertexNormals[2]=s[a.c].clone()},computeMorphNormals:function(){var e,t,r,n,o;for(r=0,n=this.faces.length;n>r;r++)for(o=this.faces[r],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),e=0,t=o.vertexNormals.length;t>e;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();var a=new i.Geometry;for(a.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s,h,l=this.morphNormals[e].faceNormals,u=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;n>r;r++)s=new i.Vector3,h={a:new i.Vector3,b:new i.Vector3,c:new i.Vector3},l.push(s),u.push(h)}var c=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals();var s,h;for(r=0,n=this.faces.length;n>r;r++)o=this.faces[r],s=c.faceNormals[r],h=c.vertexNormals[r],s.copy(o.normal),h.a.copy(o.vertexNormals[0]),h.b.copy(o.vertexNormals[1]),h.c.copy(o.vertexNormals[2])}for(r=0,n=this.faces.length;n>r;r++)o=this.faces[r],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeTangents:function(){function e(e,t,r,n,i,o,a){u=e.vertices[t],c=e.vertices[r],p=e.vertices[n],f=l[i],d=l[o],m=l[a],v=c.x-u.x,g=p.x-u.x,y=c.y-u.y,x=p.y-u.y,w=c.z-u.z,b=p.z-u.z,_=d.x-f.x,S=m.x-f.x,M=d.y-f.y,E=m.y-f.y,T=1/(_*E-S*M),B.set((E*v-M*g)*T,(E*y-M*x)*T,(E*w-M*b)*T),F.set((_*g-S*v)*T,(_*x-S*y)*T,(_*b-S*w)*T),R[t].add(B),R[r].add(B),R[n].add(B),P[t].add(F),P[r].add(F),P[n].add(F)}var t,r,n,o,a,s,h,l,u,c,p,f,d,m,v,g,y,x,w,b,_,S,M,E,T,C,A,L,R=[],P=[],B=new i.Vector3,F=new i.Vector3,k=new i.Vector3,D=new i.Vector3,U=new i.Vector3;for(n=0,o=this.vertices.length;o>n;n++)R[n]=new i.Vector3,P[n]=new i.Vector3;for(t=0,r=this.faces.length;r>t;t++)h=this.faces[t],l=this.faceVertexUvs[0][t],e(this,h.a,h.b,h.c,0,1,2);var z=["a","b","c","d"];for(t=0,r=this.faces.length;r>t;t++)for(h=this.faces[t],a=0;a<Math.min(h.vertexNormals.length,3);a++)U.copy(h.vertexNormals[a]),s=h[z[a]],C=R[s],k.copy(C),k.sub(U.multiplyScalar(U.dot(C))).normalize(),D.crossVectors(h.vertexNormals[a],C),A=D.dot(P[s]),L=0>A?-1:1,h.vertexTangents[a]=new i.Vector4(k.x,k.y,k.z,L);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,n=t.length;n>r;r++)r>0&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new i.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new i.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e instanceof i.Geometry==!1)return void i.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);var n,o=this.vertices.length,a=this.vertices,s=e.vertices,h=this.faces,l=e.faces,u=this.faceVertexUvs[0],c=e.faceVertexUvs[0];void 0===r&&(r=0),void 0!==t&&(n=(new i.Matrix3).getNormalMatrix(t));for(var p=0,f=s.length;f>p;p++){var d=s[p],m=d.clone();void 0!==t&&m.applyMatrix4(t),a.push(m)}for(p=0,f=l.length;f>p;p++){var v,g,y,x=l[p],w=x.vertexNormals,b=x.vertexColors;v=new i.Face3(x.a+o,x.b+o,x.c+o),v.normal.copy(x.normal),void 0!==n&&v.normal.applyMatrix3(n).normalize();
for(var _=0,S=w.length;S>_;_++)g=w[_].clone(),void 0!==n&&g.applyMatrix3(n).normalize(),v.vertexNormals.push(g);v.color.copy(x.color);for(var _=0,S=b.length;S>_;_++)y=b[_],v.vertexColors.push(y.clone());v.materialIndex=x.materialIndex+r,h.push(v)}for(p=0,f=c.length;f>p;p++){var M=c[p],E=[];if(void 0!==M){for(var _=0,S=M.length;S>_;_++)E.push(M[_].clone());u.push(E)}}},mergeMesh:function(e){return e instanceof i.Mesh==!1?void i.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e):(e.matrixAutoUpdate&&e.updateMatrix(),void this.merge(e.geometry,e.matrix))},mergeVertices:function(){var e,t,r,n,i,o,a,s,h={},l=[],u=[],c=4,p=Math.pow(10,c);for(r=0,n=this.vertices.length;n>r;r++)e=this.vertices[r],t=Math.round(e.x*p)+"_"+Math.round(e.y*p)+"_"+Math.round(e.z*p),void 0===h[t]?(h[t]=r,l.push(this.vertices[r]),u[r]=l.length-1):u[r]=u[h[t]];var f=[];for(r=0,n=this.faces.length;n>r;r++){i=this.faces[r],i.a=u[i.a],i.b=u[i.b],i.c=u[i.c],o=[i.a,i.b,i.c];for(var d=-1,m=0;3>m;m++)if(o[m]==o[(m+1)%3]){d=m,f.push(r);break}}for(r=f.length-1;r>=0;r--){var v=f[r];for(this.faces.splice(v,1),a=0,s=this.faceVertexUvs.length;s>a;a++)this.faceVertexUvs[a].splice(v,1)}var g=this.vertices.length-l.length;return this.vertices=l,g},toJSON:function(){function e(e,t,r){return r?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==p[t]?p[t]:(p[t]=c.length/3,c.push(e.x,e.y,e.z),p[t])}function r(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==d[t]?d[t]:(d[t]=f.length,f.push(e.getHex()),d[t])}function n(e){var t=e.x.toString()+e.y.toString();return void 0!==v[t]?v[t]:(v[t]=m.length/2,m.push(e.x,e.y),v[t])}var i={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(""!==this.name&&(i.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var a in o)void 0!==o[a]&&(i[a]=o[a]);return i}for(var s=[],h=0;h<this.vertices.length;h++){var l=this.vertices[h];s.push(l.x,l.y,l.z)}for(var u=[],c=[],p={},f=[],d={},m=[],v={},h=0;h<this.faces.length;h++){var g=this.faces[h],y=!1,x=!1,w=void 0!==this.faceVertexUvs[0][h],b=g.normal.length()>0,_=g.vertexNormals.length>0,S=1!==g.color.r||1!==g.color.g||1!==g.color.b,M=g.vertexColors.length>0,E=0;if(E=e(E,0,0),E=e(E,1,y),E=e(E,2,x),E=e(E,3,w),E=e(E,4,b),E=e(E,5,_),E=e(E,6,S),E=e(E,7,M),u.push(E),u.push(g.a,g.b,g.c),w){var T=this.faceVertexUvs[0][h];u.push(n(T[0]),n(T[1]),n(T[2]))}if(b&&u.push(t(g.normal)),_){var C=g.vertexNormals;u.push(t(C[0]),t(C[1]),t(C[2]))}if(S&&u.push(r(g.color)),M){var A=g.vertexColors;u.push(r(A[0]),r(A[1]),r(A[2]))}}return i.data={},i.data.vertices=s,i.data.normals=c,f.length>0&&(i.data.colors=f),m.length>0&&(i.data.uvs=[m]),i.data.faces=u,i},clone:function(){for(var e=new i.Geometry,t=this.vertices,r=0,n=t.length;n>r;r++)e.vertices.push(t[r].clone());for(var o=this.faces,r=0,n=o.length;n>r;r++)e.faces.push(o[r].clone());for(var r=0,n=this.faceVertexUvs.length;n>r;r++){var a=this.faceVertexUvs[r];void 0===e.faceVertexUvs[r]&&(e.faceVertexUvs[r]=[]);for(var s=0,h=a.length;h>s;s++){for(var l=a[s],u=[],c=0,p=l.length;p>c;c++){var f=l[c];u.push(f.clone())}e.faceVertexUvs[r].push(u)}}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},i.EventDispatcher.prototype.apply(i.Geometry.prototype),i.GeometryIdCount=0,i.Camera=function(){i.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new i.Matrix4,this.projectionMatrix=new i.Matrix4},i.Camera.prototype=Object.create(i.Object3D.prototype),i.Camera.prototype.constructor=i.Camera,i.Camera.prototype.getWorldDirection=function(){var e=new i.Quaternion;return function(t){var r=t||new i.Vector3;return this.getWorldQuaternion(e),r.set(0,0,-1).applyQuaternion(e)}}(),i.Camera.prototype.lookAt=function(){var e=new i.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),i.Camera.prototype.clone=function(e){return void 0===e&&(e=new i.Camera),i.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},i.CubeCamera=function(e,t,r){i.Object3D.call(this),this.type="CubeCamera";var n=90,o=1,a=new i.PerspectiveCamera(n,o,e,t);a.up.set(0,-1,0),a.lookAt(new i.Vector3(1,0,0)),this.add(a);var s=new i.PerspectiveCamera(n,o,e,t);s.up.set(0,-1,0),s.lookAt(new i.Vector3(-1,0,0)),this.add(s);var h=new i.PerspectiveCamera(n,o,e,t);h.up.set(0,0,1),h.lookAt(new i.Vector3(0,1,0)),this.add(h);var l=new i.PerspectiveCamera(n,o,e,t);l.up.set(0,0,-1),l.lookAt(new i.Vector3(0,-1,0)),this.add(l);var u=new i.PerspectiveCamera(n,o,e,t);u.up.set(0,-1,0),u.lookAt(new i.Vector3(0,0,1)),this.add(u);var c=new i.PerspectiveCamera(n,o,e,t);c.up.set(0,-1,0),c.lookAt(new i.Vector3(0,0,-1)),this.add(c),this.renderTarget=new i.WebGLRenderTargetCube(r,r,{format:i.RGBFormat,magFilter:i.LinearFilter,minFilter:i.LinearFilter}),this.updateCubeMap=function(e,t){var r=this.renderTarget,n=r.generateMipmaps;r.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,a,r),r.activeCubeFace=1,e.render(t,s,r),r.activeCubeFace=2,e.render(t,h,r),r.activeCubeFace=3,e.render(t,l,r),r.activeCubeFace=4,e.render(t,u,r),r.generateMipmaps=n,r.activeCubeFace=5,e.render(t,c,r)}},i.CubeCamera.prototype=Object.create(i.Object3D.prototype),i.CubeCamera.prototype.constructor=i.CubeCamera,i.OrthographicCamera=function(e,t,r,n,o,a){i.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=void 0!==o?o:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()},i.OrthographicCamera.prototype=Object.create(i.Camera.prototype),i.OrthographicCamera.prototype.constructor=i.OrthographicCamera,i.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-e,r+e,n+t,n-t,this.near,this.far)},i.OrthographicCamera.prototype.clone=function(){var e=new i.OrthographicCamera;return i.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},i.PerspectiveCamera=function(e,t,r,n){i.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},i.PerspectiveCamera.prototype=Object.create(i.Camera.prototype),i.PerspectiveCamera.prototype.constructor=i.PerspectiveCamera,i.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*i.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},i.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,n,i,o){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=n,this.width=i,this.height=o,this.updateProjectionMatrix()},i.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=i.Math.radToDeg(2*Math.atan(Math.tan(.5*i.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,r=Math.tan(i.Math.degToRad(.5*e))*this.near,n=-r,o=t*n,a=t*r,s=Math.abs(a-o),h=Math.abs(r-n);this.projectionMatrix.makeFrustum(o+this.x*s/this.fullWidth,o+(this.x+this.width)*s/this.fullWidth,r-(this.y+this.height)*h/this.fullHeight,r-this.y*h/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},i.PerspectiveCamera.prototype.clone=function(){var e=new i.PerspectiveCamera;return i.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},i.Light=function(e){i.Object3D.call(this),this.type="Light",this.color=new i.Color(e)},i.Light.prototype=Object.create(i.Object3D.prototype),i.Light.prototype.constructor=i.Light,i.Light.prototype.clone=function(e){return void 0===e&&(e=new i.Light),i.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},i.AmbientLight=function(e){i.Light.call(this,e),this.type="AmbientLight"},i.AmbientLight.prototype=Object.create(i.Light.prototype),i.AmbientLight.prototype.constructor=i.AmbientLight,i.AmbientLight.prototype.clone=function(){var e=new i.AmbientLight;return i.Light.prototype.clone.call(this,e),e},i.AreaLight=function(e,t){i.Light.call(this,e),this.type="AreaLight",this.normal=new i.Vector3(0,-1,0),this.right=new i.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},i.AreaLight.prototype=Object.create(i.Light.prototype),i.AreaLight.prototype.constructor=i.AreaLight,i.DirectionalLight=function(e,t){i.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.target=new i.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new i.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},i.DirectionalLight.prototype=Object.create(i.Light.prototype),i.DirectionalLight.prototype.constructor=i.DirectionalLight,i.DirectionalLight.prototype.clone=function(){var e=new i.DirectionalLight;return i.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},i.HemisphereLight=function(e,t,r){i.Light.call(this,e),this.type="HemisphereLight",this.position.set(0,100,0),this.groundColor=new i.Color(t),this.intensity=void 0!==r?r:1},i.HemisphereLight.prototype=Object.create(i.Light.prototype),i.HemisphereLight.prototype.constructor=i.HemisphereLight,i.HemisphereLight.prototype.clone=function(){var e=new i.HemisphereLight;return i.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},i.PointLight=function(e,t,r,n){i.Light.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1},i.PointLight.prototype=Object.create(i.Light.prototype),i.PointLight.prototype.constructor=i.PointLight,i.PointLight.prototype.clone=function(){var e=new i.PointLight;return i.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e.decay=this.decay,e},i.SpotLight=function(e,t,r,n,o,a){i.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.target=new i.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.exponent=void 0!==o?o:10,this.decay=void 0!==a?a:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},i.SpotLight.prototype=Object.create(i.Light.prototype),i.SpotLight.prototype.constructor=i.SpotLight,i.SpotLight.prototype.clone=function(){var e=new i.SpotLight;return i.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.decay=this.decay,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},i.Cache={files:{},add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},i.Loader=function(e){this.showStatus=e,this.statusDomElement=e?i.Loader.prototype.addStatusElement():null,this.imageLoader=new i.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},i.Loader.prototype={constructor:i.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";t+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var r=[],n=0;n<e.length;++n)r[n]=this.createMaterial(e[n],t);return r},needsTangents:function(e){for(var t=0,r=e.length;r>t;t++){var n=e[t];if(n instanceof i.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){function r(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function n(e,n,o,s,h,l,u){var c,p=t+o,f=i.Loader.Handlers.get(p);if(null!==f?c=f.load(p):(c=new i.Texture,f=a.imageLoader,f.crossOrigin=a.crossOrigin,f.load(p,function(e){if(i.Math.isPowerOfTwo(e.width)===!1||i.Math.isPowerOfTwo(e.height)===!1){var t=r(e.width),n=r(e.height),o=document.createElement("canvas");o.width=t,o.height=n;var a=o.getContext("2d");a.drawImage(e,0,0,t,n),c.image=o}else c.image=e;c.needsUpdate=!0})),c.sourceFile=o,s&&(c.repeat.set(s[0],s[1]),1!==s[0]&&(c.wrapS=i.RepeatWrapping),1!==s[1]&&(c.wrapT=i.RepeatWrapping)),h&&c.offset.set(h[0],h[1]),l){var d={repeat:i.RepeatWrapping,mirror:i.MirroredRepeatWrapping};void 0!==d[l[0]]&&(c.wrapS=d[l[0]]),void 0!==d[l[1]]&&(c.wrapT=d[l[1]])}u&&(c.anisotropy=u),e[n]=c}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var a=this,s="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var l=e.shading.toLowerCase();"phong"===l?s="MeshPhongMaterial":"basic"===l&&(s="MeshBasicMaterial")}void 0!==e.blending&&void 0!==i[e.blending]&&(h.blending=i[e.blending]),void 0!==e.transparent&&(h.transparent=e.transparent),void 0!==e.opacity&&e.opacity<1&&(h.transparent=!0),void 0!==e.depthTest&&(h.depthTest=e.depthTest),void 0!==e.depthWrite&&(h.depthWrite=e.depthWrite),void 0!==e.visible&&(h.visible=e.visible),void 0!==e.flipSided&&(h.side=i.BackSide),void 0!==e.doubleSided&&(h.side=i.DoubleSide),void 0!==e.wireframe&&(h.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?h.vertexColors=i.FaceColors:e.vertexColors&&(h.vertexColors=i.VertexColors)),e.colorDiffuse?h.color=o(e.colorDiffuse):e.DbgColor&&(h.color=e.DbgColor),e.colorSpecular&&(h.specular=o(e.colorSpecular)),e.colorEmissive&&(h.emissive=o(e.colorEmissive)),void 0!==e.transparency&&(console.warn("THREE.Loader: transparency has been renamed to opacity"),e.opacity=e.transparency),void 0!==e.opacity&&(h.opacity=e.opacity),e.specularCoef&&(h.shininess=e.specularCoef),e.mapDiffuse&&t&&n(h,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&n(h,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&n(h,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&n(h,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&n(h,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapAlpha&&t&&n(h,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy),e.mapBumpScale&&(h.bumpScale=e.mapBumpScale),e.mapNormalFactor&&(h.normalScale=new i.Vector2(e.mapNormalFactor,e.mapNormalFactor));var u=new i[s](h);return void 0!==e.DbgName&&(u.name=e.DbgName),u}},i.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,r=this.handlers.length;r>t;t+=2){var n=this.handlers[t],i=this.handlers[t+1];if(n.test(e))return i}return null}},i.XHRLoader=function(e){this.manager=void 0!==e?e:i.DefaultLoadingManager},i.XHRLoader.prototype={constructor:i.XHRLoader,load:function(e,t,r,n){var o=this,a=i.Cache.get(e);if(void 0!==a)return void(t&&t(a));var s=new XMLHttpRequest;s.open("GET",e,!0),s.addEventListener("load",function(r){i.Cache.add(e,this.response),t&&t(this.response),o.manager.itemEnd(e)},!1),void 0!==r&&s.addEventListener("progress",function(e){r(e)},!1),void 0!==n&&s.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(s.responseType=this.responseType),s.send(null),o.manager.itemStart(e)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}},i.ImageLoader=function(e){this.manager=void 0!==e?e:i.DefaultLoadingManager},i.ImageLoader.prototype={constructor:i.ImageLoader,load:function(e,t,r,n){var o=this,a=i.Cache.get(e);if(void 0!==a)return void t(a);var s=document.createElement("img");return s.addEventListener("load",function(r){i.Cache.add(e,this),t&&t(this),o.manager.itemEnd(e)},!1),void 0!==r&&s.addEventListener("progress",function(e){r(e)},!1),void 0!==n&&s.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),s.src=e,o.manager.itemStart(e),s},setCrossOrigin:function(e){this.crossOrigin=e}},i.JSONLoader=function(e){i.Loader.call(this,e),this.withCredentials=!1},i.JSONLoader.prototype=Object.create(i.Loader.prototype),i.JSONLoader.prototype.constructor=i.JSONLoader,i.JSONLoader.prototype.load=function(e,t,r){r=r&&"string"==typeof r?r:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,r)},i.JSONLoader.prototype.loadAjaxJSON=function(e,t,r,n,o){var a=new XMLHttpRequest,s=0;a.onreadystatechange=function(){if(a.readyState===a.DONE)if(200===a.status||0===a.status){if(a.responseText){var h=JSON.parse(a.responseText),l=h.metadata;if(void 0!==l){if("object"===l.type)return void i.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===l.type)return void i.error("THREE.JSONLoader: "+t+" seems to be a Scene. Use THREE.SceneLoader instead.")}var u=e.parse(h,n);r(u.geometry,u.materials)}else i.error("THREE.JSONLoader: "+t+" seems to be unreachable or the file is empty.");e.onLoadComplete()}else i.error("THREE.JSONLoader: Couldn't load "+t+" ("+a.status+")");else a.readyState===a.LOADING?o&&(0===s&&(s=a.getResponseHeader("Content-Length")),o({total:s,loaded:a.responseText.length})):a.readyState===a.HEADERS_RECEIVED&&void 0!==o&&(s=a.getResponseHeader("Content-Length"))},a.open("GET",t,!0),a.withCredentials=this.withCredentials,a.send(null)},i.JSONLoader.prototype.parse=function(e,t){function r(t){function r(e,t){return e&1<<t}var n,o,s,h,l,u,c,p,f,d,m,v,g,y,x,w,b,_,S,M,E,T,C,A,L,R,P,B=e.faces,F=e.vertices,k=e.normals,D=e.colors,U=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&U++;for(n=0;U>n;n++)a.faceVertexUvs[n]=[]}for(h=0,l=F.length;l>h;)_=new i.Vector3,_.x=F[h++]*t,_.y=F[h++]*t,_.z=F[h++]*t,a.vertices.push(_);for(h=0,l=B.length;l>h;)if(d=B[h++],m=r(d,0),v=r(d,1),g=r(d,3),y=r(d,4),x=r(d,5),w=r(d,6),b=r(d,7),m){if(M=new i.Face3,M.a=B[h],M.b=B[h+1],M.c=B[h+3],E=new i.Face3,E.a=B[h+1],E.b=B[h+2],E.c=B[h+3],h+=4,v&&(f=B[h++],M.materialIndex=f,E.materialIndex=f),s=a.faces.length,g)for(n=0;U>n;n++)for(A=e.uvs[n],a.faceVertexUvs[n][s]=[],a.faceVertexUvs[n][s+1]=[],o=0;4>o;o++)p=B[h++],R=A[2*p],P=A[2*p+1],L=new i.Vector2(R,P),2!==o&&a.faceVertexUvs[n][s].push(L),0!==o&&a.faceVertexUvs[n][s+1].push(L);if(y&&(c=3*B[h++],M.normal.set(k[c++],k[c++],k[c]),E.normal.copy(M.normal)),x)for(n=0;4>n;n++)c=3*B[h++],C=new i.Vector3(k[c++],k[c++],k[c]),2!==n&&M.vertexNormals.push(C),0!==n&&E.vertexNormals.push(C);if(w&&(u=B[h++],T=D[u],M.color.setHex(T),E.color.setHex(T)),b)for(n=0;4>n;n++)u=B[h++],T=D[u],2!==n&&M.vertexColors.push(new i.Color(T)),0!==n&&E.vertexColors.push(new i.Color(T));a.faces.push(M),a.faces.push(E)}else{if(S=new i.Face3,S.a=B[h++],S.b=B[h++],S.c=B[h++],v&&(f=B[h++],S.materialIndex=f),s=a.faces.length,g)for(n=0;U>n;n++)for(A=e.uvs[n],a.faceVertexUvs[n][s]=[],o=0;3>o;o++)p=B[h++],R=A[2*p],P=A[2*p+1],L=new i.Vector2(R,P),a.faceVertexUvs[n][s].push(L);if(y&&(c=3*B[h++],S.normal.set(k[c++],k[c++],k[c])),x)for(n=0;3>n;n++)c=3*B[h++],C=new i.Vector3(k[c++],k[c++],k[c]),S.vertexNormals.push(C);if(w&&(u=B[h++],S.color.setHex(D[u])),b)for(n=0;3>n;n++)u=B[h++],S.vertexColors.push(new i.Color(D[u]));a.faces.push(S)}}function n(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,n=e.skinWeights.length;n>r;r+=t){var o=e.skinWeights[r],s=t>1?e.skinWeights[r+1]:0,h=t>2?e.skinWeights[r+2]:0,l=t>3?e.skinWeights[r+3]:0;a.skinWeights.push(new i.Vector4(o,s,h,l))}if(e.skinIndices)for(var r=0,n=e.skinIndices.length;n>r;r+=t){var u=e.skinIndices[r],c=t>1?e.skinIndices[r+1]:0,p=t>2?e.skinIndices[r+2]:0,f=t>3?e.skinIndices[r+3]:0;a.skinIndices.push(new i.Vector4(u,c,p,f))}a.bones=e.bones,a.bones&&a.bones.length>0&&(a.skinWeights.length!==a.skinIndices.length||a.skinIndices.length!==a.vertices.length)&&i.warn("THREE.JSONLoader: When skinning, number of vertices ("+a.vertices.length+"), skinIndices ("+a.skinIndices.length+"), and skinWeights ("+a.skinWeights.length+") should match."),a.animation=e.animation,a.animations=e.animations}function o(t){if(void 0!==e.morphTargets){var r,n,o,s,h,l;for(r=0,n=e.morphTargets.length;n>r;r++)for(a.morphTargets[r]={},a.morphTargets[r].name=e.morphTargets[r].name,a.morphTargets[r].vertices=[],h=a.morphTargets[r].vertices,l=e.morphTargets[r].vertices,o=0,s=l.length;s>o;o+=3){var u=new i.Vector3;u.x=l[o]*t,u.y=l[o+1]*t,u.z=l[o+2]*t,h.push(u)}}if(void 0!==e.morphColors){var r,n,c,p,f,d,m;for(r=0,n=e.morphColors.length;n>r;r++)for(a.morphColors[r]={},a.morphColors[r].name=e.morphColors[r].name,a.morphColors[r].colors=[],f=a.morphColors[r].colors,d=e.morphColors[r].colors,c=0,p=d.length;p>c;c+=3)m=new i.Color(16755200),m.setRGB(d[c],d[c+1],d[c+2]),f.push(m)}}var a=new i.Geometry,s=void 0!==e.scale?1/e.scale:1;if(r(s),n(),o(s),a.computeFaceNormals(),a.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:a};var h=this.initMaterials(e.materials,t);return this.needsTangents(h)&&a.computeTangents(),{geometry:a,materials:h}},i.LoadingManager=function(e,t,r){var n=this,i=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++},this.itemEnd=function(e){i++,void 0!==n.onProgress&&n.onProgress(e,i,o),i===o&&void 0!==n.onLoad&&n.onLoad()}},i.DefaultLoadingManager=new i.LoadingManager,i.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:i.DefaultLoadingManager},i.BufferGeometryLoader.prototype={constructor:i.BufferGeometryLoader,load:function(e,t,r,n){var o=this,a=new i.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(o.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new i.BufferGeometry,r=e.data.attributes;for(var o in r){var a=r[o],s=new n[a.type](a.array);t.addAttribute(o,new i.BufferAttribute(s,a.itemSize))}var h=e.data.offsets;void 0!==h&&(t.offsets=JSON.parse(JSON.stringify(h)));var l=e.data.boundingSphere;if(void 0!==l){var u=new i.Vector3;void 0!==l.center&&u.fromArray(l.center),t.boundingSphere=new i.Sphere(u,l.radius)}return t}},i.MaterialLoader=function(e){this.manager=void 0!==e?e:i.DefaultLoadingManager},i.MaterialLoader.prototype={constructor:i.MaterialLoader,load:function(e,t,r,n){var o=this,a=new i.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){t(o.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new i[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.materials)for(var r=0,n=e.materials.length;n>r;r++)t.materials.push(this.parse(e.materials[r]));return t}},i.ObjectLoader=function(e){this.manager=void 0!==e?e:i.DefaultLoadingManager,this.texturePath=""},i.ObjectLoader.prototype={constructor:i.ObjectLoader,load:function(e,t,r,n){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var o=this,a=new i.XHRLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){o.parse(JSON.parse(e),t)},r,n)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=this.parseGeometries(e.geometries),n=this.parseImages(e.images,function(){void 0!==t&&t(a)}),i=this.parseTextures(e.textures,n),o=this.parseMaterials(e.materials,i),a=this.parseObject(e.object,r,o);return(void 0===e.images||0===e.images.length)&&void 0!==t&&t(a),a},parseGeometries:function(e){var t={};if(void 0!==e)for(var r=new i.JSONLoader,n=new i.BufferGeometryLoader,o=0,a=e.length;a>o;o++){var s,h=e[o];switch(h.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new i[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"CubeGeometry":s=new i.BoxGeometry(h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleGeometry":s=new i.CircleGeometry(h.radius,h.segments);break;case"CylinderGeometry":s=new i.CylinderGeometry(h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded);break;case"SphereGeometry":s=new i.SphereGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"IcosahedronGeometry":s=new i.IcosahedronGeometry(h.radius,h.detail);break;case"TorusGeometry":s=new i.TorusGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":s=new i.TorusKnotGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.p,h.q,h.heightScale);break;case"BufferGeometry":s=n.parse(h);break;case"Geometry":s=r.parse(h.data).geometry}s.uuid=h.uuid,void 0!==h.name&&(s.name=h.name),t[h.uuid]=s}return t},parseMaterials:function(e,t){var r={};if(void 0!==e)for(var n=function(e){return void 0===t[e]&&i.warn("THREE.ObjectLoader: Undefined texture",e),t[e]},o=new i.MaterialLoader,a=0,s=e.length;s>a;a++){var h=e[a],l=o.parse(h);l.uuid=h.uuid,void 0!==h.name&&(l.name=h.name),void 0!==h.map&&(l.map=n(h.map)),void 0!==h.bumpMap&&(l.bumpMap=n(h.bumpMap),h.bumpScale&&(l.bumpScale=new i.Vector2(h.bumpScale,h.bumpScale))),void 0!==h.alphaMap&&(l.alphaMap=n(h.alphaMap)),void 0!==h.envMap&&(l.envMap=n(h.envMap)),void 0!==h.normalMap&&(l.normalMap=n(h.normalMap),h.normalScale&&(l.normalScale=new i.Vector2(h.normalScale,h.normalScale))),void 0!==h.lightMap&&(l.lightMap=n(h.lightMap)),void 0!==h.specularMap&&(l.specularMap=n(h.specularMap)),r[h.uuid]=l}return r},parseImages:function(e,t){var r=this,n={};if(void 0!==e&&e.length>0){var o=new i.LoadingManager(t),a=new i.ImageLoader(o);a.setCrossOrigin(this.crossOrigin);for(var s=function(e){return r.manager.itemStart(e),a.load(e,function(){r.manager.itemEnd(e)})},h=0,l=e.length;l>h;h++){var u=e[h],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:r.texturePath+u.url;n[u.uuid]=s(c)}}return n},parseTextures:function(e,t){var r={};if(void 0!==e)for(var n=0,o=e.length;o>n;n++){var a=e[n];void 0===a.image&&i.warn('THREE.ObjectLoader: No "image" speficied for',a.uuid),void 0===t[a.image]&&i.warn("THREE.ObjectLoader: Undefined image",a.image);var s=new i.Texture(t[a.image]);s.needsUpdate=!0,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.repeat&&(s.repeat=new i.Vector2(a.repeat[0],a.repeat[1])),void 0!==a.minFilter&&(s.minFilter=i[a.minFilter]),void 0!==a.magFilter&&(s.magFilter=i[a.magFilter]),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),a.wrap instanceof Array&&(s.wrapS=i[a.wrap[0]],s.wrapT=i[a.wrap[1]]),r[a.uuid]=s}return r},parseObject:function(){var e=new i.Matrix4;return function(t,r,n){var o,a=function(e){return void 0===r[e]&&i.warn("THREE.ObjectLoader: Undefined geometry",e),r[e]},s=function(e){return void 0===n[e]&&i.warn("THREE.ObjectLoader: Undefined material",e),n[e]};switch(t.type){case"Scene":o=new i.Scene;break;case"PerspectiveCamera":o=new i.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":o=new i.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":o=new i.AmbientLight(t.color);break;case"DirectionalLight":o=new i.DirectionalLight(t.color,t.intensity);break;case"PointLight":o=new i.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":o=new i.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":o=new i.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":o=new i.Mesh(a(t.geometry),s(t.material));break;case"Line":o=new i.Line(a(t.geometry),s(t.material),t.mode);break;case"PointCloud":o=new i.PointCloud(a(t.geometry),s(t.material));break;case"Sprite":o=new i.Sprite(s(t.material));break;case"Group":o=new i.Group;break;default:o=new i.Object3D}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.children)for(var h in t.children)o.add(this.parseObject(t.children[h],r,n));return o}}()},i.TextureLoader=function(e){this.manager=void 0!==e?e:i.DefaultLoadingManager},i.TextureLoader.prototype={constructor:i.TextureLoader,load:function(e,t,r,n){var o=this,a=new i.ImageLoader(o.manager);a.setCrossOrigin(this.crossOrigin),a.load(e,function(e){
var r=new i.Texture(e);r.needsUpdate=!0,void 0!==t&&t(r)},r,n)},setCrossOrigin:function(e){this.crossOrigin=e}},i.DataTextureLoader=i.BinaryTextureLoader=function(){this._parser=null},i.BinaryTextureLoader.prototype={constructor:i.BinaryTextureLoader,load:function(e,t,r,n){var o=this,a=new i.DataTexture,s=new i.XHRLoader;return s.setResponseType("arraybuffer"),s.load(e,function(e){var r=o._parser(e);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:i.ClampToEdgeWrapping,a.wrapT=void 0!==r.wrapT?r.wrapT:i.ClampToEdgeWrapping,a.magFilter=void 0!==r.magFilter?r.magFilter:i.LinearFilter,a.minFilter=void 0!==r.minFilter?r.minFilter:i.LinearMipMapLinearFilter,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps),1===r.mipmapCount&&(a.minFilter=i.LinearFilter),a.needsUpdate=!0,t&&t(a,r))},r,n),a}},i.CompressedTextureLoader=function(){this._parser=null},i.CompressedTextureLoader.prototype={constructor:i.CompressedTextureLoader,load:function(e,t,r){var n=this,o=[],a=new i.CompressedTexture;a.image=o;var s=new i.XHRLoader;if(s.setResponseType("arraybuffer"),e instanceof Array)for(var h=0,l=function(r){s.load(e[r],function(e){var s=n._parser(e,!0);o[r]={width:s.width,height:s.height,format:s.format,mipmaps:s.mipmaps},h+=1,6===h&&(1==s.mipmapCount&&(a.minFilter=i.LinearFilter),a.format=s.format,a.needsUpdate=!0,t&&t(a))})},u=0,c=e.length;c>u;++u)l(u);else s.load(e,function(e){var r=n._parser(e,!0);if(r.isCubemap)for(var s=r.mipmaps.length/r.mipmapCount,h=0;s>h;h++){o[h]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)o[h].mipmaps.push(r.mipmaps[h*r.mipmapCount+l]),o[h].format=r.format,o[h].width=r.width,o[h].height=r.height}else a.image.width=r.width,a.image.height=r.height,a.mipmaps=r.mipmaps;1===r.mipmapCount&&(a.minFilter=i.LinearFilter),a.format=r.format,a.needsUpdate=!0,t&&t(a)});return a}},i.Material=function(){Object.defineProperty(this,"id",{value:i.MaterialIdCount++}),this.uuid=i.Math.generateUUID(),this.name="",this.type="Material",this.side=i.FrontSide,this.opacity=1,this.transparent=!1,this.blending=i.NormalBlending,this.blendSrc=i.SrcAlphaFactor,this.blendDst=i.OneMinusSrcAlphaFactor,this.blendEquation=i.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},i.Material.prototype={constructor:i.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){if(t in this){var n=this[t];n instanceof i.Color?n.set(r):n instanceof i.Vector3&&r instanceof i.Vector3?n.copy(r):"overdraw"==t?this[t]=Number(r):this[t]=r}}else i.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};return""!==this.name&&(e.name=this.name),this instanceof i.MeshBasicMaterial?(e.color=this.color.getHex(),this.vertexColors!==i.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==i.NormalBlending&&(e.blending=this.blending),this.side!==i.FrontSide&&(e.side=this.side)):this instanceof i.MeshLambertMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),this.vertexColors!==i.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==i.SmoothShading&&(e.shading=this.shading),this.blending!==i.NormalBlending&&(e.blending=this.blending),this.side!==i.FrontSide&&(e.side=this.side)):this instanceof i.MeshPhongMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),e.specular=this.specular.getHex(),e.shininess=this.shininess,this.vertexColors!==i.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==i.SmoothShading&&(e.shading=this.shading),this.blending!==i.NormalBlending&&(e.blending=this.blending),this.side!==i.FrontSide&&(e.side=this.side)):this instanceof i.MeshNormalMaterial?(this.blending!==i.NormalBlending&&(e.blending=this.blending),this.side!==i.FrontSide&&(e.side=this.side)):this instanceof i.MeshDepthMaterial?(this.blending!==i.NormalBlending&&(e.blending=this.blending),this.side!==i.FrontSide&&(e.side=this.side)):this instanceof i.PointCloudMaterial?(e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.color=this.color.getHex(),this.vertexColors!==i.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==i.NormalBlending&&(e.blending=this.blending)):this instanceof i.ShaderMaterial?(e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader):this instanceof i.SpriteMaterial&&(e.color=this.color.getHex()),this.opacity<1&&(e.opacity=this.opacity),this.transparent!==!1&&(e.transparent=this.transparent),this.wireframe!==!1&&(e.wireframe=this.wireframe),e},clone:function(e){return void 0===e&&(e=new i.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.blendSrcAlpha=this.blendSrcAlpha,e.blendDstAlpha=this.blendDstAlpha,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},i.EventDispatcher.prototype.apply(i.Material.prototype),i.MaterialIdCount=0,i.LineBasicMaterial=function(e){i.Material.call(this),this.type="LineBasicMaterial",this.color=new i.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=i.NoColors,this.fog=!0,this.setValues(e)},i.LineBasicMaterial.prototype=Object.create(i.Material.prototype),i.LineBasicMaterial.prototype.constructor=i.LineBasicMaterial,i.LineBasicMaterial.prototype.clone=function(){var e=new i.LineBasicMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},i.LineDashedMaterial=function(e){i.Material.call(this),this.type="LineDashedMaterial",this.color=new i.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},i.LineDashedMaterial.prototype=Object.create(i.Material.prototype),i.LineDashedMaterial.prototype.constructor=i.LineDashedMaterial,i.LineDashedMaterial.prototype.clone=function(){var e=new i.LineDashedMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},i.MeshBasicMaterial=function(e){i.Material.call(this),this.type="MeshBasicMaterial",this.color=new i.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=i.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=i.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=i.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},i.MeshBasicMaterial.prototype=Object.create(i.Material.prototype),i.MeshBasicMaterial.prototype.constructor=i.MeshBasicMaterial,i.MeshBasicMaterial.prototype.clone=function(){var e=new i.MeshBasicMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},i.MeshLambertMaterial=function(e){i.Material.call(this),this.type="MeshLambertMaterial",this.color=new i.Color(16777215),this.emissive=new i.Color(0),this.wrapAround=!1,this.wrapRGB=new i.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=i.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=i.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=i.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},i.MeshLambertMaterial.prototype=Object.create(i.Material.prototype),i.MeshLambertMaterial.prototype.constructor=i.MeshLambertMaterial,i.MeshLambertMaterial.prototype.clone=function(){var e=new i.MeshLambertMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},i.MeshPhongMaterial=function(e){i.Material.call(this),this.type="MeshPhongMaterial",this.color=new i.Color(16777215),this.emissive=new i.Color(0),this.specular=new i.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new i.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new i.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=i.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=i.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=i.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},i.MeshPhongMaterial.prototype=Object.create(i.Material.prototype),i.MeshPhongMaterial.prototype.constructor=i.MeshPhongMaterial,i.MeshPhongMaterial.prototype.clone=function(){var e=new i.MeshPhongMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},i.MeshDepthMaterial=function(e){i.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},i.MeshDepthMaterial.prototype=Object.create(i.Material.prototype),i.MeshDepthMaterial.prototype.constructor=i.MeshDepthMaterial,i.MeshDepthMaterial.prototype.clone=function(){var e=new i.MeshDepthMaterial;return i.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},i.MeshNormalMaterial=function(e){i.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},i.MeshNormalMaterial.prototype=Object.create(i.Material.prototype),i.MeshNormalMaterial.prototype.constructor=i.MeshNormalMaterial,i.MeshNormalMaterial.prototype.clone=function(){var e=new i.MeshNormalMaterial;return i.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},i.MeshFaceMaterial=function(e){this.uuid=i.Math.generateUUID(),this.type="MeshFaceMaterial",this.materials=e instanceof Array?e:[]},i.MeshFaceMaterial.prototype={constructor:i.MeshFaceMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,r=this.materials.length;r>t;t++)e.materials.push(this.materials[t].toJSON());return e},clone:function(){for(var e=new i.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e}},i.PointCloudMaterial=function(e){i.Material.call(this),this.type="PointCloudMaterial",this.color=new i.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=i.NoColors,this.fog=!0,this.setValues(e)},i.PointCloudMaterial.prototype=Object.create(i.Material.prototype),i.PointCloudMaterial.prototype.constructor=i.PointCloudMaterial,i.PointCloudMaterial.prototype.clone=function(){var e=new i.PointCloudMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},i.ParticleBasicMaterial=function(e){return i.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new i.PointCloudMaterial(e)},i.ParticleSystemMaterial=function(e){return i.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new i.PointCloudMaterial(e)},i.ShaderMaterial=function(e){i.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=i.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=i.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(e)},i.ShaderMaterial.prototype=Object.create(i.Material.prototype),i.ShaderMaterial.prototype.constructor=i.ShaderMaterial,i.ShaderMaterial.prototype.clone=function(){var e=new i.ShaderMaterial;return i.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=i.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},i.RawShaderMaterial=function(e){i.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},i.RawShaderMaterial.prototype=Object.create(i.ShaderMaterial.prototype),i.RawShaderMaterial.prototype.constructor=i.RawShaderMaterial,i.RawShaderMaterial.prototype.clone=function(){var e=new i.RawShaderMaterial;return i.ShaderMaterial.prototype.clone.call(this,e),e},i.SpriteMaterial=function(e){i.Material.call(this),this.type="SpriteMaterial",this.color=new i.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},i.SpriteMaterial.prototype=Object.create(i.Material.prototype),i.SpriteMaterial.prototype.constructor=i.SpriteMaterial,i.SpriteMaterial.prototype.clone=function(){var e=new i.SpriteMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},i.Texture=function(e,t,r,n,o,a,s,h,l){Object.defineProperty(this,"id",{value:i.TextureIdCount++}),this.uuid=i.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==e?e:i.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:i.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:i.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:i.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:i.LinearFilter,this.minFilter=void 0!==a?a:i.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:i.RGBAFormat,this.type=void 0!==h?h:i.UnsignedByteType,this.offset=new i.Vector2(0,0),this.repeat=new i.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},i.Texture.DEFAULT_IMAGE=void 0,i.Texture.DEFAULT_MAPPING=i.UVMapping,i.Texture.prototype={constructor:i.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new i.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},i.EventDispatcher.prototype.apply(i.Texture.prototype),i.TextureIdCount=0,i.CubeTexture=function(e,t,r,n,o,a,s,h,l){t=void 0!==t?t:i.CubeReflectionMapping,i.Texture.call(this,e,t,r,n,o,a,s,h,l),this.images=e},i.CubeTexture.prototype=Object.create(i.Texture.prototype),i.CubeTexture.prototype.constructor=i.CubeTexture,i.CubeTexture.clone=function(e){return void 0===e&&(e=new i.CubeTexture),i.Texture.prototype.clone.call(this,e),e.images=this.images,e},i.CompressedTexture=function(e,t,r,n,o,a,s,h,l,u,c){i.Texture.call(this,null,a,s,h,l,u,n,o,c),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},i.CompressedTexture.prototype=Object.create(i.Texture.prototype),i.CompressedTexture.prototype.constructor=i.CompressedTexture,i.CompressedTexture.prototype.clone=function(){var e=new i.CompressedTexture;return i.Texture.prototype.clone.call(this,e),e},i.DataTexture=function(e,t,r,n,o,a,s,h,l,u,c){i.Texture.call(this,null,a,s,h,l,u,n,o,c),this.image={data:e,width:t,height:r}},i.DataTexture.prototype=Object.create(i.Texture.prototype),i.DataTexture.prototype.constructor=i.DataTexture,i.DataTexture.prototype.clone=function(){var e=new i.DataTexture;return i.Texture.prototype.clone.call(this,e),e},i.VideoTexture=function(e,t,r,n,o,a,s,h,l){i.Texture.call(this,e,t,r,n,o,a,s,h,l),this.generateMipmaps=!1;var u=this,c=function(){requestAnimationFrame(c),e.readyState===e.HAVE_ENOUGH_DATA&&(u.needsUpdate=!0)};c()},i.VideoTexture.prototype=Object.create(i.Texture.prototype),i.VideoTexture.prototype.constructor=i.VideoTexture,i.Group=function(){i.Object3D.call(this),this.type="Group"},i.Group.prototype=Object.create(i.Object3D.prototype),i.Group.prototype.constructor=i.Group,i.PointCloud=function(e,t){i.Object3D.call(this),this.type="PointCloud",this.geometry=void 0!==e?e:new i.Geometry,this.material=void 0!==t?t:new i.PointCloudMaterial({color:16777215*Math.random()})},i.PointCloud.prototype=Object.create(i.Object3D.prototype),i.PointCloud.prototype.constructor=i.PointCloud,i.PointCloud.prototype.raycast=function(){var e=new i.Matrix4,t=new i.Ray;return function(r,n){var o=this,a=o.geometry,s=r.params.PointCloud.threshold;if(e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e),null===a.boundingBox||t.isIntersectionBox(a.boundingBox)!==!1){var h=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=new i.Vector3,u=function(e,i){var a=t.distanceToPoint(e);if(h>a){var s=t.closestPointToPoint(e);s.applyMatrix4(o.matrixWorld);var l=r.ray.origin.distanceTo(s);n.push({distance:l,distanceToRay:a,point:s.clone(),index:i,face:null,object:o})}};if(a instanceof i.BufferGeometry){var c=a.attributes,p=c.position.array;if(void 0!==c.index){var f=c.index.array,d=a.offsets;if(0===d.length){var m={start:0,count:f.length,index:0};d=[m]}for(var v=0,g=d.length;g>v;++v)for(var y=d[v].start,x=d[v].count,w=d[v].index,b=y,_=y+x;_>b;b++){var S=w+f[b];l.fromArray(p,3*S),u(l,S)}}else for(var M=p.length/3,b=0;M>b;b++)l.set(p[3*b],p[3*b+1],p[3*b+2]),u(l,b)}else for(var E=this.geometry.vertices,b=0;b<E.length;b++)u(E[b],b)}}}(),i.PointCloud.prototype.clone=function(e){return void 0===e&&(e=new i.PointCloud(this.geometry,this.material)),i.Object3D.prototype.clone.call(this,e),e},i.ParticleSystem=function(e,t){return i.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new i.PointCloud(e,t)},i.Line=function(e,t,r){i.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new i.Geometry,this.material=void 0!==t?t:new i.LineBasicMaterial({color:16777215*Math.random()}),this.mode=void 0!==r?r:i.LineStrip},i.LineStrip=0,i.LinePieces=1,i.Line.prototype=Object.create(i.Object3D.prototype),i.Line.prototype.constructor=i.Line,i.Line.prototype.raycast=function(){var e=new i.Matrix4,t=new i.Ray,r=new i.Sphere;return function(n,o){var a=n.linePrecision,s=a*a,h=this.geometry;if(null===h.boundingSphere&&h.computeBoundingSphere(),r.copy(h.boundingSphere),r.applyMatrix4(this.matrixWorld),n.ray.isIntersectionSphere(r)!==!1){e.getInverse(this.matrixWorld),t.copy(n.ray).applyMatrix4(e);var l=new i.Vector3,u=new i.Vector3,c=new i.Vector3,p=new i.Vector3,f=this.mode===i.LineStrip?1:2;if(h instanceof i.BufferGeometry){var d=h.attributes;if(void 0!==d.index){var m=d.index.array,v=d.position.array,g=h.offsets;0===g.length&&(g=[{start:0,count:m.length,index:0}]);for(var y=0;y<g.length;y++)for(var x=g[y].start,w=g[y].count,b=g[y].index,_=x;x+w-1>_;_+=f){var S=b+m[_],M=b+m[_+1];l.fromArray(v,3*S),u.fromArray(v,3*M);var E=t.distanceSqToSegment(l,u,p,c);if(!(E>s)){var T=t.origin.distanceTo(p);T<n.near||T>n.far||o.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:_,offsetIndex:y,face:null,faceIndex:null,object:this})}}}else for(var v=d.position.array,_=0;_<v.length/3-1;_+=f){l.fromArray(v,3*_),u.fromArray(v,3*_+3);var E=t.distanceSqToSegment(l,u,p,c);if(!(E>s)){var T=t.origin.distanceTo(p);T<n.near||T>n.far||o.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}else if(h instanceof i.Geometry)for(var C=h.vertices,A=C.length,_=0;A-1>_;_+=f){var E=t.distanceSqToSegment(C[_],C[_+1],p,c);if(!(E>s)){var T=t.origin.distanceTo(p);T<n.near||T>n.far||o.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}}}(),i.Line.prototype.clone=function(e){return void 0===e&&(e=new i.Line(this.geometry,this.material,this.mode)),i.Object3D.prototype.clone.call(this,e),e},i.Mesh=function(e,t){i.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new i.Geometry,this.material=void 0!==t?t:new i.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},i.Mesh.prototype=Object.create(i.Object3D.prototype),i.Mesh.prototype.constructor=i.Mesh,i.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},i.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(i.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},i.Mesh.prototype.raycast=function(){var e=new i.Matrix4,t=new i.Ray,r=new i.Sphere,n=new i.Vector3,o=new i.Vector3,a=new i.Vector3;return function(s,h){var l=this.geometry;if(null===l.boundingSphere&&l.computeBoundingSphere(),r.copy(l.boundingSphere),r.applyMatrix4(this.matrixWorld),s.ray.isIntersectionSphere(r)!==!1&&(e.getInverse(this.matrixWorld),t.copy(s.ray).applyMatrix4(e),null===l.boundingBox||t.isIntersectionBox(l.boundingBox)!==!1))if(l instanceof i.BufferGeometry){var u=this.material;if(void 0===u)return;var c,p,f,d=l.attributes,m=s.precision;if(void 0!==d.index){var v=d.index.array,g=d.position.array,y=l.offsets;0===y.length&&(y=[{start:0,count:v.length,index:0}]);for(var x=0,w=y.length;w>x;++x)for(var b=y[x].start,_=y[x].count,S=y[x].index,M=b,E=b+_;E>M;M+=3){if(c=S+v[M],p=S+v[M+1],f=S+v[M+2],n.fromArray(g,3*c),o.fromArray(g,3*p),a.fromArray(g,3*f),u.side===i.BackSide)var T=t.intersectTriangle(a,o,n,!0);else var T=t.intersectTriangle(n,o,a,u.side!==i.DoubleSide);if(null!==T){T.applyMatrix4(this.matrixWorld);var C=s.ray.origin.distanceTo(T);m>C||C<s.near||C>s.far||h.push({distance:C,point:T,face:new i.Face3(c,p,f,i.Triangle.normal(n,o,a)),faceIndex:null,object:this})}}}else for(var g=d.position.array,M=0,A=0,E=g.length;E>M;M+=3,A+=9){if(c=M,p=M+1,f=M+2,n.fromArray(g,A),o.fromArray(g,A+3),a.fromArray(g,A+6),u.side===i.BackSide)var T=t.intersectTriangle(a,o,n,!0);else var T=t.intersectTriangle(n,o,a,u.side!==i.DoubleSide);if(null!==T){T.applyMatrix4(this.matrixWorld);var C=s.ray.origin.distanceTo(T);m>C||C<s.near||C>s.far||h.push({distance:C,point:T,face:new i.Face3(c,p,f,i.Triangle.normal(n,o,a)),faceIndex:null,object:this})}}}else if(l instanceof i.Geometry)for(var c,p,f,L=this.material instanceof i.MeshFaceMaterial,R=L===!0?this.material.materials:null,m=s.precision,P=l.vertices,B=0,F=l.faces.length;F>B;B++){var k=l.faces[B],u=L===!0?R[k.materialIndex]:this.material;if(void 0!==u){if(c=P[k.a],p=P[k.b],f=P[k.c],u.morphTargets===!0){var D=l.morphTargets,U=this.morphTargetInfluences;n.set(0,0,0),o.set(0,0,0),a.set(0,0,0);for(var z=0,V=D.length;V>z;z++){var I=U[z];if(0!==I){var N=D[z].vertices;n.x+=(N[k.a].x-c.x)*I,n.y+=(N[k.a].y-c.y)*I,n.z+=(N[k.a].z-c.z)*I,o.x+=(N[k.b].x-p.x)*I,o.y+=(N[k.b].y-p.y)*I,o.z+=(N[k.b].z-p.z)*I,a.x+=(N[k.c].x-f.x)*I,a.y+=(N[k.c].y-f.y)*I,a.z+=(N[k.c].z-f.z)*I}}n.add(c),o.add(p),a.add(f),c=n,p=o,f=a}if(u.side===i.BackSide)var T=t.intersectTriangle(f,p,c,!0);else var T=t.intersectTriangle(c,p,f,u.side!==i.DoubleSide);if(null!==T){T.applyMatrix4(this.matrixWorld);var C=s.ray.origin.distanceTo(T);m>C||C<s.near||C>s.far||h.push({distance:C,point:T,face:k,faceIndex:B,object:this})}}}}}(),i.Mesh.prototype.clone=function(e,t){return void 0===e&&(e=new i.Mesh(this.geometry,this.material)),i.Object3D.prototype.clone.call(this,e,t),e},i.Bone=function(e){i.Object3D.call(this),this.type="Bone",this.skin=e},i.Bone.prototype=Object.create(i.Object3D.prototype),i.Bone.prototype.constructor=i.Bone,i.Skeleton=function(e,t,r){if(this.useVertexTexture=void 0!==r?r:!0,this.identityMatrix=new i.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture){var n;n=this.bones.length>256?64:this.bones.length>64?32:this.bones.length>16?16:8,this.boneTextureWidth=n,this.boneTextureHeight=n,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new i.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,i.RGBAFormat,i.FloatType),this.boneTexture.minFilter=i.NearestFilter,this.boneTexture.magFilter=i.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{i.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var o=0,a=this.bones.length;a>o;o++)this.boneInverses.push(new i.Matrix4)}},i.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;t>e;e++){var r=new i.Matrix4;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},i.Skeleton.prototype.pose=function(){for(var e,t=0,r=this.bones.length;r>t;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(var t=0,r=this.bones.length;r>t;t++)e=this.bones[t],e&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},i.Skeleton.prototype.update=function(){var e=new i.Matrix4;return function(){for(var t=0,r=this.bones.length;r>t;t++){var n=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(n,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),i.SkinnedMesh=function(e,t,r){i.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new i.Matrix4,this.bindMatrixInverse=new i.Matrix4;var n=[];if(this.geometry&&void 0!==this.geometry.bones){for(var o,a,s,h,l,u=0,c=this.geometry.bones.length;c>u;++u)a=this.geometry.bones[u],s=a.pos,h=a.rotq,l=a.scl,o=new i.Bone(this),n.push(o),o.name=a.name,o.position.set(s[0],s[1],s[2]),o.quaternion.set(h[0],h[1],h[2],h[3]),void 0!==l?o.scale.set(l[0],l[1],l[2]):o.scale.set(1,1,1);for(var u=0,c=this.geometry.bones.length;c>u;++u)a=this.geometry.bones[u],-1!==a.parent?n[a.parent].add(n[u]):this.add(n[u])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new i.Skeleton(n,void 0,r))},i.SkinnedMesh.prototype=Object.create(i.Mesh.prototype),i.SkinnedMesh.prototype.constructor=i.SkinnedMesh,i.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},i.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},i.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof i.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();r!==1/0?t.multiplyScalar(r):t.set(1)}},i.SkinnedMesh.prototype.updateMatrixWorld=function(e){i.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):i.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},i.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new i.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),i.Mesh.prototype.clone.call(this,e),e},i.MorphAnimMesh=function(e,t){i.Mesh.call(this,e,t),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},i.MorphAnimMesh.prototype=Object.create(i.Mesh.prototype),i.MorphAnimMesh.prototype.constructor=i.MorphAnimMesh,i.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},i.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},i.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},i.MorphAnimMesh.prototype.parseAnimations=function(){
var e=this.geometry;e.animations||(e.animations={});for(var t,r=e.animations,n=/([a-z]+)_?(\d+)/,i=0,o=e.morphTargets.length;o>i;i++){var a=e.morphTargets[i],s=a.name.match(n);if(s&&s.length>1){var h=s[1];r[h]||(r[h]={start:1/0,end:-(1/0)});var l=r[h];i<l.start&&(l.start=i),i>l.end&&(l.end=i),t||(t=h)}}e.firstAnimation=t},i.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,r){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:r}},i.MorphAnimMesh.prototype.playAnimation=function(e,t){var r=this.geometry.animations[e];r?(this.setFrameRange(r.start,r.end),this.duration=1e3*((r.end-r.start)/t),this.time=0):i.warn("THREE.MorphAnimMesh: animation["+e+"] undefined in .playAnimation()")},i.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var r=this.startKeyframe+i.Math.clamp(Math.floor(this.time/t),0,this.length-1);r!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[r]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=r);var n=this.time%t/t;this.directionBackwards&&(n=1-n),this.morphTargetInfluences[this.currentKeyframe]=n,this.morphTargetInfluences[this.lastKeyframe]=1-n},i.MorphAnimMesh.prototype.interpolateTargets=function(e,t,r){for(var n=this.morphTargetInfluences,i=0,o=n.length;o>i;i++)n[i]=0;e>-1&&(n[e]=1-r),t>-1&&(n[t]=r)},i.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new i.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,i.Mesh.prototype.clone.call(this,e),e},i.LOD=function(){i.Object3D.call(this),this.objects=[]},i.LOD.prototype=Object.create(i.Object3D.prototype),i.LOD.prototype.constructor=i.LOD,i.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=0;r<this.objects.length&&!(t<this.objects[r].distance);r++);this.objects.splice(r,0,{distance:t,object:e}),this.add(e)},i.LOD.prototype.getObjectForDistance=function(e){for(var t=1,r=this.objects.length;r>t&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},i.LOD.prototype.raycast=function(){var e=new i.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(e);this.getObjectForDistance(n).raycast(t,r)}}(),i.LOD.prototype.update=function(){var e=new i.Vector3,t=new i.Vector3;return function(r){if(this.objects.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);this.objects[0].object.visible=!0;for(var i=1,o=this.objects.length;o>i&&n>=this.objects[i].distance;i++)this.objects[i-1].object.visible=!1,this.objects[i].object.visible=!0;for(;o>i;i++)this.objects[i].object.visible=!1}}}(),i.LOD.prototype.clone=function(e){void 0===e&&(e=new i.LOD),i.Object3D.prototype.clone.call(this,e);for(var t=0,r=this.objects.length;r>t;t++){var n=this.objects[t].object.clone();n.visible=0===t,e.addLevel(n,this.objects[t].distance)}return e},i.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]),t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),r=new Float32Array([0,0,1,0,1,1,0,1]),n=new i.BufferGeometry;return n.addAttribute("index",new i.BufferAttribute(e,1)),n.addAttribute("position",new i.BufferAttribute(t,3)),n.addAttribute("uv",new i.BufferAttribute(r,2)),function(e){i.Object3D.call(this),this.type="Sprite",this.geometry=n,this.material=void 0!==e?e:new i.SpriteMaterial}}(),i.Sprite.prototype=Object.create(i.Object3D.prototype),i.Sprite.prototype.constructor=i.Sprite,i.Sprite.prototype.raycast=function(){var e=new i.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.distanceToPoint(e);n>this.scale.x||r.push({distance:n,point:this.position,face:null,object:this})}}(),i.Sprite.prototype.clone=function(e){return void 0===e&&(e=new i.Sprite(this.material)),i.Object3D.prototype.clone.call(this,e),e},i.Particle=i.Sprite,i.LensFlare=function(e,t,r,n,o){i.Object3D.call(this),this.lensFlares=[],this.positionScreen=new i.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,n,o)},i.LensFlare.prototype=Object.create(i.Object3D.prototype),i.LensFlare.prototype.constructor=i.LensFlare,i.LensFlare.prototype.add=function(e,t,r,n,o,a){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===a&&(a=1),void 0===o&&(o=new i.Color(16777215)),void 0===n&&(n=i.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:a,color:o,blending:n})},i.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,n=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(e=0;r>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+i*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},i.Scene=function(){i.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},i.Scene.prototype=Object.create(i.Object3D.prototype),i.Scene.prototype.constructor=i.Scene,i.Scene.prototype.clone=function(e){return void 0===e&&(e=new i.Scene),i.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},i.Fog=function(e,t,r){this.name="",this.color=new i.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},i.Fog.prototype.clone=function(){return new i.Fog(this.color.getHex(),this.near,this.far)},i.FogExp2=function(e,t){this.name="",this.color=new i.Color(e),this.density=void 0!==t?t:25e-5},i.FogExp2.prototype.clone=function(){return new i.FogExp2(this.color.getHex(),this.density)},i.ShaderChunk={},i.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n	return normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n	return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n	float distance = dot( planeNormal, point-pointOnPlane );\n	return point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n	return sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n	return pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n	if ( decayExponent > 0.0 ) {\n	  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n	}\n	return 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n	return pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n	return a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n	return pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n	return a;\n#endif\n}\n",i.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n	if ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",i.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n	vec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n	#ifdef DOUBLE_SIDED\n\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n		#ifdef WRAP_AROUND\n\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n		#endif\n\n	#endif\n\n	#ifdef WRAP_AROUND\n\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n		#ifdef DOUBLE_SIDED\n\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n		#endif\n\n	#endif\n\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n	#ifdef DOUBLE_SIDED\n\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n	#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n		#ifdef DOUBLE_SIDED\n\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n			#ifdef WRAP_AROUND\n\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n			#endif\n\n		#endif\n\n		#ifdef WRAP_AROUND\n\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n			#ifdef DOUBLE_SIDED\n\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n			#endif\n\n		#endif\n\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			lVector = normalize( lVector );\n\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n			#ifdef DOUBLE_SIDED\n\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n				#ifdef WRAP_AROUND\n\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n				#endif\n\n			#endif\n\n			#ifdef WRAP_AROUND\n\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n				#ifdef DOUBLE_SIDED\n\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n				#endif\n\n			#endif\n\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n		float dotProduct = dot( transformedNormal, lVector );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack += ambientLightColor;\n\n#endif\n",i.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n	uniform vec4 offsetRepeat;\n	uniform sampler2D map;\n\n#endif\n",i.ShaderChunk.default_vertex="#ifdef USE_SKINNING\n\n	vec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n	vec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",i.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",i.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	#ifdef USE_MORPHNORMALS\n\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n	#else\n\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n	#endif\n\n#endif\n",i.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif",i.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n\n#endif",i.ShaderChunk.lights_phong_fragment="#ifndef FLAT_SHADED\n\n	vec3 normal = normalize( vNormal );\n\n	#ifdef DOUBLE_SIDED\n\n		normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n	#endif\n\n#else\n\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n		lVector = normalize( lVector );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n\n		#ifdef WRAP_AROUND\n\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		totalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n				// specular\n\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		totalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n		lVector = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			// diffuse\n\n			float dotProduct = dot( normal, lVector );\n\n			#ifdef WRAP_AROUND\n\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n			#else\n\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n\n			#endif\n\n			totalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n			// specular\n\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			totalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n		// diffuse\n\n		float dotProduct = dot( normal, dirVector );\n\n		#ifdef WRAP_AROUND\n\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		totalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n		// specular\n\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n		/*\n		// fresnel term from skin shader\n		const float F0 = 0.128;\n\n		float base = 1.0 - dot( viewPosition, dirHalfVector );\n		float exponential = pow( base, 5.0 );\n\n		float fresnel = exponential + F0 * ( 1.0 - exponential );\n		*/\n\n		/*\n		// fresnel term from fresnel shader\n		const float mFresnelBias = 0.08;\n		const float mFresnelScale = 0.3;\n		const float mFresnelPower = 5.0;\n\n		float fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n		*/\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		// 		dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		totalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		totalDiffuseLight += hemiColor;\n\n		// specular (sky light)\n\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n		// specular (ground light)\n\n		vec3 lVectorGround = -lVector;\n\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n		float dotProductGround = dot( normal, lVectorGround );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		totalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n	}\n\n#endif\n\n#ifdef METAL\n\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n",i.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif",i.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n	vec3 morphedNormal = vec3( 0.0 );\n\n	morphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n	morphedNormal += normal;\n\n#endif",i.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	uniform float flipEnvMap;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif\n",i.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",i.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n	// Per-Pixel Tangent Space Normal Mapping\n	// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n",i.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n",i.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n\n#endif",i.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif",i.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif",i.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	texelColor.xyz = inputToLinear( texelColor.xyz );\n\n	diffuseColor *= texelColor;\n\n#endif",i.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n	vUv2 = uv2;\n\n#endif",i.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n	diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",i.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n",i.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n	vColor.xyz = inputToLinear( color.xyz );\n\n#endif",i.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n	#ifdef USE_MORPHTARGETS\n\n	vec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n	vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n	#endif\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n",i.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n\n#endif\n",i.ShaderChunk.linear_to_gamma_fragment="\n	outgoingLight = linearToOutput( outgoingLight );\n",i.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif",i.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n",i.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n",i.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// Transforming Normal Vectors with the Inverse Transformation\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n		#ifdef ENVMAP_MODE_REFLECTION\n\n			vec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n		#else\n\n			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		#endif\n\n	#else\n\n		vec3 reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n	#else\n		float flipNormal = 1.0;\n	#endif\n\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#elif defined( ENVMAP_TYPE_EQUIREC )\n		vec2 sampleUV;\n		sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n		vec4 envColor = texture2D( envMap, sampleUV );\n\n	#elif defined( ENVMAP_TYPE_SPHERE )\n		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n	#endif\n\n	envColor.xyz = inputToLinear( envColor.xyz );\n\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_MIX )\n\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_ADD )\n\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n	#endif\n\n#endif\n",i.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif",i.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif",i.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif",i.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif",i.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		float fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n		fogFactor = whiteCompliment( fogFactor );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	outgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",i.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n	// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n	// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n	// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif\n",
i.ShaderChunk.defaultnormal_vertex="#ifdef USE_SKINNING\n\n	vec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n	vec3 objectNormal = morphedNormal;\n\n#else\n\n	vec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",i.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n	varying vec3 vNormal;\n\n#endif\n",i.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",i.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",i.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n	outgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif",i.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",i.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n	diffuseColor.rgb *= vColor;\n\n#endif",i.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n	morphed += position;\n\n#endif",i.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	#ifdef ENVMAP_MODE_REFLECTION\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	#else\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	#endif\n\n#endif\n",i.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	#ifdef SHADOWMAP_CASCADE\n\n		int inFrustumCount = 0;\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n				// don't shadow pixels outside of light frustum\n				// use just first frustum (for cascades)\n				// don't shadow pixels behind far plane of light frustum\n\n		#ifdef SHADOWMAP_CASCADE\n\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n		#else\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		#endif\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			#ifdef SHADOWMAP_CASCADE\n\n				if ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n			#else\n\n				if ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n			#endif\n\n		#endif\n\n	}\n\n	// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n	shadowColor = inputToLinear( shadowColor );\n\n	outgoingLight = outgoingLight * shadowColor;\n\n#endif\n",i.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#elif defined( USE_MORPHTARGETS )\n\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n	#endif\n\n#endif\n",i.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif",i.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n",i.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n\n	#endif\n\n#endif",i.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n	diffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",i.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n",i.UniformsUtils={merge:function(e){for(var t={},r=0;r<e.length;r++){var n=this.clone(e[r]);for(var i in n)t[i]=n[i]}return t},clone:function(e){var t={};for(var r in e){t[r]={};for(var n in e[r]){var o=e[r][n];o instanceof i.Color||o instanceof i.Vector2||o instanceof i.Vector3||o instanceof i.Vector4||o instanceof i.Matrix4||o instanceof i.Texture?t[r][n]=o.clone():o instanceof Array?t[r][n]=o.slice():t[r][n]=o}}return t}},i.UniformsLib={common:{diffuse:{type:"c",value:new i.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new i.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new i.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new i.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new i.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new i.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new i.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},i.ShaderLib={basic:{uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.fog,i.UniformsLib.shadowmap]),vertexShader:[i.ShaderChunk.common,i.ShaderChunk.map_pars_vertex,i.ShaderChunk.lightmap_pars_vertex,i.ShaderChunk.envmap_pars_vertex,i.ShaderChunk.color_pars_vertex,i.ShaderChunk.morphtarget_pars_vertex,i.ShaderChunk.skinning_pars_vertex,i.ShaderChunk.shadowmap_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.map_vertex,i.ShaderChunk.lightmap_vertex,i.ShaderChunk.color_vertex,i.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",i.ShaderChunk.morphnormal_vertex,i.ShaderChunk.skinnormal_vertex,i.ShaderChunk.defaultnormal_vertex,"	#endif",i.ShaderChunk.morphtarget_vertex,i.ShaderChunk.skinning_vertex,i.ShaderChunk.default_vertex,i.ShaderChunk.logdepthbuf_vertex,i.ShaderChunk.worldpos_vertex,i.ShaderChunk.envmap_vertex,i.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",i.ShaderChunk.common,i.ShaderChunk.color_pars_fragment,i.ShaderChunk.map_pars_fragment,i.ShaderChunk.alphamap_pars_fragment,i.ShaderChunk.lightmap_pars_fragment,i.ShaderChunk.envmap_pars_fragment,i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.shadowmap_pars_fragment,i.ShaderChunk.specularmap_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",i.ShaderChunk.logdepthbuf_fragment,i.ShaderChunk.map_fragment,i.ShaderChunk.color_fragment,i.ShaderChunk.alphamap_fragment,i.ShaderChunk.alphatest_fragment,i.ShaderChunk.specularmap_fragment,"	outgoingLight = diffuseColor.rgb;",i.ShaderChunk.lightmap_fragment,i.ShaderChunk.envmap_fragment,i.ShaderChunk.shadowmap_fragment,i.ShaderChunk.linear_to_gamma_fragment,i.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.fog,i.UniformsLib.lights,i.UniformsLib.shadowmap,{emissive:{type:"c",value:new i.Color(0)},wrapRGB:{type:"v3",value:new i.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",i.ShaderChunk.common,i.ShaderChunk.map_pars_vertex,i.ShaderChunk.lightmap_pars_vertex,i.ShaderChunk.envmap_pars_vertex,i.ShaderChunk.lights_lambert_pars_vertex,i.ShaderChunk.color_pars_vertex,i.ShaderChunk.morphtarget_pars_vertex,i.ShaderChunk.skinning_pars_vertex,i.ShaderChunk.shadowmap_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.map_vertex,i.ShaderChunk.lightmap_vertex,i.ShaderChunk.color_vertex,i.ShaderChunk.morphnormal_vertex,i.ShaderChunk.skinbase_vertex,i.ShaderChunk.skinnormal_vertex,i.ShaderChunk.defaultnormal_vertex,i.ShaderChunk.morphtarget_vertex,i.ShaderChunk.skinning_vertex,i.ShaderChunk.default_vertex,i.ShaderChunk.logdepthbuf_vertex,i.ShaderChunk.worldpos_vertex,i.ShaderChunk.envmap_vertex,i.ShaderChunk.lights_lambert_vertex,i.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",i.ShaderChunk.common,i.ShaderChunk.color_pars_fragment,i.ShaderChunk.map_pars_fragment,i.ShaderChunk.alphamap_pars_fragment,i.ShaderChunk.lightmap_pars_fragment,i.ShaderChunk.envmap_pars_fragment,i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.shadowmap_pars_fragment,i.ShaderChunk.specularmap_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",i.ShaderChunk.logdepthbuf_fragment,i.ShaderChunk.map_fragment,i.ShaderChunk.color_fragment,i.ShaderChunk.alphamap_fragment,i.ShaderChunk.alphatest_fragment,i.ShaderChunk.specularmap_fragment,"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			outgoingLight += diffuseColor.rgb * vLightFront + emissive;","		else","			outgoingLight += diffuseColor.rgb * vLightBack + emissive;","	#else","		outgoingLight += diffuseColor.rgb * vLightFront + emissive;","	#endif",i.ShaderChunk.lightmap_fragment,i.ShaderChunk.envmap_fragment,i.ShaderChunk.shadowmap_fragment,i.ShaderChunk.linear_to_gamma_fragment,i.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.bump,i.UniformsLib.normalmap,i.UniformsLib.fog,i.UniformsLib.lights,i.UniformsLib.shadowmap,{emissive:{type:"c",value:new i.Color(0)},specular:{type:"c",value:new i.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new i.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",i.ShaderChunk.common,i.ShaderChunk.map_pars_vertex,i.ShaderChunk.lightmap_pars_vertex,i.ShaderChunk.envmap_pars_vertex,i.ShaderChunk.lights_phong_pars_vertex,i.ShaderChunk.color_pars_vertex,i.ShaderChunk.morphtarget_pars_vertex,i.ShaderChunk.skinning_pars_vertex,i.ShaderChunk.shadowmap_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.map_vertex,i.ShaderChunk.lightmap_vertex,i.ShaderChunk.color_vertex,i.ShaderChunk.morphnormal_vertex,i.ShaderChunk.skinbase_vertex,i.ShaderChunk.skinnormal_vertex,i.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",i.ShaderChunk.morphtarget_vertex,i.ShaderChunk.skinning_vertex,i.ShaderChunk.default_vertex,i.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = -mvPosition.xyz;",i.ShaderChunk.worldpos_vertex,i.ShaderChunk.envmap_vertex,i.ShaderChunk.lights_phong_vertex,i.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",i.ShaderChunk.common,i.ShaderChunk.color_pars_fragment,i.ShaderChunk.map_pars_fragment,i.ShaderChunk.alphamap_pars_fragment,i.ShaderChunk.lightmap_pars_fragment,i.ShaderChunk.envmap_pars_fragment,i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.lights_phong_pars_fragment,i.ShaderChunk.shadowmap_pars_fragment,i.ShaderChunk.bumpmap_pars_fragment,i.ShaderChunk.normalmap_pars_fragment,i.ShaderChunk.specularmap_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",i.ShaderChunk.logdepthbuf_fragment,i.ShaderChunk.map_fragment,i.ShaderChunk.color_fragment,i.ShaderChunk.alphamap_fragment,i.ShaderChunk.alphatest_fragment,i.ShaderChunk.specularmap_fragment,i.ShaderChunk.lights_phong_fragment,i.ShaderChunk.lightmap_fragment,i.ShaderChunk.envmap_fragment,i.ShaderChunk.shadowmap_fragment,i.ShaderChunk.linear_to_gamma_fragment,i.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},particle_basic:{uniforms:i.UniformsUtils.merge([i.UniformsLib.particle,i.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",i.ShaderChunk.common,i.ShaderChunk.color_pars_vertex,i.ShaderChunk.shadowmap_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",i.ShaderChunk.logdepthbuf_vertex,i.ShaderChunk.worldpos_vertex,i.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",i.ShaderChunk.common,i.ShaderChunk.color_pars_fragment,i.ShaderChunk.map_particle_pars_fragment,i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.shadowmap_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( psColor, opacity );",i.ShaderChunk.logdepthbuf_fragment,i.ShaderChunk.map_particle_fragment,i.ShaderChunk.color_fragment,i.ShaderChunk.alphatest_fragment,"	outgoingLight = diffuseColor.rgb;",i.ShaderChunk.shadowmap_fragment,i.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",i.ShaderChunk.common,i.ShaderChunk.color_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",i.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",i.ShaderChunk.common,i.ShaderChunk.color_pars_fragment,i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",i.ShaderChunk.logdepthbuf_fragment,i.ShaderChunk.color_fragment,"	outgoingLight = diffuseColor.rgb;",i.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[i.ShaderChunk.common,i.ShaderChunk.morphtarget_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.morphtarget_vertex,i.ShaderChunk.default_vertex,i.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",i.ShaderChunk.common,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",i.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",i.ShaderChunk.common,i.ShaderChunk.morphtarget_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vNormal = normalize( normalMatrix * normal );",i.ShaderChunk.morphtarget_vertex,i.ShaderChunk.default_vertex,i.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",i.ShaderChunk.common,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",i.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",i.ShaderChunk.common,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",i.ShaderChunk.common,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",i.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",i.ShaderChunk.common,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",i.ShaderChunk.common,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",i.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[i.ShaderChunk.common,i.ShaderChunk.morphtarget_pars_vertex,i.ShaderChunk.skinning_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.skinbase_vertex,i.ShaderChunk.morphtarget_vertex,i.ShaderChunk.skinning_vertex,i.ShaderChunk.default_vertex,i.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[i.ShaderChunk.common,i.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",i.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")}},i.WebGLRenderer=function(e){function t(e){e.__webglVertexBuffer=Pe.createBuffer(),e.__webglColorBuffer=Pe.createBuffer(),Be.info.memory.geometries++}function r(e){e.__webglVertexBuffer=Pe.createBuffer(),e.__webglColorBuffer=Pe.createBuffer(),e.__webglLineDistanceBuffer=Pe.createBuffer(),Be.info.memory.geometries++}function n(e){e.__webglVertexBuffer=Pe.createBuffer(),e.__webglNormalBuffer=Pe.createBuffer(),e.__webglTangentBuffer=Pe.createBuffer(),e.__webglColorBuffer=Pe.createBuffer(),e.__webglUVBuffer=Pe.createBuffer(),e.__webglUV2Buffer=Pe.createBuffer(),e.__webglSkinIndicesBuffer=Pe.createBuffer(),e.__webglSkinWeightsBuffer=Pe.createBuffer(),e.__webglFaceBuffer=Pe.createBuffer(),e.__webglLineBuffer=Pe.createBuffer();var t=e.numMorphTargets;if(t){e.__webglMorphTargetsBuffers=[];for(var r=0,n=t;n>r;r++)e.__webglMorphTargetsBuffers.push(Pe.createBuffer())}var i=e.numMorphNormals;if(i){e.__webglMorphNormalsBuffers=[];for(var r=0,n=i;n>r;r++)e.__webglMorphNormalsBuffers.push(Pe.createBuffer())}Be.info.memory.geometries++}function o(e){var t=e.geometry,r=e.material,n=t.vertices.length;if(r.attributes){void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]);for(var i in r.attributes){var o=r.attributes[i];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(n*a),o.buffer=Pe.createBuffer(),o.buffer.belongsToAttribute=i,o.needsUpdate=!0}t.__webglCustomAttributesList.push(o)}}}function a(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__webglParticleCount=r,o(t)}function s(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__lineDistanceArray=new Float32Array(1*r),e.__webglLineCount=r,o(t)}function h(e,t){var r=t.geometry,n=e.faces3,i=3*n.length,o=1*n.length,a=3*n.length,s=l(t,e);e.__vertexArray=new Float32Array(3*i),e.__normalArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__uvArray=new Float32Array(2*i),r.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*i)),r.hasTangents&&(e.__tangentArray=new Float32Array(4*i)),
t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*i),e.__skinWeightArray=new Float32Array(4*i));var h=null!==tt.get("OES_element_index_uint")&&o>21845?Uint32Array:Uint16Array;e.__typeArray=h,e.__faceArray=new h(3*o),e.__lineArray=new h(2*a);var u=e.numMorphTargets;if(u){e.__morphTargetsArrays=[];for(var c=0,p=u;p>c;c++)e.__morphTargetsArrays.push(new Float32Array(3*i))}var f=e.numMorphNormals;if(f){e.__morphNormalsArrays=[];for(var c=0,p=f;p>c;c++)e.__morphNormalsArrays.push(new Float32Array(3*i))}if(e.__webglFaceCount=3*o,e.__webglLineCount=2*a,s.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var d in s.attributes){var m=s.attributes[d],v={};for(var g in m)v[g]=m[g];if(!v.__webglInitialized||v.createUniqueBuffers){v.__webglInitialized=!0;var y=1;"v2"===v.type?y=2:"v3"===v.type?y=3:"v4"===v.type?y=4:"c"===v.type&&(y=3),v.size=y,v.array=new Float32Array(i*y),v.buffer=Pe.createBuffer(),v.buffer.belongsToAttribute=d,m.needsUpdate=!0,v.__original=m}e.__webglCustomAttributesList.push(v)}}e.__inittedArrays=!0}function l(e,t){return e.material instanceof i.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function u(e){return e instanceof i.MeshPhongMaterial==!1&&e.shading===i.FlatShading}function c(e,t,r){var n,i,o,a,s,h,l,u,c,p,f,d=e.vertices,m=d.length,v=e.colors,g=v.length,y=e.__vertexArray,x=e.__colorArray,w=e.verticesNeedUpdate,b=e.colorsNeedUpdate,_=e.__webglCustomAttributesList;if(w){for(n=0;m>n;n++)o=d[n],a=3*n,y[a]=o.x,y[a+1]=o.y,y[a+2]=o.z;Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglVertexBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,y,t)}if(b){for(i=0;g>i;i++)s=v[i],a=3*i,x[a]=s.r,x[a+1]=s.g,x[a+2]=s.b;Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglColorBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,x,t)}if(_)for(h=0,l=_.length;l>h;h++){if(f=_[h],f.needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo))if(c=f.value.length,a=0,1===f.size)for(u=0;c>u;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;c>u;u++)p=f.value[u],f.array[a]=p.x,f.array[a+1]=p.y,a+=2;else if(3===f.size)if("c"===f.type)for(u=0;c>u;u++)p=f.value[u],f.array[a]=p.r,f.array[a+1]=p.g,f.array[a+2]=p.b,a+=3;else for(u=0;c>u;u++)p=f.value[u],f.array[a]=p.x,f.array[a+1]=p.y,f.array[a+2]=p.z,a+=3;else if(4===f.size)for(u=0;c>u;u++)p=f.value[u],f.array[a]=p.x,f.array[a+1]=p.y,f.array[a+2]=p.z,f.array[a+3]=p.w,a+=4;Pe.bindBuffer(Pe.ARRAY_BUFFER,f.buffer),Pe.bufferData(Pe.ARRAY_BUFFER,f.array,t),f.needsUpdate=!1}}function p(e,t){var r,n,i,o,a,s,h,l,u,c,p,f,d=e.vertices,m=e.colors,v=e.lineDistances,g=d.length,y=m.length,x=v.length,w=e.__vertexArray,b=e.__colorArray,_=e.__lineDistanceArray,S=e.verticesNeedUpdate,M=e.colorsNeedUpdate,E=e.lineDistancesNeedUpdate,T=e.__webglCustomAttributesList;if(S){for(r=0;g>r;r++)o=d[r],a=3*r,w[a]=o.x,w[a+1]=o.y,w[a+2]=o.z;Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglVertexBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,w,t)}if(M){for(n=0;y>n;n++)s=m[n],a=3*n,b[a]=s.r,b[a+1]=s.g,b[a+2]=s.b;Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglColorBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,b,t)}if(E){for(i=0;x>i;i++)_[i]=v[i];Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglLineDistanceBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,_,t)}if(T)for(h=0,l=T.length;l>h;h++)if(f=T[h],f.needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(a=0,c=f.value.length,1===f.size)for(u=0;c>u;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;c>u;u++)p=f.value[u],f.array[a]=p.x,f.array[a+1]=p.y,a+=2;else if(3===f.size)if("c"===f.type)for(u=0;c>u;u++)p=f.value[u],f.array[a]=p.r,f.array[a+1]=p.g,f.array[a+2]=p.b,a+=3;else for(u=0;c>u;u++)p=f.value[u],f.array[a]=p.x,f.array[a+1]=p.y,f.array[a+2]=p.z,a+=3;else if(4===f.size)for(u=0;c>u;u++)p=f.value[u],f.array[a]=p.x,f.array[a+1]=p.y,f.array[a+2]=p.z,f.array[a+3]=p.w,a+=4;Pe.bindBuffer(Pe.ARRAY_BUFFER,f.buffer),Pe.bufferData(Pe.ARRAY_BUFFER,f.array,t),f.needsUpdate=!1}}function f(e,t,r,n,o){if(e.__inittedArrays){var a,s,h,l,c,p,f,d,m,v,g,y,x,w,b,_,S,M,E,T,C,A,L,R,P,B,F,k,D,U,z,V,I,N,O,j,W,H,G,q,X,Y,K=u(o),Q=0,Z=0,J=0,$=0,ee=0,te=0,re=0,ne=0,ie=0,oe=0,ae=0,se=0,he=e.__vertexArray,le=e.__uvArray,ue=e.__uv2Array,ce=e.__normalArray,pe=e.__tangentArray,fe=e.__colorArray,de=e.__skinIndexArray,me=e.__skinWeightArray,ve=e.__morphTargetsArrays,ge=e.__morphNormalsArrays,ye=e.__webglCustomAttributesList,xe=e.__faceArray,we=e.__lineArray,be=t.geometry,_e=be.verticesNeedUpdate,Se=be.elementsNeedUpdate,Me=be.uvsNeedUpdate,Ee=be.normalsNeedUpdate,Te=be.tangentsNeedUpdate,Ce=be.colorsNeedUpdate,Ae=be.morphTargetsNeedUpdate,Le=be.vertices,Re=e.faces3,Be=be.faces,Fe=be.faceVertexUvs[0],ke=be.faceVertexUvs[1],De=be.skinIndices,Ue=be.skinWeights,ze=be.morphTargets,Ve=be.morphNormals;if(_e){for(a=0,s=Re.length;s>a;a++)l=Be[Re[a]],y=Le[l.a],x=Le[l.b],w=Le[l.c],he[Z]=y.x,he[Z+1]=y.y,he[Z+2]=y.z,he[Z+3]=x.x,he[Z+4]=x.y,he[Z+5]=x.z,he[Z+6]=w.x,he[Z+7]=w.y,he[Z+8]=w.z,Z+=9;Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglVertexBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,he,r)}if(Ae)for(O=0,j=ze.length;j>O;O++){for(ae=0,a=0,s=Re.length;s>a;a++)G=Re[a],l=Be[G],y=ze[O].vertices[l.a],x=ze[O].vertices[l.b],w=ze[O].vertices[l.c],W=ve[O],W[ae]=y.x,W[ae+1]=y.y,W[ae+2]=y.z,W[ae+3]=x.x,W[ae+4]=x.y,W[ae+5]=x.z,W[ae+6]=w.x,W[ae+7]=w.y,W[ae+8]=w.z,o.morphNormals&&(K?(M=Ve[O].faceNormals[G],E=M,T=M):(q=Ve[O].vertexNormals[G],M=q.a,E=q.b,T=q.c),H=ge[O],H[ae]=M.x,H[ae+1]=M.y,H[ae+2]=M.z,H[ae+3]=E.x,H[ae+4]=E.y,H[ae+5]=E.z,H[ae+6]=T.x,H[ae+7]=T.y,H[ae+8]=T.z),ae+=9;Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[O]),Pe.bufferData(Pe.ARRAY_BUFFER,ve[O],r),o.morphNormals&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[O]),Pe.bufferData(Pe.ARRAY_BUFFER,ge[O],r))}if(Ue.length){for(a=0,s=Re.length;s>a;a++)l=Be[Re[a]],R=Ue[l.a],P=Ue[l.b],B=Ue[l.c],me[oe]=R.x,me[oe+1]=R.y,me[oe+2]=R.z,me[oe+3]=R.w,me[oe+4]=P.x,me[oe+5]=P.y,me[oe+6]=P.z,me[oe+7]=P.w,me[oe+8]=B.x,me[oe+9]=B.y,me[oe+10]=B.z,me[oe+11]=B.w,F=De[l.a],k=De[l.b],D=De[l.c],de[oe]=F.x,de[oe+1]=F.y,de[oe+2]=F.z,de[oe+3]=F.w,de[oe+4]=k.x,de[oe+5]=k.y,de[oe+6]=k.z,de[oe+7]=k.w,de[oe+8]=D.x,de[oe+9]=D.y,de[oe+10]=D.z,de[oe+11]=D.w,oe+=12;oe>0&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,de,r),Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,me,r))}if(Ce){for(a=0,s=Re.length;s>a;a++)l=Be[Re[a]],f=l.vertexColors,d=l.color,3===f.length&&o.vertexColors===i.VertexColors?(C=f[0],A=f[1],L=f[2]):(C=d,A=d,L=d),fe[ie]=C.r,fe[ie+1]=C.g,fe[ie+2]=C.b,fe[ie+3]=A.r,fe[ie+4]=A.g,fe[ie+5]=A.b,fe[ie+6]=L.r,fe[ie+7]=L.g,fe[ie+8]=L.b,ie+=9;ie>0&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglColorBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,fe,r))}if(Te&&be.hasTangents){for(a=0,s=Re.length;s>a;a++)l=Be[Re[a]],m=l.vertexTangents,b=m[0],_=m[1],S=m[2],pe[re]=b.x,pe[re+1]=b.y,pe[re+2]=b.z,pe[re+3]=b.w,pe[re+4]=_.x,pe[re+5]=_.y,pe[re+6]=_.z,pe[re+7]=_.w,pe[re+8]=S.x,pe[re+9]=S.y,pe[re+10]=S.z,pe[re+11]=S.w,re+=12;Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglTangentBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,pe,r)}if(Ee){for(a=0,s=Re.length;s>a;a++)if(l=Be[Re[a]],c=l.vertexNormals,p=l.normal,3===c.length&&K===!1)for(U=0;3>U;U++)V=c[U],ce[te]=V.x,ce[te+1]=V.y,ce[te+2]=V.z,te+=3;else for(U=0;3>U;U++)ce[te]=p.x,ce[te+1]=p.y,ce[te+2]=p.z,te+=3;Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglNormalBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,ce,r)}if(Me&&Fe){for(a=0,s=Re.length;s>a;a++)if(h=Re[a],v=Fe[h],void 0!==v)for(U=0;3>U;U++)I=v[U],le[J]=I.x,le[J+1]=I.y,J+=2;J>0&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglUVBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,le,r))}if(Me&&ke){for(a=0,s=Re.length;s>a;a++)if(h=Re[a],g=ke[h],void 0!==g)for(U=0;3>U;U++)N=g[U],ue[$]=N.x,ue[$+1]=N.y,$+=2;$>0&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglUV2Buffer),Pe.bufferData(Pe.ARRAY_BUFFER,ue,r))}if(Se){for(a=0,s=Re.length;s>a;a++)xe[ee]=Q,xe[ee+1]=Q+1,xe[ee+2]=Q+2,ee+=3,we[ne]=Q,we[ne+1]=Q+1,we[ne+2]=Q,we[ne+3]=Q+2,we[ne+4]=Q+1,we[ne+5]=Q+2,ne+=6,Q+=3;Pe.bindBuffer(Pe.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Pe.bufferData(Pe.ELEMENT_ARRAY_BUFFER,xe,r),Pe.bindBuffer(Pe.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Pe.bufferData(Pe.ELEMENT_ARRAY_BUFFER,we,r)}if(ye)for(U=0,z=ye.length;z>U;U++)if(Y=ye[U],Y.__original.needsUpdate){if(se=0,1===Y.size){if(void 0===Y.boundTo||"vertices"===Y.boundTo)for(a=0,s=Re.length;s>a;a++)l=Be[Re[a]],Y.array[se]=Y.value[l.a],Y.array[se+1]=Y.value[l.b],Y.array[se+2]=Y.value[l.c],se+=3;else if("faces"===Y.boundTo)for(a=0,s=Re.length;s>a;a++)X=Y.value[Re[a]],Y.array[se]=X,Y.array[se+1]=X,Y.array[se+2]=X,se+=3}else if(2===Y.size){if(void 0===Y.boundTo||"vertices"===Y.boundTo)for(a=0,s=Re.length;s>a;a++)l=Be[Re[a]],y=Y.value[l.a],x=Y.value[l.b],w=Y.value[l.c],Y.array[se]=y.x,Y.array[se+1]=y.y,Y.array[se+2]=x.x,Y.array[se+3]=x.y,Y.array[se+4]=w.x,Y.array[se+5]=w.y,se+=6;else if("faces"===Y.boundTo)for(a=0,s=Re.length;s>a;a++)X=Y.value[Re[a]],y=X,x=X,w=X,Y.array[se]=y.x,Y.array[se+1]=y.y,Y.array[se+2]=x.x,Y.array[se+3]=x.y,Y.array[se+4]=w.x,Y.array[se+5]=w.y,se+=6}else if(3===Y.size){var Ie;if(Ie="c"===Y.type?["r","g","b"]:["x","y","z"],void 0===Y.boundTo||"vertices"===Y.boundTo)for(a=0,s=Re.length;s>a;a++)l=Be[Re[a]],y=Y.value[l.a],x=Y.value[l.b],w=Y.value[l.c],Y.array[se]=y[Ie[0]],Y.array[se+1]=y[Ie[1]],Y.array[se+2]=y[Ie[2]],Y.array[se+3]=x[Ie[0]],Y.array[se+4]=x[Ie[1]],Y.array[se+5]=x[Ie[2]],Y.array[se+6]=w[Ie[0]],Y.array[se+7]=w[Ie[1]],Y.array[se+8]=w[Ie[2]],se+=9;else if("faces"===Y.boundTo)for(a=0,s=Re.length;s>a;a++)X=Y.value[Re[a]],y=X,x=X,w=X,Y.array[se]=y[Ie[0]],Y.array[se+1]=y[Ie[1]],Y.array[se+2]=y[Ie[2]],Y.array[se+3]=x[Ie[0]],Y.array[se+4]=x[Ie[1]],Y.array[se+5]=x[Ie[2]],Y.array[se+6]=w[Ie[0]],Y.array[se+7]=w[Ie[1]],Y.array[se+8]=w[Ie[2]],se+=9;else if("faceVertices"===Y.boundTo)for(a=0,s=Re.length;s>a;a++)X=Y.value[Re[a]],y=X[0],x=X[1],w=X[2],Y.array[se]=y[Ie[0]],Y.array[se+1]=y[Ie[1]],Y.array[se+2]=y[Ie[2]],Y.array[se+3]=x[Ie[0]],Y.array[se+4]=x[Ie[1]],Y.array[se+5]=x[Ie[2]],Y.array[se+6]=w[Ie[0]],Y.array[se+7]=w[Ie[1]],Y.array[se+8]=w[Ie[2]],se+=9}else if(4===Y.size)if(void 0===Y.boundTo||"vertices"===Y.boundTo)for(a=0,s=Re.length;s>a;a++)l=Be[Re[a]],y=Y.value[l.a],x=Y.value[l.b],w=Y.value[l.c],Y.array[se]=y.x,Y.array[se+1]=y.y,Y.array[se+2]=y.z,Y.array[se+3]=y.w,Y.array[se+4]=x.x,Y.array[se+5]=x.y,Y.array[se+6]=x.z,Y.array[se+7]=x.w,Y.array[se+8]=w.x,Y.array[se+9]=w.y,Y.array[se+10]=w.z,Y.array[se+11]=w.w,se+=12;else if("faces"===Y.boundTo)for(a=0,s=Re.length;s>a;a++)X=Y.value[Re[a]],y=X,x=X,w=X,Y.array[se]=y.x,Y.array[se+1]=y.y,Y.array[se+2]=y.z,Y.array[se+3]=y.w,Y.array[se+4]=x.x,Y.array[se+5]=x.y,Y.array[se+6]=x.z,Y.array[se+7]=x.w,Y.array[se+8]=w.x,Y.array[se+9]=w.y,Y.array[se+10]=w.z,Y.array[se+11]=w.w,se+=12;else if("faceVertices"===Y.boundTo)for(a=0,s=Re.length;s>a;a++)X=Y.value[Re[a]],y=X[0],x=X[1],w=X[2],Y.array[se]=y.x,Y.array[se+1]=y.y,Y.array[se+2]=y.z,Y.array[se+3]=y.w,Y.array[se+4]=x.x,Y.array[se+5]=x.y,Y.array[se+6]=x.z,Y.array[se+7]=x.w,Y.array[se+8]=w.x,Y.array[se+9]=w.y,Y.array[se+10]=w.z,Y.array[se+11]=w.w,se+=12;Pe.bindBuffer(Pe.ARRAY_BUFFER,Y.buffer),Pe.bufferData(Pe.ARRAY_BUFFER,Y.array,r)}n&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function d(e,t,r,n){for(var i=r.attributes,o=t.attributes,a=t.attributesKeys,s=0,h=a.length;h>s;s++){var l=a[s],u=o[l];if(u>=0){var c=i[l];if(void 0!==c){var p=c.itemSize;Pe.bindBuffer(Pe.ARRAY_BUFFER,c.buffer),et.enableAttribute(u),Pe.vertexAttribPointer(u,p,Pe.FLOAT,!1,0,n*p*4)}else void 0!==e.defaultAttributeValues&&(2===e.defaultAttributeValues[l].length?Pe.vertexAttrib2fv(u,e.defaultAttributeValues[l]):3===e.defaultAttributeValues[l].length&&Pe.vertexAttrib3fv(u,e.defaultAttributeValues[l]))}}et.disableUnusedAttributes()}function m(e,t,r){var n=e.program.attributes;if(-1!==r.morphTargetBase&&n.position>=0?(Pe.bindBuffer(Pe.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[r.morphTargetBase]),et.enableAttribute(n.position),Pe.vertexAttribPointer(n.position,3,Pe.FLOAT,!1,0,0)):n.position>=0&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,t.__webglVertexBuffer),et.enableAttribute(n.position),Pe.vertexAttribPointer(n.position,3,Pe.FLOAT,!1,0,0)),r.morphTargetForcedOrder.length)for(var i,o=0,a=r.morphTargetForcedOrder,s=r.morphTargetInfluences;o<e.numSupportedMorphTargets&&o<a.length;)i=n["morphTarget"+o],i>=0&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[a[o]]),et.enableAttribute(i),Pe.vertexAttribPointer(i,3,Pe.FLOAT,!1,0,0)),i=n["morphNormal"+o],i>=0&&e.morphNormals&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[a[o]]),et.enableAttribute(i),Pe.vertexAttribPointer(i,3,Pe.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[o]=s[a[o]],o++;else{var h=[],s=r.morphTargetInfluences,l=r.geometry.morphTargets;s.length>l.length&&(console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array."),s.length=l.length);for(var u=0,c=s.length;c>u;u++){var p=s[u];h.push([p,u])}h.length>e.numSupportedMorphTargets?(h.sort(y),h.length=e.numSupportedMorphTargets):h.length>e.numSupportedMorphNormals?h.sort(y):0===h.length&&h.push([0,0]);for(var i,o=0,f=e.numSupportedMorphTargets;f>o;o++)if(h[o]){var d=h[o][1];i=n["morphTarget"+o],i>=0&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[d]),et.enableAttribute(i),Pe.vertexAttribPointer(i,3,Pe.FLOAT,!1,0,0)),i=n["morphNormal"+o],i>=0&&e.morphNormals&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[d]),et.enableAttribute(i),Pe.vertexAttribPointer(i,3,Pe.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[o]=s[d]}else r.__webglMorphTargetInfluences[o]=0}null!==e.program.uniforms.morphTargetInfluences&&Pe.uniform1fv(e.program.uniforms.morphTargetInfluences,r.__webglMorphTargetInfluences)}function v(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function g(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function y(e,t){return t[0]-e[0]}function x(e){if(e.visible!==!1){if(e instanceof i.Scene||e instanceof i.Group);else if(M(e),e instanceof i.Light)Me.push(e);else if(e instanceof i.Sprite)Le.push(e);else if(e instanceof i.LensFlare)Re.push(e);else{var t=Ee[e.id];if(t&&(e.frustumCulled===!1||qe.intersectsObject(e)===!0))for(var r=0,n=t.length;n>r;r++){var o=t[r];S(o),o.render=!0,Be.sortObjects===!0&&(Ye.setFromMatrixPosition(e.matrixWorld),Ye.applyProjection(Xe),o.z=Ye.z)}}for(var r=0,n=e.children.length;n>r;r++)x(e.children[r])}}function w(e,t,r,n,o){for(var a,s=0,h=e.length;h>s;s++){var l=e[s],u=l.object,c=l.buffer;if(Q(u,t),o)a=o;else{if(a=l.material,!a)continue;D(a)}Be.setMaterialFaces(a),c instanceof i.BufferGeometry?Be.renderBufferDirect(t,r,n,a,c,u):Be.renderBuffer(t,r,n,a,c,u)}}function b(e,t,r,n,i,o){for(var a,s=0,h=e.length;h>s;s++){var l=e[s],u=l.object;if(u.visible){if(o)a=o;else{if(a=l[t],!a)continue;D(a)}Be.renderImmediateObject(r,n,i,a,u)}}}function _(e){var t=e.object,r=t.material;r.transparent?(e.transparent=r,e.opaque=null):(e.opaque=r,e.transparent=null)}function S(e){var t=e.object,r=e.buffer,n=t.geometry,o=t.material;if(o instanceof i.MeshFaceMaterial){var a=n instanceof i.BufferGeometry?0:r.materialIndex;o=o.materials[a],e.material=o,o.transparent?Ae.push(e):Ce.push(e)}else o&&(e.material=o,o.transparent?Ae.push(e):Ce.push(e))}function M(e){void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new i.Matrix4,e._normalMatrix=new i.Matrix3,e.addEventListener("removed",bt));var n=e.geometry;if(void 0===n||void 0===n.__webglInit&&(n.__webglInit=!0,n.addEventListener("dispose",_t),n instanceof i.BufferGeometry?Be.info.memory.geometries++:e instanceof i.Mesh?T(e,n):e instanceof i.Line?void 0===n.__webglVertexBuffer&&(r(n),s(n,e),n.verticesNeedUpdate=!0,n.colorsNeedUpdate=!0,n.lineDistancesNeedUpdate=!0):e instanceof i.PointCloud&&void 0===n.__webglVertexBuffer&&(t(n),a(n,e),n.verticesNeedUpdate=!0,n.colorsNeedUpdate=!0)),void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof i.Mesh){if(n instanceof i.BufferGeometry)C(Ee,n,e);else if(n instanceof i.Geometry)for(var o=Pt[n.id],h=0,l=o.length;l>h;h++)C(Ee,o[h],e)}else e instanceof i.Line||e instanceof i.PointCloud?C(Ee,n,e):(e instanceof i.ImmediateRenderObject||e.immediateRenderCallback)&&A(Te,e)}function E(e,t){for(var r,n,i=tt.get("OES_element_index_uint")?4294967296:65535,o={},a=e.morphTargets.length,s=e.morphNormals.length,h={},l=[],u=0,c=e.faces.length;c>u;u++){var p=e.faces[u],f=t?p.materialIndex:0;f in o||(o[f]={hash:f,counter:0}),r=o[f].hash+"_"+o[f].counter,r in h||(n={id:Bt++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:a,numMorphNormals:s},h[r]=n,l.push(n)),h[r].vertices+3>i&&(o[f].counter+=1,r=o[f].hash+"_"+o[f].counter,r in h||(n={id:Bt++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:a,numMorphNormals:s},h[r]=n,l.push(n))),h[r].faces3.push(u),h[r].vertices+=3}return l}function T(e,t){var r=e.material,o=!1;(void 0===Pt[t.id]||t.groupsNeedUpdate===!0)&&(delete Ee[e.id],Pt[t.id]=E(t,r instanceof i.MeshFaceMaterial),t.groupsNeedUpdate=!1);for(var a=Pt[t.id],s=0,l=a.length;l>s;s++){var u=a[s];void 0===u.__webglVertexBuffer?(n(u),h(u,e),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0,o=!0):o=!1,(o||void 0===e.__webglActive)&&C(Ee,u,e)}e.__webglActive=!0}function C(e,t,r){var n=r.id;e[n]=e[n]||[],e[n].push({id:n,buffer:t,object:r,material:null,z:0})}function A(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function L(e){var t=e.geometry;if(t instanceof i.BufferGeometry)for(var r=t.attributes,n=t.attributesKeys,o=0,a=n.length;a>o;o++){var s=n[o],h=r[s],u="index"===s?Pe.ELEMENT_ARRAY_BUFFER:Pe.ARRAY_BUFFER;void 0===h.buffer?(h.buffer=Pe.createBuffer(),Pe.bindBuffer(u,h.buffer),Pe.bufferData(u,h.array,h instanceof i.DynamicBufferAttribute?Pe.DYNAMIC_DRAW:Pe.STATIC_DRAW),h.needsUpdate=!1):h.needsUpdate===!0&&(Pe.bindBuffer(u,h.buffer),void 0===h.updateRange||-1===h.updateRange.count?Pe.bufferSubData(u,0,h.array):0===h.updateRange.count?console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually."):(Pe.bufferSubData(u,h.updateRange.offset*h.array.BYTES_PER_ELEMENT,h.array.subarray(h.updateRange.offset,h.updateRange.offset+h.updateRange.count)),h.updateRange.count=0),h.needsUpdate=!1)}else if(e instanceof i.Mesh){t.groupsNeedUpdate===!0&&T(e,t);for(var d=Pt[t.id],o=0,m=d.length;m>o;o++){var v=d[o],g=l(e,v),y=g.attributes&&R(g);(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||y)&&f(v,e,Pe.DYNAMIC_DRAW,!t.dynamic,g)}t.verticesNeedUpdate=!1,t.morphTargetsNeedUpdate=!1,t.elementsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.tangentsNeedUpdate=!1,g.attributes&&P(g)}else if(e instanceof i.Line){var g=l(e,t),y=g.attributes&&R(g);(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||y)&&p(t,Pe.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,t.lineDistancesNeedUpdate=!1,g.attributes&&P(g)}else if(e instanceof i.PointCloud){var g=l(e,t),y=g.attributes&&R(g);(t.verticesNeedUpdate||t.colorsNeedUpdate||y)&&c(t,Pe.DYNAMIC_DRAW,e),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,g.attributes&&P(g)}}function R(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function P(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function B(e){e instanceof i.Mesh||e instanceof i.PointCloud||e instanceof i.Line?delete Ee[e.id]:(e instanceof i.ImmediateRenderObject||e.immediateRenderCallback)&&F(Te,e),delete e.__webglInit,delete e._modelViewMatrix,delete e._normalMatrix,delete e.__webglActive}function F(e,t){for(var r=e.length-1;r>=0;r--)e[r].object===t&&e.splice(r,1)}function k(e,t,r,n){e.addEventListener("dispose",Et);var o=Ft[e.type];if(o){var a=i.ShaderLib[o];e.__webglShader={uniforms:i.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};var s=le(t),h=ue(t),l=he(n),u={precision:de,supportsVertexTextures:lt,map:!!e.map,envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:r,useFog:e.fog,fogExp:r instanceof i.FogExp2,flatShading:e.shading===i.FlatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:be,skinning:e.skinning,maxBones:l,useVertexTexture:ut&&n&&n.skeleton&&n.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:Be.maxMorphTargets,maxMorphNormals:Be.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:h,shadowMapEnabled:Be.shadowMapEnabled&&n.receiveShadow&&h>0,shadowMapType:Be.shadowMapType,shadowMapDebug:Be.shadowMapDebug,shadowMapCascade:Be.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===i.DoubleSide,flipSided:e.side===i.BackSide},c=[];if(o?c.push(o):(c.push(e.fragmentShader),c.push(e.vertexShader)),void 0!==e.defines)for(var p in e.defines)c.push(p),c.push(e.defines[p]);for(var p in u)c.push(p),c.push(u[p]);for(var f,d=c.join(),m=0,v=Fe.length;v>m;m++){var g=Fe[m];if(g.code===d){f=g,f.usedTimes++;break}}void 0===f&&(f=new i.WebGLProgram(Be,d,e,u),Fe.push(f),Be.info.memory.programs=Fe.length),e.program=f;var y=f.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;for(var x,w="morphTarget",b=0;b<Be.maxMorphTargets;b++)x=w+b,y[x]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var x,w="morphNormal";for(b=0;b<Be.maxMorphNormals;b++)x=w+b,y[x]>=0&&e.numSupportedMorphNormals++}e.uniformsList=[];for(var _ in e.__webglShader.uniforms){var S=e.program.uniforms[_];S&&e.uniformsList.push([e.__webglShader.uniforms[_],S])}}function D(e){e.transparent===!0?et.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):et.setBlending(i.NoBlending),et.setDepthTest(e.depthTest),et.setDepthWrite(e.depthWrite),et.setColorWrite(e.colorWrite),et.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function U(e,t,r,n,o){Ie=0,n.needsUpdate&&(n.program&&Rt(n),k(n,t,r,o),n.needsUpdate=!1),n.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(Be.maxMorphTargets)));var a=!1,s=!1,h=!1,l=n.program,u=l.uniforms,c=n.__webglShader.uniforms;if(l.id!==ke&&(Pe.useProgram(l.program),ke=l.id,a=!0,s=!0,h=!0),n.id!==Ue&&(-1===Ue&&(h=!0),Ue=n.id,s=!0),(a||e!==Ve)&&(Pe.uniformMatrix4fv(u.projectionMatrix,!1,e.projectionMatrix.elements),be&&Pe.uniform1f(u.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==Ve&&(Ve=e),(n instanceof i.ShaderMaterial||n instanceof i.MeshPhongMaterial||n.envMap)&&null!==u.cameraPosition&&(Ye.setFromMatrixPosition(e.matrixWorld),Pe.uniform3f(u.cameraPosition,Ye.x,Ye.y,Ye.z)),(n instanceof i.MeshPhongMaterial||n instanceof i.MeshLambertMaterial||n instanceof i.MeshBasicMaterial||n instanceof i.ShaderMaterial||n.skinning)&&null!==u.viewMatrix&&Pe.uniformMatrix4fv(u.viewMatrix,!1,e.matrixWorldInverse.elements)),n.skinning)if(o.bindMatrix&&null!==u.bindMatrix&&Pe.uniformMatrix4fv(u.bindMatrix,!1,o.bindMatrix.elements),o.bindMatrixInverse&&null!==u.bindMatrixInverse&&Pe.uniformMatrix4fv(u.bindMatrixInverse,!1,o.bindMatrixInverse.elements),ut&&o.skeleton&&o.skeleton.useVertexTexture){if(null!==u.boneTexture){var p=Y();Pe.uniform1i(u.boneTexture,p),Be.setTexture(o.skeleton.boneTexture,p)}null!==u.boneTextureWidth&&Pe.uniform1i(u.boneTextureWidth,o.skeleton.boneTextureWidth),null!==u.boneTextureHeight&&Pe.uniform1i(u.boneTextureHeight,o.skeleton.boneTextureHeight)}else o.skeleton&&o.skeleton.boneMatrices&&null!==u.boneGlobalMatrices&&Pe.uniformMatrix4fv(u.boneGlobalMatrices,!1,o.skeleton.boneMatrices);return s&&(r&&n.fog&&O(c,r),(n instanceof i.MeshPhongMaterial||n instanceof i.MeshLambertMaterial||n.lights)&&(Qe&&(h=!0,J(t),Qe=!1),h?(H(c,Ze),G(c,!0)):G(c,!1)),(n instanceof i.MeshBasicMaterial||n instanceof i.MeshLambertMaterial||n instanceof i.MeshPhongMaterial)&&z(c,n),n instanceof i.LineBasicMaterial?V(c,n):n instanceof i.LineDashedMaterial?(V(c,n),I(c,n)):n instanceof i.PointCloudMaterial?N(c,n):n instanceof i.MeshPhongMaterial?j(c,n):n instanceof i.MeshLambertMaterial?W(c,n):n instanceof i.MeshDepthMaterial?(c.mNear.value=e.near,c.mFar.value=e.far,c.opacity.value=n.opacity):n instanceof i.MeshNormalMaterial&&(c.opacity.value=n.opacity),o.receiveShadow&&!n._shadowPass&&q(c,t),K(n.uniformsList)),X(u,o),null!==u.modelMatrix&&Pe.uniformMatrix4fv(u.modelMatrix,!1,o.matrixWorld.elements),l}function z(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var r;if(t.map?r=t.map:t.specularMap?r=t.specularMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.alphaMap&&(r=t.alphaMap),void 0!==r){var n=r.offset,o=r.repeat;e.offsetRepeat.value.set(n.x,n.y,o.x,o.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof i.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}function V(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function I(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function N(e,t){if(e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=ce.height/2,e.map.value=t.map,null!==t.map){var r=t.map.offset,n=t.map.repeat;e.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}}function O(e,t){e.fogColor.value=t.color,t instanceof i.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof i.FogExp2&&(e.fogDensity.value=t.density)}function j(e,t){e.shininess.value=t.shininess,e.emissive.value=t.emissive,e.specular.value=t.specular,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function W(e,t){e.emissive.value=t.emissive,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function H(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecay.value=t.point.decays,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.spotLightDecay.value=t.spot.decays,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function G(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function q(e,t){if(e.shadowMatrix)for(var r=0,n=0,o=t.length;o>n;n++){var a=t[n];a.castShadow&&(a instanceof i.SpotLight||a instanceof i.DirectionalLight&&!a.shadowCascade)&&(e.shadowMap.value[r]=a.shadowMap,e.shadowMapSize.value[r]=a.shadowMapSize,e.shadowMatrix.value[r]=a.shadowMatrix,e.shadowDarkness.value[r]=a.shadowDarkness,e.shadowBias.value[r]=a.shadowBias,r++)}}function X(e,t){Pe.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&Pe.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function Y(){var e=Ie;return e>=ot&&i.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+ot),Ie+=1,e}function K(e){for(var t,r,n,o=0,a=e.length;a>o;o++){var s=e[o][0];if(s.needsUpdate!==!1){var h=s.type,l=s.value,u=e[o][1];switch(h){case"1i":Pe.uniform1i(u,l);break;case"1f":Pe.uniform1f(u,l);break;case"2f":Pe.uniform2f(u,l[0],l[1]);break;case"3f":Pe.uniform3f(u,l[0],l[1],l[2]);break;case"4f":Pe.uniform4f(u,l[0],l[1],l[2],l[3]);break;case"1iv":Pe.uniform1iv(u,l);break;case"3iv":Pe.uniform3iv(u,l);break;case"1fv":Pe.uniform1fv(u,l);break;case"2fv":Pe.uniform2fv(u,l);break;case"3fv":Pe.uniform3fv(u,l);break;case"4fv":Pe.uniform4fv(u,l);break;case"Matrix3fv":Pe.uniformMatrix3fv(u,!1,l);break;case"Matrix4fv":Pe.uniformMatrix4fv(u,!1,l);break;case"i":Pe.uniform1i(u,l);break;case"f":Pe.uniform1f(u,l);break;case"v2":Pe.uniform2f(u,l.x,l.y);break;case"v3":Pe.uniform3f(u,l.x,l.y,l.z);break;case"v4":Pe.uniform4f(u,l.x,l.y,l.z,l.w);break;case"c":Pe.uniform3f(u,l.r,l.g,l.b);break;case"iv1":Pe.uniform1iv(u,l);break;case"iv":Pe.uniform3iv(u,l);break;case"fv1":Pe.uniform1fv(u,l);break;case"fv":Pe.uniform3fv(u,l);break;case"v2v":void 0===s._array&&(s._array=new Float32Array(2*l.length));for(var c=0,p=l.length;p>c;c++)n=2*c,s._array[n]=l[c].x,s._array[n+1]=l[c].y;Pe.uniform2fv(u,s._array);break;case"v3v":void 0===s._array&&(s._array=new Float32Array(3*l.length));for(var c=0,p=l.length;p>c;c++)n=3*c,s._array[n]=l[c].x,s._array[n+1]=l[c].y,s._array[n+2]=l[c].z;Pe.uniform3fv(u,s._array);break;case"v4v":void 0===s._array&&(s._array=new Float32Array(4*l.length));for(var c=0,p=l.length;p>c;c++)n=4*c,s._array[n]=l[c].x,s._array[n+1]=l[c].y,s._array[n+2]=l[c].z,s._array[n+3]=l[c].w;Pe.uniform4fv(u,s._array);break;case"m3":Pe.uniformMatrix3fv(u,!1,l.elements);break;case"m3v":void 0===s._array&&(s._array=new Float32Array(9*l.length));for(var c=0,p=l.length;p>c;c++)l[c].flattenToArrayOffset(s._array,9*c);Pe.uniformMatrix3fv(u,!1,s._array);break;case"m4":Pe.uniformMatrix4fv(u,!1,l.elements);break;case"m4v":void 0===s._array&&(s._array=new Float32Array(16*l.length));for(var c=0,p=l.length;p>c;c++)l[c].flattenToArrayOffset(s._array,16*c);Pe.uniformMatrix4fv(u,!1,s._array);break;case"t":if(t=l,r=Y(),Pe.uniform1i(u,r),!t)continue;t instanceof i.CubeTexture||t.image instanceof Array&&6===t.image.length?te(t,r):t instanceof i.WebGLRenderTargetCube?re(t,r):Be.setTexture(t,r);break;case"tv":void 0===s._array&&(s._array=[]);for(var c=0,p=s.value.length;p>c;c++)s._array[c]=Y();Pe.uniform1iv(u,s._array);for(var c=0,p=s.value.length;p>c;c++)t=s.value[c],r=s._array[c],t&&Be.setTexture(t,r);break;default:i.warn("THREE.WebGLRenderer: Unknown uniform type: "+h)}}}}function Q(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function Z(e,t,r,n){e[t]=r.r*n,e[t+1]=r.g*n,e[t+2]=r.b*n}function J(e){var t,r,n,o,a,s,h,l,u=0,c=0,p=0,f=Ze,d=f.directional.colors,m=f.directional.positions,v=f.point.colors,g=f.point.positions,y=f.point.distances,x=f.point.decays,w=f.spot.colors,b=f.spot.positions,_=f.spot.distances,S=f.spot.directions,M=f.spot.anglesCos,E=f.spot.exponents,T=f.spot.decays,C=f.hemi.skyColors,A=f.hemi.groundColors,L=f.hemi.positions,R=0,P=0,B=0,F=0,k=0,D=0,U=0,z=0,V=0,I=0,N=0,O=0;for(t=0,r=e.length;r>t;t++)if(n=e[t],
!n.onlyShadow)if(o=n.color,h=n.intensity,l=n.distance,n instanceof i.AmbientLight){if(!n.visible)continue;u+=o.r,c+=o.g,p+=o.b}else if(n instanceof i.DirectionalLight){if(k+=1,!n.visible)continue;Ke.setFromMatrixPosition(n.matrixWorld),Ye.setFromMatrixPosition(n.target.matrixWorld),Ke.sub(Ye),Ke.normalize(),V=3*R,m[V]=Ke.x,m[V+1]=Ke.y,m[V+2]=Ke.z,Z(d,V,o,h),R+=1}else if(n instanceof i.PointLight){if(D+=1,!n.visible)continue;I=3*P,Z(v,I,o,h),Ye.setFromMatrixPosition(n.matrixWorld),g[I]=Ye.x,g[I+1]=Ye.y,g[I+2]=Ye.z,y[P]=l,x[P]=0===n.distance?0:n.decay,P+=1}else if(n instanceof i.SpotLight){if(U+=1,!n.visible)continue;N=3*B,Z(w,N,o,h),Ke.setFromMatrixPosition(n.matrixWorld),b[N]=Ke.x,b[N+1]=Ke.y,b[N+2]=Ke.z,_[B]=l,Ye.setFromMatrixPosition(n.target.matrixWorld),Ke.sub(Ye),Ke.normalize(),S[N]=Ke.x,S[N+1]=Ke.y,S[N+2]=Ke.z,M[B]=Math.cos(n.angle),E[B]=n.exponent,T[B]=0===n.distance?0:n.decay,B+=1}else if(n instanceof i.HemisphereLight){if(z+=1,!n.visible)continue;Ke.setFromMatrixPosition(n.matrixWorld),Ke.normalize(),O=3*F,L[O]=Ke.x,L[O+1]=Ke.y,L[O+2]=Ke.z,a=n.color,s=n.groundColor,Z(C,O,a,h),Z(A,O,s,h),F+=1}for(t=3*R,r=Math.max(d.length,3*k);r>t;t++)d[t]=0;for(t=3*P,r=Math.max(v.length,3*D);r>t;t++)v[t]=0;for(t=3*B,r=Math.max(w.length,3*U);r>t;t++)w[t]=0;for(t=3*F,r=Math.max(C.length,3*z);r>t;t++)C[t]=0;for(t=3*F,r=Math.max(A.length,3*z);r>t;t++)A[t]=0;f.directional.length=R,f.point.length=P,f.spot.length=B,f.hemi.length=F,f.ambient[0]=u,f.ambient[1]=c,f.ambient[2]=p}function $(e,t,r){var n;r?(Pe.texParameteri(e,Pe.TEXTURE_WRAP_S,se(t.wrapS)),Pe.texParameteri(e,Pe.TEXTURE_WRAP_T,se(t.wrapT)),Pe.texParameteri(e,Pe.TEXTURE_MAG_FILTER,se(t.magFilter)),Pe.texParameteri(e,Pe.TEXTURE_MIN_FILTER,se(t.minFilter))):(Pe.texParameteri(e,Pe.TEXTURE_WRAP_S,Pe.CLAMP_TO_EDGE),Pe.texParameteri(e,Pe.TEXTURE_WRAP_T,Pe.CLAMP_TO_EDGE),(t.wrapS!==i.ClampToEdgeWrapping||t.wrapT!==i.ClampToEdgeWrapping)&&i.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),Pe.texParameteri(e,Pe.TEXTURE_MAG_FILTER,ae(t.magFilter)),Pe.texParameteri(e,Pe.TEXTURE_MIN_FILTER,ae(t.minFilter)),t.minFilter!==i.NearestFilter&&t.minFilter!==i.LinearFilter&&i.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")),n=tt.get("EXT_texture_filter_anisotropic"),n&&t.type!==i.FloatType&&t.type!==i.HalfFloatType&&(t.anisotropy>1||t.__currentAnisotropy)&&(Pe.texParameterf(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Be.getMaxAnisotropy())),t.__currentAnisotropy=t.anisotropy)}function ee(e,t){if(e.width>t||e.height>t){var r=t/Math.max(e.width,e.height),n=document.createElement("canvas");n.width=Math.floor(e.width*r),n.height=Math.floor(e.height*r);var o=n.getContext("2d");return o.drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),i.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e),n}return e}function te(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",St),e.image.__webglTextureCube=Pe.createTexture(),Be.info.memory.textures++),Pe.activeTexture(Pe.TEXTURE0+t),Pe.bindTexture(Pe.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),Pe.pixelStorei(Pe.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var r=e instanceof i.CompressedTexture,n=e.image[0]instanceof i.DataTexture,o=[],a=0;6>a;a++)!Be.autoScaleCubemaps||r||n?o[a]=n?e.image[a].image:e.image[a]:o[a]=ee(e.image[a],ht);var s=o[0],h=i.Math.isPowerOfTwo(s.width)&&i.Math.isPowerOfTwo(s.height),l=se(e.format),u=se(e.type);$(Pe.TEXTURE_CUBE_MAP,e,h);for(var a=0;6>a;a++)if(r)for(var c,p=o[a].mipmaps,f=0,d=p.length;d>f;f++)c=p[f],e.format!==i.RGBAFormat&&e.format!==i.RGBFormat?mt().indexOf(l)>-1?Pe.compressedTexImage2D(Pe.TEXTURE_CUBE_MAP_POSITIVE_X+a,f,l,c.width,c.height,0,c.data):i.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):Pe.texImage2D(Pe.TEXTURE_CUBE_MAP_POSITIVE_X+a,f,l,c.width,c.height,0,l,u,c.data);else n?Pe.texImage2D(Pe.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,l,o[a].width,o[a].height,0,l,u,o[a].data):Pe.texImage2D(Pe.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,l,l,u,o[a]);e.generateMipmaps&&h&&Pe.generateMipmap(Pe.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Pe.activeTexture(Pe.TEXTURE0+t),Pe.bindTexture(Pe.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function re(e,t){Pe.activeTexture(Pe.TEXTURE0+t),Pe.bindTexture(Pe.TEXTURE_CUBE_MAP,e.__webglTexture)}function ne(e,t,r){Pe.bindFramebuffer(Pe.FRAMEBUFFER,e),Pe.framebufferTexture2D(Pe.FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,r,t.__webglTexture,0)}function ie(e,t){Pe.bindRenderbuffer(Pe.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Pe.renderbufferStorage(Pe.RENDERBUFFER,Pe.DEPTH_COMPONENT16,t.width,t.height),Pe.framebufferRenderbuffer(Pe.FRAMEBUFFER,Pe.DEPTH_ATTACHMENT,Pe.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Pe.renderbufferStorage(Pe.RENDERBUFFER,Pe.DEPTH_STENCIL,t.width,t.height),Pe.framebufferRenderbuffer(Pe.FRAMEBUFFER,Pe.DEPTH_STENCIL_ATTACHMENT,Pe.RENDERBUFFER,e)):Pe.renderbufferStorage(Pe.RENDERBUFFER,Pe.RGBA4,t.width,t.height)}function oe(e){e instanceof i.WebGLRenderTargetCube?(Pe.bindTexture(Pe.TEXTURE_CUBE_MAP,e.__webglTexture),Pe.generateMipmap(Pe.TEXTURE_CUBE_MAP),Pe.bindTexture(Pe.TEXTURE_CUBE_MAP,null)):(Pe.bindTexture(Pe.TEXTURE_2D,e.__webglTexture),Pe.generateMipmap(Pe.TEXTURE_2D),Pe.bindTexture(Pe.TEXTURE_2D,null))}function ae(e){return e===i.NearestFilter||e===i.NearestMipMapNearestFilter||e===i.NearestMipMapLinearFilter?Pe.NEAREST:Pe.LINEAR}function se(e){var t;if(e===i.RepeatWrapping)return Pe.REPEAT;if(e===i.ClampToEdgeWrapping)return Pe.CLAMP_TO_EDGE;if(e===i.MirroredRepeatWrapping)return Pe.MIRRORED_REPEAT;if(e===i.NearestFilter)return Pe.NEAREST;if(e===i.NearestMipMapNearestFilter)return Pe.NEAREST_MIPMAP_NEAREST;if(e===i.NearestMipMapLinearFilter)return Pe.NEAREST_MIPMAP_LINEAR;if(e===i.LinearFilter)return Pe.LINEAR;if(e===i.LinearMipMapNearestFilter)return Pe.LINEAR_MIPMAP_NEAREST;if(e===i.LinearMipMapLinearFilter)return Pe.LINEAR_MIPMAP_LINEAR;if(e===i.UnsignedByteType)return Pe.UNSIGNED_BYTE;if(e===i.UnsignedShort4444Type)return Pe.UNSIGNED_SHORT_4_4_4_4;if(e===i.UnsignedShort5551Type)return Pe.UNSIGNED_SHORT_5_5_5_1;if(e===i.UnsignedShort565Type)return Pe.UNSIGNED_SHORT_5_6_5;if(e===i.ByteType)return Pe.BYTE;if(e===i.ShortType)return Pe.SHORT;if(e===i.UnsignedShortType)return Pe.UNSIGNED_SHORT;if(e===i.IntType)return Pe.INT;if(e===i.UnsignedIntType)return Pe.UNSIGNED_INT;if(e===i.FloatType)return Pe.FLOAT;if(t=tt.get("OES_texture_half_float"),null!==t&&e===i.HalfFloatType)return t.HALF_FLOAT_OES;if(e===i.AlphaFormat)return Pe.ALPHA;if(e===i.RGBFormat)return Pe.RGB;if(e===i.RGBAFormat)return Pe.RGBA;if(e===i.LuminanceFormat)return Pe.LUMINANCE;if(e===i.LuminanceAlphaFormat)return Pe.LUMINANCE_ALPHA;if(e===i.AddEquation)return Pe.FUNC_ADD;if(e===i.SubtractEquation)return Pe.FUNC_SUBTRACT;if(e===i.ReverseSubtractEquation)return Pe.FUNC_REVERSE_SUBTRACT;if(e===i.ZeroFactor)return Pe.ZERO;if(e===i.OneFactor)return Pe.ONE;if(e===i.SrcColorFactor)return Pe.SRC_COLOR;if(e===i.OneMinusSrcColorFactor)return Pe.ONE_MINUS_SRC_COLOR;if(e===i.SrcAlphaFactor)return Pe.SRC_ALPHA;if(e===i.OneMinusSrcAlphaFactor)return Pe.ONE_MINUS_SRC_ALPHA;if(e===i.DstAlphaFactor)return Pe.DST_ALPHA;if(e===i.OneMinusDstAlphaFactor)return Pe.ONE_MINUS_DST_ALPHA;if(e===i.DstColorFactor)return Pe.DST_COLOR;if(e===i.OneMinusDstColorFactor)return Pe.ONE_MINUS_DST_COLOR;if(e===i.SrcAlphaSaturateFactor)return Pe.SRC_ALPHA_SATURATE;if(t=tt.get("WEBGL_compressed_texture_s3tc"),null!==t){if(e===i.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===i.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===i.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===i.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t=tt.get("WEBGL_compressed_texture_pvrtc"),null!==t){if(e===i.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===i.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===i.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===i.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t=tt.get("EXT_blend_minmax"),null!==t){if(e===i.MinEquation)return t.MIN_EXT;if(e===i.MaxEquation)return t.MAX_EXT}return 0}function he(e){if(ut&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var t=Pe.getParameter(Pe.MAX_VERTEX_UNIFORM_VECTORS),r=Math.floor((t-20)/4),n=r;return void 0!==e&&e instanceof i.SkinnedMesh&&(n=Math.min(e.skeleton.bones.length,n),n<e.skeleton.bones.length&&i.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)")),n}function le(e){for(var t=0,r=0,n=0,o=0,a=0,s=e.length;s>a;a++){var h=e[a];h.onlyShadow||h.visible===!1||(h instanceof i.DirectionalLight&&t++,h instanceof i.PointLight&&r++,h instanceof i.SpotLight&&n++,h instanceof i.HemisphereLight&&o++)}return{directional:t,point:r,spot:n,hemi:o}}function ue(e){for(var t=0,r=0,n=e.length;n>r;r++){var o=e[r];o.castShadow&&(o instanceof i.SpotLight&&t++,o instanceof i.DirectionalLight&&!o.shadowCascade&&t++)}return t}console.log("THREE.WebGLRenderer",i.REVISION),e=e||{};var ce=void 0!==e.canvas?e.canvas:document.createElement("canvas"),pe=void 0!==e.context?e.context:null,fe=1,de=void 0!==e.precision?e.precision:"highp",me=void 0!==e.alpha?e.alpha:!1,ve=void 0!==e.depth?e.depth:!0,ge=void 0!==e.stencil?e.stencil:!0,ye=void 0!==e.antialias?e.antialias:!1,xe=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,we=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,be=void 0!==e.logarithmicDepthBuffer?e.logarithmicDepthBuffer:!1,_e=new i.Color(0),Se=0,Me=[],Ee={},Te=[],Ce=[],Ae=[],Le=[],Re=[];this.domElement=ce,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapType=i.PCFShadowMap,this.shadowMapCullFace=i.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Pe,Be=this,Fe=[],ke=null,De=null,Ue=-1,ze="",Ve=null,Ie=0,Ne=0,Oe=0,je=ce.width,We=ce.height,He=0,Ge=0,qe=new i.Frustum,Xe=new i.Matrix4,Ye=new i.Vector3,Ke=new i.Vector3,Qe=!0,Ze={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var Je={alpha:me,depth:ve,stencil:ge,antialias:ye,premultipliedAlpha:xe,preserveDrawingBuffer:we};if(Pe=pe||ce.getContext("webgl",Je)||ce.getContext("experimental-webgl",Je),null===Pe)throw null!==ce.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";ce.addEventListener("webglcontextlost",function(e){e.preventDefault(),it(),nt(),Ee={}},!1)}catch($e){i.error("THREE.WebGLRenderer: "+$e)}var et=new i.WebGLState(Pe,se);void 0===Pe.getShaderPrecisionFormat&&(Pe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var tt=new i.WebGLExtensions(Pe);tt.get("OES_texture_float"),tt.get("OES_texture_float_linear"),tt.get("OES_texture_half_float"),tt.get("OES_texture_half_float_linear"),tt.get("OES_standard_derivatives"),be&&tt.get("EXT_frag_depth");var rt=function(e,t,r,n){xe===!0&&(e*=n,t*=n,r*=n),Pe.clearColor(e,t,r,n)},nt=function(){Pe.clearColor(0,0,0,1),Pe.clearDepth(1),Pe.clearStencil(0),Pe.enable(Pe.DEPTH_TEST),Pe.depthFunc(Pe.LEQUAL),Pe.frontFace(Pe.CCW),Pe.cullFace(Pe.BACK),Pe.enable(Pe.CULL_FACE),Pe.enable(Pe.BLEND),Pe.blendEquation(Pe.FUNC_ADD),Pe.blendFunc(Pe.SRC_ALPHA,Pe.ONE_MINUS_SRC_ALPHA),Pe.viewport(Ne,Oe,je,We),rt(_e.r,_e.g,_e.b,Se)},it=function(){ke=null,Ve=null,ze="",Ue=-1,Qe=!0,et.reset()};nt(),this.context=Pe,this.state=et;var ot=Pe.getParameter(Pe.MAX_TEXTURE_IMAGE_UNITS),at=Pe.getParameter(Pe.MAX_VERTEX_TEXTURE_IMAGE_UNITS),st=Pe.getParameter(Pe.MAX_TEXTURE_SIZE),ht=Pe.getParameter(Pe.MAX_CUBE_MAP_TEXTURE_SIZE),lt=at>0,ut=lt&&tt.get("OES_texture_float"),ct=Pe.getShaderPrecisionFormat(Pe.VERTEX_SHADER,Pe.HIGH_FLOAT),pt=Pe.getShaderPrecisionFormat(Pe.VERTEX_SHADER,Pe.MEDIUM_FLOAT),ft=Pe.getShaderPrecisionFormat(Pe.FRAGMENT_SHADER,Pe.HIGH_FLOAT),dt=Pe.getShaderPrecisionFormat(Pe.FRAGMENT_SHADER,Pe.MEDIUM_FLOAT),mt=function(){var e;return function(){if(void 0!==e)return e;if(e=[],tt.get("WEBGL_compressed_texture_pvrtc")||tt.get("WEBGL_compressed_texture_s3tc"))for(var t=Pe.getParameter(Pe.COMPRESSED_TEXTURE_FORMATS),r=0;r<t.length;r++)e.push(t[r]);return e}}(),vt=ct.precision>0&&ft.precision>0,gt=pt.precision>0&&dt.precision>0;"highp"!==de||vt||(gt?(de="mediump",i.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(de="lowp",i.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==de||gt||(de="lowp",i.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var yt=new i.ShadowMapPlugin(this,Me,Ee,Te),xt=new i.SpritePlugin(this,Le),wt=new i.LensFlarePlugin(this,Re);this.getContext=function(){return Pe},this.forceContextLoss=function(){tt.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return lt},this.supportsFloatTextures=function(){return tt.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return tt.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return tt.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return tt.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return tt.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return tt.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){var e;return function(){if(void 0!==e)return e;var t=tt.get("EXT_texture_filter_anisotropic");return e=null!==t?Pe.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return de},this.getPixelRatio=function(){return fe},this.setPixelRatio=function(e){fe=e},this.setSize=function(e,t,r){ce.width=e*fe,ce.height=t*fe,r!==!1&&(ce.style.width=e+"px",ce.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,n){Ne=e*fe,Oe=t*fe,je=r*fe,We=n*fe,Pe.viewport(Ne,Oe,je,We)},this.setScissor=function(e,t,r,n){Pe.scissor(e*fe,t*fe,r*fe,n*fe)},this.enableScissorTest=function(e){e?Pe.enable(Pe.SCISSOR_TEST):Pe.disable(Pe.SCISSOR_TEST)},this.getClearColor=function(){return _e},this.setClearColor=function(e,t){_e.set(e),Se=void 0!==t?t:1,rt(_e.r,_e.g,_e.b,Se)},this.getClearAlpha=function(){return Se},this.setClearAlpha=function(e){Se=e,rt(_e.r,_e.g,_e.b,Se)},this.clear=function(e,t,r){var n=0;(void 0===e||e)&&(n|=Pe.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=Pe.DEPTH_BUFFER_BIT),(void 0===r||r)&&(n|=Pe.STENCIL_BUFFER_BIT),Pe.clear(n)},this.clearColor=function(){Pe.clear(Pe.COLOR_BUFFER_BIT)},this.clearDepth=function(){Pe.clear(Pe.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Pe.clear(Pe.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,r,n){this.setRenderTarget(e),this.clear(t,r,n)},this.resetGLState=it;var bt=function(e){var t=e.target;t.traverse(function(e){e.removeEventListener("remove",bt),B(e)})},_t=function(e){var t=e.target;t.removeEventListener("dispose",_t),Ct(t)},St=function(e){var t=e.target;t.removeEventListener("dispose",St),At(t),Be.info.memory.textures--},Mt=function(e){var t=e.target;t.removeEventListener("dispose",Mt),Lt(t),Be.info.memory.textures--},Et=function(e){var t=e.target;t.removeEventListener("dispose",Et),Rt(t)},Tt=function(e){for(var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"],r=0,n=t.length;n>r;r++){var i=t[r];void 0!==e[i]&&(Pe.deleteBuffer(e[i]),delete e[i])}if(void 0!==e.__webglCustomAttributesList){for(var i in e.__webglCustomAttributesList)Pe.deleteBuffer(e.__webglCustomAttributesList[i].buffer);delete e.__webglCustomAttributesList}Be.info.memory.geometries--},Ct=function(e){if(delete e.__webglInit,e instanceof i.BufferGeometry){for(var t in e.attributes){var r=e.attributes[t];void 0!==r.buffer&&(Pe.deleteBuffer(r.buffer),delete r.buffer)}Be.info.memory.geometries--}else{var n=Pt[e.id];if(void 0!==n){for(var o=0,a=n.length;a>o;o++){var s=n[o];if(void 0!==s.numMorphTargets){for(var h=0,l=s.numMorphTargets;l>h;h++)Pe.deleteBuffer(s.__webglMorphTargetsBuffers[h]);delete s.__webglMorphTargetsBuffers}if(void 0!==s.numMorphNormals){for(var h=0,l=s.numMorphNormals;l>h;h++)Pe.deleteBuffer(s.__webglMorphNormalsBuffers[h]);delete s.__webglMorphNormalsBuffers}Tt(s)}delete Pt[e.id]}else Tt(e)}ze=""},At=function(e){if(e.image&&e.image.__webglTextureCube)Pe.deleteTexture(e.image.__webglTextureCube),delete e.image.__webglTextureCube;else{if(void 0===e.__webglInit)return;Pe.deleteTexture(e.__webglTexture),delete e.__webglTexture,delete e.__webglInit}},Lt=function(e){if(e&&void 0!==e.__webglTexture){if(Pe.deleteTexture(e.__webglTexture),delete e.__webglTexture,e instanceof i.WebGLRenderTargetCube)for(var t=0;6>t;t++)Pe.deleteFramebuffer(e.__webglFramebuffer[t]),Pe.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Pe.deleteFramebuffer(e.__webglFramebuffer),Pe.deleteRenderbuffer(e.__webglRenderbuffer);delete e.__webglFramebuffer,delete e.__webglRenderbuffer}},Rt=function(e){var t=e.program.program;if(void 0!==t){e.program=void 0;var r,n,i,o=!1;for(r=0,n=Fe.length;n>r;r++)if(i=Fe[r],i.program===t){i.usedTimes--,0===i.usedTimes&&(o=!0);break}if(o===!0){var a=[];for(r=0,n=Fe.length;n>r;r++)i=Fe[r],i.program!==t&&a.push(i);Fe=a,Pe.deleteProgram(t),Be.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,r){if(et.initAttributes(),e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Pe.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Pe.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Pe.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Pe.createBuffer()),e.hasPositions&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglVertexBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,e.positionArray,Pe.DYNAMIC_DRAW),et.enableAttribute(t.attributes.position),Pe.vertexAttribPointer(t.attributes.position,3,Pe.FLOAT,!1,0,0)),e.hasNormals){if(Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglNormalBuffer),r instanceof i.MeshPhongMaterial==!1&&r.shading===i.FlatShading){var n,o,a,s,h,l,u,c,p,f,d,m,v,g,y=3*e.count;for(g=0;y>g;g+=9)v=e.normalArray,s=v[g],u=v[g+1],f=v[g+2],h=v[g+3],c=v[g+4],d=v[g+5],l=v[g+6],p=v[g+7],m=v[g+8],n=(s+h+l)/3,o=(u+c+p)/3,a=(f+d+m)/3,v[g]=n,v[g+1]=o,v[g+2]=a,v[g+3]=n,v[g+4]=o,v[g+5]=a,v[g+6]=n,v[g+7]=o,v[g+8]=a}Pe.bufferData(Pe.ARRAY_BUFFER,e.normalArray,Pe.DYNAMIC_DRAW),et.enableAttribute(t.attributes.normal),Pe.vertexAttribPointer(t.attributes.normal,3,Pe.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglUvBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,e.uvArray,Pe.DYNAMIC_DRAW),et.enableAttribute(t.attributes.uv),Pe.vertexAttribPointer(t.attributes.uv,2,Pe.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==i.NoColors&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,e.__webglColorBuffer),Pe.bufferData(Pe.ARRAY_BUFFER,e.colorArray,Pe.DYNAMIC_DRAW),et.enableAttribute(t.attributes.color),Pe.vertexAttribPointer(t.attributes.color,3,Pe.FLOAT,!1,0,0)),et.disableUnusedAttributes(),Pe.drawArrays(Pe.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,n,o,a){if(n.visible!==!1){L(a);var s=U(e,t,r,n,a),h=!1,l=n.wireframe?1:0,u="direct_"+o.id+"_"+s.id+"_"+l;if(u!==ze&&(ze=u,h=!0),h&&et.initAttributes(),a instanceof i.Mesh){var c=n.wireframe===!0?Pe.LINES:Pe.TRIANGLES,p=o.attributes.index;if(p){var f,m;p.array instanceof Uint32Array&&tt.get("OES_element_index_uint")?(f=Pe.UNSIGNED_INT,m=4):(f=Pe.UNSIGNED_SHORT,m=2);var v=o.offsets;if(0===v.length)h&&(d(n,s,o,0),Pe.bindBuffer(Pe.ELEMENT_ARRAY_BUFFER,p.buffer)),Pe.drawElements(c,p.array.length,f,0),Be.info.render.calls++,Be.info.render.vertices+=p.array.length,Be.info.render.faces+=p.array.length/3;else{h=!0;for(var g=0,y=v.length;y>g;g++){var x=v[g].index;h&&(d(n,s,o,x),Pe.bindBuffer(Pe.ELEMENT_ARRAY_BUFFER,p.buffer)),Pe.drawElements(c,v[g].count,f,v[g].start*m),Be.info.render.calls++,Be.info.render.vertices+=v[g].count,Be.info.render.faces+=v[g].count/3}}}else{h&&d(n,s,o,0);var w=o.attributes.position;Pe.drawArrays(c,0,w.array.length/w.itemSize),Be.info.render.calls++,Be.info.render.vertices+=w.array.length/w.itemSize,Be.info.render.faces+=w.array.length/(3*w.itemSize)}}else if(a instanceof i.PointCloud){var c=Pe.POINTS,p=o.attributes.index;if(p){var f,m;p.array instanceof Uint32Array&&tt.get("OES_element_index_uint")?(f=Pe.UNSIGNED_INT,m=4):(f=Pe.UNSIGNED_SHORT,m=2);var v=o.offsets;if(0===v.length)h&&(d(n,s,o,0),Pe.bindBuffer(Pe.ELEMENT_ARRAY_BUFFER,p.buffer)),Pe.drawElements(c,p.array.length,f,0),Be.info.render.calls++,Be.info.render.points+=p.array.length;else{v.length>1&&(h=!0);for(var g=0,y=v.length;y>g;g++){var x=v[g].index;h&&(d(n,s,o,x),Pe.bindBuffer(Pe.ELEMENT_ARRAY_BUFFER,p.buffer)),Pe.drawElements(c,v[g].count,f,v[g].start*m),Be.info.render.calls++,Be.info.render.points+=v[g].count}}}else{h&&d(n,s,o,0);var w=o.attributes.position,v=o.offsets;if(0===v.length)Pe.drawArrays(c,0,w.array.length/3),Be.info.render.calls++,Be.info.render.points+=w.array.length/3;else for(var g=0,y=v.length;y>g;g++)Pe.drawArrays(c,v[g].index,v[g].count),Be.info.render.calls++,Be.info.render.points+=v[g].count}}else if(a instanceof i.Line){var c=a.mode===i.LineStrip?Pe.LINE_STRIP:Pe.LINES;et.setLineWidth(n.linewidth*fe);var p=o.attributes.index;if(p){var f,m;p.array instanceof Uint32Array?(f=Pe.UNSIGNED_INT,m=4):(f=Pe.UNSIGNED_SHORT,m=2);var v=o.offsets;if(0===v.length)h&&(d(n,s,o,0),Pe.bindBuffer(Pe.ELEMENT_ARRAY_BUFFER,p.buffer)),Pe.drawElements(c,p.array.length,f,0),Be.info.render.calls++,Be.info.render.vertices+=p.array.length;else{v.length>1&&(h=!0);for(var g=0,y=v.length;y>g;g++){var x=v[g].index;h&&(d(n,s,o,x),Pe.bindBuffer(Pe.ELEMENT_ARRAY_BUFFER,p.buffer)),Pe.drawElements(c,v[g].count,f,v[g].start*m),Be.info.render.calls++,Be.info.render.vertices+=v[g].count}}}else{h&&d(n,s,o,0);var w=o.attributes.position,v=o.offsets;if(0===v.length)Pe.drawArrays(c,0,w.array.length/3),Be.info.render.calls++,Be.info.render.vertices+=w.array.length/3;else for(var g=0,y=v.length;y>g;g++)Pe.drawArrays(c,v[g].index,v[g].count),Be.info.render.calls++,Be.info.render.vertices+=v[g].count}}}},this.renderBuffer=function(e,t,r,n,o,a){if(n.visible!==!1){L(a);var s=U(e,t,r,n,a),h=s.attributes,l=!1,u=n.wireframe?1:0,c=o.id+"_"+s.id+"_"+u;if(c!==ze&&(ze=c,l=!0),l&&et.initAttributes(),!n.morphTargets&&h.position>=0?l&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,o.__webglVertexBuffer),et.enableAttribute(h.position),Pe.vertexAttribPointer(h.position,3,Pe.FLOAT,!1,0,0)):a.morphTargetBase&&m(n,o,a),l){if(o.__webglCustomAttributesList)for(var p=0,f=o.__webglCustomAttributesList.length;f>p;p++){var d=o.__webglCustomAttributesList[p];h[d.buffer.belongsToAttribute]>=0&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,d.buffer),et.enableAttribute(h[d.buffer.belongsToAttribute]),Pe.vertexAttribPointer(h[d.buffer.belongsToAttribute],d.size,Pe.FLOAT,!1,0,0))}h.color>=0&&(a.geometry.colors.length>0||a.geometry.faces.length>0?(Pe.bindBuffer(Pe.ARRAY_BUFFER,o.__webglColorBuffer),et.enableAttribute(h.color),Pe.vertexAttribPointer(h.color,3,Pe.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&Pe.vertexAttrib3fv(h.color,n.defaultAttributeValues.color)),h.normal>=0&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,o.__webglNormalBuffer),et.enableAttribute(h.normal),Pe.vertexAttribPointer(h.normal,3,Pe.FLOAT,!1,0,0)),h.tangent>=0&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,o.__webglTangentBuffer),et.enableAttribute(h.tangent),Pe.vertexAttribPointer(h.tangent,4,Pe.FLOAT,!1,0,0)),h.uv>=0&&(a.geometry.faceVertexUvs[0]?(Pe.bindBuffer(Pe.ARRAY_BUFFER,o.__webglUVBuffer),et.enableAttribute(h.uv),Pe.vertexAttribPointer(h.uv,2,Pe.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&Pe.vertexAttrib2fv(h.uv,n.defaultAttributeValues.uv)),h.uv2>=0&&(a.geometry.faceVertexUvs[1]?(Pe.bindBuffer(Pe.ARRAY_BUFFER,o.__webglUV2Buffer),et.enableAttribute(h.uv2),Pe.vertexAttribPointer(h.uv2,2,Pe.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&Pe.vertexAttrib2fv(h.uv2,n.defaultAttributeValues.uv2)),n.skinning&&h.skinIndex>=0&&h.skinWeight>=0&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),et.enableAttribute(h.skinIndex),Pe.vertexAttribPointer(h.skinIndex,4,Pe.FLOAT,!1,0,0),Pe.bindBuffer(Pe.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),et.enableAttribute(h.skinWeight),Pe.vertexAttribPointer(h.skinWeight,4,Pe.FLOAT,!1,0,0)),h.lineDistance>=0&&(Pe.bindBuffer(Pe.ARRAY_BUFFER,o.__webglLineDistanceBuffer),et.enableAttribute(h.lineDistance),Pe.vertexAttribPointer(h.lineDistance,1,Pe.FLOAT,!1,0,0))}if(et.disableUnusedAttributes(),a instanceof i.Mesh){var v=o.__typeArray===Uint32Array?Pe.UNSIGNED_INT:Pe.UNSIGNED_SHORT;n.wireframe?(et.setLineWidth(n.wireframeLinewidth*fe),l&&Pe.bindBuffer(Pe.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),Pe.drawElements(Pe.LINES,o.__webglLineCount,v,0)):(l&&Pe.bindBuffer(Pe.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),Pe.drawElements(Pe.TRIANGLES,o.__webglFaceCount,v,0)),Be.info.render.calls++,Be.info.render.vertices+=o.__webglFaceCount,Be.info.render.faces+=o.__webglFaceCount/3}else if(a instanceof i.Line){var g=a.mode===i.LineStrip?Pe.LINE_STRIP:Pe.LINES;et.setLineWidth(n.linewidth*fe),Pe.drawArrays(g,0,o.__webglLineCount),Be.info.render.calls++}else a instanceof i.PointCloud&&(Pe.drawArrays(Pe.POINTS,0,o.__webglParticleCount),Be.info.render.calls++,Be.info.render.points+=o.__webglParticleCount)}},this.render=function(e,t,r,n){if(t instanceof i.Camera==!1)return void i.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var o=e.fog;ze="",Ue=-1,Ve=null,Qe=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),e.traverse(function(e){e instanceof i.SkinnedMesh&&e.skeleton.update()}),t.matrixWorldInverse.getInverse(t.matrixWorld),Xe.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),qe.setFromMatrix(Xe),Me.length=0,Ce.length=0,Ae.length=0,Le.length=0,Re.length=0,x(e),Be.sortObjects===!0&&(Ce.sort(v),Ae.sort(g)),yt.render(e,t),Be.info.render.calls=0,Be.info.render.vertices=0,Be.info.render.faces=0,Be.info.render.points=0,this.setRenderTarget(r),(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var a=0,s=Te.length;s>a;a++){var h=Te[a],l=h.object;l.visible&&(Q(l,t),_(h))}if(e.overrideMaterial){var u=e.overrideMaterial;D(u),w(Ce,t,Me,o,u),w(Ae,t,Me,o,u),b(Te,"",t,Me,o,u)}else et.setBlending(i.NoBlending),w(Ce,t,Me,o,null),b(Te,"opaque",t,Me,o,null),w(Ae,t,Me,o,null),b(Te,"transparent",t,Me,o,null);xt.render(e,t),wt.render(e,t,He,Ge),r&&r.generateMipmaps&&r.minFilter!==i.NearestFilter&&r.minFilter!==i.LinearFilter&&oe(r),et.setDepthTest(!0),et.setDepthWrite(!0),et.setColorWrite(!0)},this.renderImmediateObject=function(e,t,r,n,i){var o=U(e,t,r,n,i);ze="",Be.setMaterialFaces(n),i.immediateRenderCallback?i.immediateRenderCallback(o,Pe,qe):i.render(function(e){Be.renderBufferImmediate(e,o,n)})};var Pt={},Bt=0,Ft={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};this.setFaceCulling=function(e,t){e===i.CullFaceNone?Pe.disable(Pe.CULL_FACE):(t===i.FrontFaceDirectionCW?Pe.frontFace(Pe.CW):Pe.frontFace(Pe.CCW),e===i.CullFaceBack?Pe.cullFace(Pe.BACK):e===i.CullFaceFront?Pe.cullFace(Pe.FRONT):Pe.cullFace(Pe.FRONT_AND_BACK),Pe.enable(Pe.CULL_FACE))},this.setMaterialFaces=function(e){et.setDoubleSided(e.side===i.DoubleSide),et.setFlipSided(e.side===i.BackSide)},this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",St),e.__webglTexture=Pe.createTexture(),Be.info.memory.textures++),Pe.bindTexture(Pe.TEXTURE_2D,e.__webglTexture),Pe.pixelStorei(Pe.UNPACK_FLIP_Y_WEBGL,e.flipY),Pe.pixelStorei(Pe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Pe.pixelStorei(Pe.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=ee(e.image,st);var t=e.image,r=i.Math.isPowerOfTwo(t.width)&&i.Math.isPowerOfTwo(t.height),n=se(e.format),o=se(e.type);$(Pe.TEXTURE_2D,e,r);var a,s=e.mipmaps;if(e instanceof i.DataTexture)if(s.length>0&&r){for(var h=0,l=s.length;l>h;h++)a=s[h],Pe.texImage2D(Pe.TEXTURE_2D,h,n,a.width,a.height,0,n,o,a.data);e.generateMipmaps=!1}else Pe.texImage2D(Pe.TEXTURE_2D,0,n,t.width,t.height,0,n,o,t.data);else if(e instanceof i.CompressedTexture)for(var h=0,l=s.length;l>h;h++)a=s[h],e.format!==i.RGBAFormat&&e.format!==i.RGBFormat?mt().indexOf(n)>-1?Pe.compressedTexImage2D(Pe.TEXTURE_2D,h,n,a.width,a.height,0,a.data):i.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Pe.texImage2D(Pe.TEXTURE_2D,h,n,a.width,a.height,0,n,o,a.data);else if(s.length>0&&r){for(var h=0,l=s.length;l>h;h++)a=s[h],Pe.texImage2D(Pe.TEXTURE_2D,h,n,n,o,a);e.generateMipmaps=!1}else Pe.texImage2D(Pe.TEXTURE_2D,0,n,n,o,e.image);e.generateMipmaps&&r&&Pe.generateMipmap(Pe.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()},this.setTexture=function(e,t){Pe.activeTexture(Pe.TEXTURE0+t),e.needsUpdate?Be.uploadTexture(e):Pe.bindTexture(Pe.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof i.WebGLRenderTargetCube;if(e&&void 0===e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",Mt),e.__webglTexture=Pe.createTexture(),Be.info.memory.textures++;var r=i.Math.isPowerOfTwo(e.width)&&i.Math.isPowerOfTwo(e.height),n=se(e.format),o=se(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Pe.bindTexture(Pe.TEXTURE_CUBE_MAP,e.__webglTexture),$(Pe.TEXTURE_CUBE_MAP,e,r);for(var a=0;6>a;a++)e.__webglFramebuffer[a]=Pe.createFramebuffer(),e.__webglRenderbuffer[a]=Pe.createRenderbuffer(),Pe.texImage2D(Pe.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,n,e.width,e.height,0,n,o,null),ne(e.__webglFramebuffer[a],e,Pe.TEXTURE_CUBE_MAP_POSITIVE_X+a),ie(e.__webglRenderbuffer[a],e);r&&Pe.generateMipmap(Pe.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=Pe.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=Pe.createRenderbuffer(),Pe.bindTexture(Pe.TEXTURE_2D,e.__webglTexture),$(Pe.TEXTURE_2D,e,r),Pe.texImage2D(Pe.TEXTURE_2D,0,n,e.width,e.height,0,n,o,null),ne(e.__webglFramebuffer,e,Pe.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Pe.framebufferRenderbuffer(Pe.FRAMEBUFFER,Pe.DEPTH_ATTACHMENT,Pe.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Pe.framebufferRenderbuffer(Pe.FRAMEBUFFER,Pe.DEPTH_STENCIL_ATTACHMENT,Pe.RENDERBUFFER,e.__webglRenderbuffer):ie(e.__webglRenderbuffer,e),r&&Pe.generateMipmap(Pe.TEXTURE_2D);t?Pe.bindTexture(Pe.TEXTURE_CUBE_MAP,null):Pe.bindTexture(Pe.TEXTURE_2D,null),Pe.bindRenderbuffer(Pe.RENDERBUFFER,null),Pe.bindFramebuffer(Pe.FRAMEBUFFER,null)}var s,h,l,u,c;e?(s=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,h=e.width,l=e.height,u=0,c=0):(s=null,h=je,l=We,u=Ne,c=Oe),s!==De&&(Pe.bindFramebuffer(Pe.FRAMEBUFFER,s),Pe.viewport(u,c,h,l),De=s),He=h,Ge=l},this.readRenderTargetPixels=function(e,t,r,n,o,a){if(!(e instanceof i.WebGLRenderTarget))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");
if(e.__webglFramebuffer){if(e.format!==i.RGBAFormat)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");var s=!1;e.__webglFramebuffer!==De&&(Pe.bindFramebuffer(Pe.FRAMEBUFFER,e.__webglFramebuffer),s=!0),Pe.checkFramebufferStatus(Pe.FRAMEBUFFER)===Pe.FRAMEBUFFER_COMPLETE?Pe.readPixels(t,r,n,o,Pe.RGBA,Pe.UNSIGNED_BYTE,a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),s&&Pe.bindFramebuffer(Pe.FRAMEBUFFER,De)}},this.initMaterial=function(){i.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){i.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){i.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){i.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},i.WebGLRenderTarget=function(e,t,r){this.width=e,this.height=t,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:i.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:i.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:i.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:i.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new i.Vector2(0,0),this.repeat=new i.Vector2(1,1),this.format=void 0!==r.format?r.format:i.RGBAFormat,this.type=void 0!==r.type?r.type:i.UnsignedByteType,this.depthBuffer=void 0!==r.depthBuffer?r.depthBuffer:!0,this.stencilBuffer=void 0!==r.stencilBuffer?r.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=void 0!==r.shareDepthFrom?r.shareDepthFrom:null},i.WebGLRenderTarget.prototype={constructor:i.WebGLRenderTarget,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var e=new i.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},i.EventDispatcher.prototype.apply(i.WebGLRenderTarget.prototype),i.WebGLRenderTargetCube=function(e,t,r){i.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},i.WebGLRenderTargetCube.prototype=Object.create(i.WebGLRenderTarget.prototype),i.WebGLRenderTargetCube.prototype.constructor=i.WebGLRenderTargetCube,i.WebGLExtensions=function(e){var t={};this.get=function(r){if(void 0!==t[r])return t[r];var n;switch(r){case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return null===n&&i.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=n,n}},i.WebGLProgram=function(){var e=0,t=function(e){var t,r,n=[];for(var i in e)t=e[i],t!==!1&&(r="#define "+i+" "+t,n.push(r));return n.join("\n")},r=function(e,t,r){for(var n={},i=0,o=r.length;o>i;i++){var a=r[i];n[a]=e.getUniformLocation(t,a)}return n},n=function(e,t,r){for(var n={},i=0,o=r.length;o>i;i++){var a=r[i];n[a]=e.getAttribLocation(t,a)}return n};return function(o,a,s,h){var l=o,u=l.context,c=s.defines,p=s.__webglShader.uniforms,f=s.attributes,d=s.__webglShader.vertexShader,m=s.__webglShader.fragmentShader,v=s.index0AttributeName;void 0===v&&h.morphTargets===!0&&(v="position");var g="SHADOWMAP_TYPE_BASIC";h.shadowMapType===i.PCFShadowMap?g="SHADOWMAP_TYPE_PCF":h.shadowMapType===i.PCFSoftShadowMap&&(g="SHADOWMAP_TYPE_PCF_SOFT");var y="ENVMAP_TYPE_CUBE",x="ENVMAP_MODE_REFLECTION",w="ENVMAP_BLENDING_MULTIPLY";if(h.envMap){switch(s.envMap.mapping){case i.CubeReflectionMapping:case i.CubeRefractionMapping:y="ENVMAP_TYPE_CUBE";break;case i.EquirectangularReflectionMapping:case i.EquirectangularRefractionMapping:y="ENVMAP_TYPE_EQUIREC";break;case i.SphericalReflectionMapping:y="ENVMAP_TYPE_SPHERE"}switch(s.envMap.mapping){case i.CubeRefractionMapping:case i.EquirectangularRefractionMapping:x="ENVMAP_MODE_REFRACTION"}switch(s.combine){case i.MultiplyOperation:w="ENVMAP_BLENDING_MULTIPLY";break;case i.MixOperation:w="ENVMAP_BLENDING_MIX";break;case i.AddOperation:w="ENVMAP_BLENDING_ADD"}}var b,_,S=o.gammaFactor>0?o.gammaFactor:1,M=t(c),E=u.createProgram();s instanceof i.RawShaderMaterial?(b="",_=""):(b=["precision "+h.precision+" float;","precision "+h.precision+" int;",M,h.supportsVertexTextures?"#define VERTEX_TEXTURES":"",l.gammaInput?"#define GAMMA_INPUT":"",l.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+S,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,"#define MAX_BONES "+h.maxBones,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define "+x:"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.flatShading?"#define FLAT_SHADED":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals?"#define USE_MORPHNORMALS":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+g:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",""].join("\n"),_=["precision "+h.precision+" float;","precision "+h.precision+" int;",h.bumpMap||h.normalMap||h.flatShading?"#extension GL_OES_standard_derivatives : enable":"",M,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",l.gammaInput?"#define GAMMA_INPUT":"",l.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+S,h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define "+y:"",h.envMap?"#define "+x:"",h.envMap?"#define "+w:"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.flatShading?"#define FLAT_SHADED":"",h.metal?"#define METAL":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+g:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var T=new i.WebGLShader(u,u.VERTEX_SHADER,b+d),C=new i.WebGLShader(u,u.FRAGMENT_SHADER,_+m);u.attachShader(E,T),u.attachShader(E,C),void 0!==v&&u.bindAttribLocation(E,0,v),u.linkProgram(E);var A=u.getProgramInfoLog(E);u.getProgramParameter(E,u.LINK_STATUS)===!1&&i.error("THREE.WebGLProgram: shader error: "+u.getError(),"gl.VALIDATE_STATUS",u.getProgramParameter(E,u.VALIDATE_STATUS),"gl.getPRogramInfoLog",A),""!==A&&i.warn("THREE.WebGLProgram: gl.getProgramInfoLog()"+A),u.deleteShader(T),u.deleteShader(C);var L=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];h.useVertexTexture?(L.push("boneTexture"),L.push("boneTextureWidth"),L.push("boneTextureHeight")):L.push("boneGlobalMatrices"),h.logarithmicDepthBuffer&&L.push("logDepthBufFC");for(var R in p)L.push(R);this.uniforms=r(u,E,L),L=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var P=0;P<h.maxMorphTargets;P++)L.push("morphTarget"+P);for(var P=0;P<h.maxMorphNormals;P++)L.push("morphNormal"+P);for(var B in f)L.push(B);return this.attributes=n(u,E,L),this.attributesKeys=Object.keys(this.attributes),this.id=e++,this.code=a,this.usedTimes=1,this.program=E,this.vertexShader=T,this.fragmentShader=C,this}}(),i.WebGLShader=function(){var e=function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")};return function(t,r,n){var o=t.createShader(r);return t.shaderSource(o,n),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)===!1&&i.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(o)&&i.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t.getShaderInfoLog(o),e(n)),o}}(),i.WebGLState=function(e,t){var r=new Uint8Array(16),n=new Uint8Array(16),o=null,a=null,s=null,h=null,l=null,u=null,c=null,p=null,f=null,d=null,m=null,v=null,g=null,y=null,x=null,w=null;this.initAttributes=function(){for(var e=0,t=r.length;t>e;e++)r[e]=0},this.enableAttribute=function(t){r[t]=1,0===n[t]&&(e.enableVertexAttribArray(t),n[t]=1)},this.disableUnusedAttributes=function(){for(var t=0,i=n.length;i>t;t++)n[t]!==r[t]&&(e.disableVertexAttribArray(t),n[t]=0)},this.setBlending=function(r,n,p,f,d,m,v){r!==o&&(r===i.NoBlending?e.disable(e.BLEND):r===i.AdditiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):r===i.SubtractiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):r===i.MultiplyBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):r===i.CustomBlending?e.enable(e.BLEND):(e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),o=r),r===i.CustomBlending?(d=d||n,m=m||p,v=v||f,(n!==a||d!==l)&&(e.blendEquationSeparate(t(n),t(d)),a=n,l=d),(p!==s||f!==h||m!==u||v!==c)&&(e.blendFuncSeparate(t(p),t(f),t(m),t(v)),s=p,h=f,u=m,c=v)):(a=null,s=null,h=null,l=null,u=null,c=null)},this.setDepthTest=function(t){p!==t&&(t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),p=t)},this.setDepthWrite=function(t){f!==t&&(e.depthMask(t),f=t)},this.setColorWrite=function(t){d!==t&&(e.colorMask(t,t,t,t),d=t)},this.setDoubleSided=function(t){m!==t&&(t?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),m=t)},this.setFlipSided=function(t){v!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),v=t)},this.setLineWidth=function(t){t!==g&&(e.lineWidth(t),g=t)},this.setPolygonOffset=function(t,r,n){y!==t&&(t?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),y=t),!t||x===r&&w===n||(e.polygonOffset(r,n),x=r,w=n)},this.reset=function(){for(var e=0;e<n.length;e++)n[e]=0;o=null,p=null,f=null,d=null,m=null,v=null}},i.LensFlarePlugin=function(e,t){function r(t){var r=p.createProgram(),n=p.createShader(p.FRAGMENT_SHADER),i=p.createShader(p.VERTEX_SHADER),o="precision "+e.getPrecision()+" float;\n";return p.shaderSource(n,o+t.fragmentShader),p.shaderSource(i,o+t.vertexShader),p.compileShader(n),p.compileShader(i),p.attachShader(r,n),p.attachShader(r,i),p.linkProgram(r),r}var n,o,a,s,h,l,u,c,p=e.context,f=function(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),t=new Uint16Array([0,1,2,0,2,3]);n=p.createBuffer(),o=p.createBuffer(),p.bindBuffer(p.ARRAY_BUFFER,n),p.bufferData(p.ARRAY_BUFFER,e,p.STATIC_DRAW),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,o),p.bufferData(p.ELEMENT_ARRAY_BUFFER,t,p.STATIC_DRAW),u=p.createTexture(),c=p.createTexture(),p.bindTexture(p.TEXTURE_2D,u),p.texImage2D(p.TEXTURE_2D,0,p.RGB,16,16,0,p.RGB,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.bindTexture(p.TEXTURE_2D,c),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,16,16,0,p.RGBA,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),l=p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var i;i=l?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},a=r(i),s={vertex:p.getAttribLocation(a,"position"),uv:p.getAttribLocation(a,"uv")},h={renderType:p.getUniformLocation(a,"renderType"),map:p.getUniformLocation(a,"map"),occlusionMap:p.getUniformLocation(a,"occlusionMap"),opacity:p.getUniformLocation(a,"opacity"),color:p.getUniformLocation(a,"color"),scale:p.getUniformLocation(a,"scale"),rotation:p.getUniformLocation(a,"rotation"),screenPosition:p.getUniformLocation(a,"screenPosition")}};this.render=function(r,d,m,v){if(0!==t.length){var g=new i.Vector3,y=v/m,x=.5*m,w=.5*v,b=16/v,_=new i.Vector2(b*y,b),S=new i.Vector3(1,1,0),M=new i.Vector2(1,1);void 0===a&&f(),p.useProgram(a),p.enableVertexAttribArray(s.vertex),p.enableVertexAttribArray(s.uv),p.uniform1i(h.occlusionMap,0),p.uniform1i(h.map,1),p.bindBuffer(p.ARRAY_BUFFER,n),p.vertexAttribPointer(s.vertex,2,p.FLOAT,!1,16,0),p.vertexAttribPointer(s.uv,2,p.FLOAT,!1,16,8),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,o),p.disable(p.CULL_FACE),p.depthMask(!1);for(var E=0,T=t.length;T>E;E++){b=16/v,_.set(b*y,b);var C=t[E];if(g.set(C.matrixWorld.elements[12],C.matrixWorld.elements[13],C.matrixWorld.elements[14]),g.applyMatrix4(d.matrixWorldInverse),g.applyProjection(d.projectionMatrix),S.copy(g),M.x=S.x*x+x,M.y=S.y*w+w,l||M.x>0&&M.x<m&&M.y>0&&M.y<v){p.activeTexture(p.TEXTURE1),p.bindTexture(p.TEXTURE_2D,u),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGB,M.x-8,M.y-8,16,16,0),p.uniform1i(h.renderType,0),p.uniform2f(h.scale,_.x,_.y),p.uniform3f(h.screenPosition,S.x,S.y,S.z),p.disable(p.BLEND),p.enable(p.DEPTH_TEST),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),p.activeTexture(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,c),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGBA,M.x-8,M.y-8,16,16,0),p.uniform1i(h.renderType,1),p.disable(p.DEPTH_TEST),p.activeTexture(p.TEXTURE1),p.bindTexture(p.TEXTURE_2D,u),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),C.positionScreen.copy(S),C.customUpdateCallback?C.customUpdateCallback(C):C.updateLensFlares(),p.uniform1i(h.renderType,2),p.enable(p.BLEND);for(var A=0,L=C.lensFlares.length;L>A;A++){var R=C.lensFlares[A];R.opacity>.001&&R.scale>.001&&(S.x=R.x,S.y=R.y,S.z=R.z,b=R.size*R.scale/v,_.x=b*y,_.y=b,p.uniform3f(h.screenPosition,S.x,S.y,S.z),p.uniform2f(h.scale,_.x,_.y),p.uniform1f(h.rotation,R.rotation),p.uniform1f(h.opacity,R.opacity),p.uniform3f(h.color,R.color.r,R.color.g,R.color.b),e.state.setBlending(R.blending,R.blendEquation,R.blendSrc,R.blendDst),e.setTexture(R.texture,1),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0))}}}p.enable(p.CULL_FACE),p.enable(p.DEPTH_TEST),p.depthMask(!0),e.resetGLState()}}},i.ShadowMapPlugin=function(e,t,r,n){function o(e,t,n){if(t.visible){var i=r[t.id];if(i&&t.castShadow&&(t.frustumCulled===!1||m.intersectsObject(t)===!0))for(var a=0,s=i.length;s>a;a++){var h=i[a];t._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),w.push(h)}for(var a=0,s=t.children.length;s>a;a++)o(e,t.children[a],n)}}function a(e,t){var r=new i.DirectionalLight;r.isVirtual=!0,r.onlyShadow=!0,r.castShadow=!0,r.shadowCameraNear=e.shadowCameraNear,r.shadowCameraFar=e.shadowCameraFar,r.shadowCameraLeft=e.shadowCameraLeft,r.shadowCameraRight=e.shadowCameraRight,r.shadowCameraBottom=e.shadowCameraBottom,r.shadowCameraTop=e.shadowCameraTop,r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t],r.shadowMapWidth=e.shadowCascadeWidth[t],r.shadowMapHeight=e.shadowCascadeHeight[t],r.pointsWorld=[],r.pointsFrustum=[];for(var n=r.pointsWorld,o=r.pointsFrustum,a=0;8>a;a++)n[a]=new i.Vector3,o[a]=new i.Vector3;var s=e.shadowCascadeNearZ[t],h=e.shadowCascadeFarZ[t];return o[0].set(-1,-1,s),o[1].set(1,-1,s),o[2].set(-1,1,s),o[3].set(1,1,s),o[4].set(-1,-1,h),o[5].set(1,-1,h),o[6].set(-1,1,h),o[7].set(1,1,h),r}function s(e,t){var r=e.shadowCascadeArray[t];r.position.copy(e.position),r.target.position.copy(e.target.position),r.lookAt(r.target),r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t];var n=e.shadowCascadeNearZ[t],i=e.shadowCascadeFarZ[t],o=r.pointsFrustum;o[0].z=n,o[1].z=n,o[2].z=n,o[3].z=n,o[4].z=i,o[5].z=i,o[6].z=i,o[7].z=i}function h(e,t){var r=t.shadowCamera,n=t.pointsFrustum,i=t.pointsWorld;g.set(1/0,1/0,1/0),y.set(-(1/0),-(1/0),-(1/0));for(var o=0;8>o;o++){var a=i[o];a.copy(n[o]),a.unproject(e),a.applyMatrix4(r.matrixWorldInverse),a.x<g.x&&(g.x=a.x),a.x>y.x&&(y.x=a.x),a.y<g.y&&(g.y=a.y),a.y>y.y&&(y.y=a.y),a.z<g.z&&(g.z=a.z),a.z>y.z&&(y.z=a.z)}r.left=g.x,r.right=y.x,r.top=y.y,r.bottom=g.y,r.updateProjectionMatrix()}function l(e){return e.material instanceof i.MeshFaceMaterial?e.material.materials[0]:e.material}var u,c,p,f,d=e.context,m=new i.Frustum,v=new i.Matrix4,g=new i.Vector3,y=new i.Vector3,x=new i.Vector3,w=[],b=i.ShaderLib.depthRGBA,_=i.UniformsUtils.clone(b.uniforms);u=new i.ShaderMaterial({uniforms:_,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader}),c=new i.ShaderMaterial({uniforms:_,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,morphTargets:!0}),p=new i.ShaderMaterial({uniforms:_,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,skinning:!0}),f=new i.ShaderMaterial({uniforms:_,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,morphTargets:!0,skinning:!0}),u._shadowPass=!0,c._shadowPass=!0,p._shadowPass=!0,f._shadowPass=!0,this.render=function(r,g){if(e.shadowMapEnabled!==!1){var y,b,_,S,M,E,T,C,A,L,R,P,B,F=[],k=0,D=null;for(d.clearColor(1,1,1,1),d.disable(d.BLEND),d.enable(d.CULL_FACE),d.frontFace(d.CCW),e.shadowMapCullFace===i.CullFaceFront?d.cullFace(d.FRONT):d.cullFace(d.BACK),e.state.setDepthTest(!0),y=0,b=t.length;b>y;y++)if(B=t[y],B.castShadow)if(B instanceof i.DirectionalLight&&B.shadowCascade)for(M=0;M<B.shadowCascadeCount;M++){var U;if(B.shadowCascadeArray[M])U=B.shadowCascadeArray[M];else{U=a(B,M),U.originalCamera=g;var z=new i.Gyroscope;z.position.copy(B.shadowCascadeOffset),z.add(U),z.add(U.target),g.add(z),B.shadowCascadeArray[M]=U}s(B,M),F[k]=U,k++}else F[k]=B,k++;for(y=0,b=F.length;b>y;y++){if(B=F[y],!B.shadowMap){var V=i.LinearFilter;e.shadowMapType===i.PCFSoftShadowMap&&(V=i.NearestFilter);var I={minFilter:V,magFilter:V,format:i.RGBAFormat};B.shadowMap=new i.WebGLRenderTarget(B.shadowMapWidth,B.shadowMapHeight,I),B.shadowMapSize=new i.Vector2(B.shadowMapWidth,B.shadowMapHeight),B.shadowMatrix=new i.Matrix4}if(!B.shadowCamera){if(B instanceof i.SpotLight)B.shadowCamera=new i.PerspectiveCamera(B.shadowCameraFov,B.shadowMapWidth/B.shadowMapHeight,B.shadowCameraNear,B.shadowCameraFar);else{if(!(B instanceof i.DirectionalLight)){i.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",B);continue}B.shadowCamera=new i.OrthographicCamera(B.shadowCameraLeft,B.shadowCameraRight,B.shadowCameraTop,B.shadowCameraBottom,B.shadowCameraNear,B.shadowCameraFar)}r.add(B.shadowCamera),r.autoUpdate===!0&&r.updateMatrixWorld()}B.shadowCameraVisible&&!B.cameraHelper&&(B.cameraHelper=new i.CameraHelper(B.shadowCamera),r.add(B.cameraHelper)),B.isVirtual&&U.originalCamera==g&&h(g,B),E=B.shadowMap,T=B.shadowMatrix,C=B.shadowCamera,C.position.setFromMatrixPosition(B.matrixWorld),x.setFromMatrixPosition(B.target.matrixWorld),C.lookAt(x),C.updateMatrixWorld(),C.matrixWorldInverse.getInverse(C.matrixWorld),B.cameraHelper&&(B.cameraHelper.visible=B.shadowCameraVisible),B.shadowCameraVisible&&B.cameraHelper.update(),T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiply(C.projectionMatrix),T.multiply(C.matrixWorldInverse),v.multiplyMatrices(C.projectionMatrix,C.matrixWorldInverse),m.setFromMatrix(v),e.setRenderTarget(E),e.clear(),w.length=0,o(r,r,C);var N,O,j;for(_=0,S=w.length;S>_;_++)R=w[_],P=R.object,A=R.buffer,N=l(P),O=void 0!==P.geometry.morphTargets&&P.geometry.morphTargets.length>0&&N.morphTargets,j=P instanceof i.SkinnedMesh&&N.skinning,L=P.customDepthMaterial?P.customDepthMaterial:j?O?f:p:O?c:u,e.setMaterialFaces(N),A instanceof i.BufferGeometry?e.renderBufferDirect(C,t,D,L,A,P):e.renderBuffer(C,t,D,L,A,P);for(_=0,S=n.length;S>_;_++)R=n[_],P=R.object,P.visible&&P.castShadow&&(P._modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,P.matrixWorld),e.renderImmediateObject(C,t,D,u,P))}var W=e.getClearColor(),H=e.getClearAlpha();d.clearColor(W.r,W.g,W.b,H),d.enable(d.BLEND),e.shadowMapCullFace===i.CullFaceFront&&d.cullFace(d.BACK),e.resetGLState()}}},i.SpritePlugin=function(e,t){function r(){var t=c.createProgram(),r=c.createShader(c.VERTEX_SHADER),n=c.createShader(c.FRAGMENT_SHADER);return c.shaderSource(r,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),c.shaderSource(n,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),c.compileShader(r),c.compileShader(n),c.attachShader(t,r),c.attachShader(t,n),c.linkProgram(t),t}function n(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var o,a,s,h,l,u,c=e.context,p=new i.Vector3,f=new i.Quaternion,d=new i.Vector3,m=function(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),t=new Uint16Array([0,1,2,0,2,3]);o=c.createBuffer(),a=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,o),c.bufferData(c.ARRAY_BUFFER,e,c.STATIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.bufferData(c.ELEMENT_ARRAY_BUFFER,t,c.STATIC_DRAW),s=r(),h={position:c.getAttribLocation(s,"position"),uv:c.getAttribLocation(s,"uv")},l={uvOffset:c.getUniformLocation(s,"uvOffset"),uvScale:c.getUniformLocation(s,"uvScale"),rotation:c.getUniformLocation(s,"rotation"),scale:c.getUniformLocation(s,"scale"),color:c.getUniformLocation(s,"color"),map:c.getUniformLocation(s,"map"),opacity:c.getUniformLocation(s,"opacity"),modelViewMatrix:c.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:c.getUniformLocation(s,"projectionMatrix"),fogType:c.getUniformLocation(s,"fogType"),fogDensity:c.getUniformLocation(s,"fogDensity"),fogNear:c.getUniformLocation(s,"fogNear"),fogFar:c.getUniformLocation(s,"fogFar"),fogColor:c.getUniformLocation(s,"fogColor"),alphaTest:c.getUniformLocation(s,"alphaTest")};var n=document.createElement("canvas");n.width=8,n.height=8;var p=n.getContext("2d");p.fillStyle="white",p.fillRect(0,0,8,8),u=new i.Texture(n),u.needsUpdate=!0};this.render=function(r,v){if(0!==t.length){void 0===s&&m(),c.useProgram(s),c.enableVertexAttribArray(h.position),c.enableVertexAttribArray(h.uv),c.disable(c.CULL_FACE),c.enable(c.BLEND),c.bindBuffer(c.ARRAY_BUFFER,o),c.vertexAttribPointer(h.position,2,c.FLOAT,!1,16,0),c.vertexAttribPointer(h.uv,2,c.FLOAT,!1,16,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),c.uniformMatrix4fv(l.projectionMatrix,!1,v.projectionMatrix.elements),c.activeTexture(c.TEXTURE0),c.uniform1i(l.map,0);var g=0,y=0,x=r.fog;x?(c.uniform3f(l.fogColor,x.color.r,x.color.g,x.color.b),x instanceof i.Fog?(c.uniform1f(l.fogNear,x.near),c.uniform1f(l.fogFar,x.far),c.uniform1i(l.fogType,1),g=1,y=1):x instanceof i.FogExp2&&(c.uniform1f(l.fogDensity,x.density),c.uniform1i(l.fogType,2),g=2,y=2)):(c.uniform1i(l.fogType,0),g=0,y=0);for(var w=0,b=t.length;b>w;w++){var _=t[w];_._modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,_.matrixWorld),_.z=-_._modelViewMatrix.elements[14]}t.sort(n);for(var S=[],w=0,b=t.length;b>w;w++){var _=t[w],M=_.material;c.uniform1f(l.alphaTest,M.alphaTest),c.uniformMatrix4fv(l.modelViewMatrix,!1,_._modelViewMatrix.elements),_.matrixWorld.decompose(p,f,d),S[0]=d.x,S[1]=d.y;var E=0;r.fog&&M.fog&&(E=y),g!==E&&(c.uniform1i(l.fogType,E),g=E),null!==M.map?(c.uniform2f(l.uvOffset,M.map.offset.x,M.map.offset.y),c.uniform2f(l.uvScale,M.map.repeat.x,M.map.repeat.y)):(c.uniform2f(l.uvOffset,0,0),c.uniform2f(l.uvScale,1,1)),c.uniform1f(l.opacity,M.opacity),c.uniform3f(l.color,M.color.r,M.color.g,M.color.b),c.uniform1f(l.rotation,M.rotation),c.uniform2fv(l.scale,S),e.state.setBlending(M.blending,M.blendEquation,M.blendSrc,M.blendDst),e.state.setDepthTest(M.depthTest),e.state.setDepthWrite(M.depthWrite),M.map&&M.map.image&&M.map.image.width?e.setTexture(M.map,0):e.setTexture(u,0),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0)}c.enable(c.CULL_FACE),e.resetGLState()}}},i.GeometryUtils={merge:function(e,t,r){i.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;t instanceof i.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,r)},center:function(e){return i.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},i.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,r,n){var o=new i.ImageLoader;o.crossOrigin=this.crossOrigin;var a=new i.Texture(void 0,t);return o.load(e,function(e){a.image=e,a.needsUpdate=!0,r&&r(a)},void 0,function(e){n&&n(e)}),a.sourceFile=e,a},loadTextureCube:function(e,t,r,n){var o=[],a=new i.ImageLoader;a.crossOrigin=this.crossOrigin;var s=new i.CubeTexture(o,t);s.flipY=!1;for(var h=0,l=function(t){a.load(e[t],function(e){s.images[t]=e,h+=1,6===h&&(s.needsUpdate=!0,r&&r(s))},void 0,n)},u=0,c=e.length;c>u;++u)l(u);return s},loadCompressedTexture:function(){i.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){i.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var r=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]];
},n=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=1|t;var o=e.width,a=e.height,s=document.createElement("canvas");s.width=o,s.height=a;var h=s.getContext("2d");h.drawImage(e,0,0);for(var l=h.getImageData(0,0,o,a).data,u=h.createImageData(o,a),c=u.data,p=0;o>p;p++)for(var f=0;a>f;f++){var d=0>f-1?0:f-1,m=f+1>a-1?a-1:f+1,v=0>p-1?0:p-1,g=p+1>o-1?o-1:p+1,y=[],x=[0,0,l[4*(f*o+p)]/255*t];y.push([-1,0,l[4*(f*o+v)]/255*t]),y.push([-1,-1,l[4*(d*o+v)]/255*t]),y.push([0,-1,l[4*(d*o+p)]/255*t]),y.push([1,-1,l[4*(d*o+g)]/255*t]),y.push([1,0,l[4*(f*o+g)]/255*t]),y.push([1,1,l[4*(m*o+g)]/255*t]),y.push([0,1,l[4*(m*o+p)]/255*t]),y.push([-1,1,l[4*(m*o+v)]/255*t]);for(var w=[],b=y.length,_=0;b>_;_++){var S=y[_],M=y[(_+1)%b];S=n(S,x),M=n(M,x),w.push(i(r(S,M)))}for(var E=[0,0,0],_=0;_<w.length;_++)E[0]+=w[_][0],E[1]+=w[_][1],E[2]+=w[_][2];E[0]/=w.length,E[1]/=w.length,E[2]/=w.length;var T=4*(f*o+p);c[T]=(E[0]+1)/2*255|0,c[T+1]=(E[1]+1)/2*255|0,c[T+2]=255*E[2]|0,c[T+3]=255}return h.putImageData(u,0,0),s},generateDataTexture:function(e,t,r){for(var n=e*t,o=new Uint8Array(3*n),a=Math.floor(255*r.r),s=Math.floor(255*r.g),h=Math.floor(255*r.b),l=0;n>l;l++)o[3*l]=a,o[3*l+1]=s,o[3*l+2]=h;var u=new i.DataTexture(o,e,t,i.RGBFormat);return u.needsUpdate=!0,u}},i.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new i.Object3D,n=0,o=t.length;o>n;n++)r.add(new i.Mesh(e,t[n]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var n=new i.Matrix4;n.getInverse(r.matrixWorld),e.applyMatrix(n),t.remove(e),r.add(e)}},i.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase(),r=this;return r.faces[t]=r.faces[t]||{},r.faces[t][e.cssFontWeight]=r.faces[t][e.cssFontWeight]||{},r.faces[t][e.cssFontWeight][e.cssFontStyle]=e,r.faces[t][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(e){var t,r=this.getFace(),n=this.size/r.resolution,o=0,a=String(e).split(""),s=a.length,h=[];for(t=0;s>t;t++){var l=new i.Path,u=this.extractGlyphPoints(a[t],r,n,o,l);o+=u.offset,h.push(u.path)}var c=o/2;return{paths:h,offset:c}},extractGlyphPoints:function(e,t,r,n,o){var a,s,h,l,u,c,p,f,d,m,v,g,y,x,w,b,_,S,M,E=[],T=t.glyphs[e]||t.glyphs["?"];if(T){if(T.o)for(l=T._cachedOutline||(T._cachedOutline=T.o.split(" ")),c=l.length,p=r,f=r,a=0;c>a;)switch(u=l[a++]){case"m":d=l[a++]*p+n,m=l[a++]*f,o.moveTo(d,m);break;case"l":d=l[a++]*p+n,m=l[a++]*f,o.lineTo(d,m);break;case"q":if(v=l[a++]*p+n,g=l[a++]*f,w=l[a++]*p+n,b=l[a++]*f,o.quadraticCurveTo(w,b,v,g),M=E[E.length-1])for(y=M.x,x=M.y,s=1,h=this.divisions;h>=s;s++){var C=s/h;i.Shape.Utils.b2(C,y,w,v),i.Shape.Utils.b2(C,x,b,g)}break;case"b":if(v=l[a++]*p+n,g=l[a++]*f,w=l[a++]*p+n,b=l[a++]*f,_=l[a++]*p+n,S=l[a++]*f,o.bezierCurveTo(w,b,_,S,v,g),M=E[E.length-1])for(y=M.x,x=M.y,s=1,h=this.divisions;h>=s;s++){var C=s/h;i.Shape.Utils.b3(C,y,w,_,v),i.Shape.Utils.b3(C,x,b,S,g)}}return{offset:T.ha*r,path:o}}}},i.FontUtils.generateShapes=function(e,t){t=t||{};var r=void 0!==t.size?t.size:100,n=void 0!==t.curveSegments?t.curveSegments:4,o=void 0!==t.font?t.font:"helvetiker",a=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";i.FontUtils.size=r,i.FontUtils.divisions=n,i.FontUtils.face=o,i.FontUtils.weight=a,i.FontUtils.style=s;for(var h=i.FontUtils.drawText(e),l=h.paths,u=[],c=0,p=l.length;p>c;c++)Array.prototype.push.apply(u,l[c].toShapes());return u},function(e){var t=1e-10,r=function(e,t){var r=e.length;if(3>r)return null;var a,s,h,l=[],u=[],c=[];if(n(e)>0)for(s=0;r>s;s++)u[s]=s;else for(s=0;r>s;s++)u[s]=r-1-s;var p=r,f=2*p;for(s=p-1;p>2;){if(f--<=0)return i.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()"),t?c:l;if(a=s,a>=p&&(a=0),s=a+1,s>=p&&(s=0),h=s+1,h>=p&&(h=0),o(e,a,s,h,p,u)){var d,m,v,g,y;for(d=u[a],m=u[s],v=u[h],l.push([e[d],e[m],e[v]]),c.push([u[a],u[s],u[h]]),g=s,y=s+1;p>y;g++,y++)u[g]=u[y];p--,f=2*p}}return t?c:l},n=function(e){for(var t=e.length,r=0,n=t-1,i=0;t>i;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},o=function(e,r,n,i,o,a){var s,h,l,u,c,p,f,d,m;if(h=e[a[r]].x,l=e[a[r]].y,u=e[a[n]].x,c=e[a[n]].y,p=e[a[i]].x,f=e[a[i]].y,t>(u-h)*(f-l)-(c-l)*(p-h))return!1;var v,g,y,x,w,b,_,S,M,E,T,C,A,L,R;for(v=p-u,g=f-c,y=h-p,x=l-f,w=u-h,b=c-l,s=0;o>s;s++)if(d=e[a[s]].x,m=e[a[s]].y,!(d===h&&m===l||d===u&&m===c||d===p&&m===f)&&(_=d-h,S=m-l,M=d-u,E=m-c,T=d-p,C=m-f,R=v*E-g*M,A=w*S-b*_,L=y*C-x*T,R>=-t&&L>=-t&&A>=-t))return!1;return!0};return e.Triangulate=r,e.Triangulate.area=n,e}(i.FontUtils),n._typeface_js={faces:i.FontUtils.faces,loadFace:i.FontUtils.loadFace},i.typeface_js=n._typeface_js,i.Audio=function(e){i.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.isPlaying=!1},i.Audio.prototype=Object.create(i.Object3D.prototype),i.Audio.prototype.constructor=i.Audio,i.Audio.prototype.load=function(e){var t=this,r=new XMLHttpRequest;return r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e,t.autoplay&&t.play()})},r.send(),this},i.Audio.prototype.play=function(){if(this.isPlaying===!0)return void i.warn("THREE.Audio: Audio is already playing.");var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.connect(this.panner),e.start(0,this.startTime),this.isPlaying=!0,this.source=e},i.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},i.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},i.Audio.prototype.onEnded=function(){this.isPlaying=!1},i.Audio.prototype.setLoop=function(e){this.source.loop=e},i.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},i.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},i.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},i.Audio.prototype.updateMatrixWorld=function(){var e=new i.Vector3;return function(t){i.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),i.AudioListener=function(){i.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},i.AudioListener.prototype=Object.create(i.Object3D.prototype),i.AudioListener.prototype.constructor=i.AudioListener,i.AudioListener.prototype.updateMatrixWorld=function(){var e=new i.Vector3,t=new i.Quaternion,r=new i.Vector3,n=new i.Vector3,o=new i.Vector3,a=new i.Vector3;return function(s){i.Object3D.prototype.updateMatrixWorld.call(this,s);var h=this.context.listener,l=this.up;this.matrixWorld.decompose(e,t,r),n.set(0,0,-1).applyQuaternion(t),o.subVectors(e,a),h.setPosition(e.x,e.y,e.z),h.setOrientation(n.x,n.y,n.z,l.x,l.y,l.z),h.setVelocity(o.x,o.y,o.z),a.copy(e)}}(),i.Curve=function(){},i.Curve.prototype.getPoint=function(e){return i.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},i.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},i.Curve.prototype.getPoints=function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPoint(t/e));return r},i.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPointAt(t/e));return r},i.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},i.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;e>=r;r++)t=this.getPoint(r/e),o+=t.distanceTo(i),n.push(o),i=t;return this.cacheArcLengths=n,n},i.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},i.Curve.prototype.getUtoTmapping=function(e,t){var r,n=this.getLengths(),i=0,o=n.length;r=t?t:e*n[o-1];for(var a,s=0,h=o-1;h>=s;)if(i=Math.floor(s+(h-s)/2),a=n[i]-r,0>a)s=i+1;else{if(!(a>0)){h=i;break}h=i-1}if(i=h,n[i]==r){var l=i/(o-1);return l}var u=n[i],c=n[i+1],p=c-u,f=(r-u)/p,l=(i+f)/(o-1);return l},i.Curve.prototype.getTangent=function(e){var t=1e-4,r=e-t,n=e+t;0>r&&(r=0),n>1&&(n=1);var i=this.getPoint(r),o=this.getPoint(n),a=o.clone().sub(i);return a.normalize()},i.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},i.Curve.Utils={tangentQuadraticBezier:function(e,t,r,n){return 2*(1-e)*(r-t)+2*e*(n-r)},tangentCubicBezier:function(e,t,r,n,i){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*i},tangentSpline:function(e,t,r,n,i){var o=6*e*e-6*e,a=3*e*e-4*e+1,s=-6*e*e+6*e,h=3*e*e-2*e;return o+a+s+h},interpolate:function(e,t,r,n,i){var o=.5*(r-e),a=.5*(n-t),s=i*i,h=i*s;return(2*t-2*r+o+a)*h+(-3*t+3*r-2*o-a)*s+o*i+t}},i.Curve.create=function(e,t){return e.prototype=Object.create(i.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},i.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},i.CurvePath.prototype=Object.create(i.Curve.prototype),i.CurvePath.prototype.constructor=i.CurvePath,i.CurvePath.prototype.add=function(e){this.curves.push(e)},i.CurvePath.prototype.checkConnection=function(){},i.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new i.LineCurve(t,e))},i.CurvePath.prototype.getPoint=function(e){for(var t,r,n=e*this.getLength(),i=this.getCurveLengths(),o=0;o<i.length;){if(i[o]>=n){t=i[o]-n,r=this.curves[o];var a=1-t/r.getLength();return r.getPointAt(a)}o++}return null},i.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},i.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],r=0,n=this.curves.length;for(e=0;n>e;e++)r+=this.curves[e].getLength(),t.push(r);return this.cacheLengths=t,t},i.CurvePath.prototype.getBoundingBox=function(){var e,t,r,n,o,a,s=this.getPoints();e=t=Number.NEGATIVE_INFINITY,n=o=Number.POSITIVE_INFINITY;var h,l,u,c,p=s[0]instanceof i.Vector3;for(c=p?new i.Vector3:new i.Vector2,l=0,u=s.length;u>l;l++)h=s[l],h.x>e?e=h.x:h.x<n&&(n=h.x),h.y>t?t=h.y:h.y<o&&(o=h.y),p&&(h.z>r?r=h.z:h.z<a&&(a=h.z)),c.add(h);var f={minX:n,minY:o,maxX:e,maxY:t};return p&&(f.maxZ=r,f.minZ=a),f},i.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},i.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},i.CurvePath.prototype.createGeometry=function(e){for(var t=new i.Geometry,r=0;r<e.length;r++)t.vertices.push(new i.Vector3(e[r].x,e[r].y,e[r].z||0));return t},i.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},i.CurvePath.prototype.getTransformedPoints=function(e,t){var r,n,i=this.getPoints(e);for(t||(t=this.bends),r=0,n=t.length;n>r;r++)i=this.getWrapPoints(i,t[r]);return i},i.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var r,n,i=this.getSpacedPoints(e);for(t||(t=this.bends),r=0,n=t.length;n>r;r++)i=this.getWrapPoints(i,t[r]);return i},i.CurvePath.prototype.getWrapPoints=function(e,t){var r,n,i,o,a,s,h=this.getBoundingBox();for(r=0,n=e.length;n>r;r++){i=e[r],o=i.x,a=i.y,s=o/h.maxX,s=t.getUtoTmapping(s,o);var l=t.getPoint(s),u=t.getTangent(s);u.set(-u.y,u.x).multiplyScalar(a),i.x=l.x+u.x,i.y=l.y+u.y}return e},i.Gyroscope=function(){i.Object3D.call(this)},i.Gyroscope.prototype=Object.create(i.Object3D.prototype),i.Gyroscope.prototype.constructor=i.Gyroscope,i.Gyroscope.prototype.updateMatrixWorld=function(){var e=new i.Vector3,t=new i.Quaternion,r=new i.Vector3,n=new i.Vector3,o=new i.Quaternion,a=new i.Vector3;return function(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(n,o,a),this.matrix.decompose(e,t,r),this.matrixWorld.compose(n,t,a)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);for(var s=0,h=this.children.length;h>s;s++)this.children[s].updateMatrixWorld(i)}}(),i.Path=function(e){i.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},i.Path.prototype=Object.create(i.CurvePath.prototype),i.Path.prototype.constructor=i.Path,i.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},i.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;r>t;t++)this.lineTo(e[t].x,e[t].y)},i.Path.prototype.moveTo=function(e,t){var r=Array.prototype.slice.call(arguments);this.actions.push({action:i.PathActions.MOVE_TO,args:r})},i.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,o=n[n.length-2],a=n[n.length-1],s=new i.LineCurve(new i.Vector2(o,a),new i.Vector2(e,t));this.curves.push(s),this.actions.push({action:i.PathActions.LINE_TO,args:r})},i.Path.prototype.quadraticCurveTo=function(e,t,r,n){var o=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,s=a[a.length-2],h=a[a.length-1],l=new i.QuadraticBezierCurve(new i.Vector2(s,h),new i.Vector2(e,t),new i.Vector2(r,n));this.curves.push(l),this.actions.push({action:i.PathActions.QUADRATIC_CURVE_TO,args:o})},i.Path.prototype.bezierCurveTo=function(e,t,r,n,o,a){var s=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,l=h[h.length-2],u=h[h.length-1],c=new i.CubicBezierCurve(new i.Vector2(l,u),new i.Vector2(e,t),new i.Vector2(r,n),new i.Vector2(o,a));this.curves.push(c),this.actions.push({action:i.PathActions.BEZIER_CURVE_TO,args:s})},i.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,n=r[r.length-2],o=r[r.length-1],a=[new i.Vector2(n,o)];Array.prototype.push.apply(a,e);var s=new i.SplineCurve(a);this.curves.push(s),this.actions.push({action:i.PathActions.CSPLINE_THRU,args:t})},i.Path.prototype.arc=function(e,t,r,n,i,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],h=a[a.length-1];this.absarc(e+s,t+h,r,n,i,o)},i.Path.prototype.absarc=function(e,t,r,n,i,o){this.absellipse(e,t,r,r,n,i,o)},i.Path.prototype.ellipse=function(e,t,r,n,i,o,a){var s=this.actions[this.actions.length-1].args,h=s[s.length-2],l=s[s.length-1];this.absellipse(e+h,t+l,r,n,i,o,a)},i.Path.prototype.absellipse=function(e,t,r,n,o,a,s){var h=Array.prototype.slice.call(arguments),l=new i.EllipseCurve(e,t,r,n,o,a,s);this.curves.push(l);var u=l.getPoint(1);h.push(u.x),h.push(u.y),this.actions.push({action:i.PathActions.ELLIPSE,args:h})},i.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var r=[],n=0;e>n;n++)r.push(this.getPoint(n/e));return r},i.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var r,n,o,a,s,h,l,u,c,p,f,d,m,v,g,y,x,w,b=[];for(r=0,n=this.actions.length;n>r;r++)switch(o=this.actions[r],a=o.action,s=o.args,a){case i.PathActions.MOVE_TO:b.push(new i.Vector2(s[0],s[1]));break;case i.PathActions.LINE_TO:b.push(new i.Vector2(s[0],s[1]));break;case i.PathActions.QUADRATIC_CURVE_TO:for(h=s[2],l=s[3],p=s[0],f=s[1],b.length>0?(v=b[b.length-1],d=v.x,m=v.y):(v=this.actions[r-1].args,d=v[v.length-2],m=v[v.length-1]),g=1;e>=g;g++)y=g/e,x=i.Shape.Utils.b2(y,d,p,h),w=i.Shape.Utils.b2(y,m,f,l),b.push(new i.Vector2(x,w));break;case i.PathActions.BEZIER_CURVE_TO:for(h=s[4],l=s[5],p=s[0],f=s[1],u=s[2],c=s[3],b.length>0?(v=b[b.length-1],d=v.x,m=v.y):(v=this.actions[r-1].args,d=v[v.length-2],m=v[v.length-1]),g=1;e>=g;g++)y=g/e,x=i.Shape.Utils.b3(y,d,p,u,h),w=i.Shape.Utils.b3(y,m,f,c,l),b.push(new i.Vector2(x,w));break;case i.PathActions.CSPLINE_THRU:v=this.actions[r-1].args;var _=new i.Vector2(v[v.length-2],v[v.length-1]),S=[_],M=e*s[0].length;S=S.concat(s[0]);var E=new i.SplineCurve(S);for(g=1;M>=g;g++)b.push(E.getPointAt(g/M));break;case i.PathActions.ARC:var T,C=s[0],A=s[1],L=s[2],R=s[3],P=s[4],B=!!s[5],F=P-R,k=2*e;for(g=1;k>=g;g++)y=g/k,B||(y=1-y),T=R+y*F,x=C+L*Math.cos(T),w=A+L*Math.sin(T),b.push(new i.Vector2(x,w));break;case i.PathActions.ELLIPSE:var T,C=s[0],A=s[1],D=s[2],U=s[3],R=s[4],P=s[5],B=!!s[6],F=P-R,k=2*e;for(g=1;k>=g;g++)y=g/k,B||(y=1-y),T=R+y*F,x=C+D*Math.cos(T),w=A+U*Math.sin(T),b.push(new i.Vector2(x,w))}var z=b[b.length-1],V=1e-10;return Math.abs(z.x-b[0].x)<V&&Math.abs(z.y-b[0].y)<V&&b.splice(b.length-1,1),t&&b.push(b[0]),b},i.Path.prototype.toShapes=function(e,t){function r(e){var t,r,n,o,a,s=[],h=new i.Path;for(t=0,r=e.length;r>t;t++)n=e[t],a=n.args,o=n.action,o==i.PathActions.MOVE_TO&&0!=h.actions.length&&(s.push(h),h=new i.Path),h[o].apply(h,a);return 0!=h.actions.length&&s.push(h),s}function n(e){for(var t=[],r=0,n=e.length;n>r;r++){var o=e[r],a=new i.Shape;a.actions=o.actions,a.curves=o.curves,t.push(a)}return t}function o(e,t){for(var r=1e-10,n=t.length,i=!1,o=n-1,a=0;n>a;o=a++){var s=t[o],h=t[a],l=h.x-s.x,u=h.y-s.y;if(Math.abs(u)>r){if(0>u&&(s=t[a],l=-l,h=t[o],u=-u),e.y<s.y||e.y>h.y)continue;if(e.y==s.y){if(e.x==s.x)return!0}else{var c=u*(e.x-s.x)-l*(e.y-s.y);if(0==c)return!0;if(0>c)continue;i=!i}}else{if(e.y!=s.y)continue;if(h.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=h.x)return!0}}return i}var a=r(this.actions);if(0==a.length)return[];if(t===!0)return n(a);var s,h,l,u=[];if(1==a.length)return h=a[0],l=new i.Shape,l.actions=h.actions,l.curves=h.curves,u.push(l),u;var c=!i.Shape.Utils.isClockWise(a[0].getPoints());c=e?!c:c;var p,f=[],d=[],m=[],v=0;d[v]=void 0,m[v]=[];var g,y;for(g=0,y=a.length;y>g;g++)h=a[g],p=h.getPoints(),s=i.Shape.Utils.isClockWise(p),s=e?!s:s,s?(!c&&d[v]&&v++,d[v]={s:new i.Shape,p:p},d[v].s.actions=h.actions,d[v].s.curves=h.curves,c&&v++,m[v]=[]):m[v].push({h:h,p:p[0]});if(!d[0])return n(a);if(d.length>1){for(var x=!1,w=[],b=0,_=d.length;_>b;b++)f[b]=[];for(var b=0,_=d.length;_>b;b++)for(var S=m[b],M=0;M<S.length;M++){for(var E=S[M],T=!0,C=0;C<d.length;C++)o(E.p,d[C].p)&&(b!=C&&w.push({froms:b,tos:C,hole:M}),T?(T=!1,f[C].push(E)):x=!0);T&&f[b].push(E)}w.length>0&&(x||(m=f))}var A,L,R;for(g=0,y=d.length;y>g;g++)for(l=d[g].s,u.push(l),A=m[g],L=0,R=A.length;R>L;L++)l.holes.push(A[L].h);return u},i.Shape=function(){i.Path.apply(this,arguments),this.holes=[]},i.Shape.prototype=Object.create(i.Path.prototype),i.Shape.prototype.constructor=i.Shape,i.Shape.prototype.extrude=function(e){var t=new i.ExtrudeGeometry(this,e);return t},i.Shape.prototype.makeGeometry=function(e){var t=new i.ShapeGeometry(this,e);return t},i.Shape.prototype.getPointsHoles=function(e){var t,r=this.holes.length,n=[];for(t=0;r>t;t++)n[t]=this.holes[t].getTransformedPoints(e,this.bends);return n},i.Shape.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,n=[];for(t=0;r>t;t++)n[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return n},i.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},i.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},i.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},i.Shape.Utils={triangulateShape:function(e,t){function r(e,t,r){return e.x!=t.x?e.x<t.x?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:e.y<t.y?e.y<=r.y&&r.y<=t.y:t.y<=r.y&&r.y<=e.y}function n(e,t,n,i,o){var a=1e-10,s=t.x-e.x,h=t.y-e.y,l=i.x-n.x,u=i.y-n.y,c=e.x-n.x,p=e.y-n.y,f=h*l-s*u,d=h*c-s*p;if(Math.abs(f)>a){var m;if(f>0){if(0>d||d>f)return[];if(m=u*c-l*p,0>m||m>f)return[]}else{if(d>0||f>d)return[];if(m=u*c-l*p,m>0||f>m)return[]}if(0==m)return!o||0!=d&&d!=f?[e]:[];if(m==f)return!o||0!=d&&d!=f?[t]:[];if(0==d)return[n];if(d==f)return[i];var v=m/f;return[{x:e.x+v*s,y:e.y+v*h}]}if(0!=d||u*c!=l*p)return[];var g=0==s&&0==h,y=0==l&&0==u;if(g&&y)return e.x!=n.x||e.y!=n.y?[]:[e];if(g)return r(n,i,e)?[e]:[];if(y)return r(e,t,n)?[n]:[];var x,w,b,_,S,M,E,T;return 0!=s?(e.x<t.x?(x=e,b=e.x,w=t,_=t.x):(x=t,b=t.x,w=e,_=e.x),n.x<i.x?(S=n,E=n.x,M=i,T=i.x):(S=i,E=i.x,M=n,T=n.x)):(e.y<t.y?(x=e,b=e.y,w=t,_=t.y):(x=t,b=t.y,w=e,_=e.y),n.y<i.y?(S=n,E=n.y,M=i,T=i.y):(S=i,E=i.y,M=n,T=n.y)),E>=b?E>_?[]:_==E?o?[]:[S]:T>=_?[S,w]:[S,M]:b>T?[]:b==T?o?[]:[x]:T>=_?[x,w]:[x,M]}function o(e,t,r,n){var i=1e-10,o=t.x-e.x,a=t.y-e.y,s=r.x-e.x,h=r.y-e.y,l=n.x-e.x,u=n.y-e.y,c=o*h-a*s,p=o*u-a*l;if(Math.abs(c)>i){var f=l*h-u*s;return c>0?p>=0&&f>=0:p>=0||f>=0}return p>0}function a(e,t){function r(e,t){var r=y.length-1,n=e-1;0>n&&(n=r);var i=e+1;i>r&&(i=0);var a=o(y[e],y[n],y[i],s[t]);if(!a)return!1;var h=s.length-1,l=t-1;0>l&&(l=h);var u=t+1;return u>h&&(u=0),a=o(s[t],s[l],s[u],y[e]),a?!0:!1}function i(e,t){var r,i,o;for(r=0;r<y.length;r++)if(i=r+1,i%=y.length,o=n(e,t,y[r],y[i],!0),o.length>0)return!0;return!1}function a(e,r){var i,o,a,s,h;for(i=0;i<x.length;i++)for(o=t[x[i]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,h=n(e,r,o[a],o[s],!0),h.length>0)return!0;return!1}for(var s,h,l,u,c,p,f,d,m,v,g,y=e.concat(),x=[],w=[],b=0,_=t.length;_>b;b++)x.push(b);for(var S=0,M=2*x.length;x.length>0;){if(M--,0>M){console.log("Infinite Loop! Holes left:"+x.length+", Probably Hole outside Shape!");break}for(l=S;l<y.length;l++){u=y[l],h=-1;for(var b=0;b<x.length;b++)if(p=x[b],f=u.x+":"+u.y+":"+p,void 0===w[f]){s=t[p];for(var E=0;E<s.length;E++)if(c=s[E],r(l,E)&&!i(u,c)&&!a(u,c)){h=E,x.splice(b,1),d=y.slice(0,l+1),m=y.slice(l),v=s.slice(h),g=s.slice(0,h+1),y=d.concat(v).concat(g).concat(m),S=l;break}if(h>=0)break;w[f]=!0}if(h>=0)break}}return y}for(var s,h,l,u,c,p,f={},d=e.concat(),m=0,v=t.length;v>m;m++)Array.prototype.push.apply(d,t[m]);for(s=0,h=d.length;h>s;s++)c=d[s].x+":"+d[s].y,void 0!==f[c]&&i.warn("THREE.Shape: Duplicate point",c),f[c]=s;var g=a(e,t),y=i.FontUtils.Triangulate(g,!1);for(s=0,h=y.length;h>s;s++)for(u=y[s],l=0;3>l;l++)c=u[l].x+":"+u[l].y,p=f[c],void 0!==p&&(u[l]=p);return y.concat()},isClockWise:function(e){return i.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,r,n){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,n)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){var r=1-e;return 3*r*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,n,i){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,n)+this.b3p3(e,i)}},i.LineCurve=function(e,t){this.v1=e,this.v2=t},i.LineCurve.prototype=Object.create(i.Curve.prototype),i.LineCurve.prototype.constructor=i.LineCurve,i.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},i.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},i.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},i.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},i.QuadraticBezierCurve.prototype=Object.create(i.Curve.prototype),i.QuadraticBezierCurve.prototype.constructor=i.QuadraticBezierCurve,i.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new i.Vector2;return t.x=i.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=i.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t},i.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new i.Vector2;return t.x=i.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),t.y=i.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t.normalize()},i.CubicBezierCurve=function(e,t,r,n){this.v0=e,this.v1=t,this.v2=r,this.v3=n},i.CubicBezierCurve.prototype=Object.create(i.Curve.prototype),i.CubicBezierCurve.prototype.constructor=i.CubicBezierCurve,i.CubicBezierCurve.prototype.getPoint=function(e){var t,r;return t=i.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=i.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new i.Vector2(t,r)},i.CubicBezierCurve.prototype.getTangent=function(e){var t,r;t=i.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=i.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var n=new i.Vector2(t,r);return n.normalize(),n},i.SplineCurve=function(e){this.points=void 0==e?[]:e},i.SplineCurve.prototype=Object.create(i.Curve.prototype),i.SplineCurve.prototype.constructor=i.SplineCurve,i.SplineCurve.prototype.getPoint=function(e){var t=this.points,r=(t.length-1)*e,n=Math.floor(r),o=r-n,a=t[0==n?n:n-1],s=t[n],h=t[n>t.length-2?t.length-1:n+1],l=t[n>t.length-3?t.length-1:n+2],u=new i.Vector2;return u.x=i.Curve.Utils.interpolate(a.x,s.x,h.x,l.x,o),u.y=i.Curve.Utils.interpolate(a.y,s.y,h.y,l.y,o),u},i.EllipseCurve=function(e,t,r,n,i,o,a){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=n,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=a},i.EllipseCurve.prototype=Object.create(i.Curve.prototype),i.EllipseCurve.prototype.constructor=i.EllipseCurve,i.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;0>t&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI);var r;r=this.aClockwise===!0?this.aEndAngle+(1-e)*(2*Math.PI-t):this.aStartAngle+e*t;var n=new i.Vector2;return n.x=this.aX+this.xRadius*Math.cos(r),n.y=this.aY+this.yRadius*Math.sin(r),n},i.ArcCurve=function(e,t,r,n,o,a){i.EllipseCurve.call(this,e,t,r,r,n,o,a)},i.ArcCurve.prototype=Object.create(i.EllipseCurve.prototype),i.ArcCurve.prototype.constructor=i.ArcCurve,i.LineCurve3=i.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new i.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),i.QuadraticBezierCurve3=i.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t=new i.Vector3;return t.x=i.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=i.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t.z=i.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),t}),i.CubicBezierCurve3=i.Curve.create(function(e,t,r,n){this.v0=e,this.v1=t,this.v2=r,this.v3=n},function(e){var t=new i.Vector3;return t.x=i.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t.y=i.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t.z=i.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),t}),i.SplineCurve3=i.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=this.points,r=(t.length-1)*e,n=Math.floor(r),o=r-n,a=t[0==n?n:n-1],s=t[n],h=t[n>t.length-2?t.length-1:n+1],l=t[n>t.length-3?t.length-1:n+2],u=new i.Vector3;return u.x=i.Curve.Utils.interpolate(a.x,s.x,h.x,l.x,o),u.y=i.Curve.Utils.interpolate(a.y,s.y,h.y,l.y,o),u.z=i.Curve.Utils.interpolate(a.z,s.z,h.z,l.z,o),u}),i.ClosedSplineCurve3=i.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=this.points,r=(t.length-0)*e,n=Math.floor(r),o=r-n;n+=n>0?0:(Math.floor(Math.abs(n)/t.length)+1)*t.length;var a=t[(n-1)%t.length],s=t[n%t.length],h=t[(n+1)%t.length],l=t[(n+2)%t.length],u=new i.Vector3;return u.x=i.Curve.Utils.interpolate(a.x,s.x,h.x,l.x,o),u.y=i.Curve.Utils.interpolate(a.y,s.y,h.y,l.y,o),u.z=i.Curve.Utils.interpolate(a.z,s.z,h.z,l.z,o),u}),i.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){i.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){i.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){i.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(e.initialized===!0)return e;for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++)if(e.hierarchy[t].keys[r].time<0&&(e.hierarchy[t].keys[r].time=0),void 0!==e.hierarchy[t].keys[r].rot&&!(e.hierarchy[t].keys[r].rot instanceof i.Quaternion)){var n=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=(new i.Quaternion).fromArray(n)}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){for(var o={},r=0;r<e.hierarchy[t].keys.length;r++)for(var a=0;a<e.hierarchy[t].keys[r].morphTargets.length;a++){var s=e.hierarchy[t].keys[r].morphTargets[a];o[s]=-1}e.hierarchy[t].usedMorphTargets=o;for(var r=0;r<e.hierarchy[t].keys.length;r++){var h={};for(var s in o){for(var a=0;a<e.hierarchy[t].keys[r].morphTargets.length;a++)if(e.hierarchy[t].keys[r].morphTargets[a]===s){h[s]=e.hierarchy[t].keys[r].morphTargetsInfluences[a];break}a===e.hierarchy[t].keys[r].morphTargets.length&&(h[s]=0)}e.hierarchy[t].keys[r].morphTargetsInfluences=h}}for(var r=1;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time&&(e.hierarchy[t].keys.splice(r,1),r--);for(var r=0;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].index=r}return e.initialized=!0,e},parse:function(e){var t=function(e,r){r.push(e);for(var n=0;n<e.children.length;n++)t(e.children[n],r)},r=[];if(e instanceof i.SkinnedMesh)for(var n=0;n<e.skeleton.bones.length;n++)r.push(e.skeleton.bones[n]);else t(e,r);return r},play:function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},stop:function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},update:function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].resetBlendWeights();for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)}},i.Animation=function(e,t){this.root=e,this.data=i.AnimationHandler.init(t),this.hierarchy=i.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=i.AnimationHandler.LINEAR},i.Animation.prototype={constructor:i.Animation,keyTypes:["pos","rot","scl"],play:function(e,t){this.currentTime=void 0!==e?e:0,this.weight=void 0!==t?t:1,this.isPlaying=!0,this.reset(),i.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,i.AnimationHandler.stop(this)},reset:function(){for(var e=0,t=this.hierarchy.length;t>e;e++){var r=this.hierarchy[e];void 0===r.animationCache&&(r.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});var n=this.data.name,i=r.animationCache.animations,o=i[n];void 0===o&&(o={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:r.matrix},i[n]=o);for(var a=0;3>a;a++){for(var s=this.keyTypes[a],h=this.data.hierarchy[e].keys[0],l=this.getNextKeyWith(s,e,1);l.time<this.currentTime&&l.index>h.index;)h=l,l=this.getNextKeyWith(s,e,l.index+1);o.prevKey[s]=h,o.nextKey[s]=l}}},resetBlendWeights:function(){for(var e=0,t=this.hierarchy.length;t>e;e++){var r=this.hierarchy[e],n=r.animationCache;if(void 0!==n){var i=n.blending;i.positionWeight=0,i.quaternionWeight=0,i.scaleWeight=0}}},update:function(){var e=[],t=new i.Vector3,r=new i.Vector3,n=new i.Quaternion,o=function(e,t){var r,n,i,o,s,h,l,u,c,p=[],f=[];return r=(e.length-1)*t,n=Math.floor(r),i=r-n,p[0]=0===n?n:n-1,p[1]=n,p[2]=n>e.length-2?n:n+1,p[3]=n>e.length-3?n:n+2,h=e[p[0]],l=e[p[1]],u=e[p[2]],c=e[p[3]],o=i*i,s=i*o,f[0]=a(h[0],l[0],u[0],c[0],i,o,s),f[1]=a(h[1],l[1],u[1],c[1],i,o,s),f[2]=a(h[2],l[2],u[2],c[2],i,o,s),f},a=function(e,t,r,n,i,o,a){var s=.5*(r-e),h=.5*(n-t);return(2*(t-r)+s+h)*a+(-3*(t-r)-2*s-h)*o+s*i+t};return function(a){if(this.isPlaying!==!1&&(this.currentTime+=a*this.timeScale,0!==this.weight)){var s=this.data.length;(this.currentTime>s||this.currentTime<0)&&(this.loop?(this.currentTime%=s,
this.currentTime<0&&(this.currentTime+=s),this.reset()):this.stop());for(var h=0,l=this.hierarchy.length;l>h;h++)for(var u=this.hierarchy[h],c=u.animationCache.animations[this.data.name],p=u.animationCache.blending,f=0;3>f;f++){var d=this.keyTypes[f],m=c.prevKey[d],v=c.nextKey[d];if(this.timeScale>0&&v.time<=this.currentTime||this.timeScale<0&&m.time>=this.currentTime){for(m=this.data.hierarchy[h].keys[0],v=this.getNextKeyWith(d,h,1);v.time<this.currentTime&&v.index>m.index;)m=v,v=this.getNextKeyWith(d,h,v.index+1);c.prevKey[d]=m,c.nextKey[d]=v}var g=(this.currentTime-m.time)/(v.time-m.time),y=m[d],x=v[d];if(0>g&&(g=0),g>1&&(g=1),"pos"===d){if(this.interpolationType===i.AnimationHandler.LINEAR){r.x=y[0]+(x[0]-y[0])*g,r.y=y[1]+(x[1]-y[1])*g,r.z=y[2]+(x[2]-y[2])*g;var w=this.weight/(this.weight+p.positionWeight);u.position.lerp(r,w),p.positionWeight+=this.weight}else if(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",h,m.index-1).pos,e[1]=y,e[2]=x,e[3]=this.getNextKeyWith("pos",h,v.index+1).pos,g=.33*g+.33;var b=o(e,g),w=this.weight/(this.weight+p.positionWeight);p.positionWeight+=this.weight;var _=u.position;if(_.x=_.x+(b[0]-_.x)*w,_.y=_.y+(b[1]-_.y)*w,_.z=_.z+(b[2]-_.z)*w,this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){var S=o(e,1.01*g);t.set(S[0],S[1],S[2]),t.sub(_),t.y=0,t.normalize();var M=Math.atan2(t.x,t.z);u.rotation.set(0,M,0)}}}else if("rot"===d)if(i.Quaternion.slerp(y,x,n,g),0===p.quaternionWeight)u.quaternion.copy(n),p.quaternionWeight=this.weight;else{var w=this.weight/(this.weight+p.quaternionWeight);i.Quaternion.slerp(u.quaternion,n,u.quaternion,w),p.quaternionWeight+=this.weight}else if("scl"===d){r.x=y[0]+(x[0]-y[0])*g,r.y=y[1]+(x[1]-y[1])*g,r.z=y[2]+(x[2]-y[2])*g;var w=this.weight/(this.weight+p.scaleWeight);u.scale.lerp(r,w),p.scaleWeight+=this.weight}}return!0}}}(),getNextKeyWith:function(e,t,r){var n=this.data.hierarchy[t].keys;for(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD?r=r<n.length-1?r:n.length-1:r%=n.length;r<n.length;r++)if(void 0!==n[r][e])return n[r];return this.data.hierarchy[t].keys[0]},getPrevKeyWith:function(e,t,r){var n=this.data.hierarchy[t].keys;for(r=this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD?r>0?r:0:r>=0?r:r+n.length;r>=0;r--)if(void 0!==n[r][e])return n[r];return this.data.hierarchy[t].keys[n.length-1]}},i.KeyFrameAnimation=function(e){this.root=e.node,this.data=i.AnimationHandler.init(e),this.hierarchy=i.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var t=0,r=this.hierarchy.length;r>t;t++){var n=this.data.hierarchy[t].keys,o=this.data.hierarchy[t].sids,a=this.hierarchy[t];if(n.length&&o){for(var s=0;s<o.length;s++){var h=o[s],l=this.getNextKeyWith(h,t,0);l&&l.apply(h)}a.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),a.matrixWorldNeedsUpdate=!0}}},i.KeyFrameAnimation.prototype={constructor:i.KeyFrameAnimation,play:function(e){if(this.currentTime=void 0!==e?e:0,this.isPlaying===!1){this.isPlaying=!0;var t,r,n,o=this.hierarchy.length;for(t=0;o>t;t++){r=this.hierarchy[t],n=this.data.hierarchy[t],void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=r.matrix);var a=this.data.hierarchy[t].keys;a.length&&(n.animationCache.prevKey=a[0],n.animationCache.nextKey=a[1],this.startTime=Math.min(a[0].time,this.startTime),this.endTime=Math.max(a[a.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,i.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,this.isPaused=!1,i.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],r=this.data.hierarchy[e];if(void 0!==r.animationCache){var n=r.animationCache.originalMatrix;n.copy(t.matrix),t.matrix=n,delete r.animationCache}}},update:function(e){if(this.isPlaying!==!1){this.currentTime+=e*this.timeScale;var t=this.data.length;this.loop===!0&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var r=0,n=this.hierarchy.length;n>r;r++){var i=this.hierarchy[r],o=this.data.hierarchy[r],a=o.keys,s=o.animationCache;if(a.length){var h=s.prevKey,l=s.nextKey;if(l.time<=this.currentTime){for(;l.time<this.currentTime&&l.index>h.index;)h=l,l=a[h.index+1];s.prevKey=h,s.nextKey=l}l.time>=this.currentTime?h.interpolate(l,this.currentTime):h.interpolate(l,l.time),this.data.hierarchy[r].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(e,t,r){var n=this.data.hierarchy[t].keys;for(r%=n.length;r<n.length;r++)if(n[r].hasTarget(e))return n[r];return n[0]},getPrevKeyWith:function(e,t,r){var n=this.data.hierarchy[t].keys;for(r=r>=0?r:r+n.length;r>=0;r--)if(n[r].hasTarget(e))return n[r];return n[n.length-1]}},i.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.lastFrame=0,this.currentFrame=0,this.isPlaying=!1},i.MorphAnimation.prototype={constructor:i.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(e){if(this.isPlaying!==!1){this.currentTime+=e,this.loop===!0&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames,r=Math.floor(this.currentTime/t),n=this.mesh.morphTargetInfluences;r!=this.currentFrame&&(n[this.lastFrame]=0,n[this.currentFrame]=1,n[r]=0,this.lastFrame=this.currentFrame,this.currentFrame=r),n[r]=this.currentTime%t/t,n[this.lastFrame]=1-n[r]}}},i.BoxGeometry=function(e,t,r,n,o,a){function s(e,t,r,n,o,a,s,l){var u,c,p,f=h.widthSegments,d=h.heightSegments,m=o/2,v=a/2,g=h.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?u="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(u="y",d=h.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(u="x",f=h.depthSegments);var y=f+1,x=d+1,w=o/f,b=a/d,_=new i.Vector3;for(_[u]=s>0?1:-1,p=0;x>p;p++)for(c=0;y>c;c++){var S=new i.Vector3;S[e]=(c*w-m)*r,S[t]=(p*b-v)*n,S[u]=s,h.vertices.push(S)}for(p=0;d>p;p++)for(c=0;f>c;c++){var M=c+y*p,E=c+y*(p+1),T=c+1+y*(p+1),C=c+1+y*p,A=new i.Vector2(c/f,1-p/d),L=new i.Vector2(c/f,1-(p+1)/d),R=new i.Vector2((c+1)/f,1-(p+1)/d),P=new i.Vector2((c+1)/f,1-p/d),B=new i.Face3(M+g,E+g,C+g);B.normal.copy(_),B.vertexNormals.push(_.clone(),_.clone(),_.clone()),B.materialIndex=l,h.faces.push(B),h.faceVertexUvs[0].push([A,L,P]),B=new i.Face3(E+g,T+g,C+g),B.normal.copy(_),B.vertexNormals.push(_.clone(),_.clone(),_.clone()),B.materialIndex=l,h.faces.push(B),h.faceVertexUvs[0].push([L.clone(),R,P.clone()])}}i.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:o,depthSegments:a},this.widthSegments=n||1,this.heightSegments=o||1,this.depthSegments=a||1;var h=this,l=e/2,u=t/2,c=r/2;s("z","y",-1,-1,r,t,l,0),s("z","y",1,-1,r,t,-l,1),s("x","z",1,1,e,r,u,2),s("x","z",1,-1,e,r,-u,3),s("x","y",1,-1,e,t,c,4),s("x","y",-1,-1,e,t,-c,5),this.mergeVertices()},i.BoxGeometry.prototype=Object.create(i.Geometry.prototype),i.BoxGeometry.prototype.constructor=i.BoxGeometry,i.CircleGeometry=function(e,t,r,n){i.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||50,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var o,a=[],s=new i.Vector3,h=new i.Vector2(.5,.5);for(this.vertices.push(s),a.push(h),o=0;t>=o;o++){var l=new i.Vector3,u=r+o/t*n;l.x=e*Math.cos(u),l.y=e*Math.sin(u),this.vertices.push(l),a.push(new i.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var c=new i.Vector3(0,0,1);for(o=1;t>=o;o++)this.faces.push(new i.Face3(o,o+1,0,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([a[o].clone(),a[o+1].clone(),h.clone()]);this.computeFaceNormals(),this.boundingSphere=new i.Sphere(new i.Vector3,e)},i.CircleGeometry.prototype=Object.create(i.Geometry.prototype),i.CircleGeometry.prototype.constructor=i.CircleGeometry,i.CubeGeometry=function(e,t,r,n,o,a){return i.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry."),new i.BoxGeometry(e,t,r,n,o,a)},i.CylinderGeometry=function(e,t,r,n,o,a,s,h){i.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:o,openEnded:a,thetaStart:s,thetaLength:h},e=void 0!==e?e:20,t=void 0!==t?t:20,r=void 0!==r?r:100,n=n||8,o=o||1,a=void 0!==a?a:!1,s=void 0!==s?s:0,h=void 0!==h?h:2*Math.PI;var l,u,c=r/2,p=[],f=[];for(u=0;o>=u;u++){var d=[],m=[],v=u/o,g=v*(t-e)+e;for(l=0;n>=l;l++){var y=l/n,x=new i.Vector3;x.x=g*Math.sin(y*h+s),x.y=-v*r+c,x.z=g*Math.cos(y*h+s),this.vertices.push(x),d.push(this.vertices.length-1),m.push(new i.Vector2(y,1-v))}p.push(d),f.push(m)}var w,b,_=(t-e)/r;for(l=0;n>l;l++)for(0!==e?(w=this.vertices[p[0][l]].clone(),b=this.vertices[p[0][l+1]].clone()):(w=this.vertices[p[1][l]].clone(),b=this.vertices[p[1][l+1]].clone()),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*_).normalize(),b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*_).normalize(),u=0;o>u;u++){var S=p[u][l],M=p[u+1][l],E=p[u+1][l+1],T=p[u][l+1],C=w.clone(),A=w.clone(),L=b.clone(),R=b.clone(),P=f[u][l].clone(),B=f[u+1][l].clone(),F=f[u+1][l+1].clone(),k=f[u][l+1].clone();this.faces.push(new i.Face3(S,M,T,[C,A,R])),this.faceVertexUvs[0].push([P,B,k]),this.faces.push(new i.Face3(M,E,T,[A.clone(),L,R.clone()])),this.faceVertexUvs[0].push([B.clone(),F,k.clone()])}if(a===!1&&e>0)for(this.vertices.push(new i.Vector3(0,c,0)),l=0;n>l;l++){var S=p[0][l],M=p[0][l+1],E=this.vertices.length-1,C=new i.Vector3(0,1,0),A=new i.Vector3(0,1,0),L=new i.Vector3(0,1,0),P=f[0][l].clone(),B=f[0][l+1].clone(),F=new i.Vector2(B.x,0);this.faces.push(new i.Face3(S,M,E,[C,A,L])),this.faceVertexUvs[0].push([P,B,F])}if(a===!1&&t>0)for(this.vertices.push(new i.Vector3(0,-c,0)),l=0;n>l;l++){var S=p[o][l+1],M=p[o][l],E=this.vertices.length-1,C=new i.Vector3(0,-1,0),A=new i.Vector3(0,-1,0),L=new i.Vector3(0,-1,0),P=f[o][l+1].clone(),B=f[o][l].clone(),F=new i.Vector2(B.x,1);this.faces.push(new i.Face3(S,M,E,[C,A,L])),this.faceVertexUvs[0].push([P,B,F])}this.computeFaceNormals()},i.CylinderGeometry.prototype=Object.create(i.Geometry.prototype),i.CylinderGeometry.prototype.constructor=i.CylinderGeometry,i.ExtrudeGeometry=function(e,t){return"undefined"==typeof e?void(e=[]):(i.Geometry.call(this),this.type="ExtrudeGeometry",e=e instanceof Array?e:[e],this.addShapeList(e,t),void this.computeFaceNormals())},i.ExtrudeGeometry.prototype=Object.create(i.Geometry.prototype),i.ExtrudeGeometry.prototype.constructor=i.ExtrudeGeometry,i.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,n=0;r>n;n++){var i=e[n];this.addShape(i,t)}},i.ExtrudeGeometry.prototype.addShape=function(e,t){function r(e,t,r){return t||i.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}function n(e,t,r){var n,o,a=1e-10,s=1,h=e.x-t.x,l=e.y-t.y,u=r.x-e.x,c=r.y-e.y,p=h*h+l*l,f=h*c-l*u;if(Math.abs(f)>a){var d=Math.sqrt(p),m=Math.sqrt(u*u+c*c),v=t.x-l/d,g=t.y+h/d,y=r.x-c/m,x=r.y+u/m,w=((y-v)*c-(x-g)*u)/(h*c-l*u);n=v+h*w-e.x,o=g+l*w-e.y;var b=n*n+o*o;if(2>=b)return new i.Vector2(n,o);s=Math.sqrt(b/2)}else{var _=!1;h>a?u>a&&(_=!0):-a>h?-a>u&&(_=!0):Math.sign(l)==Math.sign(c)&&(_=!0),_?(n=-l,o=h,s=Math.sqrt(p)):(n=h,o=l,s=Math.sqrt(p/2))}return new i.Vector2(n/s,o/s)}function o(){if(w){var e=0,t=G*e;for(Y=0;q>Y;Y++)H=z[Y],l(H[2]+t,H[1]+t,H[0]+t);for(e=_+2*x,t=G*e,Y=0;q>Y;Y++)H=z[Y],l(H[0]+t,H[1]+t,H[2]+t)}else{for(Y=0;q>Y;Y++)H=z[Y],l(H[2],H[1],H[0]);for(Y=0;q>Y;Y++)H=z[Y],l(H[0]+G*_,H[1]+G*_,H[2]+G*_)}}function a(){var e=0;for(s(V,e),e+=V.length,L=0,R=D.length;R>L;L++)A=D[L],s(A,e),e+=A.length}function s(e,t){var r,n;for(Y=e.length;--Y>=0;){r=Y,n=Y-1,0>n&&(n=e.length-1);var i=0,o=_+2*x;for(i=0;o>i;i++){var a=G*i,s=G*(i+1),h=t+r+a,l=t+n+a,c=t+n+s,p=t+r+s;u(h,l,c,p,e,i,o,r,n)}}}function h(e,t,r){P.vertices.push(new i.Vector3(e,t,r))}function l(e,t,r){e+=B,t+=B,r+=B,P.faces.push(new i.Face3(e,t,r,null,null,E));var n=C.generateTopUV(P,e,t,r);P.faceVertexUvs[0].push(n)}function u(e,t,r,n,o,a,s,h,l){e+=B,t+=B,r+=B,n+=B,P.faces.push(new i.Face3(e,t,n,null,null,T)),P.faces.push(new i.Face3(t,r,n,null,null,T));var u=C.generateSideWallUV(P,e,t,r,n);P.faceVertexUvs[0].push([u[0],u[1],u[3]]),P.faceVertexUvs[0].push([u[1],u[2],u[3]])}var c,p,f,d,m,v=void 0!==t.amount?t.amount:100,g=void 0!==t.bevelThickness?t.bevelThickness:6,y=void 0!==t.bevelSize?t.bevelSize:g-2,x=void 0!==t.bevelSegments?t.bevelSegments:3,w=void 0!==t.bevelEnabled?t.bevelEnabled:!0,b=void 0!==t.curveSegments?t.curveSegments:12,_=void 0!==t.steps?t.steps:1,S=t.extrudePath,M=!1,E=t.material,T=t.extrudeMaterial,C=void 0!==t.UVGenerator?t.UVGenerator:i.ExtrudeGeometry.WorldUVGenerator;S&&(c=S.getSpacedPoints(_),M=!0,w=!1,p=void 0!==t.frames?t.frames:new i.TubeGeometry.FrenetFrames(S,_,!1),f=new i.Vector3,d=new i.Vector3,m=new i.Vector3),w||(x=0,g=0,y=0);var A,L,R,P=this,B=this.vertices.length,F=e.extractPoints(b),k=F.shape,D=F.holes,U=!i.Shape.Utils.isClockWise(k);if(U){for(k=k.reverse(),L=0,R=D.length;R>L;L++)A=D[L],i.Shape.Utils.isClockWise(A)&&(D[L]=A.reverse());U=!1}var z=i.Shape.Utils.triangulateShape(k,D),V=k;for(L=0,R=D.length;R>L;L++)A=D[L],k=k.concat(A);for(var I,N,O,j,W,H,G=k.length,q=z.length,X=[],Y=0,K=V.length,Q=K-1,Z=Y+1;K>Y;Y++,Q++,Z++)Q===K&&(Q=0),Z===K&&(Z=0),X[Y]=n(V[Y],V[Q],V[Z]);var J,$=[],ee=X.concat();for(L=0,R=D.length;R>L;L++){for(A=D[L],J=[],Y=0,K=A.length,Q=K-1,Z=Y+1;K>Y;Y++,Q++,Z++)Q===K&&(Q=0),Z===K&&(Z=0),J[Y]=n(A[Y],A[Q],A[Z]);$.push(J),ee=ee.concat(J)}for(I=0;x>I;I++){for(O=I/x,j=g*(1-O),N=y*Math.sin(O*Math.PI/2),Y=0,K=V.length;K>Y;Y++)W=r(V[Y],X[Y],N),h(W.x,W.y,-j);for(L=0,R=D.length;R>L;L++)for(A=D[L],J=$[L],Y=0,K=A.length;K>Y;Y++)W=r(A[Y],J[Y],N),h(W.x,W.y,-j)}for(N=y,Y=0;G>Y;Y++)W=w?r(k[Y],ee[Y],N):k[Y],M?(d.copy(p.normals[0]).multiplyScalar(W.x),f.copy(p.binormals[0]).multiplyScalar(W.y),m.copy(c[0]).add(d).add(f),h(m.x,m.y,m.z)):h(W.x,W.y,0);var te;for(te=1;_>=te;te++)for(Y=0;G>Y;Y++)W=w?r(k[Y],ee[Y],N):k[Y],M?(d.copy(p.normals[te]).multiplyScalar(W.x),f.copy(p.binormals[te]).multiplyScalar(W.y),m.copy(c[te]).add(d).add(f),h(m.x,m.y,m.z)):h(W.x,W.y,v/_*te);for(I=x-1;I>=0;I--){for(O=I/x,j=g*(1-O),N=y*Math.sin(O*Math.PI/2),Y=0,K=V.length;K>Y;Y++)W=r(V[Y],X[Y],N),h(W.x,W.y,v+j);for(L=0,R=D.length;R>L;L++)for(A=D[L],J=$[L],Y=0,K=A.length;K>Y;Y++)W=r(A[Y],J[Y],N),M?h(W.x,W.y+c[_-1].y,c[_-1].x+j):h(W.x,W.y,v+j)}o(),a()},i.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,n){var o=e.vertices,a=o[t],s=o[r],h=o[n];return[new i.Vector2(a.x,a.y),new i.Vector2(s.x,s.y),new i.Vector2(h.x,h.y)]},generateSideWallUV:function(e,t,r,n,o){var a=e.vertices,s=a[t],h=a[r],l=a[n],u=a[o];return Math.abs(s.y-h.y)<.01?[new i.Vector2(s.x,1-s.z),new i.Vector2(h.x,1-h.z),new i.Vector2(l.x,1-l.z),new i.Vector2(u.x,1-u.z)]:[new i.Vector2(s.y,1-s.z),new i.Vector2(h.y,1-h.z),new i.Vector2(l.y,1-l.z),new i.Vector2(u.y,1-u.z)]}},i.ShapeGeometry=function(e,t){i.Geometry.call(this),this.type="ShapeGeometry",e instanceof Array==!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},i.ShapeGeometry.prototype=Object.create(i.Geometry.prototype),i.ShapeGeometry.prototype.constructor=i.ShapeGeometry,i.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,n=e.length;n>r;r++)this.addShape(e[r],t);return this},i.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r,n,o,a=void 0!==t.curveSegments?t.curveSegments:12,s=t.material,h=void 0===t.UVGenerator?i.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=this.vertices.length,u=e.extractPoints(a),c=u.shape,p=u.holes,f=!i.Shape.Utils.isClockWise(c);if(f){for(c=c.reverse(),r=0,n=p.length;n>r;r++)o=p[r],i.Shape.Utils.isClockWise(o)&&(p[r]=o.reverse());f=!1}var d=i.Shape.Utils.triangulateShape(c,p);for(r=0,n=p.length;n>r;r++)o=p[r],c=c.concat(o);var m,v,g=c.length,y=d.length;for(r=0;g>r;r++)m=c[r],this.vertices.push(new i.Vector3(m.x,m.y,0));for(r=0;y>r;r++){v=d[r];var x=v[0]+l,w=v[1]+l,b=v[2]+l;this.faces.push(new i.Face3(x,w,b,null,null,s)),this.faceVertexUvs[0].push(h.generateTopUV(this,x,w,b))}},i.LatheGeometry=function(e,t,r,n){i.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=t||12,r=r||0,n=n||2*Math.PI;for(var o=1/(e.length-1),a=1/t,s=0,h=t;h>=s;s++)for(var l=r+s*a*n,u=Math.cos(l),c=Math.sin(l),p=0,f=e.length;f>p;p++){var d=e[p],m=new i.Vector3;m.x=u*d.x-c*d.y,m.y=c*d.x+u*d.y,m.z=d.z,this.vertices.push(m)}for(var v=e.length,s=0,h=t;h>s;s++)for(var p=0,f=e.length-1;f>p;p++){var g=p+v*s,y=g,x=g+v,u=g+1+v,w=g+1,b=s*a,_=p*o,S=b+a,M=_+o;this.faces.push(new i.Face3(y,x,w)),this.faceVertexUvs[0].push([new i.Vector2(b,_),new i.Vector2(S,_),new i.Vector2(b,M)]),this.faces.push(new i.Face3(x,u,w)),this.faceVertexUvs[0].push([new i.Vector2(S,_),new i.Vector2(S,M),new i.Vector2(b,M)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},i.LatheGeometry.prototype=Object.create(i.Geometry.prototype),i.LatheGeometry.prototype.constructor=i.LatheGeometry,i.PlaneGeometry=function(e,t,r,n){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint."),i.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new i.PlaneBufferGeometry(e,t,r,n))},i.PlaneGeometry.prototype=Object.create(i.Geometry.prototype),i.PlaneGeometry.prototype.constructor=i.PlaneGeometry,i.PlaneBufferGeometry=function(e,t,r,n){i.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};for(var o=e/2,a=t/2,s=r||1,h=n||1,l=s+1,u=h+1,c=e/s,p=t/h,f=new Float32Array(l*u*3),d=new Float32Array(l*u*3),m=new Float32Array(l*u*2),v=0,g=0,y=0;u>y;y++)for(var x=y*p-a,w=0;l>w;w++){var b=w*c-o;f[v]=b,f[v+1]=-x,d[v+2]=1,m[g]=w/s,m[g+1]=1-y/h,v+=3,g+=2}v=0;for(var _=new(f.length/3>65535?Uint32Array:Uint16Array)(s*h*6),y=0;h>y;y++)for(var w=0;s>w;w++){var S=w+l*y,M=w+l*(y+1),E=w+1+l*(y+1),T=w+1+l*y;_[v]=S,_[v+1]=M,_[v+2]=T,_[v+3]=M,_[v+4]=E,_[v+5]=T,v+=6}this.addAttribute("index",new i.BufferAttribute(_,1)),this.addAttribute("position",new i.BufferAttribute(f,3)),this.addAttribute("normal",new i.BufferAttribute(d,3)),this.addAttribute("uv",new i.BufferAttribute(m,2))},i.PlaneBufferGeometry.prototype=Object.create(i.BufferGeometry.prototype),i.PlaneBufferGeometry.prototype.constructor=i.PlaneBufferGeometry,i.RingGeometry=function(e,t,r,n,o,a){i.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:o,thetaLength:a},e=e||0,t=t||50,o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8,n=void 0!==n?Math.max(1,n):8;var s,h,l=[],u=e,c=(t-e)/n;for(s=0;n+1>s;s++){for(h=0;r+1>h;h++){var p=new i.Vector3,f=o+h/r*a;p.x=u*Math.cos(f),p.y=u*Math.sin(f),this.vertices.push(p),l.push(new i.Vector2((p.x/t+1)/2,(p.y/t+1)/2))}u+=c}var d=new i.Vector3(0,0,1);for(s=0;n>s;s++){var m=s*(r+1);for(h=0;r>h;h++){var f=h+m,v=f,g=f+r+1,y=f+r+2;this.faces.push(new i.Face3(v,g,y,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([l[v].clone(),l[g].clone(),l[y].clone()]),v=f,g=f+r+2,y=f+1,this.faces.push(new i.Face3(v,g,y,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([l[v].clone(),l[g].clone(),l[y].clone()])}}this.computeFaceNormals(),this.boundingSphere=new i.Sphere(new i.Vector3,u)},i.RingGeometry.prototype=Object.create(i.Geometry.prototype),i.RingGeometry.prototype.constructor=i.RingGeometry,i.SphereGeometry=function(e,t,r,n,o,a,s){i.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:o,thetaStart:a,thetaLength:s},e=e||50,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,a=void 0!==a?a:0,s=void 0!==s?s:Math.PI;var h,l,u=[],c=[];for(l=0;r>=l;l++){var p=[],f=[];for(h=0;t>=h;h++){var d=h/t,m=l/r,v=new i.Vector3;v.x=-e*Math.cos(n+d*o)*Math.sin(a+m*s),v.y=e*Math.cos(a+m*s),v.z=e*Math.sin(n+d*o)*Math.sin(a+m*s),this.vertices.push(v),p.push(this.vertices.length-1),f.push(new i.Vector2(d,1-m))}u.push(p),c.push(f)}for(l=0;r>l;l++)for(h=0;t>h;h++){var g=u[l][h+1],y=u[l][h],x=u[l+1][h],w=u[l+1][h+1],b=this.vertices[g].clone().normalize(),_=this.vertices[y].clone().normalize(),S=this.vertices[x].clone().normalize(),M=this.vertices[w].clone().normalize(),E=c[l][h+1].clone(),T=c[l][h].clone(),C=c[l+1][h].clone(),A=c[l+1][h+1].clone();Math.abs(this.vertices[g].y)===e?(E.x=(E.x+T.x)/2,this.faces.push(new i.Face3(g,x,w,[b,S,M])),this.faceVertexUvs[0].push([E,C,A])):Math.abs(this.vertices[x].y)===e?(C.x=(C.x+A.x)/2,this.faces.push(new i.Face3(g,y,x,[b,_,S])),this.faceVertexUvs[0].push([E,T,C])):(this.faces.push(new i.Face3(g,y,w,[b,_,M])),this.faceVertexUvs[0].push([E,T,A]),this.faces.push(new i.Face3(y,x,w,[_.clone(),S,M.clone()])),this.faceVertexUvs[0].push([T.clone(),C,A.clone()]))}this.computeFaceNormals(),this.boundingSphere=new i.Sphere(new i.Vector3,e)},i.SphereGeometry.prototype=Object.create(i.Geometry.prototype),i.SphereGeometry.prototype.constructor=i.SphereGeometry,i.TextGeometry=function(e,t){t=t||{};var r=i.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),i.ExtrudeGeometry.call(this,r,t),this.type="TextGeometry"},i.TextGeometry.prototype=Object.create(i.ExtrudeGeometry.prototype),i.TextGeometry.prototype.constructor=i.TextGeometry,i.TorusGeometry=function(e,t,r,n,o){i.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:o},e=e||100,t=t||40,r=r||8,n=n||6,o=o||2*Math.PI;for(var a=new i.Vector3,s=[],h=[],l=0;r>=l;l++)for(var u=0;n>=u;u++){var c=u/n*o,p=l/r*Math.PI*2;a.x=e*Math.cos(c),a.y=e*Math.sin(c);var f=new i.Vector3;f.x=(e+t*Math.cos(p))*Math.cos(c),f.y=(e+t*Math.cos(p))*Math.sin(c),f.z=t*Math.sin(p),this.vertices.push(f),s.push(new i.Vector2(u/n,l/r)),h.push(f.clone().sub(a).normalize())}for(var l=1;r>=l;l++)for(var u=1;n>=u;u++){var d=(n+1)*l+u-1,m=(n+1)*(l-1)+u-1,v=(n+1)*(l-1)+u,g=(n+1)*l+u,y=new i.Face3(d,m,g,[h[d].clone(),h[m].clone(),h[g].clone()]);this.faces.push(y),this.faceVertexUvs[0].push([s[d].clone(),s[m].clone(),s[g].clone()]),y=new i.Face3(m,v,g,[h[m].clone(),h[v].clone(),h[g].clone()]),this.faces.push(y),this.faceVertexUvs[0].push([s[m].clone(),s[v].clone(),s[g].clone()])}this.computeFaceNormals()},i.TorusGeometry.prototype=Object.create(i.Geometry.prototype),i.TorusGeometry.prototype.constructor=i.TorusGeometry,i.TorusKnotGeometry=function(e,t,r,n,o,a,s){function h(e,t,r,n,o){var a=Math.cos(e),s=Math.sin(e),h=t/r*e,l=Math.cos(h),u=n*(2+l)*.5*a,c=n*(2+l)*s*.5,p=o*n*Math.sin(h)*.5;return new i.Vector3(u,c,p)}i.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,p:o,q:a,heightScale:s},e=e||100,t=t||40,r=r||64,n=n||8,o=o||2,a=a||3,s=s||1;for(var l=new Array(r),u=new i.Vector3,c=new i.Vector3,p=new i.Vector3,f=0;r>f;++f){l[f]=new Array(n);var d=f/r*2*o*Math.PI,m=h(d,a,o,e,s),v=h(d+.01,a,o,e,s);u.subVectors(v,m),c.addVectors(v,m),p.crossVectors(u,c),c.crossVectors(p,u),p.normalize(),c.normalize();for(var g=0;n>g;++g){var y=g/n*2*Math.PI,x=-t*Math.cos(y),w=t*Math.sin(y),b=new i.Vector3;b.x=m.x+x*c.x+w*p.x,b.y=m.y+x*c.y+w*p.y,b.z=m.z+x*c.z+w*p.z,l[f][g]=this.vertices.push(b)-1}}for(var f=0;r>f;++f)for(var g=0;n>g;++g){var _=(f+1)%r,S=(g+1)%n,M=l[f][g],E=l[_][g],T=l[_][S],C=l[f][S],A=new i.Vector2(f/r,g/n),L=new i.Vector2((f+1)/r,g/n),R=new i.Vector2((f+1)/r,(g+1)/n),P=new i.Vector2(f/r,(g+1)/n);this.faces.push(new i.Face3(M,E,C)),this.faceVertexUvs[0].push([A,L,P]),this.faces.push(new i.Face3(E,T,C)),this.faceVertexUvs[0].push([L.clone(),R,P.clone()])}this.computeFaceNormals(),this.computeVertexNormals()},i.TorusKnotGeometry.prototype=Object.create(i.Geometry.prototype),i.TorusKnotGeometry.prototype.constructor=i.TorusKnotGeometry,i.TubeGeometry=function(e,t,r,n,o,a){function s(e,t,r){return R.vertices.push(new i.Vector3(e,t,r))-1}i.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:r,radialSegments:n,closed:o},t=t||64,r=r||1,n=n||8,o=o||!1,a=a||i.TubeGeometry.NoTaper;var h,l,u,c,p,f,d,m,v,g,y,x,w,b,_,S,M,E,T,C,A,L=[],R=this,P=t+1,B=new i.Vector3,F=new i.TubeGeometry.FrenetFrames(e,t,o),k=F.tangents,D=F.normals,U=F.binormals;for(this.tangents=k,this.normals=D,this.binormals=U,g=0;P>g;g++)for(L[g]=[],c=g/(P-1),v=e.getPointAt(c),h=k[g],l=D[g],u=U[g],f=r*a(c),y=0;n>y;y++)p=y/n*2*Math.PI,d=-f*Math.cos(p),m=f*Math.sin(p),B.copy(v),B.x+=d*l.x+m*u.x,B.y+=d*l.y+m*u.y,B.z+=d*l.z+m*u.z,L[g][y]=s(B.x,B.y,B.z);for(g=0;t>g;g++)for(y=0;n>y;y++)x=o?(g+1)%t:g+1,w=(y+1)%n,b=L[g][y],_=L[x][y],S=L[x][w],M=L[g][w],E=new i.Vector2(g/t,y/n),T=new i.Vector2((g+1)/t,y/n),C=new i.Vector2((g+1)/t,(y+1)/n),A=new i.Vector2(g/t,(y+1)/n),this.faces.push(new i.Face3(b,_,M)),this.faceVertexUvs[0].push([E,T,A]),this.faces.push(new i.Face3(_,S,M)),this.faceVertexUvs[0].push([T.clone(),C,A.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},i.TubeGeometry.prototype=Object.create(i.Geometry.prototype),i.TubeGeometry.prototype.constructor=i.TubeGeometry,i.TubeGeometry.NoTaper=function(e){return 1},i.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},i.TubeGeometry.FrenetFrames=function(e,t,r){function n(){d[0]=new i.Vector3,m[0]=new i.Vector3,a=Number.MAX_VALUE,s=Math.abs(f[0].x),h=Math.abs(f[0].y),l=Math.abs(f[0].z),a>=s&&(a=s,p.set(1,0,0)),a>=h&&(a=h,p.set(0,1,0)),a>=l&&p.set(0,0,1),v.crossVectors(f[0],p).normalize(),d[0].crossVectors(f[0],v),m[0].crossVectors(f[0],d[0])}var o,a,s,h,l,u,c,p=new i.Vector3,f=[],d=[],m=[],v=new i.Vector3,g=new i.Matrix4,y=t+1,x=1e-4;for(this.tangents=f,this.normals=d,this.binormals=m,u=0;y>u;u++)c=u/(y-1),f[u]=e.getTangentAt(c),f[u].normalize();for(n(),u=1;y>u;u++)d[u]=d[u-1].clone(),m[u]=m[u-1].clone(),v.crossVectors(f[u-1],f[u]),v.length()>x&&(v.normalize(),o=Math.acos(i.Math.clamp(f[u-1].dot(f[u]),-1,1)),d[u].applyMatrix4(g.makeRotationAxis(v,o))),m[u].crossVectors(f[u],d[u]);if(r)for(o=Math.acos(i.Math.clamp(d[0].dot(d[y-1]),-1,1)),o/=y-1,f[0].dot(v.crossVectors(d[0],d[y-1]))>0&&(o=-o),u=1;y>u;u++)d[u].applyMatrix4(g.makeRotationAxis(f[u],o*u)),m[u].crossVectors(f[u],d[u])},i.PolyhedronGeometry=function(e,t,r,n){function o(e){var t=e.normalize().clone();t.index=c.vertices.push(t)-1;var r=h(e)/2/Math.PI+.5,n=l(e)/Math.PI+.5;return t.uv=new i.Vector2(r,1-n),t}function a(e,t,r){var n=new i.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);c.faces.push(n),w.copy(e).add(t).add(r).divideScalar(3);var o=h(w);c.faceVertexUvs[0].push([u(e.uv,e,o),u(t.uv,t,o),u(r.uv,r,o)])}function s(e,t){for(var r=Math.pow(2,t),n=o(c.vertices[e.a]),i=o(c.vertices[e.b]),s=o(c.vertices[e.c]),h=[],l=0;r>=l;l++){h[l]=[];for(var u=o(n.clone().lerp(s,l/r)),p=o(i.clone().lerp(s,l/r)),f=r-l,d=0;f>=d;d++)0==d&&l==r?h[l][d]=u:h[l][d]=o(u.clone().lerp(p,d/f))}for(var l=0;r>l;l++)for(var d=0;2*(r-l)-1>d;d++){var m=Math.floor(d/2);d%2==0?a(h[l][m+1],h[l+1][m],h[l][m]):a(h[l][m+1],h[l+1][m+1],h[l+1][m])}}function h(e){return Math.atan2(e.z,-e.x)}function l(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function u(e,t,r){return 0>r&&1===e.x&&(e=new i.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new i.Vector2(r/2/Math.PI+.5,e.y)),e.clone()}i.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1,n=n||0;for(var c=this,p=0,f=e.length;f>p;p+=3)o(new i.Vector3(e[p],e[p+1],e[p+2]));for(var d=this.vertices,m=[],p=0,v=0,f=t.length;f>p;p+=3,v++){var g=d[t[p]],y=d[t[p+1]],x=d[t[p+2]];m[v]=new i.Face3(g.index,y.index,x.index,[g.clone(),y.clone(),x.clone()])}for(var w=new i.Vector3,p=0,f=m.length;f>p;p++)s(m[p],n);for(var p=0,f=this.faceVertexUvs[0].length;f>p;p++){var b=this.faceVertexUvs[0][p],_=b[0].x,S=b[1].x,M=b[2].x,E=Math.max(_,Math.max(S,M)),T=Math.min(_,Math.min(S,M));E>.9&&.1>T&&(.2>_&&(b[0].x+=1),.2>S&&(b[1].x+=1),.2>M&&(b[2].x+=1))}for(var p=0,f=this.vertices.length;f>p;p++)this.vertices[p].multiplyScalar(r);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new i.Sphere(new i.Vector3,r)},i.PolyhedronGeometry.prototype=Object.create(i.Geometry.prototype),i.PolyhedronGeometry.prototype.constructor=i.PolyhedronGeometry,i.DodecahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var r=(1+Math.sqrt(5))/2,n=1/r,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];i.PolyhedronGeometry.call(this,o,a,e,t)},i.DodecahedronGeometry.prototype=Object.create(i.Geometry.prototype),i.DodecahedronGeometry.prototype.constructor=i.DodecahedronGeometry,i.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];i.PolyhedronGeometry.call(this,n,o,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},i.IcosahedronGeometry.prototype=Object.create(i.Geometry.prototype),i.IcosahedronGeometry.prototype.constructor=i.IcosahedronGeometry,i.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];i.PolyhedronGeometry.call(this,r,n,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},i.OctahedronGeometry.prototype=Object.create(i.Geometry.prototype),i.OctahedronGeometry.prototype.constructor=i.OctahedronGeometry,i.TetrahedronGeometry=function(e,t){var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];i.PolyhedronGeometry.call(this,r,n,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},i.TetrahedronGeometry.prototype=Object.create(i.Geometry.prototype),i.TetrahedronGeometry.prototype.constructor=i.TetrahedronGeometry,i.ParametricGeometry=function(e,t,r){i.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r};var n,o,a,s,h,l=this.vertices,u=this.faces,c=this.faceVertexUvs[0],p=t+1;for(n=0;r>=n;n++)for(h=n/r,o=0;t>=o;o++)s=o/t,a=e(s,h),l.push(a);var f,d,m,v,g,y,x,w;for(n=0;r>n;n++)for(o=0;t>o;o++)f=n*p+o,d=n*p+o+1,m=(n+1)*p+o+1,v=(n+1)*p+o,g=new i.Vector2(o/t,n/r),y=new i.Vector2((o+1)/t,n/r),x=new i.Vector2((o+1)/t,(n+1)/r),w=new i.Vector2(o/t,(n+1)/r),u.push(new i.Face3(f,d,v)),c.push([g,y,w]),u.push(new i.Face3(d,m,v)),c.push([y.clone(),x,w.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},i.ParametricGeometry.prototype=Object.create(i.Geometry.prototype),i.ParametricGeometry.prototype.constructor=i.ParametricGeometry,i.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),n=new i.BufferGeometry;n.addAttribute("position",new i.BufferAttribute(t,3)),n.addAttribute("color",new i.BufferAttribute(r,3));var o=new i.LineBasicMaterial({vertexColors:i.VertexColors});i.Line.call(this,n,o,i.LinePieces)},i.AxisHelper.prototype=Object.create(i.Line.prototype),i.AxisHelper.prototype.constructor=i.AxisHelper,i.ArrowHelper=function(){var e=new i.Geometry;e.vertices.push(new i.Vector3(0,0,0),new i.Vector3(0,1,0));
var t=new i.CylinderGeometry(0,.5,1,5,1);return t.applyMatrix((new i.Matrix4).makeTranslation(0,-.5,0)),function(r,n,o,a,s,h){i.Object3D.call(this),void 0===a&&(a=16776960),void 0===o&&(o=1),void 0===s&&(s=.2*o),void 0===h&&(h=.2*s),this.position.copy(n),this.line=new i.Line(e,new i.LineBasicMaterial({color:a})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new i.Mesh(t,new i.MeshBasicMaterial({color:a})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(o,s,h)}}(),i.ArrowHelper.prototype=Object.create(i.Object3D.prototype),i.ArrowHelper.prototype.constructor=i.ArrowHelper,i.ArrowHelper.prototype.setDirection=function(){var e,t=new i.Vector3;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),i.ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,e-t,1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},i.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},i.BoxHelper=function(e){var t=new i.BufferGeometry;t.addAttribute("position",new i.BufferAttribute(new Float32Array(72),3)),i.Line.call(this,t,new i.LineBasicMaterial({color:16776960}),i.LinePieces),void 0!==e&&this.update(e)},i.BoxHelper.prototype=Object.create(i.Line.prototype),i.BoxHelper.prototype.constructor=i.BoxHelper,i.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var r=t.boundingBox.min,n=t.boundingBox.max,i=this.geometry.attributes.position.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=r.x,i[4]=n.y,i[5]=n.z,i[6]=r.x,i[7]=n.y,i[8]=n.z,i[9]=r.x,i[10]=r.y,i[11]=n.z,i[12]=r.x,i[13]=r.y,i[14]=n.z,i[15]=n.x,i[16]=r.y,i[17]=n.z,i[18]=n.x,i[19]=r.y,i[20]=n.z,i[21]=n.x,i[22]=n.y,i[23]=n.z,i[24]=n.x,i[25]=n.y,i[26]=r.z,i[27]=r.x,i[28]=n.y,i[29]=r.z,i[30]=r.x,i[31]=n.y,i[32]=r.z,i[33]=r.x,i[34]=r.y,i[35]=r.z,i[36]=r.x,i[37]=r.y,i[38]=r.z,i[39]=n.x,i[40]=r.y,i[41]=r.z,i[42]=n.x,i[43]=r.y,i[44]=r.z,i[45]=n.x,i[46]=n.y,i[47]=r.z,i[48]=n.x,i[49]=n.y,i[50]=n.z,i[51]=n.x,i[52]=n.y,i[53]=r.z,i[54]=r.x,i[55]=n.y,i[56]=n.z,i[57]=r.x,i[58]=n.y,i[59]=r.z,i[60]=r.x,i[61]=r.y,i[62]=n.z,i[63]=r.x,i[64]=r.y,i[65]=r.z,i[66]=n.x,i[67]=r.y,i[68]=n.z,i[69]=n.x,i[70]=r.y,i[71]=r.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},i.BoundingBoxHelper=function(e,t){var r=void 0!==t?t:8947848;this.object=e,this.box=new i.Box3,i.Mesh.call(this,new i.BoxGeometry(1,1,1),new i.MeshBasicMaterial({color:r,wireframe:!0}))},i.BoundingBoxHelper.prototype=Object.create(i.Mesh.prototype),i.BoundingBoxHelper.prototype.constructor=i.BoundingBoxHelper,i.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},i.CameraHelper=function(e){function t(e,t,n){r(e,n),r(t,n)}function r(e,t){n.vertices.push(new i.Vector3),n.colors.push(new i.Color(t)),void 0===a[e]&&(a[e]=[]),a[e].push(n.vertices.length-1)}var n=new i.Geometry,o=new i.LineBasicMaterial({color:16777215,vertexColors:i.FaceColors}),a={},s=16755200,h=16711680,l=43775,u=16777215,c=3355443;t("n1","n2",s),t("n2","n4",s),t("n4","n3",s),t("n3","n1",s),t("f1","f2",s),t("f2","f4",s),t("f4","f3",s),t("f3","f1",s),t("n1","f1",s),t("n2","f2",s),t("n3","f3",s),t("n4","f4",s),t("p","n1",h),t("p","n2",h),t("p","n3",h),t("p","n4",h),t("u1","u2",l),t("u2","u3",l),t("u3","u1",l),t("c","t",u),t("p","c",c),t("cn1","cn2",c),t("cn3","cn4",c),t("cf1","cf2",c),t("cf3","cf4",c),i.Line.call(this,n,o,i.LinePieces),this.camera=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()},i.CameraHelper.prototype=Object.create(i.Line.prototype),i.CameraHelper.prototype.constructor=i.CameraHelper,i.CameraHelper.prototype.update=function(){var e,t,r=new i.Vector3,n=new i.Camera,o=function(i,o,a,s){r.set(o,a,s).unproject(n);var h=t[i];if(void 0!==h)for(var l=0,u=h.length;u>l;l++)e.vertices[h[l]].copy(r)};return function(){e=this.geometry,t=this.pointMap;var r=1,i=1;n.projectionMatrix.copy(this.camera.projectionMatrix),o("c",0,0,-1),o("t",0,0,1),o("n1",-r,-i,-1),o("n2",r,-i,-1),o("n3",-r,i,-1),o("n4",r,i,-1),o("f1",-r,-i,1),o("f2",r,-i,1),o("f3",-r,i,1),o("f4",r,i,1),o("u1",.7*r,1.1*i,-1),o("u2",.7*-r,1.1*i,-1),o("u3",0,2*i,-1),o("cf1",-r,0,1),o("cf2",r,0,1),o("cf3",0,-i,1),o("cf4",0,i,1),o("cn1",-r,0,-1),o("cn2",r,0,-1),o("cn3",0,-i,-1),o("cn4",0,i,-1),e.verticesNeedUpdate=!0}}(),i.DirectionalLightHelper=function(e,t){i.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var r=new i.Geometry;r.vertices.push(new i.Vector3(-t,t,0),new i.Vector3(t,t,0),new i.Vector3(t,-t,0),new i.Vector3(-t,-t,0),new i.Vector3(-t,t,0));var n=new i.LineBasicMaterial({fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new i.Line(r,n),this.add(this.lightPlane),r=new i.Geometry,r.vertices.push(new i.Vector3,new i.Vector3),n=new i.LineBasicMaterial({fog:!1}),n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new i.Line(r,n),this.add(this.targetLine),this.update()},i.DirectionalLightHelper.prototype=Object.create(i.Object3D.prototype),i.DirectionalLightHelper.prototype.constructor=i.DirectionalLightHelper,i.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},i.DirectionalLightHelper.prototype.update=function(){var e=new i.Vector3,t=new i.Vector3,r=new i.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(r),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),i.EdgesHelper=function(e,t,r){var n=void 0!==t?t:16777215;r=void 0!==r?r:1;var o,a=Math.cos(i.Math.degToRad(r)),s=[0,0],h={},l=function(e,t){return e-t},u=["a","b","c"],c=new i.BufferGeometry;e.geometry instanceof i.BufferGeometry?(o=new i.Geometry,o.fromBufferGeometry(e.geometry)):o=e.geometry.clone(),o.mergeVertices(),o.computeFaceNormals();for(var p=o.vertices,f=o.faces,d=0,m=0,v=f.length;v>m;m++)for(var g=f[m],y=0;3>y;y++){s[0]=g[u[y]],s[1]=g[u[(y+1)%3]],s.sort(l);var x=s.toString();void 0===h[x]?(h[x]={vert1:s[0],vert2:s[1],face1:m,face2:void 0},d++):h[x].face2=m}var w=new Float32Array(2*d*3),b=0;for(var x in h){var _=h[x];if(void 0===_.face2||f[_.face1].normal.dot(f[_.face2].normal)<=a){var S=p[_.vert1];w[b++]=S.x,w[b++]=S.y,w[b++]=S.z,S=p[_.vert2],w[b++]=S.x,w[b++]=S.y,w[b++]=S.z}}c.addAttribute("position",new i.BufferAttribute(w,3)),i.Line.call(this,c,new i.LineBasicMaterial({color:n}),i.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},i.EdgesHelper.prototype=Object.create(i.Line.prototype),i.EdgesHelper.prototype.constructor=i.EdgesHelper,i.FaceNormalsHelper=function(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;for(var o=void 0!==r?r:16776960,a=void 0!==n?n:1,s=new i.Geometry,h=this.object.geometry.faces,l=0,u=h.length;u>l;l++)s.vertices.push(new i.Vector3,new i.Vector3);i.Line.call(this,s,new i.LineBasicMaterial({color:o,linewidth:a}),i.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new i.Matrix3,this.update()},i.FaceNormalsHelper.prototype=Object.create(i.Line.prototype),i.FaceNormalsHelper.prototype.constructor=i.FaceNormalsHelper,i.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,t=this.object,r=t.geometry.vertices,n=t.geometry.faces,i=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(i);for(var o=0,a=0,s=n.length;s>o;o++,a+=2){var h=n[o];e[a].copy(r[h.a]).add(r[h.b]).add(r[h.c]).divideScalar(3).applyMatrix4(i),e[a+1].copy(h.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[a])}return this.geometry.verticesNeedUpdate=!0,this},i.GridHelper=function(e,t){var r=new i.Geometry,n=new i.LineBasicMaterial({vertexColors:i.VertexColors});this.color1=new i.Color(4473924),this.color2=new i.Color(8947848);for(var o=-e;e>=o;o+=t){r.vertices.push(new i.Vector3(-e,0,o),new i.Vector3(e,0,o),new i.Vector3(o,0,-e),new i.Vector3(o,0,e));var a=0===o?this.color1:this.color2;r.colors.push(a,a,a,a)}i.Line.call(this,r,n,i.LinePieces)},i.GridHelper.prototype=Object.create(i.Line.prototype),i.GridHelper.prototype.constructor=i.GridHelper,i.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},i.HemisphereLightHelper=function(e,t){i.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new i.Color,new i.Color];var r=new i.SphereGeometry(t,4,2);r.applyMatrix((new i.Matrix4).makeRotationX(-Math.PI/2));for(var n=0,o=8;o>n;n++)r.faces[n].color=this.colors[4>n?0:1];var a=new i.MeshBasicMaterial({vertexColors:i.FaceColors,wireframe:!0});this.lightSphere=new i.Mesh(r,a),this.add(this.lightSphere),this.update()},i.HemisphereLightHelper.prototype=Object.create(i.Object3D.prototype),i.HemisphereLightHelper.prototype.constructor=i.HemisphereLightHelper,i.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},i.HemisphereLightHelper.prototype.update=function(){var e=new i.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),i.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var r=new i.SphereGeometry(t,4,2),n=new i.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),i.Mesh.call(this,r,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},i.PointLightHelper.prototype=Object.create(i.Mesh.prototype),i.PointLightHelper.prototype.constructor=i.PointLightHelper,i.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},i.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},i.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new i.Geometry,r=0;r<this.bones.length;r++){var n=this.bones[r];n.parent instanceof i.Bone&&(t.vertices.push(new i.Vector3),t.vertices.push(new i.Vector3),t.colors.push(new i.Color(0,0,1)),t.colors.push(new i.Color(0,1,0)))}var o=new i.LineBasicMaterial({vertexColors:i.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});i.Line.call(this,t,o,i.LinePieces),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},i.SkeletonHelper.prototype=Object.create(i.Line.prototype),i.SkeletonHelper.prototype.constructor=i.SkeletonHelper,i.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof i.Bone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,this.getBoneList(e.children[r]));return t},i.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new i.Matrix4).getInverse(this.root.matrixWorld),r=new i.Matrix4,n=0,o=0;o<this.bones.length;o++){var a=this.bones[o];a.parent instanceof i.Bone&&(r.multiplyMatrices(t,a.matrixWorld),e.vertices[n].setFromMatrixPosition(r),r.multiplyMatrices(t,a.parent.matrixWorld),e.vertices[n+1].setFromMatrixPosition(r),n+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},i.SpotLightHelper=function(e){i.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new i.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new i.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new i.Matrix4).makeRotationX(-Math.PI/2));var r=new i.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new i.Mesh(t,r),this.add(this.cone),this.update()},i.SpotLightHelper.prototype=Object.create(i.Object3D.prototype),i.SpotLightHelper.prototype.constructor=i.SpotLightHelper,i.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},i.SpotLightHelper.prototype.update=function(){var e=new i.Vector3,t=new i.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4,n=r*Math.tan(this.light.angle);this.cone.scale.set(n,n,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),i.VertexNormalsHelper=function(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;for(var o=void 0!==r?r:16711680,a=void 0!==n?n:1,s=new i.Geometry,h=e.geometry.faces,l=0,u=h.length;u>l;l++)for(var c=h[l],p=0,f=c.vertexNormals.length;f>p;p++)s.vertices.push(new i.Vector3,new i.Vector3);i.Line.call(this,s,new i.LineBasicMaterial({color:o,linewidth:a}),i.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new i.Matrix3,this.update()},i.VertexNormalsHelper.prototype=Object.create(i.Line.prototype),i.VertexNormalsHelper.prototype.constructor=i.VertexNormalsHelper,i.VertexNormalsHelper.prototype.update=function(e){var t=new i.Vector3;return function(e){var r=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var n=this.geometry.vertices,i=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,h=0,l=o.length;l>h;h++)for(var u=o[h],c=0,p=u.vertexNormals.length;p>c;c++){var f=u[r[c]],d=i[f],m=u.vertexNormals[c];n[s].copy(d).applyMatrix4(a),t.copy(m).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(n[s]),s+=1,n[s].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),i.VertexTangentsHelper=function(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;for(var o=void 0!==r?r:255,a=void 0!==n?n:1,s=new i.Geometry,h=e.geometry.faces,l=0,u=h.length;u>l;l++)for(var c=h[l],p=0,f=c.vertexTangents.length;f>p;p++)s.vertices.push(new i.Vector3),s.vertices.push(new i.Vector3);i.Line.call(this,s,new i.LineBasicMaterial({color:o,linewidth:a}),i.LinePieces),this.matrixAutoUpdate=!1,this.update()},i.VertexTangentsHelper.prototype=Object.create(i.Line.prototype),i.VertexTangentsHelper.prototype.constructor=i.VertexTangentsHelper,i.VertexTangentsHelper.prototype.update=function(e){var t=new i.Vector3;return function(e){var r=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var n=this.geometry.vertices,i=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,h=0,l=o.length;l>h;h++)for(var u=o[h],c=0,p=u.vertexTangents.length;p>c;c++){var f=u[r[c]],d=i[f],m=u.vertexTangents[c];n[s].copy(d).applyMatrix4(a),t.copy(m).transformDirection(a).multiplyScalar(this.size),t.add(n[s]),s+=1,n[s].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),i.WireframeHelper=function(e,t){var r=void 0!==t?t:16777215,n=[0,0],o={},a=function(e,t){return e-t},s=["a","b","c"],h=new i.BufferGeometry;if(e.geometry instanceof i.Geometry){for(var l=e.geometry.vertices,u=e.geometry.faces,c=0,p=new Uint32Array(6*u.length),f=0,d=u.length;d>f;f++)for(var m=u[f],v=0;3>v;v++){n[0]=m[s[v]],n[1]=m[s[(v+1)%3]],n.sort(a);var g=n.toString();void 0===o[g]&&(p[2*c]=n[0],p[2*c+1]=n[1],o[g]=!0,c++)}for(var y=new Float32Array(2*c*3),f=0,d=c;d>f;f++)for(var v=0;2>v;v++){var x=l[p[2*f+v]],w=6*f+3*v;y[w+0]=x.x,y[w+1]=x.y,y[w+2]=x.z}h.addAttribute("position",new i.BufferAttribute(y,3))}else if(e.geometry instanceof i.BufferGeometry)if(void 0!==e.geometry.attributes.index){var l=e.geometry.attributes.position.array,b=e.geometry.attributes.index.array,_=e.geometry.drawcalls,c=0;0===_.length&&(_=[{count:b.length,index:0,start:0}]);for(var p=new Uint32Array(2*b.length),S=0,M=_.length;M>S;++S)for(var E=_[S].start,T=_[S].count,w=_[S].index,f=E,C=E+T;C>f;f+=3)for(var v=0;3>v;v++){n[0]=w+b[f+v],n[1]=w+b[f+(v+1)%3],n.sort(a);var g=n.toString();void 0===o[g]&&(p[2*c]=n[0],p[2*c+1]=n[1],o[g]=!0,c++)}for(var y=new Float32Array(2*c*3),f=0,d=c;d>f;f++)for(var v=0;2>v;v++){var w=6*f+3*v,A=3*p[2*f+v];y[w+0]=l[A],y[w+1]=l[A+1],y[w+2]=l[A+2]}h.addAttribute("position",new i.BufferAttribute(y,3))}else{for(var l=e.geometry.attributes.position.array,c=l.length/3,L=c/3,y=new Float32Array(2*c*3),f=0,d=L;d>f;f++)for(var v=0;3>v;v++){var w=18*f+6*v,R=9*f+3*v;y[w+0]=l[R],y[w+1]=l[R+1],y[w+2]=l[R+2];var A=9*f+3*((v+1)%3);y[w+3]=l[A],y[w+4]=l[A+1],y[w+5]=l[A+2]}h.addAttribute("position",new i.BufferAttribute(y,3))}i.Line.call(this,h,new i.LineBasicMaterial({color:r}),i.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},i.WireframeHelper.prototype=Object.create(i.Line.prototype),i.WireframeHelper.prototype.constructor=i.WireframeHelper,i.ImmediateRenderObject=function(){i.Object3D.call(this),this.render=function(e){}},i.ImmediateRenderObject.prototype=Object.create(i.Object3D.prototype),i.ImmediateRenderObject.prototype.constructor=i.ImmediateRenderObject,i.MorphBlendMesh=function(e,t){i.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,n="__default",o=0,a=r-1,s=r/1;this.createAnimation(n,o,a,s),this.setAnimationWeight(n,1)},i.MorphBlendMesh.prototype=Object.create(i.Mesh.prototype),i.MorphBlendMesh.prototype.constructor=i.MorphBlendMesh,i.MorphBlendMesh.prototype.createAnimation=function(e,t,r,n){var i={startFrame:t,endFrame:r,length:r-t+1,fps:n,duration:(r-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=i,this.animationsList.push(i)},i.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)_?(\d+)/,n={},i=this.geometry,o=0,a=i.morphTargets.length;a>o;o++){var s=i.morphTargets[o],h=s.name.match(r);if(h&&h.length>1){var l=h[1];n[l]||(n[l]={start:1/0,end:-(1/0)});var u=n[l];o<u.start&&(u.start=o),o>u.end&&(u.end=o),t||(t=l)}}for(var l in n){var u=n[l];this.createAnimation(l,u.start,u.end,e)}this.firstAnimation=t},i.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},i.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},i.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},i.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},i.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},i.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},i.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},i.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},i.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):i.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},i.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},i.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;r>t;t++){var n=this.animationsList[t];if(n.active){var o=n.duration/n.length;n.time+=n.direction*e,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var a=n.startFrame+i.Math.clamp(Math.floor(n.time/o),0,n.length-1),s=n.weight;a!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*s,this.morphTargetInfluences[a]=0,n.lastFrame=n.currentFrame,n.currentFrame=a);var h=n.time%o/o;n.directionBackwards&&(h=1-h),this.morphTargetInfluences[n.currentFrame]=h*s,this.morphTargetInfluences[n.lastFrame]=(1-h)*s}}},"undefined"!=typeof r?("undefined"!=typeof t&&t.exports&&(r=t.exports=i),r.THREE=i):this.THREE=i},{}],24:[function(e,t,r){function n(e,t,r){function n(e){S&&(p.rotateY(e.x*-y),p.rotateX(e.y*-y),_&&c(),C=!0)}function l(e){R=e*b,P=p.fov,P*=1+R,P=Math.min(w,Math.max(x,P)),p.fov=P,p.updateProjectionMatrix(),m&&m()}function u(){T=f.isPressed("shift")?g:1,f.isPressed("a")&&(A=!0,p.translateX(-v*T)),f.isPressed("d")&&(A=!0,p.translateX(v*T)),f.isPressed("w")&&(A=!0,p.translateZ(-v*T)),f.isPressed("s")&&(A=!0,p.translateZ(v*T)),f.isPressed("e")&&(A=!0,p.rotateZ(-.1)),f.isPressed("q")&&(A=!0,p.rotateZ(.1)),E&&(f.isPressed("left")&&(p.rotateY(y),C=!0),f.isPressed("right")&&(p.rotateY(-y),C=!0),f.isPressed("up")&&(p.rotateX(y),C=!0),f.isPressed("down")&&(p.rotateX(-y),C=!0),C&&_&&c()),(A||C)&&m&&(m(),A=C=!1)}function c(){_lookAtTarget.position.copy(p.position),_lookAtTarget.rotation.copy(p.rotation),_lookAtTarget.translateZ(-1),p.lookAt(_lookAtTarget.position)}r=r||{};var p=e,f=new i(o),d=new s(t),m=r.onChangedCallback,v=h(r.movementSpeed,.1),g=h(r.movementRunSpeedScale,2.5),y=h(r.rotationSpeed,.005),x=h(r.minFov,10),w=h(r.maxFov,100),b=(h(r.upAxis,"y"),h(r.zoomSpeed,.001)),_=h(r.yUp,!0),S=h(r.rotateActive,!1),M=h(r.rotateActiveOnlyInPointerLock,!0),E=h(r.arrowKeysRotate,!1),T=1;M||(S=!0);var C,A,L=new a(t);L.on("data",n),L.onAttainSignal.add(function(){M&&(S=!0)}),L.onReleaseSignal.add(function(){M&&(S=!1)});var R,P,B=L.onAttainSignal,F=L.onReleaseSignal;d.onWheelSignal.add(l),_&&(_lookAtTarget=p.clone()),this.onPointerLockAttainSignal=B,this.onPointerLockReleaseSignal=F,this.update=u,Object.defineProperty(this,"keyboard",{get:function(){return f}}),Object.defineProperty(this,"movementSpeed",{get:function(){return v},set:function(e){v=e}}),Object.defineProperty(this,"rotationSpeed",{get:function(){return y},set:function(e){y=e}}),Object.defineProperty(this,"zoomSpeed",{get:function(){return b},set:function(e){b=e}})}var i=e("game-keyboard"),o=e("game-keyboard/key_map").US,a=e("pointer-trap-relative"),s=e("input-mousewheel"),h=e("defined");t.exports=n},{defined:25,"game-keyboard":26,"game-keyboard/key_map":27,"input-mousewheel":28,"pointer-trap-relative":31}],25:[function(e,t,r){t.exports=function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]}},{}],26:[function(e,t,r){"use strict";function n(e){this.keys={};var t=this;for(var r in e)e.hasOwnProperty(r)&&(this.keys[e[r]]=0);window.addEventListener("keydown",function(r){return r.preventDefault(),e.hasOwnProperty(r.keyCode)?(0===t.keys[e[r.keyCode]]&&(t.keys[e[r.keyCode]]=2),!1):void 0}),window.addEventListener("keyup",function(r){return r.preventDefault(),e.hasOwnProperty(r.keyCode)?(t.keys[e[r.keyCode]]=0,!1):void 0})}n.prototype.isPressed=function(e){return this.keys[e]>=1},n.prototype.consumePressed=function(e){var t=2===this.keys[e];return t&&(this.keys[e]=1),t},t.exports=n},{}],27:[function(e,t,r){t.exports={US:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause/break",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"leftwindow",92:"rightwindow",93:"select",96:"numpad-0",97:"numpad-1",98:"numpad-2",99:"numpad-3",100:"numpad-4",101:"numpad-5",102:"numpad-6",103:"numpad-7",104:"numpad-8",105:"numpad-9",106:"multiply",107:"add",109:"subtract",110:"decimalpoint",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equals",188:"comma",189:"dash",190:"period",191:"forwardslash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"}}},{}],28:[function(e,t,r){var n=e("browser-event-adder"),i=e("signals"),o=function(e){function t(e){r.dispatch(e.wheelDelta,e)}var r=new i.Signal;n.addEvent(e,"mousewheel",t),this.onWheelSignal=r};t.exports=o},{"browser-event-adder":29,signals:30}],29:[function(e,t,r){arguments[4][18][0].apply(r,arguments)},{dup:18}],30:[function(e,t,r){arguments[4][21][0].apply(r,arguments)},{dup:21}],31:[function(e,t,r){function n(e,t){function r(t){d.x+=t.dx,d.y+=t.dy,d.x=s(h(d.x,0),e.clientWidth),d.y=s(h(d.y,0),e.clientHeight),this.queue(d)}function n(e){d.x+=e.dx,d.y+=e.dy,this.queue(d)}function u(e){d.x=e.dx,d.y=e.dy,this.queue(d)}var c;switch(t){case"deltas":c=u;break;case"clamped":c=r;break;case"unclamped":c=n;break;default:c=u}var p=i(e),f=a(c),d=f.pos={},m=new l.Signal,v=new l.Signal;f.trapped=!1,f.onAttainSignal=m,f.onReleaseSignal=v,e.style.cursor="none";var g,y,x={dx:0,dy:0};return e.addEventListener("mousemove",function(e){f.trapped||(void 0===g&&(g=e.pageX),void 0===y&&(y=e.pageY),x.dx=e.pageX-g,x.dy=e.pageY-y,g=e.pageX,y=e.pageY,f.write(x))}),e.addEventListener("click",function(e){f.trapped||(d.x=e.pageX,d.y=e.pageY,p.request())}),p.on("attain",function(e){f.trapped=!0,e.pipe(f,{end:!1}),m.dispatch()}),p.on("release",function(){f.trapped=!1,v.dispatch()}),p.on("error",function(e){f.trapped=!1,v.dispatch()}),p.on("fullscreen",function(){var t=o(e);t.once("attain",function(){p.request()}).request()}),f}var i=e("pointer-lock-chrome-tolerant"),o=e("fullscreen"),a=e("through"),s=Math.min,h=Math.max,l=e("signals");t.exports=n},{fullscreen:32,"pointer-lock-chrome-tolerant":33,signals:34,through:35}],32:[function(e,t,r){function n(){return!!o(document.body)}function i(e){function t(){return s()?void c.emit("attain"):c.emit("release")}function r(){c.emit("error")}function n(){return u.call(e)}function i(){(e.exitFullscreen||e.exitFullscreen||e.webkitExitFullScreen||e.webkitExitFullscreen||e.mozExitFullScreen||e.mozExitFullscreen||e.msExitFullScreen||e.msExitFullscreen||e.oExitFullScreen||e.oExitFullscreen).call(e)}function s(){return l.fullScreenElement||l.fullscreenElement||l.webkitFullScreenElement||l.webkitFullscreenElement||l.mozFullScreenElement||l.mozFullscreenElement||l.msFullScreenElement||l.msFullscreenElement||l.oFullScreenElement||l.oFullscreenElement||null}for(var h=e.addEventListener||e.attachEvent,l=e.ownerDocument,u=(l.body,o(e)),c=new a,p=["","webkit","moz","ms","o"],f=0,d=p.length;d>f;++f)h.call(l,p[f]+"fullscreenchange",t),h.call(l,p[f]+"fullscreenerror",r);return c.release=i,c.request=n,c.target=s,o||setTimeout(function(){c.emit("error",new Error("fullscreen is not supported"))},0),c}function o(e){return e.requestFullscreen||e.webkitRequestFullscreen||e.webkitRequestFullScreen||e.mozRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.msRequestFullScreen||e.oRequestFullscreen||e.oRequestFullScreen}t.exports=i,i.available=n;var a=e("events").EventEmitter},{events:74}],33:[function(e,t,r){function n(){return!!o(document.body)}function i(e){function t(t){u()||(c=+new Date,v.call(e))}function r(e){L&&(y.emit("needs-fullscreen"),L=!1)}function n(e){return S=M=0,u()?(x=new s,x.readable=!0,x.initial={x:b,y:_,t:Date.now()},void y.emit("attain",x)):void(x&&h())}function i(e){var t=+new Date-c;return 100>t?void(L=!0):(y.emit("error"),x&&x.emit("error",e),void(x=null))}function h(){y.emit("release"),x&&(x.emit("end"),x.readable=!1,x.emit("close"),x=null);var e=u();e&&(d.exitPointerLock||d.mozExitPointerLock||d.webkitExitPointerLock||d.msExitPointerLock||d.oExitPointerLock).call(d)}function l(e){if(b=e.pageX,_=e.pageY,x){var t=e.movementX||e.webkitMovementX||e.mozMovementX||e.msMovementX||e.oMovementX||0,r=e.movementY||e.webkitMovementY||e.mozMovementY||e.msMovementY||e.oMovementY||0;g.dx=t,g.dy=r,g.dt=Date.now()-x.initial.t,E+=t,T+=r;var n=!1;(t>0&&t>S||0>t&&-S>t)&&(S=Math.abs(t),n=!0),(r>0&&r>M||0>r&&-M>r)&&(M=Math.abs(r),n=!0),n&&(C=E,A=T),Math.abs(E-C)<w&&Math.abs(T-A)<w&&(g.dx=0,g.dy=0),y.emit("data",g),x.emit("data",g)}}function u(){return d.pointerLockElement||d.mozPointerLockElement||d.webkitPointerLockElement||d.msPointerLockElement||d.oPointerLockElement||null}var c,p=e.addEventListener||e.attachEvent,f=e.removeEventListener||e.detachEvent,d=e.ownerDocument,m=d.body,v=o(e),g={dx:0,dy:0,dt:0},y=new a,x=null,w=4,b=0,_=0,S=0,M=0,E=0,T=0,C=0,A=0,L=!1;p.call(e,"mousedown",t,!1),p.call(e,"mouseup",r,!1),p.call(m,"mousemove",l,!1);for(var R=["","webkit","moz","ms","o"],P=0,B=R.length;B>P;++P)p.call(d,R[P]+"pointerlockchange",n),p.call(d,R[P]+"pointerlockerror",i);return y.release=h,y.target=u,y.request=t,y.destroy=function(){f.call(e,"mouseup",r,!1),f.call(e,"mousedown",t,!1),f.call(e,"mousemove",l,!1)},o||setTimeout(function(){y.emit("error",new Error("pointer lock is not supported"))},0),y}function o(e){return e.requestPointerLock||e.webkitRequestPointerLock||e.mozRequestPointerLock||e.msRequestPointerLock||e.oRequestPointerLock||null}t.exports=i,i.available=n;var a=e("events").EventEmitter,s=e("stream").Stream},{events:74,stream:89}],34:[function(e,t,r){arguments[4][21][0].apply(r,arguments)},{dup:21}],35:[function(e,t,r){(function(n){function i(e,t,r){function i(){for(;l.length&&!c.paused;){var e=l.shift();if(null===e)return c.emit("end");c.emit("data",e)}}function a(){c.writable=!1,t.call(c),!c.readable&&c.autoDestroy&&c.destroy()}e=e||function(e){this.queue(e)},t=t||function(){this.queue(null)};var s=!1,h=!1,l=[],u=!1,c=new o;return c.readable=c.writable=!0,c.paused=!1,c.autoDestroy=!(r&&r.autoDestroy===!1),c.write=function(t){return e.call(this,t),!c.paused},c.queue=c.push=function(e){return u?c:(null===e&&(u=!0),l.push(e),i(),c)},c.on("end",function(){c.readable=!1,!c.writable&&c.autoDestroy&&n.nextTick(function(){c.destroy()})}),c.end=function(e){return s?void 0:(s=!0,arguments.length&&c.write(e),a(),c)},c.destroy=function(){return h?void 0:(h=!0,s=!0,l.length=0,c.writable=c.readable=!1,c.emit("close"),c)},c.pause=function(){return c.paused?void 0:(c.paused=!0,c)},c.resume=function(){return c.paused&&(c.paused=!1,c.emit("resume")),i(),c.paused||c.emit("drain"),c},c}var o=e("stream");r=t.exports=i,i.through=i}).call(this,e("_process"))},{_process:77,stream:89}],36:[function(e,t,r){function n(){for(var e=new THREE.Geometry,t=new THREE.Color(1,1,1),r=new THREE.Color(0,0,0),n=8,i=.01,o=.1,a=0;n>a;a++){var s=a/n,h=s*Math.PI*2;e.vertices.push(new THREE.Vector3(Math.cos(h)*i,Math.sin(h)*i,0)),e.vertices.push(new THREE.Vector3(Math.cos(h)*o,Math.sin(h)*o,0));var l=a%2!=0;e.colors.push(l?t:r),e.colors.push(l?t:r)}THREE.Line.call(this,e,new THREE.LineBasicMaterial({color:16777215,vertexColors:!0}),THREE.LinePieces)}n.prototype=Object.create(THREE.Line.prototype),t.exports=n},{}],37:[function(e,t,r){arguments[4][18][0].apply(r,arguments)},{dup:18}],38:[function(e,t,r){function n(){var e=window.innerWidth||document.documentElement.clientWidth;return Math.max(l.minWidth,Math.min(l.maxWidth,e))}function i(){var e=window.innerHeight||document.documentElement.clientHeight;return Math.max(l.minHeight,Math.min(l.maxHeight,e))}function o(e){l.width=n(),l.height=i(),h.dispatch(l.width,l.height)}var a=e("browser-event-adder"),s=e("signals"),h=new s.Signal,l={width:16,height:16,minHeight:16,maxHeight:1e5,minWidth:16,maxWidth:1e5,debounce:50};a.addEvent(window,"resize",function(e){var t=n(),r=i();(t!=l.width||r!=l.height)&&(l.width=t,
l.height=r,l.debounce>0?(l.debouncing||setTimeout(function(){l.debouncing=!1,h.dispatch(l.width,l.height)},l.debounce),l.debouncing=!0):h.dispatch(t,r))}),l.onResize=h,l.bump=o,t.exports=l},{"browser-event-adder":37,signals:42}],39:[function(e,t,r){(function(e){(function(){function n(e,t,r){for(var n=(r||0)-1,i=e?e.length:0;++n<i;)if(e[n]===t)return n;return-1}function i(e,t){var r=typeof t;if(e=e.cache,"boolean"==r||null==t)return e[t]?0:-1;"number"!=r&&"string"!=r&&(r="object");var i="number"==r?t:w+t;return e=(e=e[r])&&e[i],"object"==r?e&&n(e,t)>-1?0:-1:e?0:-1}function o(e){var t=this.cache,r=typeof e;if("boolean"==r||null==e)t[e]=!0;else{"number"!=r&&"string"!=r&&(r="object");var n="number"==r?e:w+e,i=t[r]||(t[r]={});"object"==r?(i[n]||(i[n]=[])).push(e):i[n]=!0}}function a(e){return e.charCodeAt(0)}function s(e,t){for(var r=e.criteria,n=t.criteria,i=-1,o=r.length;++i<o;){var a=r[i],s=n[i];if(a!==s){if(a>s||"undefined"==typeof a)return 1;if(s>a||"undefined"==typeof s)return-1}}return e.index-t.index}function h(e){var t=-1,r=e.length,n=e[0],i=e[r/2|0],a=e[r-1];if(n&&"object"==typeof n&&i&&"object"==typeof i&&a&&"object"==typeof a)return!1;var s=c();s["false"]=s["null"]=s["true"]=s.undefined=!1;var h=c();for(h.array=e,h.cache=s,h.push=o;++t<r;)h.push(e[t]);return h}function l(e){return"\\"+Q[e]}function u(){return g.pop()||[]}function c(){return y.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function p(e){e.length=0,g.length<_&&g.push(e)}function f(e){var t=e.cache;t&&f(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,y.length<_&&y.push(e)}function d(e,t,r){t||(t=0),"undefined"==typeof r&&(r=e?e.length:0);for(var n=-1,i=r-t||0,o=Array(0>i?0:i);++n<i;)o[n]=e[t+n];return o}function m(e){function t(e){return e&&"object"==typeof e&&!Zr(e)&&Fr.call(e,"__wrapped__")?e:new r(e)}function r(e,t){this.__chain__=!!t,this.__wrapped__=e}function o(e){function t(){if(n){var e=d(n);kr.apply(e,arguments)}if(this instanceof t){var o=y(r.prototype),a=r.apply(o,e||arguments);return Re(a)?a:o}return r.apply(i,e||arguments)}var r=e[0],n=e[2],i=e[4];return Qr(t,e),t}function g(e,t,r,n,i){if(r){var o=r(e);if("undefined"!=typeof o)return o}var a=Re(e);if(!a)return e;var s=Tr.call(e);if(!q[s])return e;var h=Yr[s];switch(s){case I:case N:return new h(+e);case j:case G:return new h(e);case H:return o=h(e.source,A.exec(e)),o.lastIndex=e.lastIndex,o}var l=Zr(e);if(t){var c=!n;n||(n=u()),i||(i=u());for(var f=n.length;f--;)if(n[f]==e)return i[f];o=l?h(e.length):{}}else o=l?d(e):on({},e);return l&&(Fr.call(e,"index")&&(o.index=e.index),Fr.call(e,"input")&&(o.input=e.input)),t?(n.push(e),i.push(o),(l?Qe:hn)(e,function(e,a){o[a]=g(e,t,r,n,i)}),c&&(p(n),p(i)),o):o}function y(e,t){return Re(e)?Ir(e):{}}function _(e,t,r){if("function"!=typeof e)return Zt;if("undefined"==typeof t||!("prototype"in e))return e;var n=e.__bindData__;if("undefined"==typeof n&&(Kr.funcNames&&(n=!e.name),n=n||!Kr.funcDecomp,!n)){var i=Pr.call(e);Kr.funcNames||(n=!L.test(i)),n||(n=F.test(i),Qr(e,n))}if(n===!1||n!==!0&&1&n[1])return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,o){return e.call(t,r,n,i,o)}}return kt(e,t)}function Q(e){function t(){var e=h?a:this;if(i){var f=d(i);kr.apply(f,arguments)}if((o||u)&&(f||(f=d(arguments)),o&&kr.apply(f,o),u&&f.length<s))return n|=16,Q([r,c?n:-4&n,f,null,a,s]);if(f||(f=arguments),l&&(r=e[p]),this instanceof t){e=y(r.prototype);var m=r.apply(e,f);return Re(m)?m:e}return r.apply(e,f)}var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],h=1&n,l=2&n,u=4&n,c=8&n,p=r;return Qr(t,e),t}function J(e,t){var r=-1,o=he(),a=e?e.length:0,s=a>=b&&o===n,l=[];if(s){var u=h(t);u?(o=i,t=u):s=!1}for(;++r<a;){var c=e[r];o(t,c)<0&&l.push(c)}return s&&f(t),l}function $(e,t,r,n){for(var i=(n||0)-1,o=e?e.length:0,a=[];++i<o;){var s=e[i];if(s&&"object"==typeof s&&"number"==typeof s.length&&(Zr(s)||pe(s))){t||(s=$(s,t,r));var h=-1,l=s.length,u=a.length;for(a.length+=l;++h<l;)a[u++]=s[h]}else r||a.push(s)}return a}function ee(e,t,r,n,i,o){if(r){var a=r(e,t);if("undefined"!=typeof a)return!!a}if(e===t)return 0!==e||1/e==1/t;var s=typeof e,h=typeof t;if(!(e!==e||e&&K[s]||t&&K[h]))return!1;if(null==e||null==t)return e===t;var l=Tr.call(e),c=Tr.call(t);if(l==z&&(l=W),c==z&&(c=W),l!=c)return!1;switch(l){case I:case N:return+e==+t;case j:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case H:case G:return e==br(t)}var f=l==V;if(!f){var d=Fr.call(e,"__wrapped__"),m=Fr.call(t,"__wrapped__");if(d||m)return ee(d?e.__wrapped__:e,m?t.__wrapped__:t,r,n,i,o);if(l!=W)return!1;var v=e.constructor,g=t.constructor;if(v!=g&&!(Le(v)&&v instanceof v&&Le(g)&&g instanceof g)&&"constructor"in e&&"constructor"in t)return!1}var y=!i;i||(i=u()),o||(o=u());for(var x=i.length;x--;)if(i[x]==e)return o[x]==t;var w=0;if(a=!0,i.push(e),o.push(t),f){if(x=e.length,w=t.length,a=w==x,a||n)for(;w--;){var b=x,_=t[w];if(n)for(;b--&&!(a=ee(e[b],_,r,n,i,o)););else if(!(a=ee(e[w],_,r,n,i,o)))break}}else sn(t,function(t,s,h){return Fr.call(h,s)?(w++,a=Fr.call(e,s)&&ee(e[s],t,r,n,i,o)):void 0}),a&&!n&&sn(e,function(e,t,r){return Fr.call(r,t)?a=--w>-1:void 0});return i.pop(),o.pop(),y&&(p(i),p(o)),a}function te(e,t,r,n,i){(Zr(t)?Qe:hn)(t,function(t,o){var a,s,h=t,l=e[o];if(t&&((s=Zr(t))||ln(t))){for(var u=n.length;u--;)if(a=n[u]==t){l=i[u];break}if(!a){var c;r&&(h=r(l,t),(c="undefined"!=typeof h)&&(l=h)),c||(l=s?Zr(l)?l:[]:ln(l)?l:{}),n.push(t),i.push(l),c||te(l,t,r,n,i)}}else r&&(h=r(l,t),"undefined"==typeof h&&(h=t)),"undefined"!=typeof h&&(l=h);e[o]=l})}function ne(e,t){return e+Rr(Xr()*(t-e+1))}function ie(e,t,r){var o=-1,a=he(),s=e?e.length:0,l=[],c=!t&&s>=b&&a===n,d=r||c?u():l;if(c){var m=h(d);a=i,d=m}for(;++o<s;){var v=e[o],g=r?r(v,o,e):v;(t?!o||d[d.length-1]!==g:a(d,g)<0)&&((r||c)&&d.push(g),l.push(v))}return c?(p(d.array),f(d)):r&&p(d),l}function oe(e){return function(r,n,i){var o={};n=t.createCallback(n,i,3);var a=-1,s=r?r.length:0;if("number"==typeof s)for(;++a<s;){var h=r[a];e(o,h,n(h,a,r),r)}else hn(r,function(t,r,i){e(o,t,n(t,r,i),i)});return o}}function ae(e,t,r,n,i,a){var s=1&t,h=2&t,l=4&t,u=16&t,c=32&t;if(!h&&!Le(e))throw new _r;u&&!r.length&&(t&=-17,u=r=!1),c&&!n.length&&(t&=-33,c=n=!1);var p=e&&e.__bindData__;if(p&&p!==!0)return p=d(p),p[2]&&(p[2]=d(p[2])),p[3]&&(p[3]=d(p[3])),!s||1&p[1]||(p[4]=i),!s&&1&p[1]&&(t|=8),!l||4&p[1]||(p[5]=a),u&&kr.apply(p[2]||(p[2]=[]),r),c&&zr.apply(p[3]||(p[3]=[]),n),p[1]|=t,ae.apply(null,p);var f=1==t||17===t?o:Q;return f([e,t,r,n,i,a])}function se(e){return en[e]}function he(){var e=(e=t.indexOf)===gt?n:e;return e}function le(e){return"function"==typeof e&&Cr.test(e)}function ue(e){var t,r;return e&&Tr.call(e)==W&&(t=e.constructor,!Le(t)||t instanceof t)?(sn(e,function(e,t){r=t}),"undefined"==typeof r||Fr.call(e,r)):!1}function ce(e){return tn[e]}function pe(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Tr.call(e)==z||!1}function fe(e,t,r,n){return"boolean"!=typeof t&&null!=t&&(n=r,r=t,t=!1),g(e,t,"function"==typeof r&&_(r,n,1))}function de(e,t,r){return g(e,!0,"function"==typeof t&&_(t,r,1))}function me(e,t){var r=y(e);return t?on(r,t):r}function ve(e,r,n){var i;return r=t.createCallback(r,n,3),hn(e,function(e,t,n){return r(e,t,n)?(i=t,!1):void 0}),i}function ge(e,r,n){var i;return r=t.createCallback(r,n,3),xe(e,function(e,t,n){return r(e,t,n)?(i=t,!1):void 0}),i}function ye(e,t,r){var n=[];sn(e,function(e,t){n.push(t,e)});var i=n.length;for(t=_(t,r,3);i--&&t(n[i--],n[i],e)!==!1;);return e}function xe(e,t,r){var n=$r(e),i=n.length;for(t=_(t,r,3);i--;){var o=n[i];if(t(e[o],o,e)===!1)break}return e}function we(e){var t=[];return sn(e,function(e,r){Le(e)&&t.push(r)}),t.sort()}function be(e,t){return e?Fr.call(e,t):!1}function _e(e){for(var t=-1,r=$r(e),n=r.length,i={};++t<n;){var o=r[t];i[e[o]]=o}return i}function Se(e){return e===!0||e===!1||e&&"object"==typeof e&&Tr.call(e)==I||!1}function Me(e){return e&&"object"==typeof e&&Tr.call(e)==N||!1}function Ee(e){return e&&1===e.nodeType||!1}function Te(e){var t=!0;if(!e)return t;var r=Tr.call(e),n=e.length;return r==V||r==G||r==z||r==W&&"number"==typeof n&&Le(e.splice)?!n:(hn(e,function(){return t=!1}),t)}function Ce(e,t,r,n){return ee(e,t,"function"==typeof r&&_(r,n,2))}function Ae(e){return Or(e)&&!jr(parseFloat(e))}function Le(e){return"function"==typeof e}function Re(e){return!(!e||!K[typeof e])}function Pe(e){return Fe(e)&&e!=+e}function Be(e){return null===e}function Fe(e){return"number"==typeof e||e&&"object"==typeof e&&Tr.call(e)==j||!1}function ke(e){return e&&"object"==typeof e&&Tr.call(e)==H||!1}function De(e){return"string"==typeof e||e&&"object"==typeof e&&Tr.call(e)==G||!1}function Ue(e){return"undefined"==typeof e}function ze(e,r,n){var i={};return r=t.createCallback(r,n,3),hn(e,function(e,t,n){i[t]=r(e,t,n)}),i}function Ve(e){var t=arguments,r=2;if(!Re(e))return e;if("number"!=typeof t[2]&&(r=t.length),r>3&&"function"==typeof t[r-2])var n=_(t[--r-1],t[r--],2);else r>2&&"function"==typeof t[r-1]&&(n=t[--r]);for(var i=d(arguments,1,r),o=-1,a=u(),s=u();++o<r;)te(e,i[o],n,a,s);return p(a),p(s),e}function Ie(e,r,n){var i={};if("function"!=typeof r){var o=[];sn(e,function(e,t){o.push(t)}),o=J(o,$(arguments,!0,!1,1));for(var a=-1,s=o.length;++a<s;){var h=o[a];i[h]=e[h]}}else r=t.createCallback(r,n,3),sn(e,function(e,t,n){r(e,t,n)||(i[t]=e)});return i}function Ne(e){for(var t=-1,r=$r(e),n=r.length,i=fr(n);++t<n;){var o=r[t];i[t]=[o,e[o]]}return i}function Oe(e,r,n){var i={};if("function"!=typeof r)for(var o=-1,a=$(arguments,!0,!1,1),s=Re(e)?a.length:0;++o<s;){var h=a[o];h in e&&(i[h]=e[h])}else r=t.createCallback(r,n,3),sn(e,function(e,t,n){r(e,t,n)&&(i[t]=e)});return i}function je(e,r,n,i){var o=Zr(e);if(null==n)if(o)n=[];else{var a=e&&e.constructor,s=a&&a.prototype;n=y(s)}return r&&(r=t.createCallback(r,i,4),(o?Qe:hn)(e,function(e,t,i){return r(n,e,t,i)})),n}function We(e){for(var t=-1,r=$r(e),n=r.length,i=fr(n);++t<n;)i[t]=e[r[t]];return i}function He(e){for(var t=arguments,r=-1,n=$(t,!0,!1,1),i=t[2]&&t[2][t[1]]===e?1:n.length,o=fr(i);++r<i;)o[r]=e[n[r]];return o}function Ge(e,t,r){var n=-1,i=he(),o=e?e.length:0,a=!1;return r=(0>r?Hr(0,o+r):r)||0,Zr(e)?a=i(e,t,r)>-1:"number"==typeof o?a=(De(e)?e.indexOf(t,r):i(e,t,r))>-1:hn(e,function(e){return++n>=r?!(a=e===t):void 0}),a}function qe(e,r,n){var i=!0;r=t.createCallback(r,n,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a&&(i=!!r(e[o],o,e)););else hn(e,function(e,t,n){return i=!!r(e,t,n)});return i}function Xe(e,r,n){var i=[];r=t.createCallback(r,n,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a;){var s=e[o];r(s,o,e)&&i.push(s)}else hn(e,function(e,t,n){r(e,t,n)&&i.push(e)});return i}function Ye(e,r,n){r=t.createCallback(r,n,3);var i=-1,o=e?e.length:0;if("number"!=typeof o){var a;return hn(e,function(e,t,n){return r(e,t,n)?(a=e,!1):void 0}),a}for(;++i<o;){var s=e[i];if(r(s,i,e))return s}}function Ke(e,r,n){var i;return r=t.createCallback(r,n,3),Ze(e,function(e,t,n){return r(e,t,n)?(i=e,!1):void 0}),i}function Qe(e,t,r){var n=-1,i=e?e.length:0;if(t=t&&"undefined"==typeof r?t:_(t,r,3),"number"==typeof i)for(;++n<i&&t(e[n],n,e)!==!1;);else hn(e,t);return e}function Ze(e,t,r){var n=e?e.length:0;if(t=t&&"undefined"==typeof r?t:_(t,r,3),"number"==typeof n)for(;n--&&t(e[n],n,e)!==!1;);else{var i=$r(e);n=i.length,hn(e,function(e,r,o){return r=i?i[--n]:--n,t(o[r],r,o)})}return e}function Je(e,t){var r=d(arguments,2),n=-1,i="function"==typeof t,o=e?e.length:0,a=fr("number"==typeof o?o:0);return Qe(e,function(e){a[++n]=(i?t:e[t]).apply(e,r)}),a}function $e(e,r,n){var i=-1,o=e?e.length:0;if(r=t.createCallback(r,n,3),"number"==typeof o)for(var a=fr(o);++i<o;)a[i]=r(e[i],i,e);else a=[],hn(e,function(e,t,n){a[++i]=r(e,t,n)});return a}function et(e,r,n){var i=-(1/0),o=i;if("function"!=typeof r&&n&&n[r]===e&&(r=null),null==r&&Zr(e))for(var s=-1,h=e.length;++s<h;){var l=e[s];l>o&&(o=l)}else r=null==r&&De(e)?a:t.createCallback(r,n,3),Qe(e,function(e,t,n){var a=r(e,t,n);a>i&&(i=a,o=e)});return o}function tt(e,r,n){var i=1/0,o=i;if("function"!=typeof r&&n&&n[r]===e&&(r=null),null==r&&Zr(e))for(var s=-1,h=e.length;++s<h;){var l=e[s];o>l&&(o=l)}else r=null==r&&De(e)?a:t.createCallback(r,n,3),Qe(e,function(e,t,n){var a=r(e,t,n);i>a&&(i=a,o=e)});return o}function rt(e,r,n,i){if(!e)return n;var o=arguments.length<3;r=t.createCallback(r,i,4);var a=-1,s=e.length;if("number"==typeof s)for(o&&(n=e[++a]);++a<s;)n=r(n,e[a],a,e);else hn(e,function(e,t,i){n=o?(o=!1,e):r(n,e,t,i)});return n}function nt(e,r,n,i){var o=arguments.length<3;return r=t.createCallback(r,i,4),Ze(e,function(e,t,i){n=o?(o=!1,e):r(n,e,t,i)}),n}function it(e,r,n){return r=t.createCallback(r,n,3),Xe(e,function(e,t,n){return!r(e,t,n)})}function ot(e,t,r){if(e&&"number"!=typeof e.length&&(e=We(e)),null==t||r)return e?e[ne(0,e.length-1)]:v;var n=at(e);return n.length=Gr(Hr(0,t),n.length),n}function at(e){var t=-1,r=e?e.length:0,n=fr("number"==typeof r?r:0);return Qe(e,function(e){var r=ne(0,++t);n[t]=n[r],n[r]=e}),n}function st(e){var t=e?e.length:0;return"number"==typeof t?t:$r(e).length}function ht(e,r,n){var i;r=t.createCallback(r,n,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a&&!(i=r(e[o],o,e)););else hn(e,function(e,t,n){return!(i=r(e,t,n))});return!!i}function lt(e,r,n){var i=-1,o=Zr(r),a=e?e.length:0,h=fr("number"==typeof a?a:0);for(o||(r=t.createCallback(r,n,3)),Qe(e,function(e,t,n){var a=h[++i]=c();o?a.criteria=$e(r,function(t){return e[t]}):(a.criteria=u())[0]=r(e,t,n),a.index=i,a.value=e}),a=h.length,h.sort(s);a--;){var l=h[a];h[a]=l.value,o||p(l.criteria),f(l)}return h}function ut(e){return e&&"number"==typeof e.length?d(e):We(e)}function ct(e){for(var t=-1,r=e?e.length:0,n=[];++t<r;){var i=e[t];i&&n.push(i)}return n}function pt(e){return J(e,$(arguments,!0,!0,1))}function ft(e,r,n){var i=-1,o=e?e.length:0;for(r=t.createCallback(r,n,3);++i<o;)if(r(e[i],i,e))return i;return-1}function dt(e,r,n){var i=e?e.length:0;for(r=t.createCallback(r,n,3);i--;)if(r(e[i],i,e))return i;return-1}function mt(e,r,n){var i=0,o=e?e.length:0;if("number"!=typeof r&&null!=r){var a=-1;for(r=t.createCallback(r,n,3);++a<o&&r(e[a],a,e);)i++}else if(i=r,null==i||n)return e?e[0]:v;return d(e,0,Gr(Hr(0,i),o))}function vt(e,t,r,n){return"boolean"!=typeof t&&null!=t&&(n=r,r="function"!=typeof t&&n&&n[t]===e?null:t,t=!1),null!=r&&(e=$e(e,r,n)),$(e,t)}function gt(e,t,r){if("number"==typeof r){var i=e?e.length:0;r=0>r?Hr(0,i+r):r||0}else if(r){var o=Tt(e,t);return e[o]===t?o:-1}return n(e,t,r)}function yt(e,r,n){var i=0,o=e?e.length:0;if("number"!=typeof r&&null!=r){var a=o;for(r=t.createCallback(r,n,3);a--&&r(e[a],a,e);)i++}else i=null==r||n?1:r||i;return d(e,0,Gr(Hr(0,o-i),o))}function xt(){for(var e=[],t=-1,r=arguments.length,o=u(),a=he(),s=a===n,l=u();++t<r;){var c=arguments[t];(Zr(c)||pe(c))&&(e.push(c),o.push(s&&c.length>=b&&h(t?e[t]:l)))}var d=e[0],m=-1,v=d?d.length:0,g=[];e:for(;++m<v;){var y=o[0];if(c=d[m],(y?i(y,c):a(l,c))<0){for(t=r,(y||l).push(c);--t;)if(y=o[t],(y?i(y,c):a(e[t],c))<0)continue e;g.push(c)}}for(;r--;)y=o[r],y&&f(y);return p(o),p(l),g}function wt(e,r,n){var i=0,o=e?e.length:0;if("number"!=typeof r&&null!=r){var a=o;for(r=t.createCallback(r,n,3);a--&&r(e[a],a,e);)i++}else if(i=r,null==i||n)return e?e[o-1]:v;return d(e,Hr(0,o-i))}function bt(e,t,r){var n=e?e.length:0;for("number"==typeof r&&(n=(0>r?Hr(0,n+r):Gr(r,n-1))+1);n--;)if(e[n]===t)return n;return-1}function _t(e){for(var t=arguments,r=0,n=t.length,i=e?e.length:0;++r<n;)for(var o=-1,a=t[r];++o<i;)e[o]===a&&(Ur.call(e,o--,1),i--);return e}function St(e,t,r){e=+e||0,r="number"==typeof r?r:+r||1,null==t&&(t=e,e=0);for(var n=-1,i=Hr(0,Ar((t-e)/(r||1))),o=fr(i);++n<i;)o[n]=e,e+=r;return o}function Mt(e,r,n){var i=-1,o=e?e.length:0,a=[];for(r=t.createCallback(r,n,3);++i<o;){var s=e[i];r(s,i,e)&&(a.push(s),Ur.call(e,i--,1),o--)}return a}function Et(e,r,n){if("number"!=typeof r&&null!=r){var i=0,o=-1,a=e?e.length:0;for(r=t.createCallback(r,n,3);++o<a&&r(e[o],o,e);)i++}else i=null==r||n?1:Hr(0,r);return d(e,i)}function Tt(e,r,n,i){var o=0,a=e?e.length:o;for(n=n?t.createCallback(n,i,1):Zt,r=n(r);a>o;){var s=o+a>>>1;n(e[s])<r?o=s+1:a=s}return o}function Ct(){return ie($(arguments,!0,!0))}function At(e,r,n,i){return"boolean"!=typeof r&&null!=r&&(i=n,n="function"!=typeof r&&i&&i[r]===e?null:r,r=!1),null!=n&&(n=t.createCallback(n,i,3)),ie(e,r,n)}function Lt(e){return J(e,d(arguments,1))}function Rt(){for(var e=-1,t=arguments.length;++e<t;){var r=arguments[e];if(Zr(r)||pe(r))var n=n?ie(J(n,r).concat(J(r,n))):r}return n||[]}function Pt(){for(var e=arguments.length>1?arguments:arguments[0],t=-1,r=e?et(fn(e,"length")):0,n=fr(0>r?0:r);++t<r;)n[t]=fn(e,t);return n}function Bt(e,t){var r=-1,n=e?e.length:0,i={};for(t||!n||Zr(e[0])||(t=[]);++r<n;){var o=e[r];t?i[o]=t[r]:o&&(i[o[0]]=o[1])}return i}function Ft(e,t){if(!Le(t))throw new _r;return function(){return--e<1?t.apply(this,arguments):void 0}}function kt(e,t){return arguments.length>2?ae(e,17,d(arguments,2),null,t):ae(e,1,null,null,t)}function Dt(e){for(var t=arguments.length>1?$(arguments,!0,!1,1):we(e),r=-1,n=t.length;++r<n;){var i=t[r];e[i]=ae(e[i],1,null,null,e)}return e}function Ut(e,t){return arguments.length>2?ae(t,19,d(arguments,2),null,e):ae(t,3,null,null,e)}function zt(){for(var e=arguments,t=e.length;t--;)if(!Le(e[t]))throw new _r;return function(){for(var t=arguments,r=e.length;r--;)t=[e[r].apply(this,t)];return t[0]}}function Vt(e,t){return t="number"==typeof t?t:+t||e.length,ae(e,4,null,null,null,t)}function It(e,t,r){var n,i,o,a,s,h,l,u=0,c=!1,p=!0;if(!Le(e))throw new _r;if(t=Hr(0,t)||0,r===!0){var f=!0;p=!1}else Re(r)&&(f=r.leading,c="maxWait"in r&&(Hr(t,r.maxWait)||0),p="trailing"in r?r.trailing:p);var d=function(){var r=t-(mn()-a);if(0>=r){i&&Lr(i);var c=l;i=h=l=v,c&&(u=mn(),o=e.apply(s,n),h||i||(n=s=null))}else h=Dr(d,r)},m=function(){h&&Lr(h),i=h=l=v,(p||c!==t)&&(u=mn(),o=e.apply(s,n),h||i||(n=s=null))};return function(){if(n=arguments,a=mn(),s=this,l=p&&(h||!f),c===!1)var r=f&&!h;else{i||f||(u=a);var v=c-(a-u),g=0>=v;g?(i&&(i=Lr(i)),u=a,o=e.apply(s,n)):i||(i=Dr(m,v))}return g&&h?h=Lr(h):h||t===c||(h=Dr(d,t)),r&&(g=!0,o=e.apply(s,n)),!g||h||i||(n=s=null),o}}function Nt(e){if(!Le(e))throw new _r;var t=d(arguments,1);return Dr(function(){e.apply(v,t)},1)}function Ot(e,t){if(!Le(e))throw new _r;var r=d(arguments,2);return Dr(function(){e.apply(v,r)},t)}function jt(e,t){if(!Le(e))throw new _r;var r=function(){var n=r.cache,i=t?t.apply(this,arguments):w+arguments[0];return Fr.call(n,i)?n[i]:n[i]=e.apply(this,arguments)};return r.cache={},r}function Wt(e){var t,r;if(!Le(e))throw new _r;return function(){return t?r:(t=!0,r=e.apply(this,arguments),e=null,r)}}function Ht(e){return ae(e,16,d(arguments,1))}function Gt(e){return ae(e,32,null,d(arguments,1))}function qt(e,t,r){var n=!0,i=!0;if(!Le(e))throw new _r;return r===!1?n=!1:Re(r)&&(n="leading"in r?r.leading:n,i="trailing"in r?r.trailing:i),X.leading=n,X.maxWait=t,X.trailing=i,It(e,t,X)}function Xt(e,t){return ae(t,16,[e])}function Yt(e){return function(){return e}}function Kt(e,t,r){var n=typeof e;if(null==e||"function"==n)return _(e,t,r);if("object"!=n)return tr(e);var i=$r(e),o=i[0],a=e[o];return 1!=i.length||a!==a||Re(a)?function(t){for(var r=i.length,n=!1;r--&&(n=ee(t[i[r]],e[i[r]],null,!0)););return n}:function(e){var t=e[o];return a===t&&(0!==a||1/a==1/t)}}function Qt(e){return null==e?"":br(e).replace(nn,se)}function Zt(e){return e}function Jt(e,n,i){var o=!0,a=n&&we(n);n&&(i||a.length)||(null==i&&(i=n),s=r,n=e,e=t,a=we(n)),i===!1?o=!1:Re(i)&&"chain"in i&&(o=i.chain);var s=e,h=Le(s);Qe(a,function(t){var r=e[t]=n[t];h&&(s.prototype[t]=function(){var t=this.__chain__,n=this.__wrapped__,i=[n];kr.apply(i,arguments);var a=r.apply(e,i);if(o||t){if(n===a&&Re(a))return this;a=new s(a),a.__chain__=t}return a})})}function $t(){return e._=Er,this}function er(){}function tr(e){return function(t){return t[e]}}function rr(e,t,r){var n=null==e,i=null==t;if(null==r&&("boolean"==typeof e&&i?(r=e,e=1):i||"boolean"!=typeof t||(r=t,i=!0)),n&&i&&(t=1),e=+e||0,i?(t=e,e=0):t=+t||0,r||e%1||t%1){var o=Xr();return Gr(e+o*(t-e+parseFloat("1e-"+((o+"").length-1))),t)}return ne(e,t)}function nr(e,t){if(e){var r=e[t];return Le(r)?e[t]():r}}function ir(e,r,n){var i=t.templateSettings;e=br(e||""),n=an({},n,i);var o,a=an({},n.imports,i.imports),s=$r(a),h=We(a),u=0,c=n.interpolate||B,p="__p += '",f=wr((n.escape||B).source+"|"+c.source+"|"+(c===R?C:B).source+"|"+(n.evaluate||B).source+"|$","g");e.replace(f,function(t,r,n,i,a,s){return n||(n=i),p+=e.slice(u,s).replace(k,l),r&&(p+="' +\n__e("+r+") +\n'"),a&&(o=!0,p+="';\n"+a+";\n__p += '"),n&&(p+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),u=s+t.length,t}),p+="';\n";var d=n.variable,m=d;m||(d="obj",p="with ("+d+") {\n"+p+"\n}\n"),p=(o?p.replace(M,""):p).replace(E,"$1").replace(T,"$1;"),p="function("+d+") {\n"+(m?"":d+" || ("+d+" = {});\n")+"var __t, __p = '', __e = _.escape"+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var g="\n/*\n//# sourceURL="+(n.sourceURL||"/lodash/template/source["+U++ +"]")+"\n*/";try{var y=vr(s,"return "+p+g).apply(v,h)}catch(x){throw x.source=p,x}return r?y(r):(y.source=p,y)}function or(e,t,r){e=(e=+e)>-1?e:0;var n=-1,i=fr(e);for(t=_(t,r,1);++n<e;)i[n]=t(n);return i}function ar(e){return null==e?"":br(e).replace(rn,ce)}function sr(e){var t=++x;return br(null==e?"":e)+t}function hr(e){return e=new r(e),e.__chain__=!0,e}function lr(e,t){return t(e),e}function ur(){return this.__chain__=!0,this}function cr(){return br(this.__wrapped__)}function pr(){return this.__wrapped__}e=e?re.defaults(Z.Object(),e,re.pick(Z,D)):Z;var fr=e.Array,dr=e.Boolean,mr=e.Date,vr=e.Function,gr=e.Math,yr=e.Number,xr=e.Object,wr=e.RegExp,br=e.String,_r=e.TypeError,Sr=[],Mr=xr.prototype,Er=e._,Tr=Mr.toString,Cr=wr("^"+br(Tr).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Ar=gr.ceil,Lr=e.clearTimeout,Rr=gr.floor,Pr=vr.prototype.toString,Br=le(Br=xr.getPrototypeOf)&&Br,Fr=Mr.hasOwnProperty,kr=Sr.push,Dr=e.setTimeout,Ur=Sr.splice,zr=Sr.unshift,Vr=function(){try{var e={},t=le(t=xr.defineProperty)&&t,r=t(e,e,e)&&t}catch(n){}return r}(),Ir=le(Ir=xr.create)&&Ir,Nr=le(Nr=fr.isArray)&&Nr,Or=e.isFinite,jr=e.isNaN,Wr=le(Wr=xr.keys)&&Wr,Hr=gr.max,Gr=gr.min,qr=e.parseInt,Xr=gr.random,Yr={};Yr[V]=fr,Yr[I]=dr,Yr[N]=mr,Yr[O]=vr,Yr[W]=xr,Yr[j]=yr,Yr[H]=wr,Yr[G]=br,r.prototype=t.prototype;var Kr=t.support={};Kr.funcDecomp=!le(e.WinRTError)&&F.test(m),Kr.funcNames="string"==typeof vr.name,t.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:R,variable:"",imports:{_:t}},Ir||(y=function(){function t(){}return function(r){if(Re(r)){t.prototype=r;var n=new t;t.prototype=null}return n||e.Object()}}());var Qr=Vr?function(e,t){Y.value=t,Vr(e,"__bindData__",Y),Y.value=null}:er,Zr=Nr||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Tr.call(e)==V||!1},Jr=function(e){var t,r=e,n=[];if(!r)return n;if(!K[typeof e])return n;for(t in r)Fr.call(r,t)&&n.push(t);return n},$r=Wr?function(e){return Re(e)?Wr(e):[]}:Jr,en={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},tn=_e(en),rn=wr("("+$r(tn).join("|")+")","g"),nn=wr("["+$r(en).join("")+"]","g"),on=function(e,t,r){var n,i=e,o=i;if(!i)return o;var a=arguments,s=0,h="number"==typeof r?2:a.length;if(h>3&&"function"==typeof a[h-2])var l=_(a[--h-1],a[h--],2);else h>2&&"function"==typeof a[h-1]&&(l=a[--h]);for(;++s<h;)if(i=a[s],i&&K[typeof i])for(var u=-1,c=K[typeof i]&&$r(i),p=c?c.length:0;++u<p;)n=c[u],o[n]=l?l(o[n],i[n]):i[n];return o},an=function(e,t,r){var n,i=e,o=i;if(!i)return o;for(var a=arguments,s=0,h="number"==typeof r?2:a.length;++s<h;)if(i=a[s],i&&K[typeof i])for(var l=-1,u=K[typeof i]&&$r(i),c=u?u.length:0;++l<c;)n=u[l],"undefined"==typeof o[n]&&(o[n]=i[n]);return o},sn=function(e,t,r){var n,i=e,o=i;if(!i)return o;if(!K[typeof i])return o;t=t&&"undefined"==typeof r?t:_(t,r,3);for(n in i)if(t(i[n],n,e)===!1)return o;return o},hn=function(e,t,r){var n,i=e,o=i;if(!i)return o;if(!K[typeof i])return o;t=t&&"undefined"==typeof r?t:_(t,r,3);for(var a=-1,s=K[typeof i]&&$r(i),h=s?s.length:0;++a<h;)if(n=s[a],t(i[n],n,e)===!1)return o;return o},ln=Br?function(e){if(!e||Tr.call(e)!=W)return!1;var t=e.valueOf,r=le(t)&&(r=Br(t))&&Br(r);return r?e==r||Br(e)==r:ue(e)}:ue,un=oe(function(e,t,r){Fr.call(e,r)?e[r]++:e[r]=1}),cn=oe(function(e,t,r){(Fr.call(e,r)?e[r]:e[r]=[]).push(t)}),pn=oe(function(e,t,r){e[r]=t}),fn=$e,dn=Xe,mn=le(mn=mr.now)&&mn||function(){return(new mr).getTime()},vn=8==qr(S+"08")?qr:function(e,t){return qr(De(e)?e.replace(P,""):e,t||0)};return t.after=Ft,t.assign=on,t.at=He,t.bind=kt,t.bindAll=Dt,t.bindKey=Ut,t.chain=hr,t.compact=ct,t.compose=zt,t.constant=Yt,t.countBy=un,t.create=me,t.createCallback=Kt,t.curry=Vt,t.debounce=It,t.defaults=an,t.defer=Nt,t.delay=Ot,t.difference=pt,t.filter=Xe,t.flatten=vt,t.forEach=Qe,t.forEachRight=Ze,t.forIn=sn,t.forInRight=ye,t.forOwn=hn,t.forOwnRight=xe,t.functions=we,t.groupBy=cn,t.indexBy=pn,t.initial=yt,t.intersection=xt,t.invert=_e,t.invoke=Je,t.keys=$r,t.map=$e,t.mapValues=ze,t.max=et,t.memoize=jt,t.merge=Ve,t.min=tt,t.omit=Ie,t.once=Wt,t.pairs=Ne,t.partial=Ht,t.partialRight=Gt,t.pick=Oe,t.pluck=fn,t.property=tr,t.pull=_t,t.range=St,t.reject=it,t.remove=Mt,t.rest=Et,t.shuffle=at,t.sortBy=lt,t.tap=lr,t.throttle=qt,t.times=or,t.toArray=ut,t.transform=je,t.union=Ct,t.uniq=At,t.values=We,t.where=dn,t.without=Lt,t.wrap=Xt,t.xor=Rt,t.zip=Pt,t.zipObject=Bt,t.collect=$e,t.drop=Et,t.each=Qe,t.eachRight=Ze,t.extend=on,t.methods=we,t.object=Bt,t.select=Xe,t.tail=Et,t.unique=At,t.unzip=Pt,Jt(t),t.clone=fe,t.cloneDeep=de,t.contains=Ge,t.escape=Qt,t.every=qe,t.find=Ye,t.findIndex=ft,t.findKey=ve,t.findLast=Ke,t.findLastIndex=dt,t.findLastKey=ge,t.has=be,t.identity=Zt,t.indexOf=gt,t.isArguments=pe,t.isArray=Zr,t.isBoolean=Se,t.isDate=Me,t.isElement=Ee,t.isEmpty=Te,t.isEqual=Ce,t.isFinite=Ae,t.isFunction=Le,t.isNaN=Pe,t.isNull=Be,t.isNumber=Fe,t.isObject=Re,t.isPlainObject=ln,t.isRegExp=ke,t.isString=De,t.isUndefined=Ue,t.lastIndexOf=bt,t.mixin=Jt,t.noConflict=$t,t.noop=er,t.now=mn,t.parseInt=vn,t.random=rr,t.reduce=rt,t.reduceRight=nt,t.result=nr,t.runInContext=m,t.size=st,t.some=ht,t.sortedIndex=Tt,t.template=ir,t.unescape=ar,t.uniqueId=sr,t.all=qe,t.any=ht,t.detect=Ye,t.findWhere=Ye,t.foldl=rt,t.foldr=nt,t.include=Ge,t.inject=rt,Jt(function(){var e={};return hn(t,function(r,n){t.prototype[n]||(e[n]=r)}),e}(),!1),t.first=mt,t.last=wt,t.sample=ot,t.take=mt,t.head=mt,hn(t,function(e,n){var i="sample"!==n;t.prototype[n]||(t.prototype[n]=function(t,n){var o=this.__chain__,a=e(this.__wrapped__,t,n);return o||null!=t&&(!n||i&&"function"==typeof t)?new r(a,o):a})}),t.VERSION="2.4.2",t.prototype.chain=ur,t.prototype.toString=cr,t.prototype.value=pr,t.prototype.valueOf=pr,Qe(["join","pop","shift"],function(e){var n=Sr[e];t.prototype[e]=function(){var e=this.__chain__,t=n.apply(this.__wrapped__,arguments);return e?new r(t,e):t}}),Qe(["push","reverse","sort","unshift"],function(e){var r=Sr[e];t.prototype[e]=function(){return r.apply(this.__wrapped__,arguments),this}}),Qe(["concat","slice","splice"],function(e){var n=Sr[e];t.prototype[e]=function(){return new r(n.apply(this.__wrapped__,arguments),this.__chain__)}}),t}var v,g=[],y=[],x=0,w=+new Date+"",b=75,_=40,S=" 	\f \ufeff\n\r\u2028\u2029 ᠎             　",M=/\b__p \+= '';/g,E=/\b(__p \+=) '' \+/g,T=/(__e\(.*?\)|\b__t\)) \+\n'';/g,C=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,A=/\w*$/,L=/^\s*function[ \n\r\t]+\w/,R=/<%=([\s\S]+?)%>/g,P=RegExp("^["+S+"]*0+(?=.$)"),B=/($^)/,F=/\bthis\b/,k=/['\n\r\t\u2028\u2029\\]/g,D=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],U=0,z="[object Arguments]",V="[object Array]",I="[object Boolean]",N="[object Date]",O="[object Function]",j="[object Number]",W="[object Object]",H="[object RegExp]",G="[object String]",q={};q[O]=!1,q[z]=q[V]=q[I]=q[N]=q[j]=q[W]=q[H]=q[G]=!0;var X={leading:!1,maxWait:0,trailing:!1},Y={configurable:!1,enumerable:!1,value:null,writable:!1},K={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Q={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},Z=K[typeof window]&&window||this,J=K[typeof r]&&r&&!r.nodeType&&r,$=K[typeof t]&&t&&!t.nodeType&&t,ee=$&&$.exports===J&&J,te=K[typeof e]&&e;!te||te.global!==te&&te.window!==te||(Z=te);var re=m();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Z._=re,define(function(){return re})):J&&$?ee?($.exports=re)._=re:J._=re:Z._=re}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],40:[function(e,t,r){for(var n=e("performance-now"),i="undefined"==typeof window?{}:window,o=["moz","webkit"],a="AnimationFrame",s=i["request"+a],h=i["cancel"+a]||i["cancelRequest"+a],l=!0,u=0;u<o.length&&!s;u++)s=i[o[u]+"Request"+a],h=i[o[u]+"Cancel"+a]||i[o[u]+"CancelRequest"+a];if(!s||!h){l=!1;var c=0,p=0,f=[],d=1e3/60;s=function(e){if(0===f.length){var t=n(),r=Math.max(0,d-(t-c));c=r+t,setTimeout(function(){var e=f.slice(0);f.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(c)}catch(r){setTimeout(function(){throw r},0)}},Math.round(r))}return f.push({handle:++p,callback:e,cancelled:!1}),p},h=function(e){for(var t=0;t<f.length;t++)f[t].handle===e&&(f[t].cancelled=!0)}}t.exports=function(e){return l?s.call(i,function(){try{e.apply(this,arguments)}catch(t){setTimeout(function(){throw t},0)}}):s.call(i,e)},t.exports.cancel=function(){h.apply(i,arguments)}},{"performance-now":41}],41:[function(e,t,r){(function(e){(function(){var r,n,i;"undefined"!=typeof performance&&null!==performance&&performance.now?t.exports=function(){return performance.now()}:"undefined"!=typeof e&&null!==e&&e.hrtime?(t.exports=function(){return(r()-i)/1e6},n=e.hrtime,r=function(){var e;return e=n(),1e9*e[0]+e[1]},i=r()):Date.now?(t.exports=function(){return Date.now()-i},i=Date.now()):(t.exports=function(){return(new Date).getTime()-i},i=(new Date).getTime())}).call(this)}).call(this,e("_process"))},{_process:77}],42:[function(e,t,r){arguments[4][21][0].apply(r,arguments)},{dup:21}],43:[function(e,t,r){function n(e){e=e||{},this.degradeWhen=void 0!==e.degradeWhen?e.degradeWhen:this.degradeWhen,this.upgradeWhen=void 0!==e.upgradeWhen?e.upgradeWhen:this.upgradeWhen,this.denominatorMax=void 0!==e.denominatorMax?e.denominatorMax:this.denominatorMax,this.changeFactor=void 0!==e.changeFactor?e.changeFactor:this.changeFactor,this.updateFrequency=void 0!==e.updateFrequency?e.updateFrequency:this.updateFrequency,this.onChange=new i.Signal}var i=e("signals"),o=e("./FPS");n.prototype={denominator:1,degradeWhen:10,upgradeWhen:24,denominatorMax:8,dirty:0,updateFrequency:5,changeFactor:1.25,onChange:void 0,update:function(){0==this.dirty&&(o.fps<=this.degradeWhen?(this.denominator*=this.changeFactor,this.denominator<=this.denominatorMax?this.makeDirty():this.denominator=this.denominatorMax):o.fps>=this.upgradeWhen&&(this.denominator/=this.changeFactor,this.denominator>=.99?this.makeDirty():this.denominator=1)),this.denominatorSquared=this.denominator*this.denominator,this.dirty>0&&this.dirty--},makeDirty:function(){this.onChange.dispatch(1/this.denominator),this.dirty=this.updateFrequency}},t.exports=n},{"./FPS":45,signals:42}],44:[function(e,t,r){var n={FULLSCREEN:"fullscreen",CONTAINER:"container"};t.exports=n},{}],45:[function(e,t,r){function n(){this.lastTime=new Date,this.animationFrame=this.animationFrame.bind(this),requestAnimationFrame(this.animationFrame)}n.prototype={filterStrength:20,frameTime:0,lastTime:0,thisTime:new Date,fps:0,idealFrameDuration:1e3/60,animSpeedCompensation:1,animationFrame:function(){this.update(),requestAnimationFrame(this.animationFrame);
},update:function(){var e=this.thisTime;this.thisTime=new Date,e=this.thisTime-e;var t=this.thisTime-this.lastTime;t>100&&(t=100);var r=this.frameTime-t;this.frameTime-=r/this.filterStrength,this.lastTime=this.thisTime,this.fps=1e3/this.frameTime,this.animSpeedCompensation=e/this.idealFrameDuration}},t.exports=new n},{}],46:[function(e,t,r){function n(e){s?s=!1:requestAnimationFrame(e)}function i(e,t){this.running=!1,this._frame=0,t===!1&&(a=n),this.view=e,this.skipFrames=0,this.skipFramesCounter=0,this.onEnterFrame=new o.Signal,this.onExitFrame=new o.Signal,this.render=this.render.bind(this),this.renderLoop=this.renderLoop.bind(this)}var o=e("signals"),a=e("raf"),s=!1;n.cancel=function(){s=!0},i.prototype={_requestStop:!1,renderLoop:function(){this.skipFramesCounter<this.skipFrames?this.skipFramesCounter++:(this.render(),this.skipFramesCounter=0),this._frame=a(this.renderLoop)},render:function(){this.onEnterFrame.dispatch(),this.view.render(),this.onExitFrame.dispatch()},start:function(){this.running||(this.running=!0,this._frame=a(this.renderLoop))},stop:function(){this.running=!1,0!==this._frame&&a.cancel(this._frame)}},t.exports=i},{raf:40,signals:42}],47:[function(e,t,r){var n,i,o,a=function(e){n=e,i=new Stats,document.body.appendChild(i.domElement),i.domElement.style["pointer-events"]="none",i.domElement.style["z-index"]="1",i.domElement.style.position="absolute",o=new THREEx.RendererStats,o.domElement.style.position="absolute",o.domElement.style.left="0px",o.domElement.style.bottom="0px",o.domElement.style["pointer-events"]="none",o.domElement.style["z-index"]="1",document.body.appendChild(o.domElement)},s=function(){o.update(n),i.begin()},h=function(){i.end()};a.prototype={onEnterFrame:s,onExitFrame:h},t.exports=a},{}],48:[function(e,t,r){function n(e){e=e||{},this.addCanvasContainerToDOMBody=this.addCanvasContainerToDOMBody.bind(this),this.addCanvasToContainer=this.addCanvasToContainer.bind(this),this.adaptiveResolution=e.adaptiveResolution,this.adaptiveResolutionManager=new a(e.adaptiveResolutionSettings),this.fitAxis=e.fitAxis||"y",this.skipRender=Boolean(e.skipRender),this.scene=e.scene||new THREE.Scene,e.rendererSettings=e.rendererSettings||{},e.camera?this.camera=e.camera:(this.camera=new THREE.PerspectiveCamera,this.scene.add(this.camera),this.camera.position.z=8.5,this.camera.position.y=8,this.camera.lookAt(this.scene.position)),this.camera instanceof THREE.PerspectiveCamera?this.setCamera=this.setCameraPerspective:this.camera instanceof THREE.OrthographicCamera&&(this.setCamera=this.setCameraOthrographic),this.autoStartRender=e.autoStartRender!==!0,this.canvasContainerID=e.canvasContainerID||"WebGLCanvasContainer",this.domMode=e.domMode||(e.canvasContainer?i.CONTAINER:i.FULLSCREEN),this.canvasContainer=e.canvasContainer||this.createCanvasContainer(this.canvasContainerID),this.canvasID=e.canvasID||"WebGLCanvas",this.domMode=e.domMode||(this.canvasContainer?i.CONTAINER:i.FULLSCREEN),this.domSize={x:0,y:0},this.canvas=document.getElementById(this.canvasID)||this.createCanvas(),this.rendererSettings=h.merge({canvas:this.canvas,antialias:!0},e.rendererSettings),void 0!==e.renderer?this.renderer=e.renderer:this.renderer=new THREE.WebGLRenderer(this.rendererSettings),this.rendererSettings.autoClear===!1&&(this.renderer.autoClear=!1),this.renderManager=new u(this,e.useRafPolyfill),this.autoStartRender&&this.renderManager.start(),this.adaptiveResolutionManager.onChange.add(this.onAdaptiveResolutionManagerChangeResolution.bind(this)),this.dpr=this.renderer.devicePixelRatio,this.setupResizing(),e.stats&&(this.stats=new l(this.renderer),this.renderManager.onEnterFrame.add(this.stats.onEnterFrame),this.renderManager.onExitFrame.add(this.stats.onExitFrame))}var i=e("./DOMMode"),o=(e("browser-event-adder"),e("signals").Signal),a=e("./AdaptiveResolutionManager"),s=e("input-resize"),h=e("lodash"),l=e("./RenderStats"),u=e("./RenderManager");n.prototype={setupResizing:function(){this._onResizeSignal=s.onResize,this.setSize=this.setSize.bind(this),this._onResizeSignal.add(this.setSize),this.onResizeSignal=new o,s.bump()},render:function(){this.adaptiveResolution&&this.adaptiveResolutionManager.update(),this.skipRender||this.renderer.render(this.scene,this.camera)},createCanvasContainer:function(e){var t=document.createElement("div");return t.id=e,t.width=window.innerWidth,t.height=window.innerHeight,this.addCanvasContainerToDOMBody(t),this.setDOMMode(t,this.domMode),t},createCanvas:function(){var e=document.createElement("canvas");return e.id=this.canvasID,e.width=window.innerWidth,e.height=window.innerHeight,this.addCanvasToContainer(e),this.setDOMMode(e,this.domMode),e},addCanvasContainerToDOMBody:function(e){e=e||this.canvasContainer,document.body?document.body.appendChild(e):setTimeout(this.addCanvasContainerToDOMBody,50)},addCanvasToContainer:function(e){e=e||this.canvas,this.canvasContainer?this.canvasContainer.appendChild(e):setTimeout(this.addCanvasToContainer,50)},setDOMMode:function(e,t){var r=e.style;switch(t){case i.FULLSCREEN:r.position="fixed",r.left="0px",r.top="0px",r.width="100%",r.height="100%";break;case i.CONTAINER:r.position="absolute",r.left="0px",r.top="0px",r.width=this.canvasContainer.clientWidth+"px",r.height=this.canvasContainer.clientHeight+"px"}},setSize:function(e,t,r){this.domMode!=i.CONTAINER||r||(e=this.canvasContainer.clientWidth,t=this.canvasContainer.clientHeight),this.domSize.x=e,this.domSize.y=t,this.canvas.style.width=e,this.canvas.style.height=t,this.setCamera(e,t),this.setResolution(~~(e/this.adaptiveResolutionManager.denominator),~~(t/this.adaptiveResolutionManager.denominator)),this.onResizeSignal.dispatch(e,t)},setCameraPerspective:function(e,t){this.camera.aspect=e/t,"x"==this.fitAxis&&this.camera.setLens(e,t),720==e&&console.log(e,t),this.camera.updateProjectionMatrix()},setCameraOthrographic:function(e,t){this.camera.left=0,this.camera.right=e,this.camera.top=0,this.camera.bottom=t,this.camera.updateProjectionMatrix()},getSize:function(){return{width:this.domSize.x,height:this.domSize.y}},setResolution:function(e,t){this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this.renderer.setSize(e,t,!1),this.canvas.style.width=this.domSize.x+"px",this.canvas.style.height=this.domSize.y+"px"},getResolution:function(){return{width:this.canvas.width,height:this.canvas.height}},onAdaptiveResolutionManagerChangeResolution:function(e){this.setResolution(~~(window.innerWidth*e),~~(window.innerHeight*e))},captureImageData:function(e){var t=this.canvas,r=this.domSize.x,n=this.domSize.y;e=h.merge({width:r,height:n,format:"jpeg"},e);var i="jpg"===e.format?"jpeg":e.format;this.setSize(e.width/this.dpr,e.height/this.dpr,!0);var o="image/"+i,a=this.skipRender;this.skipRender=!1,this.renderManager.render(),this.skipRender=a;var s=t.toDataURL(o,e.encoderOptions);return this.setSize(r,n,!0),s}},t.exports=n},{"./AdaptiveResolutionManager":43,"./DOMMode":44,"./RenderManager":46,"./RenderStats":47,"browser-event-adder":37,"input-resize":38,lodash:39,signals:42}],49:[function(e,t,r){t.exports={DOMMode:e("./DOMMode"),RenderManager:e("./RenderManager"),RenderStats:e("./RenderStats"),View:e("./View"),AdaptiveResolutionManager:e("./AdaptiveResolutionManager")}},{"./AdaptiveResolutionManager":43,"./DOMMode":44,"./RenderManager":46,"./RenderStats":47,"./View":48}],50:[function(e,t,r){function n(e,t,r,n){e=e||new THREE.Color(11513775),t=t||new THREE.Color(4144959),e instanceof THREE.Color||(e=new THREE.Color(e)),t instanceof THREE.Color||(t=new THREE.Color(t)),r=r||4,n=n||4,n=Math.max(n,1),r=Math.max(r,1);for(var i=16,o=new Uint8Array(3*i),a=0,s=i;s>a;a++){var h=3*a,l=~~(a/2)%2==0?e:t;a>=8&&(l=l===e?t:e),o[h]=~~(255*l.r),o[h+1]=~~(255*l.g),o[h+2]=~~(255*l.b)}var u=4,c=4,p=THREE.RGBFormat,f=THREE.UnsignedByteType,d=void 0,m=THREE.RepeatWrapping,v=THREE.RepeatWrapping,g=THREE.NearestFilter,y=THREE.NearestFilter;THREE.DataTexture.call(this,o,u,c,p,f,d,m,v,g,y),this.repeat.set(.5*r,.5*n),this.needsUpdate=!0}n.prototype=Object.create(THREE.DataTexture.prototype),t.exports=n},{}],51:[function(e,t,r){function n(){a||(a=!0,console.log("URL PARAMS AVAILABLE: "+o.join(", ")))}function i(e,t){if(!i.active)return t||null;-1==o.indexOf(e)&&(o.push(e),a=!1,setTimeout(n,2e3));var r=new RegExp("[\\?&]"+e+"=([^&#]*)"),s=r.exec(window.location.href);return null==s?t:"true"==s[1]?!0:"false"==s[1]?!1:isNaN(s[1])?s[1]||t||!1:parseInt(s[1])}var o=[],a=!1;i.active=!0,t.exports=i},{}],52:[function(e,t,r){"use strict";function n(e,t){function r(){4===c.readyState&&o()}function n(){var e=void 0;if(c.response?e=c.response:"text"!==c.responseType&&c.responseType||(e=c.responseText||c.responseXML),x)try{e=JSON.parse(e)}catch(t){}return e}function i(e){clearTimeout(f),e instanceof Error||(e=new Error(""+(e||"unknown"))),e.statusCode=0,t(e,u)}function o(){clearTimeout(f);var e=1223===c.status?204:c.status,r=u,i=null;0!==e?(r={body:n(),statusCode:e,method:m,headers:{},url:d,rawRequest:c},c.getAllResponseHeaders&&(r.headers=s(c.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),t(i,r,r.body)}var u={body:void 0,headers:{},statusCode:0,method:m,url:d,rawRequest:c};if("string"==typeof e&&(e={uri:e}),e=e||{},"undefined"==typeof t)throw new Error("callback argument missing");t=a(t);var c=e.xhr||null;c||(c=e.cors||e.useXDR?new l:new h);var p,f,d=c.url=e.uri||e.url,m=c.method=e.method||"GET",v=e.body||e.data,g=c.headers=e.headers||{},y=!!e.sync,x=!1;if("json"in e&&(x=!0,g.Accept||(g.Accept="application/json"),"GET"!==m&&"HEAD"!==m&&(g["Content-Type"]="application/json",v=JSON.stringify(e.json))),c.onreadystatechange=r,c.onload=o,c.onerror=i,c.onprogress=function(){},c.ontimeout=i,c.open(m,d,!y),c.withCredentials=!!e.withCredentials,!y&&e.timeout>0&&(f=setTimeout(function(){c.abort("timeout")},e.timeout+2)),c.setRequestHeader)for(p in g)g.hasOwnProperty(p)&&c.setRequestHeader(p,g[p]);else if(e.headers)throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(c.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(c),c.send(v),c}function i(){}var o=e("global/window"),a=e("once"),s=e("parse-headers"),h=o.XMLHttpRequest||i,l="withCredentials"in new h?h:o.XDomainRequest;t.exports=n},{"global/window":53,once:54,"parse-headers":58}],53:[function(e,t,r){(function(e){"undefined"!=typeof window?t.exports=window:"undefined"!=typeof e?t.exports=e:"undefined"!=typeof self?t.exports=self:t.exports={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],54:[function(e,t,r){function n(e){var t=!1;return function(){return t?void 0:(t=!0,e.apply(this,arguments))}}t.exports=n,n.proto=n(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return n(this)},configurable:!0})})},{}],55:[function(e,t,r){function n(e,t,r){if(!s(t))throw new TypeError("iterator must be a function");arguments.length<3&&(r=this),"[object Array]"===h.call(e)?i(e,t,r):"string"==typeof e?o(e,t,r):a(e,t,r)}function i(e,t,r){for(var n=0,i=e.length;i>n;n++)l.call(e,n)&&t.call(r,e[n],n,e)}function o(e,t,r){for(var n=0,i=e.length;i>n;n++)t.call(r,e.charAt(n),n,e)}function a(e,t,r){for(var n in e)l.call(e,n)&&t.call(r,e[n],n,e)}var s=e("is-function");t.exports=n;var h=Object.prototype.toString,l=Object.prototype.hasOwnProperty},{"is-function":56}],56:[function(e,t,r){function n(e){var t=i.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}t.exports=n;var i=Object.prototype.toString},{}],57:[function(e,t,r){function n(e){return e.replace(/^\s*|\s*$/g,"")}r=t.exports=n,r.left=function(e){return e.replace(/^\s*/,"")},r.right=function(e){return e.replace(/\s*$/,"")}},{}],58:[function(e,t,r){var n=e("trim"),i=e("for-each"),o=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.exports=function(e){if(!e)return{};var t={};return i(n(e).split("\n"),function(e){var r=e.indexOf(":"),i=n(e.slice(0,r)).toLowerCase(),a=n(e.slice(r+1));"undefined"==typeof t[i]?t[i]=a:o(t[i])?t[i].push(a):t[i]=[t[i],a]}),t}},{"for-each":55,trim:57}],59:[function(e,t,r){function n(){var e,t=s("file",null),r=s("port",9966),n=new a;if(t)if(-1!==t.indexOf("http:")){var l=window.location.href.split("/");l[2]=l[2].split(":"),l[2][1]=r,l[2]=l[2].join(":"),l.pop(),l=l.join("/"),l+="/"+t,e=l}else e=t;else window.location+="?file=https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js";var u={uri:e,useXDR:!0};o(u,function(e,t,r){if(e)return void console.error(e);var o=i.parse(r,{tolerant:h.tolerant,sourceType:h.sourceType});n.dispatch(o)}),this.onTreeSignal=n}var i=e("esprima"),o=e("xhr"),a=e("signals").Signal,s=e("urlparam"),h={comment:!0,range:!0,loc:!0,tokens:!0,raw:!0,tolerant:!0,source:null};t.exports=n},{esprima:15,signals:22,urlparam:51,xhr:52}],60:[function(e,t,r){function n(e){var t=new i(e.viewManager.canvas);this.pointers=t}var i=e("input-unified-pointers");t.exports=n},{"input-unified-pointers":16}],61:[function(e,t,r){function n(e){this.app=e,this.buildTree=this.buildTree.bind(this),this.onNodeSignal=new i,this.onCompleteSignal=new i}var i=e("signals").Signal;n.prototype.buildTree=function(e){function t(e){-1===i.indexOf(e)&&i.push(e)}function r(e,r){if(e){if(-1!==a.indexOf(e))return void h++;a.push(e);var i;if(e instanceof Array)for(i=e.length-1;i>=0;i--)o.push([e[i],r]);else e instanceof Object&&(e.type&&(t(e.type),s++,n.dispatch(e,r),r=e),Object.keys(e).forEach(function(t){o.push([e[t],r])}))}}var n=this.onNodeSignal,i=[],o=[[e]],a=[],s=1,h=0;n.dispatch(e);for(var l=100;o.length>0&&l>0;){var u=o.slice();o.length=0,l--;for(var c=u.length-1;c>=0;c--)r.apply(null,u[c])}0===l&&console.warn("Tree not full. Increase iters."),console.log(o.length),console.log("tree node types:",i.length,i),console.log("branches:",a.length),console.log("nodes:",s),console.log("stillToProcess:",o.length),console.log("skippedBranches:",h),this.onCompleteSignal.dispatch()},t.exports=n},{signals:22}],62:[function(e,t,r){function n(){return a||(a=new h(.5,100,!0)),a}function i(e){-1===l.indexOf(e)&&l.push(e);var t=l.indexOf(e);if(!u[t]){var r=new THREE.Color;r.setHSL(t/24%1,1,.75),u[t]=new THREE.MeshPhongMaterial({morphTargets:!0,color:r,side:THREE.BackSide})}return u[t]}function o(e){this.app=e,this.registered=[],this.meshes=[],this.rootMeshes=[],this.multiParented=0,this.attempts=0,this.orphans=0,this.addNode=this.addNode.bind(this)}var a,s=e("utils/math/point-on-sphere-fibonacci"),h=e("geometry/SphereSimplicialFibonacci"),l=[],u=[],c=0;o.prototype.addNode=function(e,t){if(this.attempts++,-1!==this.registered.indexOf(e))return void this.multiParented++;this.registered.push(e);var r,o=this.registered.indexOf(t),a=this.meshes[o];r=a?a.depth+1:0;var h=new THREE.Mesh(n(),i(e.type));h.id2=c++,h.morphTargetInfluences[0]=0;var l=new THREE.Object3D;if(l.position.y=1,h.add(l),h.attachPoint=l,h.depth=r,this.meshes.push(h),h.scale.multiplyScalar(.8),a){var u=a.attachPoint;u.add(h);var p=u.children;p.forEach(function(e,t){var r=s(t,6*p.length);e.rotation.y=r[0],e.rotation.z=r[1]+.5*Math.PI}),p.length>1&&(u.rotation.y=.5*Math.PI);var f=Math.sqrt(p.length)/5*20;p.forEach(function(e,t){e.scale.y=.8*f,e.id2<=10&&console.log(e.id2,e.scale.y,1/f),e.attachPoint.scale.y=1/f,e.morphTargetInfluences[0]=1-1/f})}else this.rootMeshes.push(h),h.depth=0,this.orphans++},o.prototype.test=function(e){for(var t=new THREE.Object3D,r=0;e>r;r++){var o=new THREE.Mesh(n(),i("normal"));t.add(o);var a=s(r,6*e);o.rotation.y=a[0],o.rotation.z=a[1]+.5*Math.PI}return t.scale.multiplyScalar(3),t.position.z=3,t.rotation.x=.5*Math.PI,t},t.exports=o},{"geometry/SphereSimplicialFibonacci":66,"utils/math/point-on-sphere-fibonacci":67}],63:[function(e,t,r){function n(e){var t=new i;t.renderManager.skipFrames=o("skipFrames",0),this.view=t,this.scene=t.scene,this.camera=t.camera,this.canvas=t.canvas}var i=e("threejs-managed-view").View,o=e("urlparam");t.exports=n},{"threejs-managed-view":49,urlparam:51}],64:[function(e,t,r){function n(e){function t(e,t,r){var n=new THREE.Mesh(R,P);g.add(n);var i=10*Math.random()+1,o=new s.Sphere(L*i);n.scale.multiplyScalar(i),o.material=D;var a=new s.Body({mass:5*Math.pow(i,3),position:new s.Vec3(e,t,r+L*i),shape:o,linearDamping:.1,angularDamping:.1,collisionFilterGroup:f,collisionFilterMask:c|p|f});C.addBody(a),A.push({mesh:n,body:a})}var r=1,n=new u,d=e.viewManager.view,m=e.viewManager.camera;m.near=.001,m.far=40,m.updateProjectionMatrix();var v=new THREE.PointLight(16777215,1,1,2);m.add(v);var g=e.viewManager.scene,y=new THREE.Fog(8355711,m.near,m.far);g.fog=y;var x=e.viewManager.canvas,w=e.inputManager.pointers;m.up.set(0,0,1),m.position.set(0,30,30),m.lookAt(new THREE.Vector3);var b=new i(m,x,{upAxis:"z",yUp:!1,movementSpeed:.1}),_=b.keyboard,S=0,M=.001;d.renderManager.onEnterFrame.add(function(){b.update();var e;_.isPressed("dash")&&(e=!0,S-=M),_.isPressed("equals")&&(e=!0,S+=M),e||(S=0),0!==S&&(r*=1+S,r=l(r,1e-5,40),b.movementSpeed=.1*r,v.distance=r,y.near=m.near=.001*r,y.far=40*r,m.far=y.far+.1,m.updateProjectionMatrix(),n.dispatch(r))}),d.renderer.setClearColor(8355711),w.onPointerDownSignal.add(function(){console.log("down")});var E=new THREE.MeshPhongMaterial({map:new a(7294783,8347471,1e3,1e3)}),T=new THREE.Mesh(new THREE.PlaneGeometry(1e3,1e3,1,1),E);g.add(T);var C=new s.World;C.gravity.set(0,0,10),C.gravity.w=.4,C.broadphase=new s.NaiveBroadphase,C.solver.iterations=10;var A=[],L=.5,R=new THREE.SphereGeometry(L,32,16),P=(new o,new THREE.MeshPhongMaterial({color:16777215,map:new a})),B=new THREE.HemisphereLight(8368079,7294783,1);B.position.set(0,0,100),g.add(B);var F=new s.Body({mass:0,collisionFilterGroup:c,collisionFilterMask:p|f}),k=new s.Plane,D=new s.Material;D.friction=.9,k.material=D,F.addShape(k),C.addBody(F);var U=new s.Cylinder(.05,.06,.15,16),z=new s.Body({mass:50,position:new s.Vec3(0,5,5),rotation:new s.Vec3(0,1,0),shape:U,fixedRotation:!0,linearDamping:.5,resistGravity:!0,collisionFilterGroup:p,collisionFilterMask:c|f}),V=new s.Sphere(.1);z.addShape(V,new s.Vec3(0,0,0)),z.quaternion.setFromEuler(.5*Math.PI,0,0),z.position.set(0,6,6);var I=new THREE.Object3D,N=new THREE.Object3D;N.add(m),N.position.y=1.05,m.position.set(0,0,0),N.rotation.x=Math.PI*-.5,I.add(N);var O={mesh:I,body:z};A.push(O);var j=new s.Quaternion;j.setFromAxisAngle(new s.Vec3(1,0,0),-Math.PI/2);var W=new s.Vec3(0,0,0);z.shapes[0].transformAllPoints(W,j),C.add(z),g.add(I);for(var H=1/60,G=3,q=0;q<h("ballsTotal",0);q++)t(20*Math.random()-10,20*Math.random()-10,0);var X,Y=new s.RaycastResult,K={collisionFilterMask:c},Q=z.position,Z=z.position.clone();!function J(e){if(requestAnimationFrame(J),void 0!==X){var t=(e-X)/1e3;C.step(H,t,G)}z.position.vadd(m.position,z.position),m.position.set(0,0,0),b.keyboard.isPressed("space")&&(Z.copy(Q),Z.z-=2,C.raycastClosest(Q,Z,K,Y),Y.body===F&&Y.distance<1),A.forEach(function(e){e.mesh.position.copy(e.body.position),e.mesh.quaternion.copy(e.body.quaternion)}),X=e}()}THREE=e("three");var i=e("threejs-camera-controller-first-person-desktop"),o=e("threejs-gui-crosshair"),a=e("threejs-texture-checkerboard"),s=e("cannon"),h=e("urlparam"),l=e("clamp"),u=e("signals").Signal,c=1,p=2,f=4;t.exports=n},{cannon:1,clamp:2,signals:22,three:23,"threejs-camera-controller-first-person-desktop":24,"threejs-gui-crosshair":36,"threejs-texture-checkerboard":50,urlparam:51}],65:[function(e,t,r){function n(){var e=this;this.viewManager=new i(this),this.inputManager=new o(this),this.worldManager=new a(this),this.esprimaManager=new s(this),this.treeBuilder=new h(this),this.treeVisualizer=new l(this),this.esprimaManager.onTreeSignal.add(this.treeBuilder.buildTree),this.treeBuilder.onNodeSignal.add(this.treeVisualizer.addNode),this.treeBuilder.onCompleteSignal.add(function(){var t=e.treeVisualizer.rootMeshes,r=e.viewManager.scene;console.warn("attempts",e.treeVisualizer.attempts),console.warn("multiParented",e.treeVisualizer.multiParented),console.warn("orphans",e.treeVisualizer.orphans);for(var n=t.length-1;n>=0;n--)r.add(t[n]),t[n].scale.multiplyScalar(.15),t[n].rotation.x=.5*Math.PI})}var i=e("./ViewManager"),o=e("./InputManager"),a=e("./WorldManager"),s=e("./EsprimaManager"),h=e("./TreeBuilder"),l=e("./TreeVisualizer");t.exports=n},{"./EsprimaManager":59,"./InputManager":60,"./TreeBuilder":61,"./TreeVisualizer":62,"./ViewManager":63,"./WorldManager":64}],66:[function(e,t,r){function n(e,t,r){function n(e,t){return e-t}e=void 0!==e?e:20,t=void 0!==t?t:20;var a,s,h,l=[],u=new THREE.Geometry,c=u.vertices;for(a=0;t>a;a++){var p=i(a,t),f=p[0],d=p[1],m=[Math.cos(d)*Math.cos(f)*e,Math.sin(d)*e,Math.cos(d)*Math.sin(f)*e];l.push(m),c.push((new THREE.Vector3).fromArray(m))}var v=o(l),g=[];for(a=0;a<v.length;a++){var y=v[a];g.push(y[0],y[1],y[3]),g.push(y[0],y[2],y[1]),g.push(y[0],y[3],y[2]),g.push(y[3],y[1],y[2])}var x=[],w=[],b=[];for(a=0;a<g.length;a+=3)b[0]=g[a],b[1]=g[a+1],b[2]=g[a+2],b=b.sort(n),s=b[0]+","+b[1]+","+b[2],h=x.indexOf(s),-1===h&&(h=x.length,x.push(s),w.push(0)),w[h]++;for(a=0;a<g.length;a+=3)if(b[0]=g[a],b[1]=g[a+1],b[2]=g[a+2],b=b.sort(n),s=b[0]+","+b[1]+","+b[2],h=x.indexOf(s),1===w[h]){var _=new THREE.Face3(g[a],g[a+1],g[a+2]);u.faces.push(_)}if(u.computeFaceNormals(),u.computeVertexNormals(),r){var S=[];u.vertices.forEach(function(e){e.y>0&&(e.multiplyScalar(.8),e.y+=1);var t=e.clone();t.y<0?t.y=0:t.y=1,S.push(t)}),u.morphTargets.push({name:"target",vertices:S})}return u}var i=e("utils/math/point-on-sphere-fibonacci"),o=e("delaunay-triangulate");t.exports=n},{"delaunay-triangulate":14,"utils/math/point-on-sphere-fibonacci":67}],67:[function(e,t,r){function n(e,t){return[o*e,Math.asin(-1+2*e/t)]}var i=.5*(Math.sqrt(5)+1)-1,o=i*Math.PI*2;t.exports=n},{}],68:[function(e,t,r){var n=e("./src");new n},{"./src":65}],69:[function(e,t,r){},{}],70:[function(e,t,r){function n(e){return this instanceof n?(this.length=0,this.parent=void 0,"number"==typeof e?i(this,e):"string"==typeof e?o(this,e,arguments.length>1?arguments[1]:"utf8"):a(this,e)):arguments.length>1?new n(e,arguments[1]):new n(e)}function i(e,t){if(e=p(e,0>t?0:0|f(t)),!n.TYPED_ARRAY_SUPPORT)for(var r=0;t>r;r++)e[r]=0;return e}function o(e,t,r){("string"!=typeof r||""===r)&&(r="utf8");var n=0|m(t,r);return e=p(e,n),e.write(t,r),e}function a(e,t){if(n.isBuffer(t))return s(e,t);if(q(t))return h(e,t);if(null==t)throw new TypeError("must start with number, buffer, array or string");return"undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer?l(e,t):t.length?u(e,t):c(e,t)}function s(e,t){var r=0|f(t.length);return e=p(e,r),t.copy(e,0,0,r),e}function h(e,t){var r=0|f(t.length);e=p(e,r);for(var n=0;r>n;n+=1)e[n]=255&t[n];return e}function l(e,t){var r=0|f(t.length);e=p(e,r);for(var n=0;r>n;n+=1)e[n]=255&t[n];return e}function u(e,t){var r=0|f(t.length);e=p(e,r);for(var n=0;r>n;n+=1)e[n]=255&t[n];return e}function c(e,t){var r,n=0;"Buffer"===t.type&&q(t.data)&&(r=t.data,n=0|f(r.length)),e=p(e,n);for(var i=0;n>i;i+=1)e[i]=255&r[i];return e}function p(e,t){n.TYPED_ARRAY_SUPPORT?e=n._augment(new Uint8Array(t)):(e.length=t,e._isBuffer=!0);var r=0!==t&&t<=n.poolSize>>>1;return r&&(e.parent=Y),e}function f(e){if(e>=X)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+X.toString(16)+" bytes");return 0|e}function d(e,t){if(!(this instanceof d))return new d(e,t);var r=new n(e,t);return delete r.parent,r}function m(e,t){if("string"!=typeof e&&(e=String(e)),0===e.length)return 0;switch(t||"utf8"){case"ascii":case"binary":case"raw":return e.length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e.length;case"hex":return e.length>>>1;case"utf8":case"utf-8":return V(e).length;case"base64":return O(e).length;default:return e.length}}function v(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n),n>i&&(n=i)):n=i;var o=t.length;if(o%2!==0)throw new Error("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;n>a;a++){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))throw new Error("Invalid hex string");e[r+a]=s}return a}function g(e,t,r,n){return j(V(t,e.length-r),e,r,n)}function y(e,t,r,n){return j(I(t),e,r,n)}function x(e,t,r,n){return y(e,t,r,n)}function w(e,t,r,n){return j(O(t),e,r,n)}function b(e,t,r,n){return j(N(t,e.length-r),e,r,n)}function _(e,t,r){return 0===t&&r===e.length?H.fromByteArray(e):H.fromByteArray(e.slice(t,r))}function S(e,t,r){var n="",i="";r=Math.min(e.length,r);for(var o=t;r>o;o++)e[o]<=127?(n+=W(i)+String.fromCharCode(e[o]),i=""):i+="%"+e[o].toString(16);return n+W(i)}function M(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;r>i;i++)n+=String.fromCharCode(127&e[i]);return n}function E(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;r>i;i++)n+=String.fromCharCode(e[i]);return n}function T(e,t,r){var n=e.length;(!t||0>t)&&(t=0),(!r||0>r||r>n)&&(r=n);for(var i="",o=t;r>o;o++)i+=z(e[o]);return i}function C(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function A(e,t,r){if(e%1!==0||0>e)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,r,i,o,a){if(!n.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");if(t>o||a>t)throw new RangeError("value is out of bounds");if(r+i>e.length)throw new RangeError("index out of range")}function R(e,t,r,n){0>t&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);o>i;i++)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function P(e,t,r,n){0>t&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);o>i;i++)e[r+i]=t>>>8*(n?i:3-i)&255}function B(e,t,r,n,i,o){if(t>i||o>t)throw new RangeError("value is out of bounds");if(r+n>e.length)throw new RangeError("index out of range");if(0>r)throw new RangeError("index out of range")}function F(e,t,r,n,i){return i||B(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),G.write(e,t,r,n,23,4),r+4}function k(e,t,r,n,i){return i||B(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),G.write(e,t,r,n,52,8),r+8}function D(e){if(e=U(e).replace(Q,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function U(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function z(e){return 16>e?"0"+e.toString(16):e.toString(16)}function V(e,t){t=t||1/0;for(var r,n=e.length,i=null,o=[],a=0;n>a;a++){if(r=e.charCodeAt(a),r>55295&&57344>r){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(56320>r){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&((t-=3)>-1&&o.push(239,191,189),i=null);if(128>r){if((t-=1)<0)break;o.push(r)}else if(2048>r){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(65536>r){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(2097152>r))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function I(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t}function N(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);a++)r=e.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}function O(e){return H.toByteArray(D(e))}function j(e,t,r,n){for(var i=0;n>i&&!(i+r>=t.length||i>=e.length);i++)t[i+r]=e[i];return i}function W(e){try{return decodeURIComponent(e)}catch(t){return String.fromCharCode(65533)}}var H=e("base64-js"),G=e("ieee754"),q=e("is-array");r.Buffer=n,r.SlowBuffer=d,r.INSPECT_MAX_BYTES=50,n.poolSize=8192;var X=1073741823,Y={};n.TYPED_ARRAY_SUPPORT=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(r){return!1}}(),n.isBuffer=function(e){return!(null==e||!e._isBuffer)},n.compare=function(e,t){if(!n.isBuffer(e)||!n.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,i=t.length,o=0,a=Math.min(r,i);a>o&&e[o]===t[o];)++o;return o!==a&&(r=e[o],i=t[o]),i>r?-1:r>i?1:0},n.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},n.concat=function(e,t){if(!q(e))throw new TypeError("list argument must be an Array of Buffers.");if(0===e.length)return new n(0);if(1===e.length)return e[0];var r;if(void 0===t)for(t=0,r=0;r<e.length;r++)t+=e[r].length;var i=new n(t),o=0;for(r=0;r<e.length;r++){var a=e[r];a.copy(i,o),o+=a.length}return i},n.byteLength=m,n.prototype.length=void 0,n.prototype.parent=void 0,n.prototype.toString=function(e,t,r){var n=!1;if(t=0|t,r=void 0===r||r===1/0?this.length:0|r,e||(e="utf8"),0>t&&(t=0),r>this.length&&(r=this.length),t>=r)return"";for(;;)switch(e){case"hex":return T(this,t,r);case"utf8":case"utf-8":return S(this,t,r);case"ascii":return M(this,t,r);case"binary":return E(this,t,r);case"base64":return _(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}},n.prototype.equals=function(e){if(!n.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:0===n.compare(this,e)},n.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},n.prototype.compare=function(e){if(!n.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?0:n.compare(this,e)},n.prototype.indexOf=function(e,t){function r(e,t,r){for(var n=-1,i=0;r+i<e.length;i++)if(e[r+i]===t[-1===n?0:i-n]){if(-1===n&&(n=i),i-n+1===t.length)return r+n}else n=-1;return-1}if(t>2147483647?t=2147483647:-2147483648>t&&(t=-2147483648),t>>=0,0===this.length)return-1;if(t>=this.length)return-1;if(0>t&&(t=Math.max(this.length+t,0)),"string"==typeof e)return 0===e.length?-1:String.prototype.indexOf.call(this,e,t);if(n.isBuffer(e))return r(this,e,t);if("number"==typeof e)return n.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,e,t):r(this,[e],t);throw new TypeError("val must be string, number or Buffer")},n.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},n.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},n.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t=0|t,isFinite(r)?(r=0|r,void 0===n&&(n="utf8")):(n=r,r=void 0);else{var i=n;n=t,t=0|r,r=i}var o=this.length-t;if((void 0===r||r>o)&&(r=o),e.length>0&&(0>r||0>t)||t>this.length)throw new RangeError("attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return v(this,e,t,r);case"utf8":case"utf-8":return g(this,e,t,r);case"ascii":return y(this,e,t,r);case"binary":return x(this,e,t,r);case"base64":return w(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},n.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},n.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,0>e?(e+=r,0>e&&(e=0)):e>r&&(e=r),0>t?(t+=r,0>t&&(t=0)):t>r&&(t=r),e>t&&(t=e);var i;if(n.TYPED_ARRAY_SUPPORT)i=n._augment(this.subarray(e,t));else{var o=t-e;i=new n(o,void 0);for(var a=0;o>a;a++)i[a]=this[a+e]}return i.length&&(i.parent=this.parent||this),i},n.prototype.readUIntLE=function(e,t,r){e=0|e,t=0|t,r||A(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},n.prototype.readUIntBE=function(e,t,r){e=0|e,t=0|t,r||A(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;
return n},n.prototype.readUInt8=function(e,t){return t||A(e,1,this.length),this[e]},n.prototype.readUInt16LE=function(e,t){return t||A(e,2,this.length),this[e]|this[e+1]<<8},n.prototype.readUInt16BE=function(e,t){return t||A(e,2,this.length),this[e]<<8|this[e+1]},n.prototype.readUInt32LE=function(e,t){return t||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},n.prototype.readUInt32BE=function(e,t){return t||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},n.prototype.readIntLE=function(e,t,r){e=0|e,t=0|t,r||A(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},n.prototype.readIntBE=function(e,t,r){e=0|e,t=0|t,r||A(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},n.prototype.readInt8=function(e,t){return t||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},n.prototype.readInt16LE=function(e,t){t||A(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},n.prototype.readInt16BE=function(e,t){t||A(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},n.prototype.readInt32LE=function(e,t){return t||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},n.prototype.readInt32BE=function(e,t){return t||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},n.prototype.readFloatLE=function(e,t){return t||A(e,4,this.length),G.read(this,e,!0,23,4)},n.prototype.readFloatBE=function(e,t){return t||A(e,4,this.length),G.read(this,e,!1,23,4)},n.prototype.readDoubleLE=function(e,t){return t||A(e,8,this.length),G.read(this,e,!0,52,8)},n.prototype.readDoubleBE=function(e,t){return t||A(e,8,this.length),G.read(this,e,!1,52,8)},n.prototype.writeUIntLE=function(e,t,r,n){e=+e,t=0|t,r=0|r,n||L(this,e,t,r,Math.pow(2,8*r),0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},n.prototype.writeUIntBE=function(e,t,r,n){e=+e,t=0|t,r=0|r,n||L(this,e,t,r,Math.pow(2,8*r),0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},n.prototype.writeUInt8=function(e,t,r){return e=+e,t=0|t,r||L(this,e,t,1,255,0),n.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=e,t+1},n.prototype.writeUInt16LE=function(e,t,r){return e=+e,t=0|t,r||L(this,e,t,2,65535,0),n.TYPED_ARRAY_SUPPORT?(this[t]=e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},n.prototype.writeUInt16BE=function(e,t,r){return e=+e,t=0|t,r||L(this,e,t,2,65535,0),n.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e):R(this,e,t,!1),t+2},n.prototype.writeUInt32LE=function(e,t,r){return e=+e,t=0|t,r||L(this,e,t,4,4294967295,0),n.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e):P(this,e,t,!0),t+4},n.prototype.writeUInt32BE=function(e,t,r){return e=+e,t=0|t,r||L(this,e,t,4,4294967295,0),n.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e):P(this,e,t,!1),t+4},n.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t=0|t,!n){var i=Math.pow(2,8*r-1);L(this,e,t,r,i-1,-i)}var o=0,a=1,s=0>e?1:0;for(this[t]=255&e;++o<r&&(a*=256);)this[t+o]=(e/a>>0)-s&255;return t+r},n.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t=0|t,!n){var i=Math.pow(2,8*r-1);L(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0>e?1:0;for(this[t+o]=255&e;--o>=0&&(a*=256);)this[t+o]=(e/a>>0)-s&255;return t+r},n.prototype.writeInt8=function(e,t,r){return e=+e,t=0|t,r||L(this,e,t,1,127,-128),n.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),0>e&&(e=255+e+1),this[t]=e,t+1},n.prototype.writeInt16LE=function(e,t,r){return e=+e,t=0|t,r||L(this,e,t,2,32767,-32768),n.TYPED_ARRAY_SUPPORT?(this[t]=e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},n.prototype.writeInt16BE=function(e,t,r){return e=+e,t=0|t,r||L(this,e,t,2,32767,-32768),n.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e):R(this,e,t,!1),t+2},n.prototype.writeInt32LE=function(e,t,r){return e=+e,t=0|t,r||L(this,e,t,4,2147483647,-2147483648),n.TYPED_ARRAY_SUPPORT?(this[t]=e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},n.prototype.writeInt32BE=function(e,t,r){return e=+e,t=0|t,r||L(this,e,t,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),n.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e):P(this,e,t,!1),t+4},n.prototype.writeFloatLE=function(e,t,r){return F(this,e,t,!0,r)},n.prototype.writeFloatBE=function(e,t,r){return F(this,e,t,!1,r)},n.prototype.writeDoubleLE=function(e,t,r){return k(this,e,t,!0,r)},n.prototype.writeDoubleBE=function(e,t,r){return k(this,e,t,!1,r)},n.prototype.copy=function(e,t,r,i){if(r||(r=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&r>i&&(i=r),i===r)return 0;if(0===e.length||0===this.length)return 0;if(0>t)throw new RangeError("targetStart out of bounds");if(0>r||r>=this.length)throw new RangeError("sourceStart out of bounds");if(0>i)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);var o=i-r;if(1e3>o||!n.TYPED_ARRAY_SUPPORT)for(var a=0;o>a;a++)e[a+t]=this[a+r];else e._set(this.subarray(r,r+o),t);return o},n.prototype.fill=function(e,t,r){if(e||(e=0),t||(t=0),r||(r=this.length),t>r)throw new RangeError("end < start");if(r!==t&&0!==this.length){if(0>t||t>=this.length)throw new RangeError("start out of bounds");if(0>r||r>this.length)throw new RangeError("end out of bounds");var n;if("number"==typeof e)for(n=t;r>n;n++)this[n]=e;else{var i=V(e.toString()),o=i.length;for(n=t;r>n;n++)this[n]=i[n%o]}return this}},n.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(n.TYPED_ARRAY_SUPPORT)return new n(this).buffer;for(var e=new Uint8Array(this.length),t=0,r=e.length;r>t;t+=1)e[t]=this[t];return e.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var K=n.prototype;n._augment=function(e){return e.constructor=n,e._isBuffer=!0,e._set=e.set,e.get=K.get,e.set=K.set,e.write=K.write,e.toString=K.toString,e.toLocaleString=K.toString,e.toJSON=K.toJSON,e.equals=K.equals,e.compare=K.compare,e.indexOf=K.indexOf,e.copy=K.copy,e.slice=K.slice,e.readUIntLE=K.readUIntLE,e.readUIntBE=K.readUIntBE,e.readUInt8=K.readUInt8,e.readUInt16LE=K.readUInt16LE,e.readUInt16BE=K.readUInt16BE,e.readUInt32LE=K.readUInt32LE,e.readUInt32BE=K.readUInt32BE,e.readIntLE=K.readIntLE,e.readIntBE=K.readIntBE,e.readInt8=K.readInt8,e.readInt16LE=K.readInt16LE,e.readInt16BE=K.readInt16BE,e.readInt32LE=K.readInt32LE,e.readInt32BE=K.readInt32BE,e.readFloatLE=K.readFloatLE,e.readFloatBE=K.readFloatBE,e.readDoubleLE=K.readDoubleLE,e.readDoubleBE=K.readDoubleBE,e.writeUInt8=K.writeUInt8,e.writeUIntLE=K.writeUIntLE,e.writeUIntBE=K.writeUIntBE,e.writeUInt16LE=K.writeUInt16LE,e.writeUInt16BE=K.writeUInt16BE,e.writeUInt32LE=K.writeUInt32LE,e.writeUInt32BE=K.writeUInt32BE,e.writeIntLE=K.writeIntLE,e.writeIntBE=K.writeIntBE,e.writeInt8=K.writeInt8,e.writeInt16LE=K.writeInt16LE,e.writeInt16BE=K.writeInt16BE,e.writeInt32LE=K.writeInt32LE,e.writeInt32BE=K.writeInt32BE,e.writeFloatLE=K.writeFloatLE,e.writeFloatBE=K.writeFloatBE,e.writeDoubleLE=K.writeDoubleLE,e.writeDoubleBE=K.writeDoubleBE,e.fill=K.fill,e.inspect=K.inspect,e.toArrayBuffer=K.toArrayBuffer,e};var Q=/[^+\/0-9A-z\-]/g},{"base64-js":71,ieee754:72,"is-array":73}],71:[function(e,t,r){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(e){"use strict";function t(e){var t=e.charCodeAt(0);return t===a||t===c?62:t===s||t===p?63:h>t?-1:h+10>t?t-h+26+26:u+26>t?t-u:l+26>t?t-l+26:void 0}function r(e){function r(e){l[c++]=e}var n,i,a,s,h,l;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var u=e.length;h="="===e.charAt(u-2)?2:"="===e.charAt(u-1)?1:0,l=new o(3*e.length/4-h),a=h>0?e.length-4:e.length;var c=0;for(n=0,i=0;a>n;n+=4,i+=3)s=t(e.charAt(n))<<18|t(e.charAt(n+1))<<12|t(e.charAt(n+2))<<6|t(e.charAt(n+3)),r((16711680&s)>>16),r((65280&s)>>8),r(255&s);return 2===h?(s=t(e.charAt(n))<<2|t(e.charAt(n+1))>>4,r(255&s)):1===h&&(s=t(e.charAt(n))<<10|t(e.charAt(n+1))<<4|t(e.charAt(n+2))>>2,r(s>>8&255),r(255&s)),l}function i(e){function t(e){return n.charAt(e)}function r(e){return t(e>>18&63)+t(e>>12&63)+t(e>>6&63)+t(63&e)}var i,o,a,s=e.length%3,h="";for(i=0,a=e.length-s;a>i;i+=3)o=(e[i]<<16)+(e[i+1]<<8)+e[i+2],h+=r(o);switch(s){case 1:o=e[e.length-1],h+=t(o>>2),h+=t(o<<4&63),h+="==";break;case 2:o=(e[e.length-2]<<8)+e[e.length-1],h+=t(o>>10),h+=t(o>>4&63),h+=t(o<<2&63),h+="="}return h}var o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="+".charCodeAt(0),s="/".charCodeAt(0),h="0".charCodeAt(0),l="a".charCodeAt(0),u="A".charCodeAt(0),c="-".charCodeAt(0),p="_".charCodeAt(0);e.toByteArray=r,e.fromByteArray=i}("undefined"==typeof r?this.base64js={}:r)},{}],72:[function(e,t,r){r.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,h=(1<<s)-1,l=h>>1,u=-7,c=r?i-1:0,p=r?-1:1,f=e[t+c];for(c+=p,o=f&(1<<-u)-1,f>>=-u,u+=s;u>0;o=256*o+e[t+c],c+=p,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=n;u>0;a=256*a+e[t+c],c+=p,u-=8);if(0===o)o=1-l;else{if(o===h)return a?NaN:(f?-1:1)*(1/0);a+=Math.pow(2,n),o-=l}return(f?-1:1)*a*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var a,s,h,l=8*o-i-1,u=(1<<l)-1,c=u>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,d=n?1:-1,m=0>t||0===t&&0>1/t?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-a))<1&&(a--,h*=2),t+=a+c>=1?p/h:p*Math.pow(2,1-c),t*h>=2&&(a++,h/=2),a+c>=u?(s=0,a=u):a+c>=1?(s=(t*h-1)*Math.pow(2,i),a+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[r+f]=255&a,f+=d,a/=256,l-=8);e[r+f-d]|=128*m}},{}],73:[function(e,t,r){var n=Array.isArray,i=Object.prototype.toString;t.exports=n||function(e){return!!e&&"[object Array]"==i.call(e)}},{}],74:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!o(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,o,h,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(r=this._events[e],s(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),h=1;n>h;h++)o[h-1]=arguments[h];r.apply(this,o)}else if(a(r)){for(n=arguments.length,o=new Array(n-1),h=1;n>h;h++)o[h-1]=arguments[h];for(l=r.slice(),n=l.length,h=0;n>h;h++)l[h].apply(this,o)}return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned){var r;r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,o,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],o=r.length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(r)){for(s=o;s-->0;)if(r[s]===t||r[s].listener&&r[s].listener===t){n=s;break}if(0>n)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.listenerCount=function(e,t){var r;return r=e._events&&e._events[t]?i(e._events[t])?1:e._events[t].length:0}},{}],75:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],76:[function(e,t,r){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],77:[function(e,t,r){function n(){u=!1,s.length?l=s.concat(l):c=-1,l.length&&i()}function i(){if(!u){var e=setTimeout(n);u=!0;for(var t=l.length;t;){for(s=l,l=[];++c<t;)s[c].run();c=-1,t=l.length}s=null,u=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function a(){}var s,h=t.exports={},l=[],u=!1,c=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new o(e,t)),1!==l.length||u||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],78:[function(e,t,r){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":79}],79:[function(e,t,r){(function(r){function n(e){return this instanceof n?(h.call(this,e),l.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",i)):new n(e)}function i(){this.allowHalfOpen||this._writableState.ended||r.nextTick(this.end.bind(this))}function o(e,t){for(var r=0,n=e.length;n>r;r++)t(e[r],r)}t.exports=n;var a=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},s=e("core-util-is");s.inherits=e("inherits");var h=e("./_stream_readable"),l=e("./_stream_writable");s.inherits(n,h),o(a(l.prototype),function(e){n.prototype[e]||(n.prototype[e]=l.prototype[e])})}).call(this,e("_process"))},{"./_stream_readable":81,"./_stream_writable":83,_process:77,"core-util-is":84,inherits:75}],80:[function(e,t,r){function n(e){return this instanceof n?void i.call(this,e):new n(e)}t.exports=n;var i=e("./_stream_transform"),o=e("core-util-is");o.inherits=e("inherits"),o.inherits(n,i),n.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":82,"core-util-is":84,inherits:75}],81:[function(e,t,r){(function(r){function n(t,r){var n=e("./_stream_duplex");t=t||{};var i=t.highWaterMark,o=t.objectMode?16:16384;this.highWaterMark=i||0===i?i:o,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,r instanceof n&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(A||(A=e("string_decoder/").StringDecoder),this.decoder=new A(t.encoding),this.encoding=t.encoding)}function i(t){e("./_stream_duplex");return this instanceof i?(this._readableState=new n(t,this),this.readable=!0,void T.call(this)):new i(t)}function o(e,t,r,n,i){var o=l(t,r);if(o)e.emit("error",o);else if(C.isNullOrUndefined(r))t.reading=!1,t.ended||u(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!i){var s=new Error("stream.push() after EOF");e.emit("error",s)}else if(t.endEmitted&&i){var s=new Error("stream.unshift() after end event");e.emit("error",s)}else!t.decoder||i||n||(r=t.decoder.write(r)),i||(t.reading=!1),t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,i?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&c(e)),f(e,t);else i||(t.reading=!1);return a(t)}function a(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function s(e){if(e>=R)e=R;else{e--;for(var t=1;32>t;t<<=1)e|=e>>t;e++}return e}function h(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:isNaN(e)||C.isNull(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:0>=e?0:(e>t.highWaterMark&&(t.highWaterMark=s(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function l(e,t){var r=null;return C.isBuffer(t)||C.isString(t)||C.isNullOrUndefined(t)||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}function u(e,t){if(t.decoder&&!t.ended){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,c(e)}function c(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(L("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?r.nextTick(function(){p(e)}):p(e))}function p(e){L("emit readable"),e.emit("readable"),y(e)}function f(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(function(){d(e,t)}))}function d(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(L("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function m(e){return function(){var t=e._readableState;L("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&E.listenerCount(e,"data")&&(t.flowing=!0,y(e))}}function v(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(function(){g(e,t)}))}function g(e,t){t.resumeScheduled=!1,e.emit("resume"),y(e),t.flowing&&!t.reading&&e.read(0)}function y(e){var t=e._readableState;if(L("flow",t.flowing),t.flowing)do var r=e.read();while(null!==r&&t.flowing)}function x(e,t){var r,n=t.buffer,i=t.length,o=!!t.decoder,a=!!t.objectMode;if(0===n.length)return null;if(0===i)r=null;else if(a)r=n.shift();else if(!e||e>=i)r=o?n.join(""):M.concat(n,i),n.length=0;else if(e<n[0].length){var s=n[0];r=s.slice(0,e),n[0]=s.slice(e)}else if(e===n[0].length)r=n.shift();else{r=o?"":new M(e);for(var h=0,l=0,u=n.length;u>l&&e>h;l++){var s=n[0],c=Math.min(e-h,s.length);o?r+=s.slice(0,c):s.copy(r,h,0,c),c<s.length?n[0]=s.slice(c):n.shift(),h+=c}}return r}function w(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");t.endEmitted||(t.ended=!0,r.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function b(e,t){for(var r=0,n=e.length;n>r;r++)t(e[r],r)}function _(e,t){for(var r=0,n=e.length;n>r;r++)if(e[r]===t)return r;return-1}t.exports=i;var S=e("isarray"),M=e("buffer").Buffer;i.ReadableState=n;var E=e("events").EventEmitter;E.listenerCount||(E.listenerCount=function(e,t){return e.listeners(t).length});var T=e("stream"),C=e("core-util-is");C.inherits=e("inherits");var A,L=e("util");L=L&&L.debuglog?L.debuglog("stream"):function(){},C.inherits(i,T),i.prototype.push=function(e,t){var r=this._readableState;return C.isString(e)&&!r.objectMode&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=new M(e,t),t="")),o(this,r,e,t,!1)},i.prototype.unshift=function(e){var t=this._readableState;return o(this,t,e,"",!0)},i.prototype.setEncoding=function(t){return A||(A=e("string_decoder/").StringDecoder),this._readableState.decoder=new A(t),this._readableState.encoding=t,this};var R=8388608;i.prototype.read=function(e){L("read",e);var t=this._readableState,r=e;if((!C.isNumber(e)||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return L("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?w(this):c(this),null;if(e=h(e,t),0===e&&t.ended)return 0===t.length&&w(this),null;var n=t.needReadable;L("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&(n=!0,L("length less than watermark",n)),(t.ended||t.reading)&&(n=!1,L("reading or ended",n)),n&&(L("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),n&&!t.reading&&(e=h(r,t));var i;return i=e>0?x(e,t):null,C.isNull(i)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),r!==e&&t.ended&&0===t.length&&w(this),C.isNull(i)||this.emit("data",i),i},i.prototype._read=function(e){this.emit("error",new Error("not implemented"))},i.prototype.pipe=function(e,t){function n(e){L("onunpipe"),e===c&&o()}function i(){L("onend"),e.end()}function o(){L("cleanup"),e.removeListener("close",h),e.removeListener("finish",l),e.removeListener("drain",v),e.removeListener("error",s),e.removeListener("unpipe",n),c.removeListener("end",i),c.removeListener("end",o),c.removeListener("data",a),!p.awaitDrain||e._writableState&&!e._writableState.needDrain||v()}function a(t){L("ondata");var r=e.write(t);!1===r&&(L("false write response, pause",c._readableState.awaitDrain),c._readableState.awaitDrain++,c.pause())}function s(t){L("onerror",t),u(),e.removeListener("error",s),0===E.listenerCount(e,"error")&&e.emit("error",t)}function h(){e.removeListener("finish",l),u()}function l(){L("onfinish"),e.removeListener("close",h),u()}function u(){L("unpipe"),c.unpipe(e)}var c=this,p=this._readableState;switch(p.pipesCount){case 0:p.pipes=e;break;case 1:p.pipes=[p.pipes,e];break;default:p.pipes.push(e)}p.pipesCount+=1,L("pipe count=%d opts=%j",p.pipesCount,t);var f=(!t||t.end!==!1)&&e!==r.stdout&&e!==r.stderr,d=f?i:o;p.endEmitted?r.nextTick(d):c.once("end",d),e.on("unpipe",n);var v=m(c);return e.on("drain",v),c.on("data",a),e._events&&e._events.error?S(e._events.error)?e._events.error.unshift(s):e._events.error=[s,e._events.error]:e.on("error",s),e.once("close",h),e.once("finish",l),e.emit("pipe",c),p.flowing||(L("pipe resume"),c.resume()),e},i.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;n>i;i++)r[i].emit("unpipe",this);return this}var i=_(t.pipes,e);return-1===i?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},i.prototype.on=function(e,t){var n=T.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&this.readable){var i=this._readableState;if(!i.readableListening)if(i.readableListening=!0,i.emittedReadable=!1,i.needReadable=!0,i.reading)i.length&&c(this,i);else{var o=this;r.nextTick(function(){L("readable nexttick read 0"),o.read(0)})}}return n},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){var e=this._readableState;return e.flowing||(L("resume"),e.flowing=!0,e.reading||(L("resume read 0"),this.read(0)),v(this,e)),this},i.prototype.pause=function(){return L("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(L("pause"),this._readableState.flowing=!1,this.emit("pause")),this},i.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;e.on("end",function(){if(L("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(i){if(L("wrapped data"),t.decoder&&(i=t.decoder.write(i)),i&&(t.objectMode||i.length)){var o=n.push(i);o||(r=!0,e.pause())}});for(var i in e)C.isFunction(e[i])&&C.isUndefined(this[i])&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var o=["error","close","destroy","pause","resume"];return b(o,function(t){e.on(t,n.emit.bind(n,t))}),n._read=function(t){L("wrapped _read",t),r&&(r=!1,e.resume())},n},i._fromList=x}).call(this,e("_process"))},{"./_stream_duplex":79,_process:77,buffer:70,"core-util-is":84,events:74,inherits:75,isarray:76,stream:89,"string_decoder/":90,util:69}],82:[function(e,t,r){function n(e,t){this.afterTransform=function(e,r){return i(t,e,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function i(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,h.isNullOrUndefined(r)||e.push(r),i&&i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);s.call(this,e),this._transformState=new n(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("prefinish",function(){h.isFunction(this._flush)?this._flush(function(e){a(t,e)}):a(t)})}function a(e,t){if(t)return e.emit("error",t);var r=e._writableState,n=e._transformState;if(r.length)throw new Error("calling transform done when ws.length != 0");if(n.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}t.exports=o;var s=e("./_stream_duplex"),h=e("core-util-is");h.inherits=e("inherits"),h.inherits(o,s),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,r){throw new Error("not implemented")},o.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;h.isNull(t.writechunk)||!t.writecb||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))}},{"./_stream_duplex":79,"core-util-is":84,inherits:75}],83:[function(e,t,r){(function(r){function n(e,t,r){this.chunk=e,this.encoding=t,this.callback=r}function i(t,r){var n=e("./_stream_duplex");t=t||{};var i=t.highWaterMark,o=t.objectMode?16:16384;this.highWaterMark=i||0===i?i:o,this.objectMode=!!t.objectMode,r instanceof n&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var a=t.decodeStrings===!1;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){f(r,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function o(t){var r=e("./_stream_duplex");return this instanceof o||this instanceof r?(this._writableState=new i(t,this),this.writable=!0,void S.call(this)):new o(t)}function a(e,t,n){var i=new Error("write after end");e.emit("error",i),r.nextTick(function(){n(i)})}function s(e,t,n,i){var o=!0;if(!(_.isBuffer(n)||_.isString(n)||_.isNullOrUndefined(n)||t.objectMode)){var a=new TypeError("Invalid non-string/buffer chunk");e.emit("error",a),r.nextTick(function(){i(a)}),o=!1}return o}function h(e,t,r){return!e.objectMode&&e.decodeStrings!==!1&&_.isString(t)&&(t=new b(t,r)),t}function l(e,t,r,i,o){r=h(t,r,i),_.isBuffer(r)&&(i="buffer");var a=t.objectMode?1:r.length;t.length+=a;var s=t.length<t.highWaterMark;return s||(t.needDrain=!0),t.writing||t.corked?t.buffer.push(new n(r,i,o)):u(e,t,!1,a,r,i,o),s}function u(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function c(e,t,n,i,o){n?r.nextTick(function(){t.pendingcb--,o(i)}):(t.pendingcb--,o(i)),e._writableState.errorEmitted=!0,e.emit("error",i)}function p(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function f(e,t){var n=e._writableState,i=n.sync,o=n.writecb;if(p(n),t)c(e,n,i,t,o);else{var a=g(e,n);a||n.corked||n.bufferProcessing||!n.buffer.length||v(e,n),i?r.nextTick(function(){d(e,n,a,o)}):d(e,n,a,o)}}function d(e,t,r,n){r||m(e,t),t.pendingcb--,n(),x(e,t)}function m(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function v(e,t){if(t.bufferProcessing=!0,e._writev&&t.buffer.length>1){for(var r=[],n=0;n<t.buffer.length;n++)r.push(t.buffer[n].callback);t.pendingcb++,u(e,t,!0,t.length,t.buffer,"",function(e){for(var n=0;n<r.length;n++)t.pendingcb--,r[n](e)}),t.buffer=[]}else{for(var n=0;n<t.buffer.length;n++){var i=t.buffer[n],o=i.chunk,a=i.encoding,s=i.callback,h=t.objectMode?1:o.length;if(u(e,t,!1,h,o,a,s),t.writing){n++;break}}n<t.buffer.length?t.buffer=t.buffer.slice(n):t.buffer.length=0}t.bufferProcessing=!1}function g(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function y(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function x(e,t){var r=g(e,t);return r&&(0===t.pendingcb?(y(e,t),t.finished=!0,e.emit("finish")):y(e,t)),r}function w(e,t,n){t.ending=!0,x(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n)),t.ended=!0}t.exports=o;var b=e("buffer").Buffer;o.WritableState=i;var _=e("core-util-is");_.inherits=e("inherits");var S=e("stream");_.inherits(o,S),o.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},o.prototype.write=function(e,t,r){var n=this._writableState,i=!1;return _.isFunction(t)&&(r=t,t=null),_.isBuffer(e)?t="buffer":t||(t=n.defaultEncoding),_.isFunction(r)||(r=function(){}),n.ended?a(this,n,r):s(this,n,e,r)&&(n.pendingcb++,i=l(this,n,e,t,r)),i},o.prototype.cork=function(){var e=this._writableState;e.corked++},o.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.buffer.length||v(this,e))},o.prototype._write=function(e,t,r){r(new Error("not implemented"))},o.prototype._writev=null,o.prototype.end=function(e,t,r){var n=this._writableState;_.isFunction(e)?(r=e,e=null,t=null):_.isFunction(t)&&(r=t,t=null),_.isNullOrUndefined(e)||this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||w(this,n,r)}}).call(this,e("_process"))},{"./_stream_duplex":79,_process:77,buffer:70,"core-util-is":84,inherits:75,stream:89}],84:[function(e,t,r){(function(e){function t(e){return Array.isArray(e)}function n(e){return"boolean"==typeof e}function i(e){return null===e}function o(e){return null==e}function a(e){return"number"==typeof e}function s(e){return"string"==typeof e}function h(e){return"symbol"==typeof e}function l(e){return void 0===e}function u(e){return c(e)&&"[object RegExp]"===g(e)}function c(e){return"object"==typeof e&&null!==e}function p(e){return c(e)&&"[object Date]"===g(e)}function f(e){return c(e)&&("[object Error]"===g(e)||e instanceof Error)}function d(e){return"function"==typeof e}function m(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function v(t){return e.isBuffer(t)}function g(e){return Object.prototype.toString.call(e);
}r.isArray=t,r.isBoolean=n,r.isNull=i,r.isNullOrUndefined=o,r.isNumber=a,r.isString=s,r.isSymbol=h,r.isUndefined=l,r.isRegExp=u,r.isObject=c,r.isDate=p,r.isError=f,r.isFunction=d,r.isPrimitive=m,r.isBuffer=v}).call(this,e("buffer").Buffer)},{buffer:70}],85:[function(e,t,r){t.exports=e("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":80}],86:[function(e,t,r){r=t.exports=e("./lib/_stream_readable.js"),r.Stream=e("stream"),r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":79,"./lib/_stream_passthrough.js":80,"./lib/_stream_readable.js":81,"./lib/_stream_transform.js":82,"./lib/_stream_writable.js":83,stream:89}],87:[function(e,t,r){t.exports=e("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":82}],88:[function(e,t,r){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":83}],89:[function(e,t,r){function n(){i.call(this)}t.exports=n;var i=e("events").EventEmitter,o=e("inherits");o(n,i),n.Readable=e("readable-stream/readable.js"),n.Writable=e("readable-stream/writable.js"),n.Duplex=e("readable-stream/duplex.js"),n.Transform=e("readable-stream/transform.js"),n.PassThrough=e("readable-stream/passthrough.js"),n.Stream=n,n.prototype.pipe=function(e,t){function r(t){e.writable&&!1===e.write(t)&&l.pause&&l.pause()}function n(){l.readable&&l.resume&&l.resume()}function o(){u||(u=!0,e.end())}function a(){u||(u=!0,"function"==typeof e.destroy&&e.destroy())}function s(e){if(h(),0===i.listenerCount(this,"error"))throw e}function h(){l.removeListener("data",r),e.removeListener("drain",n),l.removeListener("end",o),l.removeListener("close",a),l.removeListener("error",s),e.removeListener("error",s),l.removeListener("end",h),l.removeListener("close",h),e.removeListener("close",h)}var l=this;l.on("data",r),e.on("drain",n),e._isStdio||t&&t.end===!1||(l.on("end",o),l.on("close",a));var u=!1;return l.on("error",s),e.on("error",s),l.on("end",h),l.on("close",h),e.on("close",h),e.emit("pipe",l),e}},{events:74,inherits:75,"readable-stream/duplex.js":78,"readable-stream/passthrough.js":85,"readable-stream/readable.js":86,"readable-stream/transform.js":87,"readable-stream/writable.js":88}],90:[function(e,t,r){function n(e){if(e&&!h(e))throw new Error("Unknown encoding: "+e)}function i(e){return e.toString(this.encoding)}function o(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function a(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var s=e("buffer").Buffer,h=s.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},l=r.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),n(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=a;break;default:return void(this.write=i)}this.charBuffer=new s(6),this.charReceived=0,this.charLength=0};l.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";e=e.slice(r,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var n=t.charCodeAt(t.length-1);if(!(n>=55296&&56319>=n)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,n=t.charCodeAt(i);if(n>=55296&&56319>=n){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,i)}return t},l.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(2>=t&&r>>4==14){this.charLength=3;break}if(3>=t&&r>>3==30){this.charLength=4;break}}this.charReceived=t},l.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,n=this.charBuffer,i=this.encoding;t+=n.slice(0,r).toString(i)}return t}},{buffer:70}]},{},[68]);