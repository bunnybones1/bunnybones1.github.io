!function(t){function webpackJsonpCallback(e){for(var o,n,r=e[0],l=e[1],h=e[2],m=0,c=[];m<r.length;m++)n=r[m],i[n]&&c.push(i[n][0]),i[n]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);for(a&&a(e);c.length;)c.shift()();return s.push.apply(s,h||[]),checkDeferredModules()}function checkDeferredModules(){for(var t,e=0;e<s.length;e++){for(var o=s[e],n=!0,r=1;r<o.length;r++){var a=o[r];0!==i[a]&&(n=!1)}n&&(s.splice(e--,1),t=__webpack_require__(__webpack_require__.s=o[0]))}return t}var e={},i={0:0},s=[];function __webpack_require__(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,__webpack_require__),s.l=!0,s.exports}__webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.d=function(t,e,i){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(__webpack_require__.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)__webpack_require__.d(i,s,function(e){return t[e]}.bind(null,s));return i},__webpack_require__.n=function(t){var e=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="/";var o=window.webpackJsonp=window.webpackJsonp||[],n=o.push.bind(o);o.push=webpackJsonpCallback,o=o.slice();for(var r=0;r<o.length;r++)webpackJsonpCallback(o[r]);var a=n;s.push([146,1]),checkDeferredModules()}([function(t,e,i){"use strict";i.d(e,"a",function(){return n}),i.d(e,"i",function(){return r}),i.d(e,"h",function(){return a}),i.d(e,"d",function(){return Clamp}),i.d(e,"l",function(){return Sq}),i.d(e,"e",function(){return InvSqrt}),i.d(e,"m",function(){return l}),i.d(e,"j",function(){return h}),i.d(e,"b",function(){return m}),i.d(e,"c",function(){return c}),i.d(e,"p",function(){return Vec2}),i.d(e,"q",function(){return Vec3}),i.d(e,"f",function(){return Mat22}),i.d(e,"g",function(){return Mat33}),i.d(e,"k",function(){return Rot}),i.d(e,"o",function(){return Transform}),i.d(e,"n",function(){return Sweep});var s=i(1);s.F,s.F;const o=2*s.F,n=Math.abs,r=Math.min,a=Math.max;function Clamp(t,e,i){return t<e?e:t>i?i:t}isFinite;function Sq(t){return t*t}function InvSqrt(t){return 1/Math.sqrt(t)}const l=Math.sqrt,h=Math.pow;Math.cos,Math.sin,Math.acos;const m=Math.asin,c=Math.atan2;class Vec2{constructor(t=0,e=0){this.x=t,this.y=e}static MakeArray(t){return Object(s.a)(t,t=>new Vec2)}static AbsV(t,e){return e.x=n(t.x),e.y=n(t.y),e}static MinV(t,e,i){return i.x=r(t.x,e.x),i.y=r(t.y,e.y),i}static MaxV(t,e,i){return i.x=a(t.x,e.x),i.y=a(t.y,e.y),i}static ClampV(t,e,i,s){return s.x=Clamp(t.x,e.x,i.x),s.y=Clamp(t.y,e.y,i.y),s}static RotateV(t,e,i){const s=t.x,o=t.y,n=Math.cos(e),r=Math.sin(e);return i.x=n*s-r*o,i.y=r*s+n*o,i}static DotVV(t,e){return t.x*e.x+t.y*e.y}static CrossVV(t,e){return t.x*e.y-t.y*e.x}static CrossVS(t,e,i){const s=t.x;return i.x=e*t.y,i.y=-e*s,i}static CrossVOne(t,e){const i=t.x;return e.x=t.y,e.y=-i,e}static CrossSV(t,e,i){const s=e.x;return i.x=-t*e.y,i.y=t*s,i}static CrossOneV(t,e){const i=t.x;return e.x=-t.y,e.y=i,e}static AddVV(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}static SubVV(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}static MulSV(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}static MulVS(t,e,i){return i.x=t.x*e,i.y=t.y*e,i}static AddVMulSV(t,e,i,s){return s.x=t.x+e*i.x,s.y=t.y+e*i.y,s}static SubVMulSV(t,e,i,s){return s.x=t.x-e*i.x,s.y=t.y-e*i.y,s}static AddVCrossSV(t,e,i,s){const o=i.x;return s.x=t.x-e*i.y,s.y=t.y+e*o,s}static MidVV(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}static ExtVV(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}static IsEqualToV(t,e){return t.x===e.x&&t.y===e.y}static DistanceVV(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}static DistanceSquaredVV(t,e){const i=t.x-e.x,s=t.y-e.y;return i*i+s*s}static NegV(t,e){return e.x=-t.x,e.y=-t.y,e}Clone(){return new Vec2(this.x,this.y)}SetZero(){return this.x=0,this.y=0,this}Set(t,e){return this.x=t,this.y=e,this}Copy(t){return this.x=t.x,this.y=t.y,this}SelfAdd(t){return this.x+=t.x,this.y+=t.y,this}SelfAddXY(t,e){return this.x+=t,this.y+=e,this}SelfSub(t){return this.x-=t.x,this.y-=t.y,this}SelfSubXY(t,e){return this.x-=t,this.y-=e,this}SelfMul(t){return this.x*=t,this.y*=t,this}SelfMulAdd(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}SelfMulSub(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}Dot(t){return this.x*t.x+this.y*t.y}Cross(t){return this.x*t.y-this.y*t.x}Length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}LengthSquared(){const t=this.x,e=this.y;return t*t+e*e}Normalize(){const t=this.Length();if(t>=s.j){const e=1/t;this.x*=e,this.y*=e}return t}SelfNormalize(){const t=this.Length();if(t>=s.j){const e=1/t;this.x*=e,this.y*=e}return this}SelfRotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.x;return this.x=e*s-i*this.y,this.y=i*s+e*this.y,this}SelfRotateCosSin(t,e){const i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this}IsValid(){return isFinite(this.x)&&isFinite(this.y)}SelfCrossVS(t){const e=this.x;return this.x=t*this.y,this.y=-t*e,this}SelfCrossSV(t){const e=this.x;return this.x=-t*this.y,this.y=t*e,this}SelfMinV(t){return this.x=r(this.x,t.x),this.y=r(this.y,t.y),this}SelfMaxV(t){return this.x=a(this.x,t.x),this.y=a(this.y,t.y),this}SelfAbs(){return this.x=n(this.x),this.y=n(this.y),this}SelfNeg(){return this.x=-this.x,this.y=-this.y,this}SelfSkew(){const t=this.x;return this.x=-this.y,this.y=t,this}}Vec2.ZERO=new Vec2(0,0),Vec2.UNITX=new Vec2(1,0),Vec2.UNITY=new Vec2(0,1),Vec2.s_t0=new Vec2,Vec2.s_t1=new Vec2,Vec2.s_t2=new Vec2,Vec2.s_t3=new Vec2;new Vec2(0,0);class Vec3{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}static DotV3V3(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static CrossV3V3(t,e,i){const s=t.x,o=t.y,n=t.z,r=e.x,a=e.y,l=e.z;return i.x=o*l-n*a,i.y=n*r-s*l,i.z=s*a-o*r,i}Clone(){return new Vec3(this.x,this.y,this.z)}SetZero(){return this.x=0,this.y=0,this.z=0,this}SetXYZ(t,e,i){return this.x=t,this.y=e,this.z=i,this}Copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}SelfNeg(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}SelfAdd(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}SelfAddXYZ(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}SelfSub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}SelfSubXYZ(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}SelfMul(t){return this.x*=t,this.y*=t,this.z*=t,this}}Vec3.ZERO=new Vec3(0,0,0),Vec3.s_t0=new Vec3;class Mat22{constructor(){this.ex=new Vec2(1,0),this.ey=new Vec2(0,1)}static FromVV(t,e){return(new Mat22).SetVV(t,e)}static FromSSSS(t,e,i,s){return(new Mat22).SetSSSS(t,e,i,s)}static FromAngle(t){return(new Mat22).SetAngle(t)}static AbsM(t,e){const i=t.ex,s=t.ey;return e.ex.x=n(i.x),e.ex.y=n(i.y),e.ey.x=n(s.x),e.ey.y=n(s.y),e}static MulMV(t,e,i){const s=t.ex,o=t.ey,n=e.x,r=e.y;return i.x=s.x*n+o.x*r,i.y=s.y*n+o.y*r,i}static MulTMV(t,e,i){const s=t.ex,o=t.ey,n=e.x,r=e.y;return i.x=s.x*n+s.y*r,i.y=o.x*n+o.y*r,i}static AddMM(t,e,i){const s=t.ex,o=t.ey,n=e.ex,r=e.ey;return i.ex.x=s.x+n.x,i.ex.y=s.y+n.y,i.ey.x=o.x+r.x,i.ey.y=o.y+r.y,i}static MulMM(t,e,i){const s=t.ex.x,o=t.ex.y,n=t.ey.x,r=t.ey.y,a=e.ex.x,l=e.ex.y,h=e.ey.x,m=e.ey.y;return i.ex.x=s*a+n*l,i.ex.y=o*a+r*l,i.ey.x=s*h+n*m,i.ey.y=o*h+r*m,i}static MulTMM(t,e,i){const s=t.ex.x,o=t.ex.y,n=t.ey.x,r=t.ey.y,a=e.ex.x,l=e.ex.y,h=e.ey.x,m=e.ey.y;return i.ex.x=s*a+o*l,i.ex.y=n*a+r*l,i.ey.x=s*h+o*m,i.ey.y=n*h+r*m,i}Clone(){return(new Mat22).Copy(this)}SetSSSS(t,e,i,s){return this.ex.Set(t,i),this.ey.Set(e,s),this}SetVV(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}SetAngle(t){const e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}SetIdentity(){return this.ex.Set(1,0),this.ey.Set(0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this}GetAngle(){return Math.atan2(this.ex.y,this.ex.x)}GetInverse(t){const e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y;let n=e*o-i*s;return 0!==n&&(n=1/n),t.ex.x=n*o,t.ey.x=-n*i,t.ex.y=-n*s,t.ey.y=n*e,t}Solve(t,e,i){const s=this.ex.x,o=this.ey.x,n=this.ex.y,r=this.ey.y;let a=s*r-o*n;return 0!==a&&(a=1/a),i.x=a*(r*t-o*e),i.y=a*(s*e-n*t),i}SelfAbs(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}SelfInv(){return this.GetInverse(this),this}SelfAddM(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}SelfSubM(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}}Mat22.IDENTITY=new Mat22;class Mat33{constructor(){this.ex=new Vec3(1,0,0),this.ey=new Vec3(0,1,0),this.ez=new Vec3(0,0,1)}static MulM33V3(t,e,i){const s=e.x,o=e.y,n=e.z;return i.x=t.ex.x*s+t.ey.x*o+t.ez.x*n,i.y=t.ex.y*s+t.ey.y*o+t.ez.y*n,i.z=t.ex.z*s+t.ey.z*o+t.ez.z*n,i}static MulM33XYZ(t,e,i,s,o){return o.x=t.ex.x*e+t.ey.x*i+t.ez.x*s,o.y=t.ex.y*e+t.ey.y*i+t.ez.y*s,o.z=t.ex.z*e+t.ey.z*i+t.ez.z*s,o}static MulM33V2(t,e,i){const s=e.x,o=e.y;return i.x=t.ex.x*s+t.ey.x*o,i.y=t.ex.y*s+t.ey.y*o,i}static MulM33XY(t,e,i,s){return s.x=t.ex.x*e+t.ey.x*i,s.y=t.ex.y*e+t.ey.y*i,s}Clone(){return(new Mat33).Copy(this)}SetVVV(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}SetIdentity(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}SelfAddM(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}Solve33(t,e,i,s){const o=this.ex.x,n=this.ex.y,r=this.ex.z,a=this.ey.x,l=this.ey.y,h=this.ey.z,m=this.ez.x,c=this.ez.y,_=this.ez.z;let u=o*(l*_-h*c)+n*(h*m-a*_)+r*(a*c-l*m);return 0!==u&&(u=1/u),s.x=u*(t*(l*_-h*c)+e*(h*m-a*_)+i*(a*c-l*m)),s.y=u*(o*(e*_-i*c)+n*(i*m-t*_)+r*(t*c-e*m)),s.z=u*(o*(l*i-h*e)+n*(h*t-a*i)+r*(a*e-l*t)),s}Solve22(t,e,i){const s=this.ex.x,o=this.ey.x,n=this.ex.y,r=this.ey.y;let a=s*r-o*n;return 0!==a&&(a=1/a),i.x=a*(r*t-o*e),i.y=a*(s*e-n*t),i}GetInverse22(t){const e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y;let n=e*o-i*s;0!==n&&(n=1/n),t.ex.x=n*o,t.ey.x=-n*i,t.ex.z=0,t.ex.y=-n*s,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}GetSymInverse33(t){let e=Vec3.DotV3V3(this.ex,Vec3.CrossV3V3(this.ey,this.ez,Vec3.s_t0));0!==e&&(e=1/e);const i=this.ex.x,s=this.ey.x,o=this.ez.x,n=this.ey.y,r=this.ez.y,a=this.ez.z;t.ex.x=e*(n*a-r*r),t.ex.y=e*(o*r-s*a),t.ex.z=e*(s*r-o*n),t.ey.x=t.ex.y,t.ey.y=e*(i*a-o*o),t.ey.z=e*(o*s-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*n-s*s)}}Mat33.IDENTITY=new Mat33;class Rot{constructor(t=0){this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}static MulRR(t,e,i){const s=t.c,o=t.s,n=e.c,r=e.s;return i.s=o*n+s*r,i.c=s*n-o*r,i}static MulTRR(t,e,i){const s=t.c,o=t.s,n=e.c,r=e.s;return i.s=s*r-o*n,i.c=s*n+o*r,i}static MulRV(t,e,i){const s=t.c,o=t.s,n=e.x,r=e.y;return i.x=s*n-o*r,i.y=o*n+s*r,i}static MulTRV(t,e,i){const s=t.c,o=t.s,n=e.x,r=e.y;return i.x=s*n+o*r,i.y=-o*n+s*r,i}Clone(){return(new Rot).Copy(this)}Copy(t){return this.s=t.s,this.c=t.c,this}SetAngle(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}SetIdentity(){return this.s=0,this.c=1,this}GetAngle(){return Math.atan2(this.s,this.c)}GetXAxis(t){return t.x=this.c,t.y=this.s,t}GetYAxis(t){return t.x=-this.s,t.y=this.c,t}}Rot.IDENTITY=new Rot;class Transform{constructor(){this.p=new Vec2,this.q=new Rot}static MulXV(t,e,i){const s=t.q.c,o=t.q.s,n=e.x,r=e.y;return i.x=s*n-o*r+t.p.x,i.y=o*n+s*r+t.p.y,i}static MulTXV(t,e,i){const s=t.q.c,o=t.q.s,n=e.x-t.p.x,r=e.y-t.p.y;return i.x=s*n+o*r,i.y=-o*n+s*r,i}static MulXX(t,e,i){return Rot.MulRR(t.q,e.q,i.q),Vec2.AddVV(Rot.MulRV(t.q,e.p,i.p),t.p,i.p),i}static MulTXX(t,e,i){return Rot.MulTRR(t.q,e.q,i.q),Rot.MulTRV(t.q,Vec2.SubVV(e.p,t.p,i.p),i.p),i}Clone(){return(new Transform).Copy(this)}Copy(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}SetIdentity(){return this.p.SetZero(),this.q.SetIdentity(),this}SetPositionRotation(t,e){return this.p.Copy(t),this.q.Copy(e),this}SetPositionAngle(t,e){return this.p.Copy(t),this.q.SetAngle(e),this}SetPosition(t){return this.p.Copy(t),this}SetPositionXY(t,e){return this.p.Set(t,e),this}SetRotation(t){return this.q.Copy(t),this}SetRotationAngle(t){return this.q.SetAngle(t),this}GetPosition(){return this.p}GetRotation(){return this.q}GetRotationAngle(){return this.q.GetAngle()}GetAngle(){return this.q.GetAngle()}}Transform.IDENTITY=new Transform;class Sweep{constructor(){this.localCenter=new Vec2,this.c0=new Vec2,this.c=new Vec2,this.a0=0,this.a=0,this.alpha0=0}Clone(){return(new Sweep).Copy(this)}Copy(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}GetTransform(t,e){const i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;const s=i*this.a0+e*this.a;return t.q.SetAngle(s),t.p.SelfSub(Rot.MulRV(t.q,this.localCenter,Vec2.s_t0)),t}Advance(t){const e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t}Normalize(){const t=o*Math.floor(this.a0/o);this.a0-=t,this.a-=t}}},function(t,e,i){"use strict";function Maybe(t,e){return void 0!==t?t:e}i.d(e,"c",function(){return Maybe}),i.d(e,"p",function(){return s}),i.d(e,"j",function(){return o}),i.d(e,"k",function(){return n}),i.d(e,"F",function(){return r}),i.d(e,"r",function(){return a}),i.d(e,"u",function(){return l}),i.d(e,"d",function(){return h}),i.d(e,"e",function(){return m}),i.d(e,"n",function(){return c}),i.d(e,"g",function(){return _}),i.d(e,"G",function(){return u}),i.d(e,"x",function(){return p}),i.d(e,"y",function(){return d}),i.d(e,"J",function(){return f}),i.d(e,"q",function(){return y}),i.d(e,"o",function(){return S}),i.d(e,"z",function(){return x}),i.d(e,"A",function(){return C}),i.d(e,"v",function(){return B}),i.d(e,"w",function(){return w}),i.d(e,"i",function(){return g}),i.d(e,"I",function(){return v}),i.d(e,"l",function(){return A}),i.d(e,"E",function(){return V}),i.d(e,"D",function(){return b}),i.d(e,"t",function(){return P}),i.d(e,"s",function(){return M}),i.d(e,"B",function(){return I}),i.d(e,"C",function(){return G}),i.d(e,"h",function(){return D}),i.d(e,"H",function(){return F}),i.d(e,"m",function(){return k}),i.d(e,"f",function(){return L}),i.d(e,"a",function(){return MakeArray}),i.d(e,"b",function(){return MakeNumberArray});const s=1e37,o=1e-5,n=o*o,r=3.14159265359,a=2,l=8,h=.1,m=2,c=.008,_=2/180*r,u=2*c,p=8,d=32,f=1,y=.2,S=8/180*r,x=2,C=x*x,B=.5*r,w=B*B,g=.2,v=.75,A=-1,V=.75,b=1,P=.25,M=.5,I=4,G=256,D=2.5,F=.5,k=.01,L=2/180*r;new class Version{constructor(t=0,e=0,i=0){this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=e,this.revision=i}toString(){return this.major+"."+this.minor+"."+this.revision}}(2,3,2);function MakeArray(t,e){const i=[];for(let s=0;s<t;++s)i.push(e(s));return i}function MakeNumberArray(t,e=0){const i=[];for(let s=0;s<t;++s)i.push(e);return i}},,function(t,e,i){"use strict";i.d(e,"c",function(){return s}),i.d(e,"d",function(){return o}),i.d(e,"b",function(){return JointDef}),i.d(e,"a",function(){return Joint});i(0);var s,o,n=i(1);!function(t){t[t.e_unknownJoint=0]="e_unknownJoint",t[t.e_revoluteJoint=1]="e_revoluteJoint",t[t.e_prismaticJoint=2]="e_prismaticJoint",t[t.e_distanceJoint=3]="e_distanceJoint",t[t.e_pulleyJoint=4]="e_pulleyJoint",t[t.e_mouseJoint=5]="e_mouseJoint",t[t.e_gearJoint=6]="e_gearJoint",t[t.e_wheelJoint=7]="e_wheelJoint",t[t.e_weldJoint=8]="e_weldJoint",t[t.e_frictionJoint=9]="e_frictionJoint",t[t.e_ropeJoint=10]="e_ropeJoint",t[t.e_motorJoint=11]="e_motorJoint",t[t.e_areaJoint=12]="e_areaJoint"}(s||(s={})),function(t){t[t.e_inactiveLimit=0]="e_inactiveLimit",t[t.e_atLowerLimit=1]="e_atLowerLimit",t[t.e_atUpperLimit=2]="e_atUpperLimit",t[t.e_equalLimits=3]="e_equalLimits"}(o||(o={}));class JointEdge{constructor(t,e){this.prev=null,this.next=null,this.joint=t,this.other=e}}class JointDef{constructor(t){this.type=s.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=t}}class Joint{constructor(t){this.m_type=s.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=t.type,this.m_edgeA=new JointEdge(this,t.bodyB),this.m_edgeB=new JointEdge(this,t.bodyA),this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=Object(n.c)(t.collideConnected,!1),this.m_userData=t.userData}GetType(){return this.m_type}GetBodyA(){return this.m_bodyA}GetBodyB(){return this.m_bodyB}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}IsActive(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()}GetCollideConnected(){return this.m_collideConnected}Dump(t){t("// Dump is not supported for this joint type.\n")}ShiftOrigin(t){}}},function(t,e,i){"use strict";i.d(e,"d",function(){return s}),i.d(e,"e",function(){return ContactID}),i.d(e,"g",function(){return o}),i.d(e,"f",function(){return Manifold}),i.d(e,"l",function(){return WorldManifold}),i.d(e,"c",function(){return ClipVertex}),i.d(e,"h",function(){return RayCastInput}),i.d(e,"i",function(){return RayCastOutput}),i.d(e,"a",function(){return AABB}),i.d(e,"j",function(){return TestOverlapAABB}),i.d(e,"b",function(){return ClipSegmentToLine}),i.d(e,"k",function(){return TestOverlapShape});var s,o,n,r=i(0),a=i(1),l=i(20);!function(t){t[t.e_vertex=0]="e_vertex",t[t.e_face=1]="e_face"}(s||(s={}));class ContactFeature{constructor(){this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}get key(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key}set key(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255}get indexA(){return this._indexA}set indexA(t){this._indexA=t,this._key_invalid=!0}get indexB(){return this._indexB}set indexB(t){this._indexB=t,this._key_invalid=!0}get typeA(){return this._typeA}set typeA(t){this._typeA=t,this._key_invalid=!0}get typeB(){return this._typeB}set typeB(t){this._typeB=t,this._key_invalid=!0}}class ContactID{constructor(){this.cf=new ContactFeature}Copy(t){return this.key=t.key,this}Clone(){return(new ContactID).Copy(this)}get key(){return this.cf.key}set key(t){this.cf.key=t}}class ManifoldPoint{constructor(){this.localPoint=new r.p,this.normalImpulse=0,this.tangentImpulse=0,this.id=new ContactID}static MakeArray(t){return Object(a.a)(t,t=>new ManifoldPoint)}Reset(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}Copy(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_circles=0]="e_circles",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(o||(o={}));class Manifold{constructor(){this.points=ManifoldPoint.MakeArray(a.r),this.localNormal=new r.p,this.localPoint=new r.p,this.type=o.e_unknown,this.pointCount=0}Reset(){for(let t=0;t<a.r;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=o.e_unknown,this.pointCount=0}Copy(t){this.pointCount=t.pointCount;for(let e=0;e<a.r;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}Clone(){return(new Manifold).Copy(this)}}class WorldManifold{constructor(){this.normal=new r.p,this.points=r.p.MakeArray(a.r),this.separations=Object(a.b)(a.r)}Initialize(t,e,i,s,n){if(0!==t.pointCount)switch(t.type){case o.e_circles:{this.normal.Set(1,0);const o=r.o.MulXV(e,t.localPoint,WorldManifold.Initialize_s_pointA),l=r.o.MulXV(s,t.points[0].localPoint,WorldManifold.Initialize_s_pointB);r.p.DistanceSquaredVV(o,l)>a.k&&r.p.SubVV(l,o,this.normal).SelfNormalize();const h=r.p.AddVMulSV(o,i,this.normal,WorldManifold.Initialize_s_cA),m=r.p.SubVMulSV(l,n,this.normal,WorldManifold.Initialize_s_cB);r.p.MidVV(h,m,this.points[0]),this.separations[0]=r.p.DotVV(r.p.SubVV(m,h,r.p.s_t0),this.normal);break}case o.e_faceA:{r.k.MulRV(e.q,t.localNormal,this.normal);const o=r.o.MulXV(e,t.localPoint,WorldManifold.Initialize_s_planePoint);for(let e=0;e<t.pointCount;++e){const a=r.o.MulXV(s,t.points[e].localPoint,WorldManifold.Initialize_s_clipPoint),l=i-r.p.DotVV(r.p.SubVV(a,o,r.p.s_t0),this.normal),h=r.p.AddVMulSV(a,l,this.normal,WorldManifold.Initialize_s_cA),m=r.p.SubVMulSV(a,n,this.normal,WorldManifold.Initialize_s_cB);r.p.MidVV(h,m,this.points[e]),this.separations[e]=r.p.DotVV(r.p.SubVV(m,h,r.p.s_t0),this.normal)}break}case o.e_faceB:{r.k.MulRV(s.q,t.localNormal,this.normal);const o=r.o.MulXV(s,t.localPoint,WorldManifold.Initialize_s_planePoint);for(let s=0;s<t.pointCount;++s){const a=r.o.MulXV(e,t.points[s].localPoint,WorldManifold.Initialize_s_clipPoint),l=n-r.p.DotVV(r.p.SubVV(a,o,r.p.s_t0),this.normal),h=r.p.AddVMulSV(a,l,this.normal,WorldManifold.Initialize_s_cB),m=r.p.SubVMulSV(a,i,this.normal,WorldManifold.Initialize_s_cA);r.p.MidVV(m,h,this.points[s]),this.separations[s]=r.p.DotVV(r.p.SubVV(m,h,r.p.s_t0),this.normal)}this.normal.SelfNeg();break}}}}WorldManifold.Initialize_s_pointA=new r.p,WorldManifold.Initialize_s_pointB=new r.p,WorldManifold.Initialize_s_cA=new r.p,WorldManifold.Initialize_s_cB=new r.p,WorldManifold.Initialize_s_planePoint=new r.p,WorldManifold.Initialize_s_clipPoint=new r.p,function(t){t[t.nullState=0]="nullState",t[t.addState=1]="addState",t[t.persistState=2]="persistState",t[t.removeState=3]="removeState"}(n||(n={}));class ClipVertex{constructor(){this.v=new r.p,this.id=new ContactID}static MakeArray(t){return Object(a.a)(t,t=>new ClipVertex)}Copy(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}class RayCastInput{constructor(){this.p1=new r.p,this.p2=new r.p,this.maxFraction=1}Copy(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}class RayCastOutput{constructor(){this.normal=new r.p,this.fraction=0}Copy(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}class AABB{constructor(){this.lowerBound=new r.p,this.upperBound=new r.p,this.m_cache_center=new r.p,this.m_cache_extent=new r.p}static Combine(t,e,i){return i.Combine2(t,e),i}Copy(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}IsValid(){const t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y;let i=t>=0&&e>=0;return i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid()}GetCenter(){return r.p.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}GetExtents(){return r.p.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}GetPerimeter(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))}Combine1(t){return this.lowerBound.x=Object(r.i)(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Object(r.i)(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=Object(r.h)(this.upperBound.x,t.upperBound.x),this.upperBound.y=Object(r.h)(this.upperBound.y,t.upperBound.y),this}Combine2(t,e){return this.lowerBound.x=Object(r.i)(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Object(r.i)(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Object(r.h)(t.upperBound.x,e.upperBound.x),this.upperBound.y=Object(r.h)(t.upperBound.y,e.upperBound.y),this}Contains(t){let e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y}RayCast(t,e){let i=-a.p,s=a.p;const o=e.p1.x,n=e.p1.y,l=e.p2.x-e.p1.x,h=e.p2.y-e.p1.y,m=Object(r.a)(l),c=Object(r.a)(h),_=t.normal;if(m<a.j){if(o<this.lowerBound.x||this.upperBound.x<o)return!1}else{const t=1/l;let e=(this.lowerBound.x-o)*t,n=(this.upperBound.x-o)*t,a=-1;if(e>n){const t=e;e=n,n=t,a=1}if(e>i&&(_.x=a,_.y=0,i=e),i>(s=Object(r.i)(s,n)))return!1}if(c<a.j){if(n<this.lowerBound.y||this.upperBound.y<n)return!1}else{const t=1/h;let e=(this.lowerBound.y-n)*t,o=(this.upperBound.y-n)*t,a=-1;if(e>o){const t=e;e=o,o=t,a=1}if(e>i&&(_.x=0,_.y=a,i=e),i>(s=Object(r.i)(s,o)))return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,!0)}TestContain(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x)&&!(t.y<this.lowerBound.y||this.upperBound.y<t.y)}TestOverlap(t){const e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,s=this.lowerBound.x-t.upperBound.x,o=this.lowerBound.y-t.upperBound.y;return!(e>0||i>0)&&!(s>0||o>0)}}function TestOverlapAABB(t,e){const i=e.lowerBound.x-t.upperBound.x,s=e.lowerBound.y-t.upperBound.y,o=t.lowerBound.x-e.upperBound.x,n=t.lowerBound.y-e.upperBound.y;return!(i>0||s>0)&&!(o>0||n>0)}function ClipSegmentToLine(t,e,i,o,n){let a=0;const l=e[0],h=e[1],m=r.p.DotVV(i,l.v)-o,c=r.p.DotVV(i,h.v)-o;if(m<=0&&t[a++].Copy(l),c<=0&&t[a++].Copy(h),m*c<0){const e=m/(m-c),i=t[a].v;i.x=l.v.x+e*(h.v.x-l.v.x),i.y=l.v.y+e*(h.v.y-l.v.y);const o=t[a].id;o.cf.indexA=n,o.cf.indexB=l.id.cf.indexB,o.cf.typeA=s.e_vertex,o.cf.typeB=s.e_face,++a}return a}const h=new l.b,m=new l.e,c=new l.c;function TestOverlapShape(t,e,i,s,o,n){const r=h.Reset();r.proxyA.SetShape(t,e),r.proxyB.SetShape(i,s),r.transformA.Copy(o),r.transformB.Copy(n),r.useRadii=!0;const _=m.Reset();_.count=0;const u=c.Reset();return Object(l.a)(u,_,r),u.distance<10*a.j}},function(t,e,i){"use strict";i.d(e,"c",function(){return s}),i.d(e,"b",function(){return ParticleDef}),i.d(e,"a",function(){return CalculateParticleIterations}),i.d(e,"d",function(){return ParticleHandle});var s,o=i(11),n=i(0),r=i(1);!function(t){t[t.waterParticle=0]="waterParticle",t[t.zombieParticle=2]="zombieParticle",t[t.wallParticle=4]="wallParticle",t[t.springParticle=8]="springParticle",t[t.elasticParticle=16]="elasticParticle",t[t.viscousParticle=32]="viscousParticle",t[t.powderParticle=64]="powderParticle",t[t.tensileParticle=128]="tensileParticle",t[t.colorMixingParticle=256]="colorMixingParticle",t[t.destructionListenerParticle=512]="destructionListenerParticle",t[t.barrierParticle=1024]="barrierParticle",t[t.staticPressureParticle=2048]="staticPressureParticle",t[t.reactiveParticle=4096]="reactiveParticle",t[t.repulsiveParticle=8192]="repulsiveParticle",t[t.fixtureContactListenerParticle=16384]="fixtureContactListenerParticle",t[t.particleContactListenerParticle=32768]="particleContactListenerParticle",t[t.fixtureContactFilterParticle=65536]="fixtureContactFilterParticle",t[t.particleContactFilterParticle=131072]="particleContactFilterParticle"}(s||(s={}));class ParticleDef{constructor(){this.flags=0,this.position=new n.p,this.velocity=new n.p,this.color=new o.a(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null}}function CalculateParticleIterations(t,e,i){const s=Math.ceil(Math.sqrt(t/(.01*e))*i);return Object(n.d)(s,1,8)}class ParticleHandle{constructor(){this.m_index=r.l}GetIndex(){return this.m_index}SetIndex(t){this.m_index=t}}},function(t,e,i){"use strict";i.d(e,"a",function(){return MassData}),i.d(e,"c",function(){return s}),i.d(e,"b",function(){return Shape});var s,o=i(0);class MassData{constructor(){this.mass=0,this.center=new o.p(0,0),this.I=0}}!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_circleShape=0]="e_circleShape",t[t.e_edgeShape=1]="e_edgeShape",t[t.e_polygonShape=2]="e_polygonShape",t[t.e_chainShape=3]="e_chainShape",t[t.e_shapeTypeCount=4]="e_shapeTypeCount"}(s||(s={}));class Shape{constructor(t,e){this.m_type=s.e_unknown,this.m_radius=0,this.m_type=t,this.m_radius=e}Copy(t){return this.m_radius=t.m_radius,this}GetType(){return this.m_type}}},function(t,e,i){"use strict";i.d(e,"b",function(){return clamp}),i.d(e,"a",function(){return absFloor}),i.d(e,"d",function(){return lerp}),i.d(e,"e",function(){return radiansDifference}),i.d(e,"f",function(){return rand}),i.d(e,"g",function(){return rand2}),i.d(e,"c",function(){return inferDirection});var s=i(2);i(10);function clamp(t,e,i){return Math.min(i,Math.max(e,t))}function absFloor(t){return Math.floor(Math.abs(t))*(t<0?-1:1)}Math.PI,Math.PI,Math.PI;new s.Ray,new s.Plane(new s.Vector3(0,-1,0),1),new s.Plane(new s.Vector3(0,-1,0),1),new s.Vector3;new s.Vector2,new s.Raycaster;function lerp(t,e,i){const s=t+i*(e-t);return Math.abs(e-s)>1e-5?s:e}const o=2*Math.PI,n=3*Math.PI;function radiansDifference(t,e){return((t-e)%o+n)%o-Math.PI}function rand(t=0,e=1){return Math.random()*(e-t)+t}function rand2(t=1,e=0){return(2*Math.random()-1)*t+e}function inferDirection(t,e=1e-5){return t<-e?-1:t>e?1:0}},function(t,e,i){"use strict";i(1);var s=i(0);i.d(e,"h",function(){return s.p});i(11),i(27),i(58),i(95),i(96),i(4),i(20),i(59),i(60),i(24),i(37),i(61),i(26);var o=i(6);i.d(e,"g",function(){return o.c});var n=i(97);i.d(e,"c",function(){return n.a});var r=i(98);i.d(e,"f",function(){return r.a});i(22),i(99);var a=i(45);i.d(e,"e",function(){return a.b});var l=i(12);i.d(e,"a",function(){return l.b}),i.d(e,"b",function(){return l.c});var h=i(100);i.d(e,"i",function(){return h.a});var m=i(19);i.d(e,"d",function(){return m.c});i(65),i(15),i(63),i(16),i(64),i(53),i(48),i(52),i(51),i(49),i(50),i(46),i(47),i(3),i(66),i(38),i(67),i(68),i(69),i(70),i(71),i(72),i(73),i(74),i(75),i(76),i(21),i(101),i(102),i(103),i(104),i(105),i(5),i(14),i(62),i(106)},function(t,e,i){"use strict";i.d(e,"b",function(){return s}),i.d(e,"a",function(){return o});const s=.005,o=10},function(t,e,i){"use strict";const s=new class Device{constructor(){this.targetFPS=60,this.listeners=new Set,this.cachedPPCm=-1,this.handleChange=()=>{this.useTouch=/Mobi|Android|iPhone|iPad|BlackBerry|Windows Phone|webOS/i.test(navigator.userAgent),this.width===window.innerWidth&&this.height===window.innerHeight||(this.width=window.innerWidth,this.height=window.innerHeight,this.aspect=this.width/this.height,this.deviceHeight=Math.min(this.width,this.height),this.deviceWidth=Math.max(this.width,this.height),this.deviceAspect=this.deviceWidth/this.deviceHeight,this.pixelRatio=window.devicePixelRatio,this.orientation=this.aspect<1?"portrait":"landscape",this.type=this.useTouch?this.deviceWidth<1024&&this.deviceAspect>1.6?"mobile":"tablet":"desktop",this.listeners.forEach(t=>t()))},window.addEventListener("resize",()=>{this.handleChange(),setTimeout(this.handleChange,50)}),this.handleChange()}onChange(t,e=!1){return this.listeners.add(t),e&&t(),()=>this.listeners.delete(t)}get isMobile(){return"mobile"===this.type}get isTablet(){return"tablet"===this.type}get isDesktop(){return"desktop"===this.type}get pixelsPerCm(){if(-1===this.cachedPPCm){const t=document.createElement("div");t.style.height="1in";const e=document.getElementsByTagName("body")[0];e.appendChild(t);const i=getComputedStyle(t,null).getPropertyValue("height");e.removeChild(t),this.cachedPPCm=2.54*parseFloat(i)}return this.cachedPPCm}get screenHeightCms(){return this.height/this.pixelsPerCm}get screenWidthCms(){return this.width/this.pixelsPerCm}get screenShorterCms(){return Math.min(this.width,this.height)/this.pixelsPerCm}setFPS(t=60){this.targetFPS=t}};window.device=s,e.a=s},function(t,e,i){"use strict";i.d(e,"a",function(){return Color}),i.d(e,"b",function(){return s});class Color{constructor(t=.5,e=.5,i=.5,s=1){this.r=t,this.g=e,this.b=i,this.a=s}static MixColors(t,e,i){const s=i*(e.r-t.r),o=i*(e.g-t.g),n=i*(e.b-t.b),r=i*(e.a-t.a);t.r+=s,t.g+=o,t.b+=n,t.a+=r,e.r-=s,e.g-=o,e.b-=n,e.a-=r}static MakeStyleString(t,e,i,s=1){return t*=255,e*=255,i*=255,s<1?`rgba(${t},${e},${i},${s})`:`rgb(${t},${e},${i})`}Clone(){return(new Color).Copy(this)}Copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}IsEqual(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}IsZero(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}Set(t,e,i,s=this.a){this.SetRGBA(t,e,i,s)}SetByteRGB(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}SetByteRGBA(t,e,i,s){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=s/255,this}SetRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}SetRGBA(t,e,i,s){return this.r=t,this.g=e,this.b=i,this.a=s,this}SelfAdd(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}Add(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}SelfSub(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}Sub(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}SelfMul(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}Mul(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e}Mix(t,e){Color.MixColors(this,t,e)}MakeStyleString(t=this.a){return Color.MakeStyleString(this.r,this.g,this.b,t)}}var s;Color.ZERO=new Color(0,0,0,0),Color.RED=new Color(1,0,0),Color.GREEN=new Color(0,1,0),Color.BLUE=new Color(0,0,1),function(t){t[t.e_none=0]="e_none",t[t.e_shapeBit=1]="e_shapeBit",t[t.e_jointBit=2]="e_jointBit",t[t.e_aabbBit=4]="e_aabbBit",t[t.e_pairBit=8]="e_pairBit",t[t.e_centerOfMassBit=16]="e_centerOfMassBit",t[t.e_particleBit=32]="e_particleBit",t[t.e_controllerBit=64]="e_controllerBit",t[t.e_all=63]="e_all"}(s||(s={}))},function(t,e,i){"use strict";i.d(e,"c",function(){return s}),i.d(e,"b",function(){return BodyDef}),i.d(e,"a",function(){return Body});var s,o=i(6),n=i(0),r=i(1),a=i(45);!function(t){t[t.unknown=-1]="unknown",t[t.staticBody=0]="staticBody",t[t.kinematicBody=1]="kinematicBody",t[t.dynamicBody=2]="dynamicBody"}(s||(s={}));class BodyDef{constructor(){this.type=s.staticBody,this.position=new n.p(0,0),this.angle=0,this.linearVelocity=new n.p(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1}}class Body{constructor(t,e){this.m_type=s.staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new n.o,this.m_xf0=new n.o,this.m_sweep=new n.n,this.m_linearVelocity=new n.p,this.m_angularVelocity=0,this.m_force=new n.p,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=Object(r.c)(t.bullet,!1),this.m_fixedRotationFlag=Object(r.c)(t.fixedRotation,!1),this.m_autoSleepFlag=Object(r.c)(t.allowSleep,!0),this.m_awakeFlag=Object(r.c)(t.awake,!0),this.m_activeFlag=Object(r.c)(t.active,!0),this.m_world=e,this.m_xf.p.Copy(Object(r.c)(t.position,n.p.ZERO)),this.m_xf.q.SetAngle(Object(r.c)(t.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(Object(r.c)(t.linearVelocity,n.p.ZERO)),this.m_angularVelocity=Object(r.c)(t.angularVelocity,0),this.m_linearDamping=Object(r.c)(t.linearDamping,0),this.m_angularDamping=Object(r.c)(t.angularDamping,0),this.m_gravityScale=Object(r.c)(t.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=Object(r.c)(t.type,s.staticBody),t.type===s.dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}CreateFixture(t,e=0){return t instanceof o.b?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)}CreateFixtureDef(t){if(this.m_world.IsLocked())throw new Error;const e=new a.a(t,this);return e.Create(t),this.m_activeFlag&&e.CreateProxies(this.m_xf),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e}CreateFixtureShapeDensity(t,e=0){const i=Body.CreateFixtureShapeDensity_s_def;return i.shape=t,i.density=e,this.CreateFixtureDef(i)}DestroyFixture(t){if(this.m_world.IsLocked())throw new Error;let e=this.m_fixtureList,i=null;for(;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}let s=this.m_contactList;for(;s;){const e=s.contact;s=s.next;const i=e.GetFixtureA(),o=e.GetFixtureB();t!==i&&t!==o||this.m_world.m_contactManager.Destroy(e)}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Destroy(),--this.m_fixtureCount,this.ResetMassData()}SetTransformVec(t,e){this.SetTransformXY(t.x,t.y,e)}SetTransformXY(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),n.o.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(let t=this.m_fixtureList;t;t=t.m_next)t.Synchronize(this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}SetTransform(t){this.SetTransformVec(t.p,t.GetAngle())}GetTransform(){return this.m_xf}GetPosition(){return this.m_xf.p}SetPosition(t){this.SetTransformVec(t,this.GetAngle())}SetPositionXY(t,e){this.SetTransformXY(t,e,this.GetAngle())}GetAngle(){return this.m_sweep.a}SetAngle(t){this.SetTransformVec(this.GetPosition(),t)}GetWorldCenter(){return this.m_sweep.c}GetLocalCenter(){return this.m_sweep.localCenter}SetLinearVelocity(t){this.m_type!==s.staticBody&&(n.p.DotVV(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))}GetLinearVelocity(){return this.m_linearVelocity}SetAngularVelocity(t){this.m_type!==s.staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)}GetAngularVelocity(){return this.m_angularVelocity}GetDefinition(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}ApplyForce(t,e,i=!0){this.m_type===s.dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))}ApplyForceToCenter(t,e=!0){this.m_type===s.dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))}ApplyTorque(t,e=!0){this.m_type===s.dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}ApplyLinearImpulse(t,e,i=!0){this.m_type===s.dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))}ApplyLinearImpulseToCenter(t,e=!0){this.m_type===s.dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))}ApplyAngularImpulse(t,e=!0){this.m_type===s.dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}GetMass(){return this.m_mass}GetInertia(){return this.m_I+this.m_mass*n.p.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}GetMassData(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*n.p.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}SetMassData(t){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==s.dynamicBody)return;this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&!this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*n.p.DotVV(t.center,t.center),this.m_invI=1/this.m_I);const e=Body.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t.center),n.o.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),n.p.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,n.p.SubVV(this.m_sweep.c,e,n.p.s_t0),this.m_linearVelocity)}ResetMassData(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===s.staticBody||this.m_type===s.kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);const t=Body.ResetMassData_s_localCenter.SetZero();for(let e=this.m_fixtureList;e;e=e.m_next){if(0===e.m_density)continue;const i=e.GetMassData(Body.ResetMassData_s_massData);this.m_mass+=i.mass,t.x+=i.center.x*i.mass,t.y+=i.center.y*i.mass,this.m_I+=i.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*n.p.DotVV(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);const e=Body.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t),n.o.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),n.p.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,n.p.SubVV(this.m_sweep.c,e,n.p.s_t0),this.m_linearVelocity)}GetWorldPoint(t,e){return n.o.MulXV(this.m_xf,t,e)}GetWorldVector(t,e){return n.k.MulRV(this.m_xf.q,t,e)}GetLocalPoint(t,e){return n.o.MulTXV(this.m_xf,t,e)}GetLocalVector(t,e){return n.k.MulTRV(this.m_xf.q,t,e)}GetLinearVelocityFromWorldPoint(t,e){return n.p.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,n.p.SubVV(t,this.m_sweep.c,n.p.s_t0),e)}GetLinearVelocityFromLocalPoint(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}GetLinearDamping(){return this.m_linearDamping}SetLinearDamping(t){this.m_linearDamping=t}GetAngularDamping(){return this.m_angularDamping}SetAngularDamping(t){this.m_angularDamping=t}GetGravityScale(){return this.m_gravityScale}SetGravityScale(t){this.m_gravityScale=t}SetType(t){if(this.m_world.IsLocked())throw new Error;if(this.m_type===t)return;this.m_type=t,this.ResetMassData(),this.m_type===s.staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;let e=this.m_contactList;for(;e;){const t=e;e=e.next,this.m_world.m_contactManager.Destroy(t.contact)}this.m_contactList=null;for(let t=this.m_fixtureList;t;t=t.m_next)t.TouchProxies()}GetType(){return this.m_type}SetBullet(t){this.m_bulletFlag=t}IsBullet(){return this.m_bulletFlag}SetSleepingAllowed(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}IsSleepingAllowed(){return this.m_autoSleepFlag}SetAwake(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)}IsAwake(){return this.m_awakeFlag}SetActive(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsActive())if(this.m_activeFlag=t,t)for(let t=this.m_fixtureList;t;t=t.m_next)t.CreateProxies(this.m_xf);else{for(let t=this.m_fixtureList;t;t=t.m_next)t.DestroyProxies();let t=this.m_contactList;for(;t;){const e=t;t=t.next,this.m_world.m_contactManager.Destroy(e.contact)}this.m_contactList=null}}IsActive(){return this.m_activeFlag}SetFixedRotation(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}IsFixedRotation(){return this.m_fixedRotationFlag}GetFixtureList(){return this.m_fixtureList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactList}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}GetWorld(){return this.m_world}Dump(t){const e=this.m_islandIndex;t("{\n"),t("  const bd: BodyDef = new BodyDef();\n");let i="";switch(this.m_type){case s.staticBody:i="BodyType.staticBody";break;case s.kinematicBody:i="BodyType.kinematicBody";break;case s.dynamicBody:i="BodyType.dynamicBody"}t("  bd.type = %s;\n",i),t("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),t("  bd.angle = %.15f;\n",this.m_sweep.a),t("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),t("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),t("  bd.linearDamping = %.15f;\n",this.m_linearDamping),t("  bd.angularDamping = %.15f;\n",this.m_angularDamping),t("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),t("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),t("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),t("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),t("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),t("  bd.gravityScale = %.15f;\n",this.m_gravityScale),t("\n"),t("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),t("\n");for(let i=this.m_fixtureList;i;i=i.m_next)t("  {\n"),i.Dump(t,e),t("  }\n");t("}\n")}SynchronizeFixtures(){const t=Body.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),n.k.MulRV(t.q,this.m_sweep.localCenter,t.p),n.p.SubVV(this.m_sweep.c0,t.p,t.p);for(let e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(t,this.m_xf)}SynchronizeTransform(){this.m_xf.q.SetAngle(this.m_sweep.a),n.k.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),n.p.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}ShouldCollide(t){return(this.m_type!==s.staticBody||t.m_type!==s.staticBody)&&this.ShouldCollideConnected(t)}ShouldCollideConnected(t){for(let e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}Advance(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),n.k.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),n.p.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}GetControllerList(){return this.m_controllerList}GetControllerCount(){return this.m_controllerCount}}Body.CreateFixtureShapeDensity_s_def=new a.b,Body.SetMassData_s_oldCenter=new n.p,Body.ResetMassData_s_localCenter=new n.p,Body.ResetMassData_s_oldCenter=new n.p,Body.ResetMassData_s_massData=new o.a,Body.SynchronizeFixtures_s_xf1=new n.o},function(t,e,i){"use strict";i.d(e,"e",function(){return getUrlParam}),i.d(e,"b",function(){return getUrlFlag}),i.d(e,"c",function(){return getUrlFloat}),i.d(e,"d",function(){return getUrlInt}),i.d(e,"a",function(){return getUrlColor});var s=i(2),o=i(79),n=i(7);function getUrlParam(t){return function __setReminder(t){r.includes(t)||(r.push(t),a||(a=!0,setTimeout(()=>{console.log("Nice Parameters to try: "+r.join(", ")),a=!1},2e3)))}(t),new URL(window.location.href).searchParams.get(t)}function getUrlFlag(t){const e=getUrlParam(t);return!!(""===e||e&&"false"!==e)}function __getUrlNumber(t,e,i,s=-1/0,o=1/0){return Object(n.b)(i(getUrlParam(t)||e.toString()),s,o)}function getUrlFloat(t,e,i=-1/0,s=1/0){return __getUrlNumber(t,e,parseFloat,i,s)}function getUrlInt(t,e,i=-1/0,s=1/0){return __getUrlNumber(t,e,parseInt,i,s)}function getUrlColor(t,e){let i=getUrlParam(t);if(!i){if(e instanceof s.Color)return e;i=e}return Object(o.a)("#"+i)}const r=[];let a=!1},function(t,e,i){"use strict";i.d(e,"c",function(){return s}),i.d(e,"b",function(){return ParticleGroupDef}),i.d(e,"a",function(){return ParticleGroup});var s,o=i(11),n=i(0);!function(t){t[t.solidParticleGroup=1]="solidParticleGroup",t[t.rigidParticleGroup=2]="rigidParticleGroup",t[t.particleGroupCanBeEmpty=4]="particleGroupCanBeEmpty",t[t.particleGroupWillBeDestroyed=8]="particleGroupWillBeDestroyed",t[t.particleGroupNeedsUpdateDepth=16]="particleGroupNeedsUpdateDepth",t[t.particleGroupInternalMask=24]="particleGroupInternalMask"}(s||(s={}));class ParticleGroupDef{constructor(){this.flags=0,this.groupFlags=0,this.position=new n.p,this.angle=0,this.linearVelocity=new n.p,this.angularVelocity=0,this.color=new o.a,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null}}class ParticleGroup{constructor(t){this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new n.p,this.m_linearVelocity=new n.p,this.m_angularVelocity=0,this.m_transform=new n.o,this.m_userData=null,this.m_system=t}GetNext(){return this.m_next}GetParticleSystem(){return this.m_system}GetParticleCount(){return this.m_lastIndex-this.m_firstIndex}GetBufferIndex(){return this.m_firstIndex}ContainsParticle(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}GetAllParticleFlags(){if(!this.m_system.m_flagsBuffer.data)throw new Error;let t=0;for(let e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}GetGroupFlags(){return this.m_groupFlags}SetGroupFlags(t){t|=this.m_groupFlags&s.particleGroupInternalMask,this.m_system.SetGroupFlags(this,t)}GetMass(){return this.UpdateStatistics(),this.m_mass}GetInertia(){return this.UpdateStatistics(),this.m_inertia}GetCenter(){return this.UpdateStatistics(),this.m_center}GetLinearVelocity(){return this.UpdateStatistics(),this.m_linearVelocity}GetAngularVelocity(){return this.UpdateStatistics(),this.m_angularVelocity}GetTransform(){return this.m_transform}GetPosition(){return this.m_transform.p}GetAngle(){return this.m_transform.q.GetAngle()}GetLinearVelocityFromWorldPoint(t,e){const i=ParticleGroup.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),n.p.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,n.p.SubVV(t,this.m_center,i),e)}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}ApplyForce(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}ApplyLinearImpulse(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}DestroyParticles(t){if(this.m_system.m_world.IsLocked())throw new Error;for(let e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}UpdateStatistics(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;const t=new n.p,e=new n.p;if(this.m_timestamp!==this.m_system.m_timestamp){const i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(let t=this.m_firstIndex;t<this.m_lastIndex;t++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[t]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[t]);if(this.m_mass>0){const t=1/this.m_mass;this.m_center.SelfMul(t),this.m_linearVelocity.SelfMul(t)}this.m_inertia=0,this.m_angularVelocity=0;for(let s=this.m_firstIndex;s<this.m_lastIndex;s++)n.p.SubVV(this.m_system.m_positionBuffer.data[s],this.m_center,t),n.p.SubVV(this.m_system.m_velocityBuffer.data[s],this.m_linearVelocity,e),this.m_inertia+=i*n.p.DotVV(t,t),this.m_angularVelocity+=i*n.p.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}}ParticleGroup.GetLinearVelocityFromWorldPoint_s_t0=new n.p},function(t,e,i){"use strict";i.d(e,"b",function(){return Profile}),i.d(e,"d",function(){return TimeStep}),i.d(e,"a",function(){return Position}),i.d(e,"e",function(){return Velocity}),i.d(e,"c",function(){return SolverData});var s=i(0),o=i(1);class Profile{constructor(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}Reset(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}class TimeStep{constructor(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}Copy(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this}}class Position{constructor(){this.c=new s.p,this.a=0}static MakeArray(t){return Object(o.a)(t,t=>new Position)}}class Velocity{constructor(){this.v=new s.p,this.w=0}static MakeArray(t){return Object(o.a)(t,t=>new Velocity)}}class SolverData{constructor(){this.step=new TimeStep}}},function(t,e,i){"use strict";i.d(e,"a",function(){return Contact});var s=i(4),o=i(24),n=i(0),r=i(1);function MixFriction(t,e){return Object(n.m)(t*e)}function MixRestitution(t,e){return t>e?t:e}class ContactEdge{constructor(t){this.prev=null,this.next=null,this.contact=t}}class Contact{constructor(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new s.f,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new s.f,this.m_nodeA=new ContactEdge(this),this.m_nodeB=new ContactEdge(this)}GetManifold(){return this.m_manifold}GetWorldManifold(t){const e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),s=this.m_fixtureA.GetShape(),o=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),s.m_radius,i.GetTransform(),o.m_radius)}IsTouching(){return this.m_touchingFlag}SetEnabled(t){this.m_enabledFlag=t}IsEnabled(){return this.m_enabledFlag}GetNext(){return this.m_next}GetFixtureA(){return this.m_fixtureA}GetChildIndexA(){return this.m_indexA}GetFixtureB(){return this.m_fixtureB}GetChildIndexB(){return this.m_indexB}FlagForFiltering(){this.m_filterFlag=!0}SetFriction(t){this.m_friction=t}GetFriction(){return this.m_friction}ResetFriction(){this.m_friction=MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}SetRestitution(t){this.m_restitution=t}GetRestitution(){return this.m_restitution}ResetRestitution(){this.m_restitution=MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}SetTangentSpeed(t){this.m_tangentSpeed=t}GetTangentSpeed(){return this.m_tangentSpeed}Reset(t,e,i,s){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=s,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,delete this.m_nodeA.contact,this.m_nodeA.prev=null,this.m_nodeA.next=null,delete this.m_nodeA.other,delete this.m_nodeB.contact,this.m_nodeB.prev=null,this.m_nodeB.next=null,delete this.m_nodeB.other,this.m_toiCount=0,this.m_friction=MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}Update(t){const e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;let i=!1;const o=this.m_touchingFlag,n=this.m_fixtureA.IsSensor(),r=this.m_fixtureB.IsSensor(),a=n||r,l=this.m_fixtureA.GetBody(),h=this.m_fixtureB.GetBody(),m=l.GetTransform(),c=h.GetTransform();if(a){const t=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();i=Object(s.k)(t,this.m_indexA,e,this.m_indexB,m,c),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,m,c),i=this.m_manifold.pointCount>0;for(let t=0;t<this.m_manifold.pointCount;++t){const e=this.m_manifold.points[t];e.normalImpulse=0,e.tangentImpulse=0;const i=e.id;for(let t=0;t<this.m_oldManifold.pointCount;++t){const s=this.m_oldManifold.points[t];if(s.id.key===i.key){e.normalImpulse=s.normalImpulse,e.tangentImpulse=s.tangentImpulse;break}}}i!==o&&(l.SetAwake(!0),h.SetAwake(!0))}this.m_touchingFlag=i,!o&&i&&t&&t.BeginContact(this),o&&!i&&t&&t.EndContact(this),!a&&i&&t&&t.PreSolve(this,this.m_oldManifold)}ComputeTOI(t,e){const i=Contact.ComputeTOI_s_input;i.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),i.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),i.sweepA.Copy(t),i.sweepB.Copy(e),i.tMax=r.n;const s=Contact.ComputeTOI_s_output;return Object(o.d)(s,i),s.t}}Contact.ComputeTOI_s_input=new o.a,Contact.ComputeTOI_s_output=new o.b},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(2);const o=new class MaterialLibrary{get keyboardPlasticKey(){return this._keyboardPlasticKey||(this._keyboardPlasticKey=new s.MeshStandardMaterial({color:15654314})),this._keyboardPlasticKey}get keyboardPlasticKeyMouth(){return this._keyboardPlasticKeyMouth||(this._keyboardPlasticKeyMouth=new s.MeshStandardMaterial({color:2232593,depthFunc:s.GreaterDepth,side:s.BackSide})),this._keyboardPlasticKeyMouth}get scoopMask(){return this._scoopMask||(this._scoopMask=new s.MeshBasicMaterial({color:16711935,depthWrite:!1,colorWrite:!1})),this._scoopMask}get keyboardPlasticKeyUnderside(){return this._keyboardPlasticKeyUnderside||(this._keyboardPlasticKeyUnderside=new s.MeshStandardMaterial({color:15654314,depthFunc:s.GreaterDepth,side:s.BackSide})),this._keyboardPlasticKeyUnderside}get keyboardPlastic(){return this._keyboardPlastic||(this._keyboardPlastic=new s.MeshStandardMaterial({color:11180441})),this._keyboardPlastic}get keyboardPlasticHole(){return this._keyboardPlasticHole||(this._keyboardPlasticHole=new s.MeshStandardMaterial({color:5588036,depthFunc:s.GreaterDepth,side:s.BackSide})),this._keyboardPlasticHole}get levelMaterial(){return this._levelMaterial||(this._levelMaterial=new s.MeshStandardMaterial({color:1122867})),this._levelMaterial}}},function(t,e,i){"use strict";i.d(e,"c",function(){return s}),i.d(e,"b",function(){return o}),i.d(e,"a",function(){return n});i(7);const s=(t,e,i=!1)=>{const s=t.indexOf(e);if(-1!==s)t.splice(s,1);else if(i)throw new Error("could not find value in array");return e};const o=(t,e,i,s=!1)=>{t.has(e)||t.set(e,[]);const o=t.get(e);o&&(s?-1===o.indexOf(i)&&o.push(i):o.push(i))},n=(t,e,i)=>{if(!t.has(e))return;const o=t.get(e);o&&(s(o,i),0===o.length&&t.delete(e))}},function(t,e,i){"use strict";i.d(e,"a",function(){return ContactFilter}),i.d(e,"b",function(){return ContactImpulse}),i.d(e,"c",function(){return ContactListener}),i.d(e,"d",function(){return QueryCallback});var s=i(1),o=i(12);class ContactFilter{ShouldCollide(t,e){const i=t.GetBody(),s=e.GetBody();if(s.GetType()===o.c.staticBody&&i.GetType()===o.c.staticBody)return!1;if(!s.ShouldCollideConnected(i))return!1;const n=t.GetFilterData(),r=e.GetFilterData();return n.groupIndex===r.groupIndex&&0!==n.groupIndex?n.groupIndex>0:0!=(n.maskBits&r.categoryBits)&&0!=(n.categoryBits&r.maskBits)}ShouldCollideFixtureParticle(t,e,i){return!0}ShouldCollideParticleParticle(t,e,i){return!0}}ContactFilter.defaultFilter=new ContactFilter;class ContactImpulse{constructor(){this.normalImpulses=Object(s.b)(s.r),this.tangentImpulses=Object(s.b)(s.r),this.count=0}}class ContactListener{BeginContact(t){}EndContact(t){}BeginContactFixtureParticle(t,e){}EndContactFixtureParticle(t,e){}BeginContactParticleParticle(t,e){}EndContactParticleParticle(t,e){}PreSolve(t,e){}PostSolve(t,e){}}ContactListener.defaultListener=new ContactListener;class QueryCallback{ReportFixture(t){return!0}ReportParticle(t,e){return!1}ShouldQueryParticleSystem(t){return!0}}},function(t,e,i){"use strict";i.d(e,"d",function(){return DistanceProxy}),i.d(e,"e",function(){return SimplexCache}),i.d(e,"b",function(){return DistanceInput}),i.d(e,"c",function(){return DistanceOutput}),i.d(e,"a",function(){return Distance});var s=i(0),o=i(1);class DistanceProxy{constructor(){this.m_buffer=s.p.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}Copy(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}Reset(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}SetShape(t,e){t.SetupDistanceProxy(this,e)}SetVerticesRadius(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i}GetSupport(t){let e=0,i=s.p.DotVV(this.m_vertices[0],t);for(let o=1;o<this.m_count;++o){const n=s.p.DotVV(this.m_vertices[o],t);n>i&&(e=o,i=n)}return e}GetSupportVertex(t){let e=0,i=s.p.DotVV(this.m_vertices[0],t);for(let o=1;o<this.m_count;++o){const n=s.p.DotVV(this.m_vertices[o],t);n>i&&(e=o,i=n)}return this.m_vertices[e]}GetVertexCount(){return this.m_count}GetVertex(t){return this.m_vertices[t]}}class SimplexCache{constructor(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}Reset(){return this.metric=0,this.count=0,this}}class DistanceInput{constructor(){this.proxyA=new DistanceProxy,this.proxyB=new DistanceProxy,this.transformA=new s.o,this.transformB=new s.o,this.useRadii=!1}Reset(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}class DistanceOutput{constructor(){this.pointA=new s.p,this.pointB=new s.p,this.distance=0,this.iterations=0}Reset(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}let n=0;class SimplexVertex{constructor(){this.wA=new s.p,this.wB=new s.p,this.w=new s.p,this.a=0,this.indexA=0,this.indexB=0}Copy(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}class Simplex{constructor(){this.m_v1=new SimplexVertex,this.m_v2=new SimplexVertex,this.m_v3=new SimplexVertex,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}ReadCache(t,e,i,n,r){this.m_count=t.count;const a=this.m_vertices;for(let o=0;o<this.m_count;++o){const l=a[o];l.indexA=t.indexA[o],l.indexB=t.indexB[o];const h=e.GetVertex(l.indexA),m=n.GetVertex(l.indexB);s.o.MulXV(i,h,l.wA),s.o.MulXV(r,m,l.wB),s.p.SubVV(l.wB,l.wA,l.w),l.a=0}if(this.m_count>1){const e=t.metric,i=this.GetMetric();(i<.5*e||2*e<i||i<o.j)&&(this.m_count=0)}if(0===this.m_count){const t=a[0];t.indexA=0,t.indexB=0;const o=e.GetVertex(0),l=n.GetVertex(0);s.o.MulXV(i,o,t.wA),s.o.MulXV(r,l,t.wB),s.p.SubVV(t.wB,t.wA,t.w),t.a=1,this.m_count=1}}WriteCache(t){t.metric=this.GetMetric(),t.count=this.m_count;const e=this.m_vertices;for(let i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}GetSearchDirection(t){switch(this.m_count){case 1:return s.p.NegV(this.m_v1.w,t);case 2:{const e=s.p.SubVV(this.m_v2.w,this.m_v1.w,t);return s.p.CrossVV(e,s.p.NegV(this.m_v1.w,s.p.s_t0))>0?s.p.CrossOneV(e,t):s.p.CrossVOne(e,t)}default:return t.SetZero()}}GetClosestPoint(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:default:return t.SetZero()}}GetWitnessPoints(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}GetMetric(){switch(this.m_count){case 0:case 1:return 0;case 2:return s.p.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return s.p.CrossVV(s.p.SubVV(this.m_v2.w,this.m_v1.w,s.p.s_t0),s.p.SubVV(this.m_v3.w,this.m_v1.w,s.p.s_t1));default:return 0}}Solve2(){const t=this.m_v1.w,e=this.m_v2.w,i=s.p.SubVV(e,t,Simplex.s_e12),o=-s.p.DotVV(t,i);if(o<=0)return this.m_v1.a=1,void(this.m_count=1);const n=s.p.DotVV(e,i);if(n<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);const r=1/(n+o);this.m_v1.a=n*r,this.m_v2.a=o*r,this.m_count=2}Solve3(){const t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,o=s.p.SubVV(e,t,Simplex.s_e12),n=s.p.DotVV(t,o),r=s.p.DotVV(e,o),a=-n,l=s.p.SubVV(i,t,Simplex.s_e13),h=s.p.DotVV(t,l),m=s.p.DotVV(i,l),c=-h,_=s.p.SubVV(i,e,Simplex.s_e23),u=s.p.DotVV(e,_),p=s.p.DotVV(i,_),d=-u,f=s.p.CrossVV(o,l),y=f*s.p.CrossVV(e,i),S=f*s.p.CrossVV(i,t),x=f*s.p.CrossVV(t,e);if(a<=0&&c<=0)return this.m_v1.a=1,void(this.m_count=1);if(r>0&&a>0&&x<=0){const t=1/(r+a);return this.m_v1.a=r*t,this.m_v2.a=a*t,void(this.m_count=2)}if(m>0&&c>0&&S<=0){const t=1/(m+c);return this.m_v1.a=m*t,this.m_v3.a=c*t,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(r<=0&&d<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(m<=0&&p<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(p>0&&d>0&&y<=0){const t=1/(p+d);return this.m_v2.a=p*t,this.m_v3.a=d*t,this.m_count=2,void this.m_v1.Copy(this.m_v3)}const C=1/(y+S+x);this.m_v1.a=y*C,this.m_v2.a=S*C,this.m_v3.a=x*C,this.m_count=3}}Simplex.s_e12=new s.p,Simplex.s_e13=new s.p,Simplex.s_e23=new s.p;const r=new Simplex,a=[0,0,0],l=[0,0,0],h=new s.p,m=new s.p,c=new s.p,_=new s.p,u=new s.p;function Distance(t,e,i){0;const p=i.proxyA,d=i.proxyB,f=i.transformA,y=i.transformB,S=r;S.ReadCache(e,p,f,d,y);const x=S.m_vertices,C=a,B=l;let w=0,g=0;for(;g<20;){w=S.m_count;for(let t=0;t<w;++t)C[t]=x[t].indexA,B[t]=x[t].indexB;switch(S.m_count){case 1:break;case 2:S.Solve2();break;case 3:S.Solve3()}if(3===S.m_count)break;const t=S.GetSearchDirection(m);if(t.LengthSquared()<o.k)break;const e=x[S.m_count];e.indexA=p.GetSupport(s.k.MulTRV(f.q,s.p.NegV(t,s.p.s_t0),_)),s.o.MulXV(f,p.GetVertex(e.indexA),e.wA),e.indexB=d.GetSupport(s.k.MulTRV(y.q,t,u)),s.o.MulXV(y,d.GetVertex(e.indexB),e.wB),s.p.SubVV(e.wB,e.wA,e.w),++g,0;let i=!1;for(let t=0;t<w;++t)if(e.indexA===C[t]&&e.indexB===B[t]){i=!0;break}if(i)break;++S.m_count}if(n=Object(s.h)(n,g),S.GetWitnessPoints(t.pointA,t.pointB),t.distance=s.p.DistanceVV(t.pointA,t.pointB),t.iterations=g,S.WriteCache(e),i.useRadii){const e=p.m_radius,i=d.m_radius;if(t.distance>e+i&&t.distance>o.j){t.distance-=e+i;const o=s.p.SubVV(t.pointB,t.pointA,c);o.Normalize(),t.pointA.SelfMulAdd(e,o),t.pointB.SelfMulSub(i,o)}else{const e=s.p.MidVV(t.pointA,t.pointB,h);t.pointA.Copy(e),t.pointB.Copy(e),t.distance=0}}}new s.p,new Simplex,new s.p,new s.p,new s.p,new s.p,new s.p,new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return Controller});class ControllerEdge{constructor(t,e){this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=t,this.body=e}}class Controller{constructor(){this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}GetNext(){return this.m_next}GetPrev(){return this.m_prev}GetBodyList(){return this.m_bodyList}AddBody(t){const e=new ControllerEdge(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount}RemoveBody(t){if(this.m_bodyCount<=0)throw new Error;let e=this.m_bodyList;for(;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount}Clear(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0}}},function(t,e,i){"use strict";i.d(e,"a",function(){return EdgeShape});var s=i(0),o=i(1),n=i(6);class EdgeShape extends n.b{constructor(){super(n.c.e_edgeShape,o.G),this.m_vertex1=new s.p,this.m_vertex2=new s.p,this.m_vertex0=new s.p,this.m_vertex3=new s.p,this.m_hasVertex0=!1,this.m_hasVertex3=!1}Set(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this}Clone(){return(new EdgeShape).Copy(this)}Copy(t){return super.Copy(t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this}GetChildCount(){return 1}TestPoint(t,e){return!1}ComputeDistance(t,e,i,o){const n=s.o.MulXV(t,this.m_vertex1,EdgeShape.ComputeDistance_s_v1),r=s.o.MulXV(t,this.m_vertex2,EdgeShape.ComputeDistance_s_v2),a=s.p.SubVV(e,n,EdgeShape.ComputeDistance_s_d),l=s.p.SubVV(r,n,EdgeShape.ComputeDistance_s_s),h=s.p.DotVV(a,l);if(h>0){const t=s.p.DotVV(l,l);h>t?s.p.SubVV(e,r,a):a.SelfMulSub(h/t,l)}return i.Copy(a),i.Normalize()}RayCast(t,e,i,o){const n=s.o.MulTXV(i,e.p1,EdgeShape.RayCast_s_p1),r=s.o.MulTXV(i,e.p2,EdgeShape.RayCast_s_p2),a=s.p.SubVV(r,n,EdgeShape.RayCast_s_d),l=this.m_vertex1,h=this.m_vertex2,m=s.p.SubVV(h,l,EdgeShape.RayCast_s_e),c=t.normal.Set(m.y,-m.x).SelfNormalize(),_=s.p.DotVV(c,s.p.SubVV(l,n,s.p.s_t0)),u=s.p.DotVV(c,a);if(0===u)return!1;const p=_/u;if(p<0||e.maxFraction<p)return!1;const d=s.p.AddVMulSV(n,p,a,EdgeShape.RayCast_s_q),f=s.p.SubVV(h,l,EdgeShape.RayCast_s_r),y=s.p.DotVV(f,f);if(0===y)return!1;const S=s.p.DotVV(s.p.SubVV(d,l,s.p.s_t0),f)/y;return!(S<0||1<S)&&(t.fraction=p,s.k.MulRV(i.q,t.normal,t.normal),_>0&&t.normal.SelfNeg(),!0)}ComputeAABB(t,e,i){const o=s.o.MulXV(e,this.m_vertex1,EdgeShape.ComputeAABB_s_v1),n=s.o.MulXV(e,this.m_vertex2,EdgeShape.ComputeAABB_s_v2);s.p.MinV(o,n,t.lowerBound),s.p.MaxV(o,n,t.upperBound);const r=this.m_radius;t.lowerBound.SelfSubXY(r,r),t.upperBound.SelfAddXY(r,r)}ComputeMass(t,e){t.mass=0,s.p.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,s){return s.SetZero(),0}Dump(t){t("    const shape: EdgeShape = new EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)}}EdgeShape.ComputeDistance_s_v1=new s.p,EdgeShape.ComputeDistance_s_v2=new s.p,EdgeShape.ComputeDistance_s_d=new s.p,EdgeShape.ComputeDistance_s_s=new s.p,EdgeShape.RayCast_s_p1=new s.p,EdgeShape.RayCast_s_p2=new s.p,EdgeShape.RayCast_s_d=new s.p,EdgeShape.RayCast_s_e=new s.p,EdgeShape.RayCast_s_q=new s.p,EdgeShape.RayCast_s_r=new s.p,EdgeShape.ComputeAABB_s_v1=new s.p,EdgeShape.ComputeAABB_s_v2=new s.p},function(t,e,i){"use strict";i.d(e,"b",function(){return getChamferedBoxGeometry}),i.d(e,"a",function(){return getCachedChamferedBoxGeometry});var s=i(2),o=i(7);function getChamferedBoxGeometry(t,e,i,n=.005){const r=new s.SphereBufferGeometry(.02,8,5,.125*Math.PI),a=r.attributes.position.array,l=r.attributes.normal.array,h=new s.Vector3,m=new s.Vector3,c=.5*t-n,_=.5*e-n,u=.5*i-n;for(let t=0;t<l.length;t+=3)h.fromArray(l,t),m.fromArray(a,t),h.round(),1===h.y&&h.set(0,1,0),-1===h.y&&h.set(0,-1,0),h.toArray(l,t),h.multiplyScalar(n),h.x+=c*Object(o.c)(m.x),h.y+=_*Object(o.c)(m.y),h.z+=u*Object(o.c)(m.z),h.toArray(a,t);return r}const n=new Map;function getCachedChamferedBoxGeometry(t,e,i,s=.005){const o=`${t};${e};${i};${s};`;return n.has(o)||n.set(o,getChamferedBoxGeometry(t,e,i,s)),n.get(o)}},function(t,e,i){"use strict";i.d(e,"a",function(){return TOIInput}),i.d(e,"c",function(){return S}),i.d(e,"b",function(){return TOIOutput}),i.d(e,"d",function(){return TimeOfImpact});var s=i(0),o=i(1),n=i(27),r=i(20);let a=0,l=0,h=0,m=0;const c=new s.o,_=new s.o,u=new s.p,p=new s.p,d=new s.p,f=new s.p,y=new s.p;class TOIInput{constructor(){this.proxyA=new r.d,this.proxyB=new r.d,this.sweepA=new s.n,this.sweepB=new s.n,this.tMax=0}}var S,x;!function(t){t[t.e_unknown=0]="e_unknown",t[t.e_failed=1]="e_failed",t[t.e_overlapped=2]="e_overlapped",t[t.e_touching=3]="e_touching",t[t.e_separated=4]="e_separated"}(S||(S={}));class TOIOutput{constructor(){this.state=S.e_unknown,this.t=0}}!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_points=0]="e_points",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(x||(x={}));const C=new n.a,B=new r.e,w=new r.b,g=new r.c,v=new class SeparationFunction{constructor(){this.m_sweepA=new s.n,this.m_sweepB=new s.n,this.m_type=x.e_unknown,this.m_localPoint=new s.p,this.m_axis=new s.p}Initialize(t,e,i,o,n,r){this.m_proxyA=e,this.m_proxyB=o;const a=t.count;this.m_sweepA.Copy(i),this.m_sweepB.Copy(n);const l=c,h=_;if(this.m_sweepA.GetTransform(l,r),this.m_sweepB.GetTransform(h,r),1===a){this.m_type=x.e_points;const e=this.m_proxyA.GetVertex(t.indexA[0]),i=this.m_proxyB.GetVertex(t.indexB[0]),o=s.o.MulXV(l,e,u),n=s.o.MulXV(h,i,p);s.p.SubVV(n,o,this.m_axis);const r=this.m_axis.Normalize();return this.m_localPoint.SetZero(),r}if(t.indexA[0]===t.indexA[1]){this.m_type=x.e_faceB;const e=this.m_proxyB.GetVertex(t.indexB[0]),i=this.m_proxyB.GetVertex(t.indexB[1]);s.p.CrossVOne(s.p.SubVV(i,e,s.p.s_t0),this.m_axis).SelfNormalize();const o=s.k.MulRV(h.q,this.m_axis,d);s.p.MidVV(e,i,this.m_localPoint);const n=s.o.MulXV(h,this.m_localPoint,p),r=this.m_proxyA.GetVertex(t.indexA[0]),a=s.o.MulXV(l,r,u);let m=s.p.DotVV(s.p.SubVV(a,n,s.p.s_t0),o);return m<0&&(this.m_axis.SelfNeg(),m=-m),m}{this.m_type=x.e_faceA;const e=this.m_proxyA.GetVertex(t.indexA[0]),i=this.m_proxyA.GetVertex(t.indexA[1]);s.p.CrossVOne(s.p.SubVV(i,e,s.p.s_t0),this.m_axis).SelfNormalize();const o=s.k.MulRV(l.q,this.m_axis,d);s.p.MidVV(e,i,this.m_localPoint);const n=s.o.MulXV(l,this.m_localPoint,u),r=this.m_proxyB.GetVertex(t.indexB[0]),a=s.o.MulXV(h,r,p);let m=s.p.DotVV(s.p.SubVV(a,n,s.p.s_t0),o);return m<0&&(this.m_axis.SelfNeg(),m=-m),m}}FindMinSeparation(t,e,i){const o=c,n=_;switch(this.m_sweepA.GetTransform(o,i),this.m_sweepB.GetTransform(n,i),this.m_type){case x.e_points:{const i=s.k.MulTRV(o.q,this.m_axis,f),r=s.k.MulTRV(n.q,s.p.NegV(this.m_axis,s.p.s_t0),y);t[0]=this.m_proxyA.GetSupport(i),e[0]=this.m_proxyB.GetSupport(r);const a=this.m_proxyA.GetVertex(t[0]),l=this.m_proxyB.GetVertex(e[0]),h=s.o.MulXV(o,a,u),m=s.o.MulXV(n,l,p);return s.p.DotVV(s.p.SubVV(m,h,s.p.s_t0),this.m_axis)}case x.e_faceA:{const i=s.k.MulRV(o.q,this.m_axis,d),r=s.o.MulXV(o,this.m_localPoint,u),a=s.k.MulTRV(n.q,s.p.NegV(i,s.p.s_t0),y);t[0]=-1,e[0]=this.m_proxyB.GetSupport(a);const l=this.m_proxyB.GetVertex(e[0]),h=s.o.MulXV(n,l,p);return s.p.DotVV(s.p.SubVV(h,r,s.p.s_t0),i)}case x.e_faceB:{const i=s.k.MulRV(n.q,this.m_axis,d),r=s.o.MulXV(n,this.m_localPoint,p),a=s.k.MulTRV(o.q,s.p.NegV(i,s.p.s_t0),f);e[0]=-1,t[0]=this.m_proxyA.GetSupport(a);const l=this.m_proxyA.GetVertex(t[0]),h=s.o.MulXV(o,l,u);return s.p.DotVV(s.p.SubVV(h,r,s.p.s_t0),i)}default:return t[0]=-1,e[0]=-1,0}}Evaluate(t,e,i){const o=c,n=_;switch(this.m_sweepA.GetTransform(o,i),this.m_sweepB.GetTransform(n,i),this.m_type){case x.e_points:{const i=this.m_proxyA.GetVertex(t),r=this.m_proxyB.GetVertex(e),a=s.o.MulXV(o,i,u),l=s.o.MulXV(n,r,p);return s.p.DotVV(s.p.SubVV(l,a,s.p.s_t0),this.m_axis)}case x.e_faceA:{const t=s.k.MulRV(o.q,this.m_axis,d),i=s.o.MulXV(o,this.m_localPoint,u),r=this.m_proxyB.GetVertex(e),a=s.o.MulXV(n,r,p);return s.p.DotVV(s.p.SubVV(a,i,s.p.s_t0),t)}case x.e_faceB:{const e=s.k.MulRV(n.q,this.m_axis,d),i=s.o.MulXV(n,this.m_localPoint,p),r=this.m_proxyA.GetVertex(t),a=s.o.MulXV(o,r,u);return s.p.DotVV(s.p.SubVV(a,i,s.p.s_t0),e)}default:return 0}}},A=[0],V=[0],b=new s.n,P=new s.n;function TimeOfImpact(t,e){const i=C.Reset();0,t.state=S.e_unknown,t.t=e.tMax;const n=e.proxyA,u=e.proxyB,p=Object(s.h)(o.u,n.m_count,u.m_count),d=b.Copy(e.sweepA),f=P.Copy(e.sweepB);d.Normalize(),f.Normalize();const y=e.tMax,x=n.m_radius+u.m_radius,M=Object(s.h)(o.n,x-3*o.n),I=.25*o.n;let G=0;let D=0;const F=B;F.count=0;const k=w;for(k.proxyA.Copy(e.proxyA),k.proxyB.Copy(e.proxyB),k.useRadii=!1;;){const e=c,i=_;d.GetTransform(e,G),f.GetTransform(i,G),k.transformA.Copy(e),k.transformB.Copy(i);const o=g;if(Object(r.a)(o,F,k),o.distance<=0){t.state=S.e_overlapped,t.t=0;break}if(o.distance<M+I){t.state=S.e_touching,t.t=G;break}const a=v;a.Initialize(F,n,d,u,f,G);let l=!1,h=y,x=0;for(;;){const e=A,i=V;let o=a.FindMinSeparation(e,i,h);if(o>M+I){t.state=S.e_separated,t.t=y,l=!0;break}if(o>M-I){G=h;break}let n=a.Evaluate(e[0],i[0],G);if(n<M-I){t.state=S.e_failed,t.t=G,l=!0;break}if(n<=M+I){t.state=S.e_touching,t.t=G,l=!0;break}let r=0,c=G,_=h;for(;;){const t=1&r?c+(M-n)*(_-c)/(o-n):.5*(c+_);++r,0;const l=a.Evaluate(e[0],i[0],t);if(Object(s.a)(l-M)<I){h=t;break}if(l>M?(c=t,n=l):(_=t,o=l),50===r)break}if(m=Object(s.h)(m,r),++x===p)break}if(++D,0,l)break;if(20===D){t.state=S.e_failed,t.t=G;break}}h=Object(s.h)(h,D);const L=i.GetMilliseconds();l=Object(s.h)(l,L),a+=L}},function(t,e,i){"use strict";i.d(e,"a",function(){return listenToProperty}),i.d(e,"b",function(){return stopListeningToProperty});var s=i(18);class LiveProperty{get listenerCount(){return this.listeners.length}constructor(t,e){this.propName=e,this.listeners=[],this.setValue=this.setValue.bind(this),this.attach(t)}attach(t){this.obj&&this.release(),this.obj=t;const e=this.obj[this.propName];Object.defineProperty(t,this.propName,{configurable:!0,set:this.setValue,get:()=>this.value}),this.setValue(e)}release(){Object.defineProperty(this.obj,this.propName,{value:this.value,writable:!0})}hasListener(t){return-1!==this.listeners.indexOf(t)}addListener(t,e=!0){e&&t(this.value,void 0),this.listeners.push(t)}removeListener(t){Object(s.c)(this.listeners,t)}setValue(t){if(this.value===t)return;const e=this.value;this.value=t;for(const i of this.listeners)i(t,e)}}const o=new Map;function getObjectPropGroup(t){return o.has(t)||o.set(t,new Map),o.get(t)}function listenToProperty(t,e,i,s=!0){(function getLiveProperty(t,e){const i=getObjectPropGroup(t);return i.has(e)||i.set(e,new LiveProperty(t,e)),i.get(e)})(t,e).addListener(i,s)}function stopListeningToProperty(t,e,i){const s=o.get(t);if(s){const n=s.get(e);n&&(n.removeListener(i),0===n.listenerCount&&(n.release(),s.delete(e))),0===s.size&&o.delete(t)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return CollideEdgeAndCircle}),i.d(e,"b",function(){return CollideEdgeAndPolygon});var s=i(0),o=i(1),n=i(4);const r=new s.p,a=new s.p,l=new s.p,h=new s.p,m=new s.p,c=new s.p,_=new s.p,u=new n.e;function CollideEdgeAndCircle(t,e,i,o,p){t.pointCount=0;const d=s.o.MulTXV(i,s.o.MulXV(p,o.m_p,s.p.s_t0),r),f=e.m_vertex1,y=e.m_vertex2,S=s.p.SubVV(y,f,a),x=s.p.DotVV(S,s.p.SubVV(y,d,s.p.s_t0)),C=s.p.DotVV(S,s.p.SubVV(d,f,s.p.s_t0)),B=e.m_radius+o.m_radius,w=u;if(w.cf.indexB=0,w.cf.typeB=n.d.e_vertex,C<=0){const i=f,r=s.p.SubVV(d,i,l);if(s.p.DotVV(r,r)>B*B)return;if(e.m_hasVertex0){const t=e.m_vertex0,i=f,o=s.p.SubVV(i,t,h);if(s.p.DotVV(o,s.p.SubVV(i,d,s.p.s_t0))>0)return}return w.cf.indexA=0,w.cf.typeA=n.d.e_vertex,t.pointCount=1,t.type=n.g.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(i),t.points[0].id.Copy(w),void t.points[0].localPoint.Copy(o.m_p)}if(x<=0){const i=y,r=s.p.SubVV(d,i,l);if(s.p.DotVV(r,r)>B*B)return;if(e.m_hasVertex3){const t=e.m_vertex3,i=y,o=s.p.SubVV(t,i,m);if(s.p.DotVV(o,s.p.SubVV(d,i,s.p.s_t0))>0)return}return w.cf.indexA=1,w.cf.typeA=n.d.e_vertex,t.pointCount=1,t.type=n.g.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(i),t.points[0].id.Copy(w),void t.points[0].localPoint.Copy(o.m_p)}const g=s.p.DotVV(S,S),v=c;v.x=1/g*(x*f.x+C*y.x),v.y=1/g*(x*f.y+C*y.y);const A=s.p.SubVV(d,v,l);if(s.p.DotVV(A,A)>B*B)return;const V=_.Set(-S.y,S.x);s.p.DotVV(V,s.p.SubVV(d,f,s.p.s_t0))<0&&V.Set(-V.x,-V.y),V.Normalize(),w.cf.indexA=0,w.cf.typeA=n.d.e_face,t.pointCount=1,t.type=n.g.e_faceA,t.localNormal.Copy(V),t.localPoint.Copy(f),t.points[0].id.Copy(w),t.points[0].localPoint.Copy(o.m_p)}var p,d;!function(t){t[t.e_unknown=0]="e_unknown",t[t.e_edgeA=1]="e_edgeA",t[t.e_edgeB=2]="e_edgeB"}(p||(p={}));class EPAxis{constructor(){this.type=p.e_unknown,this.index=0,this.separation=0}}class TempPolygon{constructor(){this.vertices=[],this.normals=[],this.count=0}}!function(t){t[t.e_isolated=0]="e_isolated",t[t.e_concave=1]="e_concave",t[t.e_convex=2]="e_convex"}(d||(d={}));class EPCollider{constructor(){this.m_polygonB=new TempPolygon,this.m_xf=new s.o,this.m_centroidB=new s.p,this.m_v0=new s.p,this.m_v1=new s.p,this.m_v2=new s.p,this.m_v3=new s.p,this.m_normal0=new s.p,this.m_normal1=new s.p,this.m_normal2=new s.p,this.m_normal=new s.p,this.m_type1=d.e_isolated,this.m_type2=d.e_isolated,this.m_lowerLimit=new s.p,this.m_upperLimit=new s.p,this.m_radius=0,this.m_front=!1}Collide(t,e,i,r,a){s.o.MulTXX(i,a,this.m_xf),s.o.MulXV(this.m_xf,r.m_centroid,this.m_centroidB),this.m_v0.Copy(e.m_vertex0),this.m_v1.Copy(e.m_vertex1),this.m_v2.Copy(e.m_vertex2),this.m_v3.Copy(e.m_vertex3);const l=e.m_hasVertex0,h=e.m_hasVertex3,m=s.p.SubVV(this.m_v2,this.m_v1,EPCollider.s_edge1);m.Normalize(),this.m_normal1.Set(m.y,-m.x);const c=s.p.DotVV(this.m_normal1,s.p.SubVV(this.m_centroidB,this.m_v1,s.p.s_t0));let _=0,u=0,d=!1,f=!1;if(l){const t=s.p.SubVV(this.m_v1,this.m_v0,EPCollider.s_edge0);t.Normalize(),this.m_normal0.Set(t.y,-t.x),d=s.p.CrossVV(t,m)>=0,_=s.p.DotVV(this.m_normal0,s.p.SubVV(this.m_centroidB,this.m_v0,s.p.s_t0))}if(h){const t=s.p.SubVV(this.m_v3,this.m_v2,EPCollider.s_edge2);t.Normalize(),this.m_normal2.Set(t.y,-t.x),f=s.p.CrossVV(m,t)>0,u=s.p.DotVV(this.m_normal2,s.p.SubVV(this.m_centroidB,this.m_v2,s.p.s_t0))}l&&h?d&&f?(this.m_front=_>=0||c>=0||u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):d?(this.m_front=_>=0||c>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):f?(this.m_front=u>=0||_>=0&&c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=_>=0&&c>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):l?d?(this.m_front=_>=0||c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=_>=0&&c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):h?f?(this.m_front=c>=0||u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=c>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=r.m_count;for(let t=0;t<r.m_count;++t)this.m_polygonB.vertices.length<=t&&this.m_polygonB.vertices.push(new s.p),this.m_polygonB.normals.length<=t&&this.m_polygonB.normals.push(new s.p),s.o.MulXV(this.m_xf,r.m_vertices[t],this.m_polygonB.vertices[t]),s.k.MulRV(this.m_xf.q,r.m_normals[t],this.m_polygonB.normals[t]);this.m_radius=r.m_radius+e.m_radius,t.pointCount=0;const y=this.ComputeEdgeSeparation(EPCollider.s_edgeAxis);if(y.type===p.e_unknown)return;if(y.separation>this.m_radius)return;const S=this.ComputePolygonSeparation(EPCollider.s_polygonAxis);if(S.type!==p.e_unknown&&S.separation>this.m_radius)return;let x;x=S.type===p.e_unknown?y:S.separation>.98*y.separation+.001?S:y;const C=EPCollider.s_ie,B=EPCollider.s_rf;if(x.type===p.e_edgeA){t.type=n.g.e_faceA;let e=0,i=s.p.DotVV(this.m_normal,this.m_polygonB.normals[0]);for(let t=1;t<this.m_polygonB.count;++t){const o=s.p.DotVV(this.m_normal,this.m_polygonB.normals[t]);o<i&&(i=o,e=t)}const o=e,r=(o+1)%this.m_polygonB.count,a=C[0];a.v.Copy(this.m_polygonB.vertices[o]),a.id.cf.indexA=0,a.id.cf.indexB=o,a.id.cf.typeA=n.d.e_face,a.id.cf.typeB=n.d.e_vertex;const l=C[1];l.v.Copy(this.m_polygonB.vertices[r]),l.id.cf.indexA=0,l.id.cf.indexB=r,l.id.cf.typeA=n.d.e_face,l.id.cf.typeB=n.d.e_vertex,this.m_front?(B.i1=0,B.i2=1,B.v1.Copy(this.m_v1),B.v2.Copy(this.m_v2),B.normal.Copy(this.m_normal1)):(B.i1=1,B.i2=0,B.v1.Copy(this.m_v2),B.v2.Copy(this.m_v1),B.normal.Copy(this.m_normal1).SelfNeg())}else{t.type=n.g.e_faceB;const e=C[0];e.v.Copy(this.m_v1),e.id.cf.indexA=0,e.id.cf.indexB=x.index,e.id.cf.typeA=n.d.e_vertex,e.id.cf.typeB=n.d.e_face;const i=C[1];i.v.Copy(this.m_v2),i.id.cf.indexA=0,i.id.cf.indexB=x.index,i.id.cf.typeA=n.d.e_vertex,i.id.cf.typeB=n.d.e_face,B.i1=x.index,B.i2=(B.i1+1)%this.m_polygonB.count,B.v1.Copy(this.m_polygonB.vertices[B.i1]),B.v2.Copy(this.m_polygonB.vertices[B.i2]),B.normal.Copy(this.m_polygonB.normals[B.i1])}B.sideNormal1.Set(B.normal.y,-B.normal.x),B.sideNormal2.Copy(B.sideNormal1).SelfNeg(),B.sideOffset1=s.p.DotVV(B.sideNormal1,B.v1),B.sideOffset2=s.p.DotVV(B.sideNormal2,B.v2);const w=EPCollider.s_clipPoints1,g=EPCollider.s_clipPoints2;let v=0;if((v=Object(n.b)(w,C,B.sideNormal1,B.sideOffset1,B.i1))<o.r)return;if((v=Object(n.b)(g,w,B.sideNormal2,B.sideOffset2,B.i2))<o.r)return;x.type===p.e_edgeA?(t.localNormal.Copy(B.normal),t.localPoint.Copy(B.v1)):(t.localNormal.Copy(r.m_normals[B.i1]),t.localPoint.Copy(r.m_vertices[B.i1]));let A=0;for(let e=0;e<o.r;++e){let i;if((i=s.p.DotVV(B.normal,s.p.SubVV(g[e].v,B.v1,s.p.s_t0)))<=this.m_radius){const i=t.points[A];x.type===p.e_edgeA?(s.o.MulTXV(this.m_xf,g[e].v,i.localPoint),i.id=g[e].id):(i.localPoint.Copy(g[e].v),i.id.cf.typeA=g[e].id.cf.typeB,i.id.cf.typeB=g[e].id.cf.typeA,i.id.cf.indexA=g[e].id.cf.indexB,i.id.cf.indexB=g[e].id.cf.indexA),++A}}t.pointCount=A}ComputeEdgeSeparation(t){const e=t;e.type=p.e_edgeA,e.index=this.m_front?0:1,e.separation=o.p;for(let t=0;t<this.m_polygonB.count;++t){const i=s.p.DotVV(this.m_normal,s.p.SubVV(this.m_polygonB.vertices[t],this.m_v1,s.p.s_t0));i<e.separation&&(e.separation=i)}return e}ComputePolygonSeparation(t){const e=t;e.type=p.e_unknown,e.index=-1,e.separation=-o.p;const i=EPCollider.s_perp.Set(-this.m_normal.y,this.m_normal.x);for(let t=0;t<this.m_polygonB.count;++t){const n=s.p.NegV(this.m_polygonB.normals[t],EPCollider.s_n),r=s.p.DotVV(n,s.p.SubVV(this.m_polygonB.vertices[t],this.m_v1,s.p.s_t0)),a=s.p.DotVV(n,s.p.SubVV(this.m_polygonB.vertices[t],this.m_v2,s.p.s_t0)),l=Object(s.i)(r,a);if(l>this.m_radius)return e.type=p.e_edgeB,e.index=t,e.separation=l,e;if(s.p.DotVV(n,i)>=0){if(s.p.DotVV(s.p.SubVV(n,this.m_upperLimit,s.p.s_t0),this.m_normal)<-o.g)continue}else if(s.p.DotVV(s.p.SubVV(n,this.m_lowerLimit,s.p.s_t0),this.m_normal)<-o.g)continue;l>e.separation&&(e.type=p.e_edgeB,e.index=t,e.separation=l)}return e}}EPCollider.s_edge1=new s.p,EPCollider.s_edge0=new s.p,EPCollider.s_edge2=new s.p,EPCollider.s_ie=n.c.MakeArray(2),EPCollider.s_rf=new class ReferenceFace{constructor(){this.i1=0,this.i2=0,this.v1=new s.p,this.v2=new s.p,this.normal=new s.p,this.sideNormal1=new s.p,this.sideOffset1=0,this.sideNormal2=new s.p,this.sideOffset2=0}},EPCollider.s_clipPoints1=n.c.MakeArray(2),EPCollider.s_clipPoints2=n.c.MakeArray(2),EPCollider.s_edgeAxis=new EPAxis,EPCollider.s_polygonAxis=new EPAxis,EPCollider.s_n=new s.p,EPCollider.s_perp=new s.p;const f=new EPCollider;function CollideEdgeAndPolygon(t,e,i,s,o){f.Collide(t,e,i,s,o)}},function(t,e,i){"use strict";i.d(e,"a",function(){return Timer});class Timer{constructor(){this.m_start=Date.now()}Reset(){return this.m_start=Date.now(),this}GetMilliseconds(){return Date.now()-this.m_start}}},function(t,e,i){"use strict";i.d(e,"a",function(){return h});var s=i(90),o=i(42),n=i(134);const r={fontFace:o.a.GothicA1Regular,size:24,align:"center",vAlign:"center",letterSpacing:0,color:s.b,strokeWidth:0,strokeBias:1,alphaTest:0,strokeColor:s.a,scaleDownToPhysicalSize:!0,shadow:!1,screenSpace:!1,constantSizeOnScreen:!1,prescale:1},a=Object.assign({},r,n.a.title,{lineHeight:1.175,size:72,color:13815992,strokeWidth:.5,strokeBias:.5,strokeColor:2898505,fontFace:o.a.GothicA1ExtraBold}),l=Object.assign({},r,{lineHeight:1.175,size:24,color:s.a,fontFace:o.a.GothicA1Regular}),h={generic:r,title:a,keyLabel:l,keyLabelDouble:Object.assign({},l,{lineHeight:1.2,fontFace:o.a.GothicA1Bold,size:14}),keyLabelSmall:Object.assign({},l,{fontFace:o.a.GothicA1Bold,size:10})}},function(t,e,i){"use strict";i.d(e,"b",function(){return createPhysicBoxFromPixels}),i.d(e,"a",function(){return createPhysicBox}),i.d(e,"c",function(){return createPhysicsCircle});var s=i(9),o=i(8);const n=-16,r=8;function createPhysicBoxFromPixels(t,e,i,o,a){createPhysicBox(t,(e+n-.5*o)*s.b,(-i+r-.5*a)*s.b,o*s.b,a*s.b,!0)}function createPhysicBox(t,e,i,n,r,a=!1,l=.1,h=1){const m=new o.a,c=new o.e;m.fixedRotation=!1,m.type=a?o.b.staticBody:o.b.dynamicBody;const _=t.CreateBody(m);_.SetPositionXY(e*s.a,i*s.a),c.friction=l,c.restitution=.7,c.density=h;const u=(new o.f).SetAsBox(.5*n*s.a,.5*r*s.a);return c.shape=u,_.CreateFixture(c),_}function createPhysicsCircle(t,e,i,n){const r=new o.c(n*s.a),a=new o.a,l=new o.e;l.shape=r,l.density=1,l.friction=.2,l.restitution=.7,a.type=o.b.dynamicBody;const h=t.CreateBody(a);return h.SetPositionXY(e*s.a,i*s.a),h.CreateFixture(l),h}},function(t,e,i){"use strict";i.d(e,"a",function(){return TestLightingScene});var s=i(2),o=i(86),n=i(13),r=i(140),a=i(40);class TestLightingScene extends a.a{constructor(t=!0,e=!0){super();const i=Object(r.a)(this.scene,this.bgColor);this.sunLight=i.sunLight,this.ambientLight=i.ambientLight;const a=new o.a(this.camera);Object(n.b)("fpsCam")&&a.toggle(!0);(async()=>{const i=new s.MeshStandardMaterial({color:11197934,roughness:.7});if(e){const t=new s.Mesh(new s.PlaneBufferGeometry(1,1,1,1),i);t.castShadow=!1,t.receiveShadow=!0,this.scene.add(t),t.rotation.x=-.5*Math.PI}if(t){const t=new s.Mesh(new s.SphereBufferGeometry(.03,32,16),i);t.castShadow=!0,t.receiveShadow=!0,t.position.x=-.03,t.position.y=.03,t.name="Sphere",this.scene.add(t);const e=new s.Mesh(new s.BoxBufferGeometry(.06,.06,.06),i);e.castShadow=!0,e.receiveShadow=!0,e.position.x=.03,e.position.y=.03,e.name="Cube",this.scene.add(e)}})()}update(t){super.update(t)}render(t,e){super.render(t,e)}}},function(t,e,i){"use strict";i.d(e,"c",function(){return n}),i.d(e,"a",function(){return r}),i.d(e,"b",function(){return a});var s=i(2),o=i(10);const n=new s.Uniform(0),r=new s.Uniform(o.a.pixelRatio),a=new s.Uniform(new s.Vector2(2/o.a.width,2/o.a.height))},,,function(t,e,i){"use strict";i.d(e,"a",function(){return TextMesh});var s=i(2),o=i(132),n=i.n(o),r=i(31),a=i(93),l=i(84),h=i(85),m=i(25),c=i(133),_=i.n(c),u=i(28),p=i(135),d=i.n(p);class Gradient{constructor(t){Object.keys(t).forEach(e=>{const i=t[e];if(i){const t=w(i);this[e]=t}})}set top(t){this.topLeft=w(t),this.topRight=w(t)}set bottom(t){this.bottomLeft=w(t),this.bottomRight=w(t)}set left(t){this.topLeft=w(t),this.bottomLeft=w(t)}set right(t){this.topRight=w(t),this.bottomRight=w(t)}}const f=new s.Matrix4,y=[];class TextMesh extends s.Mesh{constructor(t="",e=u.a.generic,i,s,o,n=!0){super(C(t,e),S(e)),this.onFontFaceChange=(t,e)=>{e&&(Object(m.b)(e,"msdfTexture",this.onFontTextureUpdate),Object(m.b)(e,"font",this.onFontUpdate)),Object(m.a)(t,"msdfTexture",this.onFontTextureUpdate),Object(m.a)(t,"font",this.onFontUpdate),t.init(),this._fontFace=t},this.onFontTextureUpdate=t=>{this.newTexture=t,this.dirty=!0},this.onFontUpdate=t=>{this.dirty=!0},this.onBeforeRender=(t,e,i,s,o,n)=>{if(this.settings.screenSpace){const t=this.material.uniforms.clipSpacePosition.value;f.multiplyMatrices(i.matrixWorldInverse,this.matrixWorld).premultiply(i.projectionMatrix),t.set(0,0,0,1).applyMatrix4(f)}this.dirty&&(this.dirty=!1,this.regenerateGeometry(),this.newTexture&&(this.optimizeRenderOrder&&(this.renderOrder=this.renderOrder||100+function getFontFaceSubOrder(t){if(!t)return-1;const e=y.indexOf(t);return-1===e?(y.push(t),y.length-1):e}(this.newTexture)),this.material.uniforms.msdf.value=this.newTexture,this.newTexture=void 0))},this.updateText=(t="")=>{this.text=`${t}`},this.onMeasurementsUpdated=o,this.optimizeRenderOrder=n,Object(m.a)(e,"fontFace",this.onFontFaceChange,!0),this._text=t,this.updateMeasurements(),this.userData.isFrontFacing=!0,this.userData.doNotBillboard=!0,this.settings=e,this.livePropObject=i,this.livePropName=s,this.frustumCulled=!1}set text(t){"number"==typeof t&&(t=String(t)),this._text!==t&&(this._text=t,this.dirty=!0)}set color(t){"object"!=typeof t&&(t=w(t)),this._globalColor=t;const{topLeft:e,topRight:i,bottomLeft:s,bottomRight:o}=v(t),n=this.geometry.getAttribute("color");if(n){const t=n.array;for(let n=0;n<t.length;n+=12)t.set(e,n+0),t.set(s,n+3),t.set(o,n+6),t.set(i,n+9);n.needsUpdate=!0}}set strokeWidth(t){const e=this.material;if(e.uniforms.strokeWidth.value!==t){e.uniforms.strokeWidth.value=t;const i=t>0;i!==e.defines.USE_STROKE&&(e.defines.USE_STROKE=i,e.needsUpdate=!0)}}get opacity(){return this.material.uniforms.opacity.value}set opacity(t){this.material.uniforms.opacity.value=t}onAdd(){this.livePropObject&&this.livePropName&&Object(m.a)(this.livePropObject,this.livePropName,this.updateText,!0)}onRemove(){Object(m.b)(this.settings,"fontFace",this.onFontFaceChange),this.livePropObject&&this.livePropName&&Object(m.b)(this.livePropObject,this.livePropName,this.updateText),this._fontFace&&(Object(m.b)(this._fontFace,"msdfTexture",this.onFontTextureUpdate),Object(m.b)(this._fontFace,"font",this.onFontUpdate))}setSize(t,e){}regenerateGeometry(){this.geometry&&this.geometry!==x&&Object(h.b)(()=>this.geometry.dispose()),this.geometry=C(this._text,this.settings,this._globalColor),this.updateMeasurements()}updateMeasurements(){const t=this.geometry.boundingBox;this.width=t.max.x-t.min.x,this.height=Math.abs(t.max.y-t.min.y),this.userData.resolution=new s.Vector2(this.width,this.height),this.onMeasurementsUpdated&&this.onMeasurementsUpdated(this)}}const S=t=>{const e={msdf:new s.Uniform(t.fontFace.msdfTexture),alphaTest:new s.Uniform(t.alphaTest),strokeWidth:new s.Uniform(t.strokeWidth),strokeBias:new s.Uniform(t.strokeBias),strokeColor:new s.Uniform(new s.Color(t.strokeColor)),opacity:new s.Uniform(1)};t.screenSpace&&(e.offset=new s.Uniform(t.offset),e.clipSpacePosition=new s.Uniform(new s.Vector4),e.pixelSizeInClipSpace=r.b,e.prescale=new s.Uniform(t.prescale));const i=t.alphaTest>0&&t.alphaTest<1&&!t.shadow,o=new s.RawShaderMaterial({defines:{USE_STROKE:t.strokeWidth>0,USE_ALPHATEST:i,USE_SHADOW:t.shadow,USE_SCREENSPACE:t.screenSpace,CONSTANT_SIZE_ON_SCREEN:t.constantSizeOnScreen},uniforms:e,vertexShader:d(),fragmentShader:_(),transparent:!0,depthWrite:i});return Object.defineProperty(o,"opacity",{get:()=>o.uniforms.opacity.value,set:t=>o.uniforms.opacity.value=t}),o},x=new s.PlaneBufferGeometry(.001,.001);x.computeBoundingBox();const C=(t,e,i)=>e.fontFace.font&&t?B(t,e,i):x,B=(t,e,i)=>{const o=e.fontFace.font,r=(t=>Array.isArray(t)?t.reduce((t,e)=>t.concat(e.text),""):String(t))(t),h=n()({text:`${r}`,font:o,align:e.align,width:void 0!==e.width?e.width/e.size*o.info.size:void 0,lineHeight:void 0!==e.lineHeight?e.lineHeight*o.info.size:void 0,letterSpacing:e.letterSpacing}),m=h.getAttribute("position").array,c=m.length/2,_=g(i||e.color),u=Array.isArray(t)?t:[{text:r,color:_}],{base:p}=o.common,d=new Float32Array(3*c),f=new Float32Array(c);let y=0;u.forEach(t=>{const{topLeft:e,topRight:i,bottomLeft:s,bottomRight:n}=v(t.color),r=t.fontWeight||1,a=t.italicSkew||0,l=t.xOffset||0,h=t.yOffset||0,c=t.text.replace(/\s+/g,""),_=y,u=y+c.length;for(let t=_;t<u;t++){const _=12*t,u=4*t,S=2*u,x=c[t-y],C=o.chars.find(t=>String(t.char)===x);d.set(e,_+0),d.set(s,_+3),d.set(n,_+6),d.set(i,_+9),f[u+0]=r,f[u+1]=r,f[u+2]=r,f[u+3]=r;const B=p*a,w=C.height+C.yoffset-p,g=(p-C.yoffset)/p*B,v=w>0?w/p*-B:0;m[S+0]+=g,m[S+6]+=g,m[S+2]+=v,m[S+4]+=v,m[S+0]+=l,m[S+1]+=h,m[S+2]+=l,m[S+3]+=h,m[S+4]+=l,m[S+5]+=h,m[S+6]+=l,m[S+7]+=h}y=u}),h.addAttribute("color",new s.BufferAttribute(d,3)),h.addAttribute("weight",new s.BufferAttribute(f,1));const S=e.bakedOffset?e.bakedOffset.x:0,x=e.bakedOffset?e.bakedOffset.y:0;h.computeBoundingBox();const C=h.boundingBox;if(e.width){const t=h.layout.width;C.max.x=t-C.min.x}const B=C.min,w=C.max,A=h.attributes.position,V=A.itemSize,b=A.array;if("1"===t)for(let t=0;t<b.length;t+=V)b[t]-=2;const P=w.x-B.x,M=h.layout,I=(M._linesTotal-1)*M.lineHeight+M.capHeight,G=S+P*Object(a.a)(e.align)-B.x,D=x+I*Object(a.b)(e.vAlign);for(let t=0;t<b.length;t+=V)b[t]+=G,b[t+1]+=D;w.x+=G,B.x+=G,w.y+=D,B.y+=D;for(let t=1;t<b.length;t+=V)b[t]*=-1;B.y*=-1,w.y*=-1;let F=e.size/o.info.size;e.scaleDownToPhysicalSize&&(F/=l.a);for(let t=0;t<b.length;t++)b[t]*=F;if(B.multiplyScalar(F),w.multiplyScalar(F),B.y>w.y){const t=B.y;B.y=w.y,w.y=t}return h},w=t=>t instanceof s.Color?t:new s.Color(t),g=t=>t instanceof Gradient?t:new Gradient({top:t,bottom:t}),v=t=>({topLeft:(t=g(t||16777215)).topLeft.toArray(),topRight:t.topRight.toArray(),bottomLeft:t.bottomLeft.toArray(),bottomRight:t.bottomRight.toArray()})},,,function(t,e,i){"use strict";i.d(e,"a",function(){return CollideCircles}),i.d(e,"b",function(){return CollidePolygonAndCircle});var s=i(0),o=i(1),n=i(4);const r=new s.p,a=new s.p;function CollideCircles(t,e,i,o,l){t.pointCount=0;const h=s.o.MulXV(i,e.m_p,r),m=s.o.MulXV(l,o.m_p,a),c=s.p.DistanceSquaredVV(h,m),_=e.m_radius+o.m_radius;c>_*_||(t.type=n.g.e_circles,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(o.m_p),t.points[0].id.key=0)}const l=new s.p,h=new s.p,m=new s.p;function CollidePolygonAndCircle(t,e,i,r,a){t.pointCount=0;const c=s.o.MulXV(a,r.m_p,l),_=s.o.MulTXV(i,c,h);let u=0,p=-o.p;const d=e.m_radius+r.m_radius,f=e.m_count,y=e.m_vertices,S=e.m_normals;for(let t=0;t<f;++t){const e=s.p.DotVV(S[t],s.p.SubVV(_,y[t],s.p.s_t0));if(e>d)return;e>p&&(p=e,u=t)}const x=u,C=(x+1)%f,B=y[x],w=y[C];if(p<o.j)return t.pointCount=1,t.type=n.g.e_faceA,t.localNormal.Copy(S[u]),s.p.MidVV(B,w,t.localPoint),t.points[0].localPoint.Copy(r.m_p),void(t.points[0].id.key=0);const g=s.p.DotVV(s.p.SubVV(_,B,s.p.s_t0),s.p.SubVV(w,B,s.p.s_t1)),v=s.p.DotVV(s.p.SubVV(_,w,s.p.s_t0),s.p.SubVV(B,w,s.p.s_t1));if(g<=0){if(s.p.DistanceSquaredVV(_,B)>d*d)return;t.pointCount=1,t.type=n.g.e_faceA,s.p.SubVV(_,B,t.localNormal).SelfNormalize(),t.localPoint.Copy(B),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}else if(v<=0){if(s.p.DistanceSquaredVV(_,w)>d*d)return;t.pointCount=1,t.type=n.g.e_faceA,s.p.SubVV(_,w,t.localNormal).SelfNormalize(),t.localPoint.Copy(w),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}else{const e=s.p.MidVV(B,w,m);if(s.p.DotVV(s.p.SubVV(_,e,s.p.s_t1),S[x])>d)return;t.pointCount=1,t.type=n.g.e_faceA,t.localNormal.Copy(S[x]).SelfNormalize(),t.localPoint.Copy(e),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}}},function(t,e,i){"use strict";i.d(e,"b",function(){return DistanceJointDef}),i.d(e,"a",function(){return DistanceJoint});var s=i(0),o=i(1),n=i(3);class DistanceJointDef extends n.b{constructor(){super(n.c.e_distanceJoint),this.localAnchorA=new s.p,this.localAnchorB=new s.p,this.length=1,this.frequencyHz=0,this.dampingRatio=0}Initialize(t,e,i,o){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.length=s.p.DistanceVV(i,o),this.frequencyHz=0,this.dampingRatio=0}}class DistanceJoint extends n.a{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_bias=0,this.m_localAnchorA=new s.p,this.m_localAnchorB=new s.p,this.m_gamma=0,this.m_impulse=0,this.m_length=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new s.p,this.m_rA=new s.p,this.m_rB=new s.p,this.m_localCenterA=new s.p,this.m_localCenterB=new s.p,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_qA=new s.k,this.m_qB=new s.k,this.m_lalcA=new s.p,this.m_lalcB=new s.p,this.m_frequencyHz=Object(o.c)(t.frequencyHz,0),this.m_dampingRatio=Object(o.c)(t.dampingRatio,0),this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_length=t.length}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse*this.m_u.x,e.y=t*this.m_impulse*this.m_u.y,e}GetReactionTorque(t){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetLength(t){this.m_length=t}Length(){return this.m_length}SetFrequency(t){this.m_frequencyHz=t}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t}GetDampingRatio(){return this.m_dampingRatio}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: DistanceJointDef = new DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v;let m=t.velocities[this.m_indexB].w;const c=this.m_qA.SetAngle(i),_=this.m_qB.SetAngle(l);s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),s.k.MulRV(c,this.m_lalcA,this.m_rA),s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),s.k.MulRV(_,this.m_lalcB,this.m_rB),this.m_u.x=a.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=a.y+this.m_rB.y-e.y-this.m_rA.y;const u=this.m_u.Length();u>o.n?this.m_u.SelfMul(1/u):this.m_u.SetZero();const p=s.p.CrossVV(this.m_rA,this.m_u),d=s.p.CrossVV(this.m_rB,this.m_u);let f=this.m_invMassA+this.m_invIA*p*p+this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=0!==f?1/f:0,this.m_frequencyHz>0){const e=u-this.m_length,i=2*o.F*this.m_frequencyHz,s=2*this.m_mass*this.m_dampingRatio*i,n=this.m_mass*i*i,r=t.step.dt;this.m_gamma=r*(s+r*n),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=e*r*n*this.m_gamma,f+=this.m_gamma,this.m_mass=0!==f?1/f:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const e=s.p.MulSV(this.m_impulse,this.m_u,DistanceJoint.InitVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,e),r-=this.m_invIA*s.p.CrossVV(this.m_rA,e),h.SelfMulAdd(this.m_invMassB,e),m+=this.m_invIB*s.p.CrossVV(this.m_rB,e)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=m}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const o=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=s.p.AddVCrossSV(e,i,this.m_rA,DistanceJoint.SolveVelocityConstraints_s_vpA),a=s.p.AddVCrossSV(o,n,this.m_rB,DistanceJoint.SolveVelocityConstraints_s_vpB),l=s.p.DotVV(this.m_u,s.p.SubVV(a,r,s.p.s_t0)),h=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;const m=s.p.MulSV(h,this.m_u,DistanceJoint.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,m),i-=this.m_invIA*s.p.CrossVV(this.m_rA,m),o.SelfMulAdd(this.m_invMassB,m),n+=this.m_invIB*s.p.CrossVV(this.m_rB,m),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){if(this.m_frequencyHz>0)return!0;const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r),h=s.k.MulRV(a,this.m_lalcA,this.m_rA),m=s.k.MulRV(l,this.m_lalcB,this.m_rB),c=this.m_u;c.x=n.x+m.x-e.x-h.x,c.y=n.y+m.y-e.y-h.y;let _=this.m_u.Normalize()-this.m_length;_=Object(s.d)(_,-o.q,o.q);const u=-this.m_mass*_,p=s.p.MulSV(u,c,DistanceJoint.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,p),i-=this.m_invIA*s.p.CrossVV(h,p),n.SelfMulAdd(this.m_invMassB,p),r+=this.m_invIB*s.p.CrossVV(m,p),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,Object(s.a)(_)<o.n}}DistanceJoint.InitVelocityConstraints_s_P=new s.p,DistanceJoint.SolveVelocityConstraints_s_vpA=new s.p,DistanceJoint.SolveVelocityConstraints_s_vpB=new s.p,DistanceJoint.SolveVelocityConstraints_s_P=new s.p,DistanceJoint.SolvePositionConstraints_s_P=new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return KeyboardInput});var s=i(18);class KeyboardInput{constructor(t=!1){this._preventDefault=t,this._listeners=[],this._keyStates=new Map,this.onKeyEvent=(t,e)=>{const i=t.code;this._preventDefault&&t.preventDefault(),this._keyStates.set(i,e);for(const t of this._listeners)t(i,e)},window.addEventListener("keydown",t=>this.onKeyEvent(t,!0)),window.addEventListener("keyup",t=>this.onKeyEvent(t,!1))}addListener(t){this._listeners.push(t)}removeListener(t){Object(s.c)(this._listeners,t)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return BaseTestScene});var s=i(2),o=i(10),n=i(13);const r=35,a=28;class BaseTestScene{constructor(){const t=new s.Scene,e=Object(n.a)("bgColor",new s.Color(7308476));t.fog=new s.Fog(e.getHex(),0,6),t.autoUpdate=!1,t.matrixAutoUpdate=!1;const i=new s.PerspectiveCamera(o.a.isMobile?a:r,o.a.aspect,.01,10);o.a.onChange(()=>{i.fov=o.a.isMobile?a:r,i.aspect=o.a.aspect,i.updateProjectionMatrix()},!0),i.position.set(0,.2,.4),i.lookAt(0,0,0),i.updateProjectionMatrix(),t.add(i),this.scene=t,this.camera=i,this.bgColor=e}update(t){this.scene.updateMatrixWorld(!1)}render(t,e){t.setClearColor(this.bgColor,1),t.clear(!0,!0,!0),t.render(this.scene,this.camera)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return m});var s=i(2),o=i(10),n=i(7);const r=.1,a=200,l=6e3;const h=new s.PerspectiveCamera(o.a.isMobile?28:35,o.a.aspect,.01,10),m=new class CameraShaker{constructor(t){this.camera=t,this._time=0,this._timers=[],this._shakeScale=25e-5,this._shakeStrength=0;const e=t.clone();e.position.set(0,0,0),e.quaternion.setFromEuler(new s.Euler(0,0,0)),e.scale.set(1,1,1),t.add(e),this.shakyCamera=e}set shakeStrength(t){(t=Object(n.b)(t,0,1))!==this._shakeStrength&&(this._shakeStrength=t)}set shakeScale(t){(t=Object(n.b)(t,0,10))!==this._shakeScale&&(this._shakeScale=t)}updateProjection(){this.shakyCamera.fov=this.camera.fov,this.shakyCamera.aspect=this.camera.aspect,this.shakyCamera.updateProjectionMatrix()}update(t){if(this._time+=t,this.shakeStrength=this._shakeStrength+t/r*(this._timers.length>0?12:-1),this._shakeStrength>0){this.shakyCamera.position.set(0,0,0);let t=1;for(let e=a;e<l;e*=1.674,t*=.8){const i=1/t*this._shakeScale*this._shakeStrength;this.shakyCamera.position.x+=Math.sin(this._time*e)*i,this.shakyCamera.position.y+=Math.sin(this._time*e*1.235)*i,this.shakyCamera.position.z+=Math.sin(this._time*e*1.67235)*i}}for(;this._timers.length>0&&this._timers[0]<=this._time;)this._timers.shift()}add(t){this._timers.push(this._time+t),this._timers.sort()}}(h);o.a.onChange(()=>{h.fov=o.a.isMobile?28:35,h.aspect=o.a.aspect,h.updateProjectionMatrix(),m.updateProjection()})},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(2),o=i(94);function url(t,e){return`fonts/${t}.${e}`}class FontFace{constructor(t){this.name=t}async init(){this.initd||(this.initd=!0,this.msdfTexture=await Object(o.b)(url(this.name,"png")),this.msdfTexture.minFilter=s.LinearFilter,this.msdfTexture.magFilter=s.LinearFilter,this.font=await Object(o.a)(url(this.name,"json")))}}const n={GothicA1Black:new FontFace("GothicA1-Black"),GothicA1Bold:new FontFace("GothicA1-Bold"),GothicA1ExtraBold:new FontFace("GothicA1-ExtraBold"),GothicA1ExtraLight:new FontFace("GothicA1-ExtraLight"),GothicA1Light:new FontFace("GothicA1-Light"),GothicA1Medium:new FontFace("GothicA1-Medium"),GothicA1Regular:new FontFace("GothicA1-Regular"),GothicA1SemiBold:new FontFace("GothicA1-SemiBold"),GothicA1Thin:new FontFace("GothicA1-Thin")}},,,function(t,e,i){"use strict";i.d(e,"b",function(){return FixtureDef}),i.d(e,"a",function(){return Fixture});var s=i(4),o=i(6),n=i(0),r=i(1);class Filter{constructor(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}Clone(){return(new Filter).Copy(this)}Copy(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this}}Filter.DEFAULT=new Filter;class FixtureDef{constructor(){this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new Filter}}class FixtureProxy{constructor(t){this.aabb=new s.a,this.childIndex=0,this.fixture=t}}class Fixture{constructor(t,e){this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=[],this.m_proxyCount=0,this.m_filter=new Filter,this.m_isSensor=!1,this.m_userData=null,this.m_body=e,this.m_shape=t.shape.Clone()}GetType(){return this.m_shape.GetType()}GetShape(){return this.m_shape}SetSensor(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}IsSensor(){return this.m_isSensor}SetFilterData(t){this.m_filter.Copy(t),this.Refilter()}GetFilterData(){return this.m_filter}Refilter(){let t=this.m_body.GetContactList();for(;t;){const e=t.contact,i=e.GetFixtureA(),s=e.GetFixtureB();i!==this&&s!==this||e.FlagForFiltering(),t=t.next}const e=this.m_body.GetWorld();if(null===e)return;const i=e.m_contactManager.m_broadPhase;for(let t=0;t<this.m_proxyCount;++t)i.TouchProxy(this.m_proxies[t].treeNode)}GetBody(){return this.m_body}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}TestPoint(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}ComputeDistance(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)}RayCast(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}GetMassData(t=new o.a){return this.m_shape.ComputeMass(t,this.m_density),t}SetDensity(t){this.m_density=t}GetDensity(){return this.m_density}GetFriction(){return this.m_friction}SetFriction(t){this.m_friction=t}GetRestitution(){return this.m_restitution}SetRestitution(t){this.m_restitution=t}GetAABB(t){return this.m_proxies[t].aabb}Dump(t,e){t("    const fd: FixtureDef = new FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)}Create(t){this.m_userData=t.userData,this.m_friction=Object(r.c)(t.friction,.2),this.m_restitution=Object(r.c)(t.restitution,0),this.m_next=null,this.m_filter.Copy(Object(r.c)(t.filter,Filter.DEFAULT)),this.m_isSensor=Object(r.c)(t.isSensor,!1),this.m_proxies=Object(r.a)(this.m_shape.GetChildCount(),t=>new FixtureProxy(this)),this.m_proxyCount=0,this.m_density=Object(r.c)(t.density,0)}Destroy(){}CreateProxies(t){const e=this.m_body.m_world.m_contactManager.m_broadPhase;this.m_proxyCount=this.m_shape.GetChildCount();for(let i=0;i<this.m_proxyCount;++i){const s=this.m_proxies[i]=new FixtureProxy(this);this.m_shape.ComputeAABB(s.aabb,t,i),s.treeNode=e.CreateProxy(s.aabb,s),s.childIndex=i}}DestroyProxies(){const t=this.m_body.m_world.m_contactManager.m_broadPhase;for(let e=0;e<this.m_proxyCount;++e){const i=this.m_proxies[e];delete i.treeNode.userData,t.DestroyProxy(i.treeNode),delete i.treeNode}this.m_proxyCount=0}TouchProxies(){const t=this.m_body.m_world.m_contactManager.m_broadPhase,e=this.m_proxyCount;for(let i=0;i<e;++i)t.TouchProxy(this.m_proxies[i].treeNode)}Synchronize(t,e){if(0===this.m_proxyCount)return;const i=this.m_body.m_world.m_contactManager.m_broadPhase;for(let s=0;s<this.m_proxyCount;++s){const o=this.m_proxies[s],r=Fixture.Synchronize_s_aabb1,a=Fixture.Synchronize_s_aabb2;this.m_shape.ComputeAABB(r,t,s),this.m_shape.ComputeAABB(a,e,s),o.aabb.Combine2(r,a);const l=n.p.SubVV(e.p,t.p,Fixture.Synchronize_s_displacement);i.MoveProxy(o.treeNode,o.aabb,l)}}}Fixture.Synchronize_s_aabb1=new s.a,Fixture.Synchronize_s_aabb2=new s.a,Fixture.Synchronize_s_displacement=new n.p},function(t,e,i){"use strict";i.d(e,"a",function(){return ChainAndCircleContact});var s=i(26),o=i(22),n=i(16);class ChainAndCircleContact extends n.a{constructor(){super()}static Create(t){return new ChainAndCircleContact}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){const o=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape(),r=o,a=ChainAndCircleContact.Evaluate_s_edge;r.GetChildEdge(a,this.m_indexA),Object(s.a)(t,a,e,n,i)}}ChainAndCircleContact.Evaluate_s_edge=new o.a},function(t,e,i){"use strict";i.d(e,"a",function(){return ChainAndPolygonContact});var s=i(26),o=i(22),n=i(16);class ChainAndPolygonContact extends n.a{constructor(){super()}static Create(t){return new ChainAndPolygonContact}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){const o=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape(),r=o,a=ChainAndPolygonContact.Evaluate_s_edge;r.GetChildEdge(a,this.m_indexA),Object(s.b)(t,a,e,n,i)}}ChainAndPolygonContact.Evaluate_s_edge=new o.a},function(t,e,i){"use strict";i.d(e,"a",function(){return CircleContact});var s=i(37),o=i(16);class CircleContact extends o.a{static Create(t){return new CircleContact}static Destroy(t,e){}constructor(){super()}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){const o=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();Object(s.a)(t,o,e,n,i)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return EdgeAndCircleContact});var s=i(26),o=i(16);class EdgeAndCircleContact extends o.a{static Create(t){return new EdgeAndCircleContact}static Destroy(t,e){}constructor(){super()}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){const o=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();Object(s.a)(t,o,e,n,i)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return EdgeAndPolygonContact});var s=i(26),o=i(16);class EdgeAndPolygonContact extends o.a{static Create(t){return new EdgeAndPolygonContact}static Destroy(t,e){}constructor(){super()}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){const o=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();Object(s.b)(t,o,e,n,i)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return PolygonAndCircleContact});var s=i(37),o=i(16);class PolygonAndCircleContact extends o.a{static Create(t){return new PolygonAndCircleContact}static Destroy(t,e){}constructor(){super()}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){const o=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();Object(s.b)(t,o,e,n,i)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return PolygonContact});var s=i(61),o=i(16);class PolygonContact extends o.a{static Create(t){return new PolygonContact}static Destroy(t,e){}constructor(){super()}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){const o=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();Object(s.a)(t,o,e,n,i)}}},function(t,e,i){"use strict";i.d(e,"b",function(){return ContactSolverDef}),i.d(e,"a",function(){return ContactSolver});var s=i(4),o=i(0),n=i(1),r=i(15);let a=!1;class VelocityConstraintPoint{constructor(){this.rA=new o.p,this.rB=new o.p,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}static MakeArray(t){return Object(n.a)(t,t=>new VelocityConstraintPoint)}}class ContactVelocityConstraint{constructor(){this.points=VelocityConstraintPoint.MakeArray(n.r),this.normal=new o.p,this.tangent=new o.p,this.normalMass=new o.f,this.K=new o.f,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}static MakeArray(t){return Object(n.a)(t,t=>new ContactVelocityConstraint)}}class ContactPositionConstraint{constructor(){this.localPoints=o.p.MakeArray(n.r),this.localNormal=new o.p,this.localPoint=new o.p,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new o.p,this.localCenterB=new o.p,this.invIA=0,this.invIB=0,this.type=s.g.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}static MakeArray(t){return Object(n.a)(t,t=>new ContactPositionConstraint)}}class ContactSolverDef{constructor(){this.step=new r.d,this.count=0,this.allocator=null}}class PositionSolverManifold{constructor(){this.normal=new o.p,this.point=new o.p,this.separation=0}Initialize(t,e,i,n){const r=PositionSolverManifold.Initialize_s_pointA,a=PositionSolverManifold.Initialize_s_pointB,l=PositionSolverManifold.Initialize_s_planePoint,h=PositionSolverManifold.Initialize_s_clipPoint;switch(t.type){case s.g.e_circles:o.o.MulXV(e,t.localPoint,r),o.o.MulXV(i,t.localPoints[0],a),o.p.SubVV(a,r,this.normal).SelfNormalize(),o.p.MidVV(r,a,this.point),this.separation=o.p.DotVV(o.p.SubVV(a,r,o.p.s_t0),this.normal)-t.radiusA-t.radiusB;break;case s.g.e_faceA:o.k.MulRV(e.q,t.localNormal,this.normal),o.o.MulXV(e,t.localPoint,l),o.o.MulXV(i,t.localPoints[n],h),this.separation=o.p.DotVV(o.p.SubVV(h,l,o.p.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(h);break;case s.g.e_faceB:o.k.MulRV(i.q,t.localNormal,this.normal),o.o.MulXV(i,t.localPoint,l),o.o.MulXV(e,t.localPoints[n],h),this.separation=o.p.DotVV(o.p.SubVV(h,l,o.p.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(h),this.normal.SelfNeg()}}}PositionSolverManifold.Initialize_s_pointA=new o.p,PositionSolverManifold.Initialize_s_pointB=new o.p,PositionSolverManifold.Initialize_s_planePoint=new o.p,PositionSolverManifold.Initialize_s_clipPoint=new o.p;class ContactSolver{constructor(){this.m_step=new r.d,this.m_allocator=null,this.m_positionConstraints=ContactPositionConstraint.MakeArray(1024),this.m_velocityConstraints=ContactVelocityConstraint.MakeArray(1024),this.m_count=0}Initialize(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count){const t=Object(o.h)(2*this.m_positionConstraints.length,this.m_count);for(;this.m_positionConstraints.length<t;)this.m_positionConstraints[this.m_positionConstraints.length]=new ContactPositionConstraint}if(this.m_velocityConstraints.length<this.m_count){const t=Object(o.h)(2*this.m_velocityConstraints.length,this.m_count);for(;this.m_velocityConstraints.length<t;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new ContactVelocityConstraint}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(let t=0;t<this.m_count;++t){const e=this.m_contacts[t],i=e.m_fixtureA,s=e.m_fixtureB,o=i.GetShape(),n=s.GetShape(),r=o.m_radius,a=n.m_radius,l=i.GetBody(),h=s.GetBody(),m=e.GetManifold(),c=m.pointCount,_=this.m_velocityConstraints[t];_.friction=e.m_friction,_.restitution=e.m_restitution,_.tangentSpeed=e.m_tangentSpeed,_.indexA=l.m_islandIndex,_.indexB=h.m_islandIndex,_.invMassA=l.m_invMass,_.invMassB=h.m_invMass,_.invIA=l.m_invI,_.invIB=h.m_invI,_.contactIndex=t,_.pointCount=c,_.K.SetZero(),_.normalMass.SetZero();const u=this.m_positionConstraints[t];u.indexA=l.m_islandIndex,u.indexB=h.m_islandIndex,u.invMassA=l.m_invMass,u.invMassB=h.m_invMass,u.localCenterA.Copy(l.m_sweep.localCenter),u.localCenterB.Copy(h.m_sweep.localCenter),u.invIA=l.m_invI,u.invIB=h.m_invI,u.localNormal.Copy(m.localNormal),u.localPoint.Copy(m.localPoint),u.pointCount=c,u.radiusA=r,u.radiusB=a,u.type=m.type;for(let t=0;t<c;++t){const e=m.points[t],i=_.points[t];this.m_step.warmStarting?(i.normalImpulse=this.m_step.dtRatio*e.normalImpulse,i.tangentImpulse=this.m_step.dtRatio*e.tangentImpulse):(i.normalImpulse=0,i.tangentImpulse=0),i.rA.SetZero(),i.rB.SetZero(),i.normalMass=0,i.tangentMass=0,i.velocityBias=0,u.localPoints[t].Copy(e.localPoint)}}return this}InitializeVelocityConstraints(){const t=ContactSolver.InitializeVelocityConstraints_s_xfA,e=ContactSolver.InitializeVelocityConstraints_s_xfB,i=ContactSolver.InitializeVelocityConstraints_s_worldManifold;for(let s=0;s<this.m_count;++s){const r=this.m_velocityConstraints[s],l=this.m_positionConstraints[s],h=l.radiusA,m=l.radiusB,c=this.m_contacts[r.contactIndex].GetManifold(),_=r.indexA,u=r.indexB,p=r.invMassA,d=r.invMassB,f=r.invIA,y=r.invIB,S=l.localCenterA,x=l.localCenterB,C=this.m_positions[_].c,B=this.m_positions[_].a,w=this.m_velocities[_].v,g=this.m_velocities[_].w,v=this.m_positions[u].c,A=this.m_positions[u].a,V=this.m_velocities[u].v,b=this.m_velocities[u].w;t.q.SetAngle(B),e.q.SetAngle(A),o.p.SubVV(C,o.k.MulRV(t.q,S,o.p.s_t0),t.p),o.p.SubVV(v,o.k.MulRV(e.q,x,o.p.s_t0),e.p),i.Initialize(c,t,h,e,m),r.normal.Copy(i.normal),o.p.CrossVOne(r.normal,r.tangent);const P=r.pointCount;for(let t=0;t<P;++t){const e=r.points[t];o.p.SubVV(i.points[t],C,e.rA),o.p.SubVV(i.points[t],v,e.rB);const s=o.p.CrossVV(e.rA,r.normal),a=o.p.CrossVV(e.rB,r.normal),l=p+d+f*s*s+y*a*a;e.normalMass=l>0?1/l:0;const h=r.tangent,m=o.p.CrossVV(e.rA,h),c=o.p.CrossVV(e.rB,h),_=p+d+f*m*m+y*c*c;e.tangentMass=_>0?1/_:0,e.velocityBias=0;const u=o.p.DotVV(r.normal,o.p.SubVV(o.p.AddVCrossSV(V,b,e.rB,o.p.s_t0),o.p.AddVCrossSV(w,g,e.rA,o.p.s_t1),o.p.s_t0));u<-n.J&&(e.velocityBias+=-r.restitution*u)}if(2===r.pointCount&&a){const t=r.points[0],e=r.points[1],i=o.p.CrossVV(t.rA,r.normal),s=o.p.CrossVV(t.rB,r.normal),n=o.p.CrossVV(e.rA,r.normal),a=o.p.CrossVV(e.rB,r.normal),l=p+d+f*i*i+y*s*s,h=p+d+f*n*n+y*a*a,m=p+d+f*i*n+y*s*a;l*l<1e3*(l*h-m*m)?(r.K.ex.Set(l,m),r.K.ey.Set(m,h),r.K.GetInverse(r.normalMass)):r.pointCount=1}}}WarmStart(){const t=ContactSolver.WarmStart_s_P;for(let e=0;e<this.m_count;++e){const i=this.m_velocityConstraints[e],s=i.indexA,n=i.indexB,r=i.invMassA,a=i.invIA,l=i.invMassB,h=i.invIB,m=i.pointCount,c=this.m_velocities[s].v;let _=this.m_velocities[s].w;const u=this.m_velocities[n].v;let p=this.m_velocities[n].w;const d=i.normal,f=i.tangent;for(let e=0;e<m;++e){const s=i.points[e];o.p.AddVV(o.p.MulSV(s.normalImpulse,d,o.p.s_t0),o.p.MulSV(s.tangentImpulse,f,o.p.s_t1),t),_-=a*o.p.CrossVV(s.rA,t),c.SelfMulSub(r,t),p+=h*o.p.CrossVV(s.rB,t),u.SelfMulAdd(l,t)}this.m_velocities[s].w=_,this.m_velocities[n].w=p}}SolveVelocityConstraints(){const t=ContactSolver.SolveVelocityConstraints_s_dv,e=ContactSolver.SolveVelocityConstraints_s_dv1,i=ContactSolver.SolveVelocityConstraints_s_dv2,s=ContactSolver.SolveVelocityConstraints_s_P,n=ContactSolver.SolveVelocityConstraints_s_a,r=ContactSolver.SolveVelocityConstraints_s_b,l=ContactSolver.SolveVelocityConstraints_s_x,h=ContactSolver.SolveVelocityConstraints_s_d,m=ContactSolver.SolveVelocityConstraints_s_P1,c=ContactSolver.SolveVelocityConstraints_s_P2,_=ContactSolver.SolveVelocityConstraints_s_P1P2;for(let u=0;u<this.m_count;++u){const p=this.m_velocityConstraints[u],d=p.indexA,f=p.indexB,y=p.invMassA,S=p.invIA,x=p.invMassB,C=p.invIB,B=p.pointCount,w=this.m_velocities[d].v;let g=this.m_velocities[d].w;const v=this.m_velocities[f].v;let A=this.m_velocities[f].w;const V=p.normal,b=p.tangent,P=p.friction;for(let e=0;e<B;++e){const i=p.points[e];o.p.SubVV(o.p.AddVCrossSV(v,A,i.rB,o.p.s_t0),o.p.AddVCrossSV(w,g,i.rA,o.p.s_t1),t);const n=o.p.DotVV(t,b)-p.tangentSpeed;let r=i.tangentMass*-n;const a=P*i.normalImpulse,l=Object(o.d)(i.tangentImpulse+r,-a,a);r=l-i.tangentImpulse,i.tangentImpulse=l,o.p.MulSV(r,b,s),w.SelfMulSub(y,s),g-=S*o.p.CrossVV(i.rA,s),v.SelfMulAdd(x,s),A+=C*o.p.CrossVV(i.rB,s)}if(1===p.pointCount||!1===a)for(let e=0;e<B;++e){const i=p.points[e];o.p.SubVV(o.p.AddVCrossSV(v,A,i.rB,o.p.s_t0),o.p.AddVCrossSV(w,g,i.rA,o.p.s_t1),t);const n=o.p.DotVV(t,V);let r=-i.normalMass*(n-i.velocityBias);const a=Object(o.h)(i.normalImpulse+r,0);r=a-i.normalImpulse,i.normalImpulse=a,o.p.MulSV(r,V,s),w.SelfMulSub(y,s),g-=S*o.p.CrossVV(i.rA,s),v.SelfMulAdd(x,s),A+=C*o.p.CrossVV(i.rB,s)}else{const t=p.points[0],s=p.points[1];n.Set(t.normalImpulse,s.normalImpulse),o.p.SubVV(o.p.AddVCrossSV(v,A,t.rB,o.p.s_t0),o.p.AddVCrossSV(w,g,t.rA,o.p.s_t1),e),o.p.SubVV(o.p.AddVCrossSV(v,A,s.rB,o.p.s_t0),o.p.AddVCrossSV(w,g,s.rA,o.p.s_t1),i);let a=o.p.DotVV(e,V),u=o.p.DotVV(i,V);for(r.x=a-t.velocityBias,r.y=u-s.velocityBias,r.SelfSub(o.f.MulMV(p.K,n,o.p.s_t0));;){if(o.f.MulMV(p.normalMass,r,l).SelfNeg(),l.x>=0&&l.y>=0){o.p.SubVV(l,n,h),o.p.MulSV(h.x,V,m),o.p.MulSV(h.y,V,c),o.p.AddVV(m,c,_),w.SelfMulSub(y,_),g-=S*(o.p.CrossVV(t.rA,m)+o.p.CrossVV(s.rA,c)),v.SelfMulAdd(x,_),A+=C*(o.p.CrossVV(t.rB,m)+o.p.CrossVV(s.rB,c)),t.normalImpulse=l.x,s.normalImpulse=l.y;break}if(l.x=-t.normalMass*r.x,l.y=0,a=0,u=p.K.ex.y*l.x+r.y,l.x>=0&&u>=0){o.p.SubVV(l,n,h),o.p.MulSV(h.x,V,m),o.p.MulSV(h.y,V,c),o.p.AddVV(m,c,_),w.SelfMulSub(y,_),g-=S*(o.p.CrossVV(t.rA,m)+o.p.CrossVV(s.rA,c)),v.SelfMulAdd(x,_),A+=C*(o.p.CrossVV(t.rB,m)+o.p.CrossVV(s.rB,c)),t.normalImpulse=l.x,s.normalImpulse=l.y;break}if(l.x=0,l.y=-s.normalMass*r.y,a=p.K.ey.x*l.y+r.x,u=0,l.y>=0&&a>=0){o.p.SubVV(l,n,h),o.p.MulSV(h.x,V,m),o.p.MulSV(h.y,V,c),o.p.AddVV(m,c,_),w.SelfMulSub(y,_),g-=S*(o.p.CrossVV(t.rA,m)+o.p.CrossVV(s.rA,c)),v.SelfMulAdd(x,_),A+=C*(o.p.CrossVV(t.rB,m)+o.p.CrossVV(s.rB,c)),t.normalImpulse=l.x,s.normalImpulse=l.y;break}if(l.x=0,l.y=0,a=r.x,u=r.y,a>=0&&u>=0){o.p.SubVV(l,n,h),o.p.MulSV(h.x,V,m),o.p.MulSV(h.y,V,c),o.p.AddVV(m,c,_),w.SelfMulSub(y,_),g-=S*(o.p.CrossVV(t.rA,m)+o.p.CrossVV(s.rA,c)),v.SelfMulAdd(x,_),A+=C*(o.p.CrossVV(t.rB,m)+o.p.CrossVV(s.rB,c)),t.normalImpulse=l.x,s.normalImpulse=l.y;break}break}}this.m_velocities[d].w=g,this.m_velocities[f].w=A}}StoreImpulses(){for(let t=0;t<this.m_count;++t){const e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold();for(let t=0;t<e.pointCount;++t)i.points[t].normalImpulse=e.points[t].normalImpulse,i.points[t].tangentImpulse=e.points[t].tangentImpulse}}SolvePositionConstraints(){const t=ContactSolver.SolvePositionConstraints_s_xfA,e=ContactSolver.SolvePositionConstraints_s_xfB,i=ContactSolver.SolvePositionConstraints_s_psm,s=ContactSolver.SolvePositionConstraints_s_rA,r=ContactSolver.SolvePositionConstraints_s_rB,a=ContactSolver.SolvePositionConstraints_s_P;let l=0;for(let h=0;h<this.m_count;++h){const m=this.m_positionConstraints[h],c=m.indexA,_=m.indexB,u=m.localCenterA,p=m.invMassA,d=m.invIA,f=m.localCenterB,y=m.invMassB,S=m.invIB,x=m.pointCount,C=this.m_positions[c].c;let B=this.m_positions[c].a;const w=this.m_positions[_].c;let g=this.m_positions[_].a;for(let h=0;h<x;++h){t.q.SetAngle(B),e.q.SetAngle(g),o.p.SubVV(C,o.k.MulRV(t.q,u,o.p.s_t0),t.p),o.p.SubVV(w,o.k.MulRV(e.q,f,o.p.s_t0),e.p),i.Initialize(m,t,e,h);const c=i.normal,_=i.point,x=i.separation;o.p.SubVV(_,C,s),o.p.SubVV(_,w,r),l=Object(o.i)(l,x);const v=Object(o.d)(n.i*(x+n.n),-n.q,0),A=o.p.CrossVV(s,c),V=o.p.CrossVV(r,c),b=p+y+d*A*A+S*V*V,P=b>0?-v/b:0;o.p.MulSV(P,c,a),C.SelfMulSub(p,a),B-=d*o.p.CrossVV(s,a),w.SelfMulAdd(y,a),g+=S*o.p.CrossVV(r,a)}this.m_positions[c].a=B,this.m_positions[_].a=g}return l>-3*n.n}SolveTOIPositionConstraints(t,e){const i=ContactSolver.SolveTOIPositionConstraints_s_xfA,s=ContactSolver.SolveTOIPositionConstraints_s_xfB,r=ContactSolver.SolveTOIPositionConstraints_s_psm,a=ContactSolver.SolveTOIPositionConstraints_s_rA,l=ContactSolver.SolveTOIPositionConstraints_s_rB,h=ContactSolver.SolveTOIPositionConstraints_s_P;let m=0;for(let c=0;c<this.m_count;++c){const _=this.m_positionConstraints[c],u=_.indexA,p=_.indexB,d=_.localCenterA,f=_.localCenterB,y=_.pointCount;let S=0,x=0;u!==t&&u!==e||(S=_.invMassA,x=_.invIA);let C=0,B=0;p!==t&&p!==e||(C=_.invMassB,B=_.invIB);const w=this.m_positions[u].c;let g=this.m_positions[u].a;const v=this.m_positions[p].c;let A=this.m_positions[p].a;for(let t=0;t<y;++t){i.q.SetAngle(g),s.q.SetAngle(A),o.p.SubVV(w,o.k.MulRV(i.q,d,o.p.s_t0),i.p),o.p.SubVV(v,o.k.MulRV(s.q,f,o.p.s_t0),s.p),r.Initialize(_,i,s,t);const e=r.normal,c=r.point,u=r.separation;o.p.SubVV(c,w,a),o.p.SubVV(c,v,l),m=Object(o.i)(m,u);const p=Object(o.d)(n.I*(u+n.n),-n.q,0),y=o.p.CrossVV(a,e),V=o.p.CrossVV(l,e),b=S+C+x*y*y+B*V*V,P=b>0?-p/b:0;o.p.MulSV(P,e,h),w.SelfMulSub(S,h),g-=x*o.p.CrossVV(a,h),v.SelfMulAdd(C,h),A+=B*o.p.CrossVV(l,h)}this.m_positions[u].a=g,this.m_positions[p].a=A}return m>=-1.5*n.n}}ContactSolver.InitializeVelocityConstraints_s_xfA=new o.o,ContactSolver.InitializeVelocityConstraints_s_xfB=new o.o,ContactSolver.InitializeVelocityConstraints_s_worldManifold=new s.l,ContactSolver.WarmStart_s_P=new o.p,ContactSolver.SolveVelocityConstraints_s_dv=new o.p,ContactSolver.SolveVelocityConstraints_s_dv1=new o.p,ContactSolver.SolveVelocityConstraints_s_dv2=new o.p,ContactSolver.SolveVelocityConstraints_s_P=new o.p,ContactSolver.SolveVelocityConstraints_s_a=new o.p,ContactSolver.SolveVelocityConstraints_s_b=new o.p,ContactSolver.SolveVelocityConstraints_s_x=new o.p,ContactSolver.SolveVelocityConstraints_s_d=new o.p,ContactSolver.SolveVelocityConstraints_s_P1=new o.p,ContactSolver.SolveVelocityConstraints_s_P2=new o.p,ContactSolver.SolveVelocityConstraints_s_P1P2=new o.p,ContactSolver.SolvePositionConstraints_s_xfA=new o.o,ContactSolver.SolvePositionConstraints_s_xfB=new o.o,ContactSolver.SolvePositionConstraints_s_psm=new PositionSolverManifold,ContactSolver.SolvePositionConstraints_s_rA=new o.p,ContactSolver.SolvePositionConstraints_s_rB=new o.p,ContactSolver.SolvePositionConstraints_s_P=new o.p,ContactSolver.SolveTOIPositionConstraints_s_xfA=new o.o,ContactSolver.SolveTOIPositionConstraints_s_xfB=new o.o,ContactSolver.SolveTOIPositionConstraints_s_psm=new PositionSolverManifold,ContactSolver.SolveTOIPositionConstraints_s_rA=new o.p,ContactSolver.SolveTOIPositionConstraints_s_rB=new o.p,ContactSolver.SolveTOIPositionConstraints_s_P=new o.p},function(t,e,i){"use strict";i.d(e,"a",function(){return s});const s=new(i(117).a)(void 0,!1)},function(t,e,i){"use strict";var s=i(2),o=i(137),n=i(10),r=i(31),a=i(138);const l=document.createElement("canvas"),h=new s.WebGLRenderer({canvas:l,antialias:!0,premultipliedAlpha:!1});document.body.append(l);["-moz-crisp-edges","-webkit-crisp-edges","pixelated","crisp-edges"].forEach(t=>{h.context.canvas.style.setProperty("image-rendering",t)}),h.shadowMap.enabled=!0,h.shadowMap.type=s.PCFShadowMap,h.gammaOutput=!0,h.gammaFactor=2.2,h.autoClear=!1;const m=new a.a("pixel-down-sample","Graphics Quality",6,0,10,t=>t,t=>t+"",!0,o.a,1);let c=1;function updatePixelRatio(){const t=n.a.pixelRatio/c;r.a.value=t,h.setPixelRatio(t)}m.listen(t=>{c=Math.round(t+1),updatePixelRatio()}),n.a.onChange(()=>{updatePixelRatio();const{width:t,height:e}=n.a;h.setSize(t,e),r.a.value=n.a.pixelRatio,r.b.value.set(2/t,2/e)},!0);Math.min(8192,h.capabilities.maxTextureSize);e.a=h},,,function(t,e,i){"use strict";i.d(e,"a",function(){return GrowableStack});var s=i(1);class GrowableStack{constructor(t){this.m_stack=[],this.m_count=0,this.m_stack=Object(s.a)(t,t=>null),this.m_count=0}Reset(){return this.m_count=0,this}Push(t){this.m_stack[this.m_count]=t,this.m_count++}Pop(){this.m_count--;const t=this.m_stack[this.m_count];if(this.m_stack[this.m_count]=null,null===t)throw new Error;return t}GetCount(){return this.m_count}}},function(t,e,i){"use strict";i.d(e,"a",function(){return BroadPhase});var s=i(60);class Pair{constructor(t,e){this.proxyA=t,this.proxyB=e}}class BroadPhase{constructor(){this.m_tree=new s.a,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}CreateProxy(t,e){const i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}DestroyProxy(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}MoveProxy(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)}TouchProxy(t){this.BufferMove(t)}GetProxyCount(){return this.m_proxyCount}UpdatePairs(t){this.m_pairCount=0;for(let t=0;t<this.m_moveCount;++t){const e=this.m_moveBuffer[t];if(null===e)continue;const i=e.aabb;this.m_tree.Query(i,t=>{if(t.m_id===e.m_id)return!0;let i,s;if(t.m_id<e.m_id?(i=t,s=e):(i=e,s=t),this.m_pairCount===this.m_pairBuffer.length)this.m_pairBuffer[this.m_pairCount]=new Pair(i,s);else{const t=this.m_pairBuffer[this.m_pairCount];t.proxyA=i,t.proxyB=s}return++this.m_pairCount,!0})}this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(PairLessThan);let e=0;for(;e<this.m_pairCount;){const i=this.m_pairBuffer[e];for(t(i.proxyA.userData,i.proxyB.userData),++e;e<this.m_pairCount;){const t=this.m_pairBuffer[e];if(t.proxyA.m_id!==i.proxyA.m_id||t.proxyB.m_id!==i.proxyB.m_id)break;++e}}}Query(t,e){this.m_tree.Query(t,e)}QueryPoint(t,e){this.m_tree.QueryPoint(t,e)}RayCast(t,e){this.m_tree.RayCast(t,e)}GetTreeHeight(){return this.m_tree.GetHeight()}GetTreeBalance(){return this.m_tree.GetMaxBalance()}GetTreeQuality(){return this.m_tree.GetAreaRatio()}ShiftOrigin(t){this.m_tree.ShiftOrigin(t)}BufferMove(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}UnBufferMove(t){const e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null}}function PairLessThan(t,e){return t.proxyA.m_id===e.proxyA.m_id?t.proxyB.m_id-e.proxyB.m_id:t.proxyA.m_id-e.proxyA.m_id}},function(t,e,i){"use strict";i.d(e,"a",function(){return DynamicTree});var s=i(58),o=i(0),n=i(1),r=i(4);function verify(t){if(null===t)throw new Error;return t}class TreeNode{constructor(t=0){this.m_id=0,this.aabb=new r.a,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=t}IsLeaf(){return null===this.child1}}class DynamicTree{constructor(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0,this.m_stack=new s.a(256)}static GetAreaNode(t){if(null===t)return 0;if(t.IsLeaf())return 0;let e=t.aabb.GetPerimeter();return e+=DynamicTree.GetAreaNode(t.child1),e+=DynamicTree.GetAreaNode(t.child2)}static GetMaxBalanceNode(t,e){if(null===t)return e;if(t.height<=1)return e;const i=verify(t.child1),s=verify(t.child2),n=Object(o.a)(s.height-i.height);return Object(o.h)(e,n)}static ShiftOriginNode(t,e){if(null===t)return;if(t.height<=1)return;const i=t.child1,s=t.child2;DynamicTree.ShiftOriginNode(i,e),DynamicTree.ShiftOriginNode(s,e),t.aabb.lowerBound.SelfSub(e),t.aabb.upperBound.SelfSub(e)}Query(t,e){if(null===this.m_root)return;const i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){const s=i.Pop();if(s.aabb.TestOverlap(t))if(s.IsLeaf()){if(!e(s))return}else i.Push(verify(s.child1)),i.Push(verify(s.child2))}}QueryPoint(t,e){if(null===this.m_root)return;const i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){const s=i.Pop();if(s.aabb.TestContain(t))if(s.IsLeaf()){if(!e(s))return}else i.Push(verify(s.child1)),i.Push(verify(s.child2))}}RayCast(t,e){if(null===this.m_root)return;const i=t.p1,s=t.p2,n=o.p.SubVV(s,i,DynamicTree.s_r);n.Normalize();const a=o.p.CrossOneV(n,DynamicTree.s_v),l=o.p.AbsV(a,DynamicTree.s_abs_v);let h=t.maxFraction;const m=DynamicTree.s_segmentAABB;let c=i.x+h*(s.x-i.x),_=i.y+h*(s.y-i.y);m.lowerBound.x=Object(o.i)(i.x,c),m.lowerBound.y=Object(o.i)(i.y,_),m.upperBound.x=Object(o.h)(i.x,c),m.upperBound.y=Object(o.h)(i.y,_);const u=this.m_stack.Reset();for(u.Push(this.m_root);u.GetCount()>0;){const n=u.Pop();if(!Object(r.j)(n.aabb,m))continue;const p=n.aabb.GetCenter(),d=n.aabb.GetExtents();if(!(Object(o.a)(o.p.DotVV(a,o.p.SubVV(i,p,o.p.s_t0)))-o.p.DotVV(l,d)>0))if(n.IsLeaf()){const r=DynamicTree.s_subInput;r.p1.Copy(t.p1),r.p2.Copy(t.p2),r.maxFraction=h;const a=e(r,n);if(0===a)return;a>0&&(h=a,c=i.x+h*(s.x-i.x),_=i.y+h*(s.y-i.y),m.lowerBound.x=Object(o.i)(i.x,c),m.lowerBound.y=Object(o.i)(i.y,_),m.upperBound.x=Object(o.h)(i.x,c),m.upperBound.y=Object(o.h)(i.y,_))}else u.Push(verify(n.child1)),u.Push(verify(n.child2))}}AllocateNode(){if(this.m_freeList){const t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,delete t.userData,t}return new TreeNode(DynamicTree.s_node_id++)}FreeNode(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,delete t.userData,this.m_freeList=t}CreateProxy(t,e){const i=this.AllocateNode(),s=n.d,o=n.d;return i.aabb.lowerBound.x=t.lowerBound.x-s,i.aabb.lowerBound.y=t.lowerBound.y-o,i.aabb.upperBound.x=t.upperBound.x+s,i.aabb.upperBound.y=t.upperBound.y+o,i.userData=e,i.height=0,this.InsertLeaf(i),i}DestroyProxy(t){this.RemoveLeaf(t),this.FreeNode(t)}MoveProxy(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);const s=n.d+n.e*(i.x>0?i.x:-i.x),o=n.d+n.e*(i.y>0?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-s,t.aabb.lowerBound.y=e.lowerBound.y-o,t.aabb.upperBound.x=e.upperBound.x+s,t.aabb.upperBound.y=e.upperBound.y+o,this.InsertLeaf(t),!0}InsertLeaf(t){if(++this.m_insertionCount,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);const e=t.aabb;let i=this.m_root;for(;!i.IsLeaf();){const t=verify(i.child1),s=verify(i.child2),o=i.aabb.GetPerimeter(),n=DynamicTree.s_combinedAABB;n.Combine2(i.aabb,e);const r=n.GetPerimeter(),a=2*r,l=2*(r-o);let h;const m=DynamicTree.s_aabb;let c,_,u;if(t.IsLeaf()?(m.Combine2(e,t.aabb),h=m.GetPerimeter()+l):(m.Combine2(e,t.aabb),c=t.aabb.GetPerimeter(),h=(_=m.GetPerimeter())-c+l),s.IsLeaf()?(m.Combine2(e,s.aabb),u=m.GetPerimeter()+l):(m.Combine2(e,s.aabb),c=s.aabb.GetPerimeter(),u=(_=m.GetPerimeter())-c+l),a<h&&a<u)break;i=i=h<u?t:s}const s=i,n=s.parent,r=this.AllocateNode();r.parent=n,delete r.userData,r.aabb.Combine2(e,s.aabb),r.height=s.height+1,n?(n.child1===s?n.child1=r:n.child2=r,r.child1=s,r.child2=t,s.parent=r,t.parent=r):(r.child1=s,r.child2=t,s.parent=r,t.parent=r,this.m_root=r);let a=t.parent;for(;null!==a;){const t=verify((a=this.Balance(a)).child1),e=verify(a.child2);a.height=1+Object(o.h)(t.height,e.height),a.aabb.Combine2(t.aabb,e.aabb),a=a.parent}}RemoveLeaf(t){if(t===this.m_root)return void(this.m_root=null);const e=verify(t.parent),i=e&&e.parent,s=e.child1===t?verify(e.child2):verify(e.child1);if(i){i.child1===e?i.child1=s:i.child2=s,s.parent=i,this.FreeNode(e);let t=i;for(;t;){const e=verify((t=this.Balance(t)).child1),i=verify(t.child2);t.aabb.Combine2(e.aabb,i.aabb),t.height=1+Object(o.h)(e.height,i.height),t=t.parent}}else this.m_root=s,s.parent=null,this.FreeNode(e)}Balance(t){if(t.IsLeaf()||t.height<2)return t;const e=verify(t.child1),i=verify(t.child2),s=i.height-e.height;if(s>1){const s=verify(i.child1),n=verify(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,s.height>n.height?(i.child2=s,t.child2=n,n.parent=t,t.aabb.Combine2(e.aabb,n.aabb),i.aabb.Combine2(t.aabb,s.aabb),t.height=1+Object(o.h)(e.height,n.height),i.height=1+Object(o.h)(t.height,s.height)):(i.child2=n,t.child2=s,s.parent=t,t.aabb.Combine2(e.aabb,s.aabb),i.aabb.Combine2(t.aabb,n.aabb),t.height=1+Object(o.h)(e.height,s.height),i.height=1+Object(o.h)(t.height,n.height)),i}if(s<-1){const s=verify(e.child1),n=verify(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,s.height>n.height?(e.child2=s,t.child1=n,n.parent=t,t.aabb.Combine2(i.aabb,n.aabb),e.aabb.Combine2(t.aabb,s.aabb),t.height=1+Object(o.h)(i.height,n.height),e.height=1+Object(o.h)(t.height,s.height)):(e.child2=n,t.child1=s,s.parent=t,t.aabb.Combine2(i.aabb,s.aabb),e.aabb.Combine2(t.aabb,n.aabb),t.height=1+Object(o.h)(i.height,s.height),e.height=1+Object(o.h)(t.height,n.height)),e}return t}GetHeight(){return null===this.m_root?0:this.m_root.height}GetAreaRatio(){if(null===this.m_root)return 0;const t=this.m_root.aabb.GetPerimeter();return DynamicTree.GetAreaNode(this.m_root)/t}ComputeHeightNode(t){if(!t||t.IsLeaf())return 0;const e=this.ComputeHeightNode(t.child1),i=this.ComputeHeightNode(t.child2);return 1+Object(o.h)(e,i)}ComputeHeight(){return this.ComputeHeightNode(this.m_root)}ValidateStructure(t){if(null===t)return;this.m_root;const e=t;if(e.IsLeaf())return;const i=verify(e.child1),s=verify(e.child2);this.ValidateStructure(i),this.ValidateStructure(s)}ValidateMetrics(t){if(null===t)return;const e=t;if(e.IsLeaf())return;const i=verify(e.child1),s=verify(e.child2);DynamicTree.s_aabb.Combine2(i.aabb,s.aabb),this.ValidateMetrics(i),this.ValidateMetrics(s)}Validate(){}GetMaxBalance(){return DynamicTree.GetMaxBalanceNode(this.m_root,0)}RebuildBottomUp(){this.Validate()}ShiftOrigin(t){DynamicTree.ShiftOriginNode(this.m_root,t)}}DynamicTree.s_r=new o.p,DynamicTree.s_v=new o.p,DynamicTree.s_abs_v=new o.p,DynamicTree.s_segmentAABB=new r.a,DynamicTree.s_subInput=new r.h,DynamicTree.s_combinedAABB=new r.a,DynamicTree.s_aabb=new r.a,DynamicTree.s_node_id=0},function(t,e,i){"use strict";i.d(e,"a",function(){return CollidePolygons});var s=i(0),o=i(1),n=i(4);const r=new s.p,a=new s.p,l=new s.p,h=new s.p;function EdgeSeparation(t,e,i,n,m){const c=t.m_vertices,_=t.m_normals,u=n.m_count,p=n.m_vertices,d=s.k.MulRV(e.q,_[i],r),f=s.k.MulTRV(m.q,d,a);let y=0,S=o.p;for(let t=0;t<u;++t){const e=s.p.DotVV(p[t],f);e<S&&(S=e,y=t)}const x=s.o.MulXV(e,c[i],l),C=s.o.MulXV(m,p[y],h);return s.p.DotVV(s.p.SubVV(C,x,s.p.s_t0),d)}const m=new s.p,c=new s.p;function FindMaxSeparation(t,e,i,n,r){const a=e.m_count,l=e.m_normals,h=s.p.SubVV(s.o.MulXV(r,n.m_centroid,s.p.s_t0),s.o.MulXV(i,e.m_centroid,s.p.s_t1),m),_=s.k.MulTRV(i.q,h,c);let u=0,p=-o.p;for(let t=0;t<a;++t){const e=s.p.DotVV(l[t],_);e>p&&(p=e,u=t)}let d=EdgeSeparation(e,i,u,n,r);const f=(u+a-1)%a,y=EdgeSeparation(e,i,f,n,r),S=(u+1)%a,x=EdgeSeparation(e,i,S,n,r);let C=0,B=0,w=0;if(y>d&&y>x)w=-1,C=f,B=y;else{if(!(x>d))return t[0]=u,d;w=1,C=S,B=x}for(;(d=EdgeSeparation(e,i,u=-1===w?(C+a-1)%a:(C+1)%a,n,r))>B;)C=u,B=d;return t[0]=C,B}const _=new s.p;const u=n.c.MakeArray(2),p=n.c.MakeArray(2),d=n.c.MakeArray(2),f=[0],y=[0],S=new s.p,x=new s.p,C=new s.p,B=new s.p,w=new s.p,g=new s.p,v=new s.p,A=new s.p;function CollidePolygons(t,e,i,r,a){t.pointCount=0;const l=e.m_radius+r.m_radius,h=f;h[0]=0;const m=FindMaxSeparation(h,e,i,r,a);if(m>l)return;const c=y;c[0]=0;const V=FindMaxSeparation(c,r,a,e,i);if(V>l)return;let b,P,M,I,G=0,D=0;V>.98*m+.001?(b=r,P=e,M=a,I=i,G=c[0],t.type=n.g.e_faceB,D=1):(b=e,P=r,M=i,I=a,G=h[0],t.type=n.g.e_faceA,D=0);const F=u;!function FindIncidentEdge(t,e,i,r,a,l){const h=e.m_normals,m=a.m_count,c=a.m_vertices,u=a.m_normals,p=s.k.MulTRV(l.q,s.k.MulRV(i.q,h[r],s.p.s_t0),_);let d=0,f=o.p;for(let t=0;t<m;++t){const e=s.p.DotVV(p,u[t]);e<f&&(f=e,d=t)}const y=d,S=(y+1)%m,x=t[0];s.o.MulXV(l,c[y],x.v);const C=x.id.cf;C.indexA=r,C.indexB=y,C.typeA=n.d.e_face,C.typeB=n.d.e_vertex;const B=t[1];s.o.MulXV(l,c[S],B.v);const w=B.id.cf;w.indexA=r,w.indexB=S,w.typeA=n.d.e_face,w.typeB=n.d.e_vertex}(F,b,M,G,P,I);const k=b.m_count,L=b.m_vertices,R=G,T=(G+1)%k,j=L[R],O=L[T],E=s.p.SubVV(O,j,S);E.Normalize();const q=s.p.CrossVOne(E,x),J=s.p.MidVV(j,O,C),z=s.k.MulRV(M.q,E,w),N=s.p.CrossVOne(z,B),W=s.o.MulXV(M,j,v),U=s.o.MulXV(M,O,A),K=s.p.DotVV(N,W),X=-s.p.DotVV(z,W)+l,Z=s.p.DotVV(z,U)+l,H=p,Q=d;let Y;const $=s.p.NegV(z,g);if((Y=Object(n.b)(H,F,$,X,R))<2)return;if((Y=Object(n.b)(Q,H,z,Z,T))<2)return;t.localNormal.Copy(q),t.localPoint.Copy(J);let tt=0;for(let e=0;e<o.r;++e){const i=Q[e];if(s.p.DotVV(N,i.v)-K<=l){const e=t.points[tt];if(s.o.MulTXV(I,i.v,e.localPoint),e.id.Copy(i.id),D){const t=e.id.cf;e.id.cf.indexA=t.indexB,e.id.cf.indexB=t.indexA,e.id.cf.typeA=t.typeB,e.id.cf.typeB=t.typeA}++tt}}t.pointCount=tt}},function(t,e,i){"use strict";i.d(e,"a",function(){return ParticleSystem});var s=i(4),o=i(22),n=i(6),r=i(11),a=i(0),l=i(1),h=i(15),m=i(19),c=i(5),_=i(14),u=i(124);function std_iter_swap(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}function default_compare(t,e){return t<e}function std_sort(t,e=0,i=t.length-e,s=default_compare){let o=e;const n=[];let r=0;for(;;){for(;o+1<i;i++){const e=t[o+Math.floor(Math.random()*(i-o))];n[r++]=i;for(let n=o-1;;){for(;s(t[++n],e););for(;s(e,t[--i]););if(n>=i)break;std_iter_swap(t,n,i)}}if(0===r)break;o=i,i=n[--r]}return t}function std_stable_sort(t,e=0,i=t.length-e,s=default_compare){return std_sort(t,e,i,s)}function std_remove_if(t,e,i=t.length){let s=0;for(let o=0;o<i;++o)e(t[o])||(o!==s?std_iter_swap(t,s++,o):++s);return s}function std_lower_bound(t,e,i,s,o){let n=i-e;for(;n>0;){const i=Math.floor(n/2);let r=e+i;o(t[r],s)?(e=++r,n-=i+1):n=i}return e}function std_upper_bound(t,e,i,s,o){let n=i-e;for(;n>0;){const i=Math.floor(n/2);let r=e+i;o(s,t[r])?n=i:(e=++r,n-=i+1)}return e}function std_rotate(t,e,i,s){let o=i;for(;e!==o;)std_iter_swap(t,e++,o++),o===s?o=i:e===i&&(i=o)}class GrowableBuffer{constructor(t){this.data=[],this.count=0,this.capacity=0,this.allocator=t}Append(){return this.count>=this.capacity&&this.Grow(),this.count++}Reserve(t){if(!(this.capacity>=t)){for(let e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}Grow(){const t=this.capacity?2*this.capacity:l.C;this.Reserve(t)}Free(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)}Shorten(t){}Data(){return this.data}GetCount(){return this.count}SetCount(t){this.count=t}GetCapacity(){return this.capacity}RemoveIf(t){this.count=std_remove_if(this.data,t,this.count)}Unique(t){this.count=function std_unique(t,e,i,s){if(e===i)return i;let o=e;for(;++e!==i;)s(t[o],t[e])||std_iter_swap(t,++o,e);return++o}(this.data,0,this.count,t)}}class FixtureParticleQueryCallback extends m.d{constructor(t){super(),this.m_system=t}ShouldQueryParticleSystem(t){return!1}ReportFixture(t){if(t.IsSensor())return!0;const e=t.GetShape().GetChildCount();for(let i=0;i<e;i++){const e=t.GetAABB(i),s=this.m_system.GetInsideBoundsEnumerator(e);let o=s.GetNext();for(;o>=0;)this.ReportFixtureAndParticle(t,i,o),o=s.GetNext()}return!0}ReportParticle(t,e){return!1}ReportFixtureAndParticle(t,e,i){}}class ParticleContact{constructor(){this.indexA=0,this.indexB=0,this.weight=0,this.normal=new a.p,this.flags=0}SetIndices(t,e){this.indexA=t,this.indexB=e}SetWeight(t){this.weight=t}SetNormal(t){this.normal.Copy(t)}SetFlags(t){this.flags=t}GetIndexA(){return this.indexA}GetIndexB(){return this.indexB}GetWeight(){return this.weight}GetNormal(){return this.normal}GetFlags(){return this.flags}IsEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}IsNotEqual(t){return!this.IsEqual(t)}ApproximatelyEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&Object(a.a)(this.weight-t.weight)<.01&&a.p.DistanceSquaredVV(this.normal,t.normal)<1e-4}}class ParticleBodyContact{constructor(){this.index=0,this.weight=0,this.normal=new a.p,this.mass=0}}class ParticlePair{constructor(){this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0}}class ParticleTriad{constructor(){this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new a.p(0,0),this.pb=new a.p(0,0),this.pc=new a.p(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0}}class ParticleSystemDef{constructor(){this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}Copy(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}Clone(){return(new ParticleSystemDef).Copy(this)}}class ParticleSystem{constructor(t,e){this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new ParticleSystemUserOverridableBuffer,this.m_flagsBuffer=new ParticleSystemUserOverridableBuffer,this.m_positionBuffer=new ParticleSystemUserOverridableBuffer,this.m_velocityBuffer=new ParticleSystemUserOverridableBuffer,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new ParticleSystemUserOverridableBuffer,this.m_groupBuffer=[],this.m_userDataBuffer=new ParticleSystemUserOverridableBuffer,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new ParticleSystemUserOverridableBuffer,this.m_bodyContactCountBuffer=new ParticleSystemUserOverridableBuffer,this.m_consecutiveContactStepsBuffer=new ParticleSystemUserOverridableBuffer,this.m_stuckParticleBuffer=new GrowableBuffer(()=>0),this.m_proxyBuffer=new GrowableBuffer(()=>new ParticleSystemProxy),this.m_contactBuffer=new GrowableBuffer(()=>new ParticleContact),this.m_bodyContactBuffer=new GrowableBuffer(()=>new ParticleBodyContact),this.m_pairBuffer=new GrowableBuffer(()=>new ParticlePair),this.m_triadBuffer=new GrowableBuffer(()=>new ParticleTriad),this.m_expirationTimeBuffer=new ParticleSystemUserOverridableBuffer,this.m_indexByExpirationTimeBuffer=new ParticleSystemUserOverridableBuffer,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new ParticleSystemDef,this.m_prev=null,this.m_next=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=e,this.SetDestructionByAge(this.m_def.destroyByAge)}static computeTag(t,e){return(e+ParticleSystem.yOffset>>>0<<ParticleSystem.yShift)+(ParticleSystem.xScale*t+ParticleSystem.xOffset>>>0)>>>0}static computeRelativeTag(t,e,i){return t+(i<<ParticleSystem.yShift)+(e<<ParticleSystem.xShift)>>>0}static IsSignificantForce(t){return 0!==t.x||0!==t.y}static ParticleCanBeConnected(t,e){return 0!=(t&(c.c.wallParticle|c.c.springParticle|c.c.elasticParticle))||null!==e&&0!=(e.GetGroupFlags()&_.c.rigidParticleGroup)}static ComparePairIndices(t,e){const i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB}static MatchPairIndices(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}static CompareTriadIndices(t,e){const i=t.indexA-e.indexA;if(0!==i)return i<0;const s=t.indexB-e.indexB;return 0!==s?s<0:t.indexC<e.indexC}static MatchTriadIndices(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}static InitializeParticleLists(t,e){const i=t.GetBufferIndex(),s=t.GetParticleCount();for(let t=0;t<s;t++){const s=e[t];s.list=s,s.next=null,s.count=1,s.index=t+i}}static MergeParticleLists(t,e){for(let i=e;;){i.list=t;const e=i.next;if(!e){i.next=t.next;break}i=e}t.next=e,t.count+=e.count,e.count=0}static FindLongestParticleList(t,e){const i=t.GetParticleCount();let s=e[0];for(let t=0;t<i;t++){const i=e[t];s.count<i.count&&(s=i)}return s}static MergeParticleListAndNode(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}static ParticleContactIsZombie(t){return(t.flags&c.c.zombieParticle)===c.c.zombieParticle}static BodyContactCompare(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}Drop(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}CreateParticle(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){const t=this.m_count?2*this.m_count:l.C;this.ReallocateInternalAllocatedBuffers(t)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return l.l;this.DestroyOldestParticle(0,!1),this.SolveZombie()}const e=this.m_count++;if(!this.m_flagsBuffer.data)throw new Error;if(this.m_flagsBuffer.data[e]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=0),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;this.m_positionBuffer.data[e]=(this.m_positionBuffer.data[e]||new a.p).Copy(Object(l.c)(t.position,a.p.ZERO)),this.m_velocityBuffer.data[e]=(this.m_velocityBuffer.data[e]||new a.p).Copy(Object(l.c)(t.velocity,a.p.ZERO)),this.m_weightBuffer[e]=0,this.m_forceBuffer[e]=(this.m_forceBuffer[e]||new a.p).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=0),this.m_depthBuffer&&(this.m_depthBuffer[e]=0);const i=(new r.a).Copy(Object(l.c)(t.color,r.a.ZERO));!this.m_colorBuffer.data&&i.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[e]=(this.m_colorBuffer.data[e]||new r.a).Copy(i)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[e]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[e]=null);const s=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],o=Object(l.c)(t.lifetime,0),n=o>0;if(this.m_expirationTimeBuffer.data||n){if(this.SetParticleLifetime(e,n?o:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_indexByExpirationTimeBuffer.data[e]=e}s.index=e;const h=Object(l.c)(t.group,null);return this.m_groupBuffer[e]=h,h&&(h.m_firstIndex<h.m_lastIndex?(this.RotateBuffer(h.m_firstIndex,h.m_lastIndex,e),h.m_lastIndex=e+1):(h.m_firstIndex=e,h.m_lastIndex=e+1)),this.SetParticleFlags(e,Object(l.c)(t.flags,0)),e}GetParticleHandleFromIndex(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);let e=this.m_handleIndexBuffer.data[t];return e||((e=new c.d).SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)}DestroyParticle(t,e=!1){if(!this.m_flagsBuffer.data)throw new Error;let i=c.c.zombieParticle;e&&(i|=c.c.destructionListenerParticle),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|i)}DestroyOldestParticle(t,e=!1){const i=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;if(!this.m_expirationTimeBuffer.data)throw new Error;const s=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],o=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[s]>0?s:o,e)}DestroyParticlesInShape(t,e,i=!1){const s=ParticleSystem.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;const o=new ParticleSystemDestroyParticlesInShapeCallback(this,t,e,i),n=s;return t.ComputeAABB(n,e,0),this.m_world.QueryAABB(o,n),o.Destroyed()}CreateParticleGroup(t){const e=ParticleSystem.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;const i=e;i.SetPositionAngle(Object(l.c)(t.position,a.p.ZERO),Object(l.c)(t.angle,0));const s=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,i),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,Object(l.c)(t.shapeCount,t.shapes.length),t,i),t.positionData){const e=Object(l.c)(t.particleCount,t.positionData.length);for(let s=0;s<e;s++){const e=t.positionData[s];this.CreateParticleForGroup(t,i,e)}}const o=this.m_count;let n=new _.a(this);n.m_firstIndex=s,n.m_lastIndex=o,n.m_strength=Object(l.c)(t.strength,1),n.m_userData=t.userData,n.m_transform.Copy(i),n.m_prev=null,n.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=n),this.m_groupList=n,++this.m_groupCount;for(let t=s;t<o;t++)this.m_groupBuffer[t]=n;this.SetGroupFlags(n,Object(l.c)(t.groupFlags,0));const r=new ParticleSystemConnectionFilter;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(s,o,r),t.group&&(this.JoinParticleGroups(t.group,n),n=t.group),n}JoinParticleGroups(t,e){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);const i=new ParticleSystemJoinParticleGroupsFilter(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(let i=e.m_firstIndex;i<e.m_lastIndex;i++)this.m_groupBuffer[i]=t;const s=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,s),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)}SplitParticleGroup(t){this.UpdateContacts(!0);const e=t.GetParticleCount(),i=Object(l.a)(e,t=>new ParticleSystemParticleListNode);ParticleSystem.InitializeParticleLists(t,i),this.MergeParticleListsInContact(t,i);const s=ParticleSystem.FindLongestParticleList(t,i);this.MergeZombieParticleListNodes(t,i,s),this.CreateParticleGroupsFromParticleList(t,i,s),this.UpdatePairsAndTriadsWithParticleList(t,i)}GetParticleGroupList(){return this.m_groupList}GetParticleGroupCount(){return this.m_groupCount}GetParticleCount(){return this.m_count}GetMaxParticleCount(){return this.m_def.maxCount}SetMaxParticleCount(t){this.m_def.maxCount=t}GetAllParticleFlags(){return this.m_allParticleFlags}GetAllGroupFlags(){return this.m_allGroupFlags}SetPaused(t){this.m_paused=t}GetPaused(){return this.m_paused}SetDensity(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}GetDensity(){return this.m_def.density}SetGravityScale(t){this.m_def.gravityScale=t}GetGravityScale(){return this.m_def.gravityScale}SetDamping(t){this.m_def.dampingStrength=t}GetDamping(){return this.m_def.dampingStrength}SetStaticPressureIterations(t){this.m_def.staticPressureIterations=t}GetStaticPressureIterations(){return this.m_def.staticPressureIterations}SetRadius(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}GetRadius(){return this.m_particleDiameter/2}GetPositionBuffer(){if(!this.m_positionBuffer.data)throw new Error;return this.m_positionBuffer.data}GetVelocityBuffer(){if(!this.m_velocityBuffer.data)throw new Error;return this.m_velocityBuffer.data}GetColorBuffer(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}GetGroupBuffer(){return this.m_groupBuffer}GetWeightBuffer(){return this.m_weightBuffer}GetUserDataBuffer(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}GetFlagsBuffer(){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data}SetParticleFlags(t,e){if(!this.m_flagsBuffer.data)throw new Error;this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(e&c.c.tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),e&c.c.colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e}GetParticleFlags(t){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data[t]}SetFlagsBuffer(t,e){this.SetUserOverridableBuffer(this.m_flagsBuffer,t,e)}SetPositionBuffer(t,e){this.SetUserOverridableBuffer(this.m_positionBuffer,t,e)}SetVelocityBuffer(t,e){this.SetUserOverridableBuffer(this.m_velocityBuffer,t,e)}SetColorBuffer(t,e){this.SetUserOverridableBuffer(this.m_colorBuffer,t,e)}SetUserDataBuffer(t,e){this.SetUserOverridableBuffer(this.m_userDataBuffer,t,e)}GetContacts(){return this.m_contactBuffer.data}GetContactCount(){return this.m_contactBuffer.count}GetBodyContacts(){return this.m_bodyContactBuffer.data}GetBodyContactCount(){return this.m_bodyContactBuffer.count}GetPairs(){return this.m_pairBuffer.data}GetPairCount(){return this.m_pairBuffer.count}GetTriads(){return this.m_triadBuffer.data}GetTriadCount(){return this.m_triadBuffer.count}SetStuckThreshold(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}GetStuckCandidates(){return this.m_stuckParticleBuffer.Data()}GetStuckCandidateCount(){return this.m_stuckParticleBuffer.GetCount()}ComputeCollisionEnergy(){if(!this.m_velocityBuffer.data)throw new Error;const t=ParticleSystem.ComputeCollisionEnergy_s_v,e=this.m_velocityBuffer.data;let i=0;for(let s=0;s<this.m_contactBuffer.count;s++){const o=this.m_contactBuffer.data[s],n=o.indexA,r=o.indexB,l=o.normal,h=a.p.SubVV(e[r],e[n],t),m=a.p.DotVV(h,l);m<0&&(i+=m*m)}return.5*this.GetParticleMass()*i}SetStrictContactCheck(t){this.m_def.strictContactCheck=t}GetStrictContactCheck(){return this.m_def.strictContactCheck}SetParticleLifetime(t,e){const i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i){const t=this.GetParticleCount();for(let e=0;e<t;++e)this.m_indexByExpirationTimeBuffer.data[e]=e}const s=e/this.m_def.lifetimeGranularity,o=s>0?this.GetQuantizedTimeElapsed()+s:s;o!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=o,this.m_expirationTimeBufferRequiresSorting=!0)}GetParticleLifetime(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}SetDestructionByAge(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}GetDestructionByAge(){return this.m_def.destroyByAge}GetExpirationTimeBuffer(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}ExpirationTimeToLifetime(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}GetIndexByExpirationTimeBuffer(){if(this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),!this.m_indexByExpirationTimeBuffer.data)throw new Error;return this.m_indexByExpirationTimeBuffer.data}ParticleApplyLinearImpulse(t,e){this.ApplyLinearImpulse(t,t+1,e)}ApplyLinearImpulse(t,e,i){if(!this.m_velocityBuffer.data)throw new Error;const s=this.m_velocityBuffer.data,o=(e-t)*this.GetParticleMass(),n=(new a.p).Copy(i).SelfMul(1/o);for(let i=t;i<e;i++)s[i].SelfAdd(n)}ParticleApplyForce(t,e){if(!this.m_flagsBuffer.data)throw new Error;ParticleSystem.IsSignificantForce(e)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(e))}ApplyForce(t,e,i){const s=(new a.p).Copy(i).SelfMul(1/(e-t));if(ParticleSystem.IsSignificantForce(s)){this.PrepareForceBuffer();for(let i=t;i<e;i++)this.m_forceBuffer[i].SelfAdd(s)}}GetNext(){return this.m_next}QueryAABB(t,e){if(0===this.m_proxyBuffer.count)return;const i=this.m_proxyBuffer.count,s=std_lower_bound(this.m_proxyBuffer.data,0,i,ParticleSystem.computeTag(this.m_inverseDiameter*e.lowerBound.x,this.m_inverseDiameter*e.lowerBound.y),ParticleSystemProxy.CompareProxyTag),o=std_upper_bound(this.m_proxyBuffer.data,s,i,ParticleSystem.computeTag(this.m_inverseDiameter*e.upperBound.x,this.m_inverseDiameter*e.upperBound.y),ParticleSystemProxy.CompareTagProxy);if(!this.m_positionBuffer.data)throw new Error;const n=this.m_positionBuffer.data;for(let i=s;i<o;++i){const s=this.m_proxyBuffer.data[i].index,o=n[s];if(e.lowerBound.x<o.x&&o.x<e.upperBound.x&&e.lowerBound.y<o.y&&o.y<e.upperBound.y&&!t.ReportParticle(this,s))break}}QueryShapeAABB(t,e,i,s=0){const o=ParticleSystem.QueryShapeAABB_s_aabb;e.ComputeAABB(o,i,s),this.QueryAABB(t,o)}QueryPointAABB(t,e,i=l.n){const s=ParticleSystem.QueryPointAABB_s_aabb;s.lowerBound.Set(e.x-i,e.y-i),s.upperBound.Set(e.x+i,e.y+i),this.QueryAABB(t,s)}RayCast(t,e,i){const s=ParticleSystem.RayCast_s_aabb,o=ParticleSystem.RayCast_s_p,n=ParticleSystem.RayCast_s_v,r=ParticleSystem.RayCast_s_n,l=ParticleSystem.RayCast_s_point;if(0===this.m_proxyBuffer.count)return;if(!this.m_positionBuffer.data)throw new Error;const h=this.m_positionBuffer.data,m=s;a.p.MinV(e,i,m.lowerBound),a.p.MaxV(e,i,m.upperBound);let c=1;const _=a.p.SubVV(i,e,n),u=a.p.DotVV(_,_),p=this.GetInsideBoundsEnumerator(m);let d=p.GetNext();for(;d>=0;){const i=a.p.SubVV(e,h[d],o),s=a.p.DotVV(i,_),n=s*s-u*(a.p.DotVV(i,i)-this.m_squaredDiameter);if(n>=0){const o=Object(a.m)(n);let h=(-s-o)/u;if(h>c)continue;if(h<0&&((h=(-s+o)/u)<0||h>c))continue;const m=a.p.AddVMulSV(i,h,_,r);m.Normalize();const p=t.ReportParticle(this,d,a.p.AddVMulSV(e,h,_,l),m,h);if((c=Object(a.i)(c,p))<=0)break}d=p.GetNext()}}ComputeAABB(t){const e=this.GetParticleCount();if(t.lowerBound.x=+l.p,t.lowerBound.y=+l.p,t.upperBound.x=-l.p,t.upperBound.y=-l.p,!this.m_positionBuffer.data)throw new Error;const i=this.m_positionBuffer.data;for(let s=0;s<e;s++){const e=i[s];a.p.MinV(t.lowerBound,e,t.lowerBound),a.p.MaxV(t.upperBound,e,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}FreeBuffer(t,e){null!==t&&(t.length=0)}FreeUserOverridableBuffer(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)}ReallocateBuffer3(t,e,i){if(i<=e)throw new Error;const s=t?t.slice():[];return s.length=i,s}ReallocateBuffer5(t,e,i,s,o){if(s<=i)throw new Error;if(e&&!(s<=e))throw new Error;return o&&!t||e||(t=this.ReallocateBuffer3(t,i,s)),t}ReallocateBuffer4(t,e,i,s){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,s)}RequestBuffer(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(l.C),(t=[]).length=this.m_internalAllocatedCapacity),t}ReallocateHandleBuffers(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}ReallocateInternalAllocatedBuffers(t){function LimitCapacity(t,e){return e&&t>e?e:t}if(t=LimitCapacity(t,this.m_def.maxCount),t=LimitCapacity(t,this.m_flagsBuffer.userSuppliedCapacity),t=LimitCapacity(t,this.m_positionBuffer.userSuppliedCapacity),t=LimitCapacity(t,this.m_velocityBuffer.userSuppliedCapacity),t=LimitCapacity(t,this.m_colorBuffer.userSuppliedCapacity),t=LimitCapacity(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);const e=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,e),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,e),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,e),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}CreateParticleForGroup(t,e,i){const s=new c.b;s.flags=Object(l.c)(t.flags,0),a.o.MulXV(e,i,s.position),a.p.AddVV(Object(l.c)(t.linearVelocity,a.p.ZERO),a.p.CrossSV(Object(l.c)(t.angularVelocity,0),a.p.SubVV(s.position,Object(l.c)(t.position,a.p.ZERO),a.p.s_t0),a.p.s_t0),s.velocity),s.color.Copy(Object(l.c)(t.color,r.a.ZERO)),s.lifetime=Object(l.c)(t.lifetime,0),s.userData=t.userData,this.CreateParticle(s)}CreateParticlesStrokeShapeForGroup(t,e,i){const s=ParticleSystem.CreateParticlesStrokeShapeForGroup_s_edge,o=ParticleSystem.CreateParticlesStrokeShapeForGroup_s_d,r=ParticleSystem.CreateParticlesStrokeShapeForGroup_s_p;let h=Object(l.c)(e.stride,0);0===h&&(h=this.GetParticleStride());let m=0;const c=t.GetChildCount();for(let l=0;l<c;l++){let c=null;t.GetType()===n.c.e_edgeShape?c=t:(c=s,t.GetChildEdge(c,l));const _=a.p.SubVV(c.m_vertex2,c.m_vertex1,o),u=_.Length();for(;m<u;){const t=a.p.AddVMulSV(c.m_vertex1,m/u,_,r);this.CreateParticleForGroup(e,i,t),m+=h}m-=u}}CreateParticlesFillShapeForGroup(t,e,i){const s=ParticleSystem.CreateParticlesFillShapeForGroup_s_aabb,o=ParticleSystem.CreateParticlesFillShapeForGroup_s_p;let n=Object(l.c)(e.stride,0);0===n&&(n=this.GetParticleStride());const r=a.o.IDENTITY,h=s;t.ComputeAABB(h,r,0);for(let s=Math.floor(h.lowerBound.y/n)*n;s<h.upperBound.y;s+=n)for(let a=Math.floor(h.lowerBound.x/n)*n;a<h.upperBound.x;a+=n){const n=o.Set(a,s);t.TestPoint(r,n)&&this.CreateParticleForGroup(e,i,n)}}CreateParticlesWithShapeForGroup(t,e,i){switch(t.GetType()){case n.c.e_edgeShape:case n.c.e_chainShape:this.CreateParticlesStrokeShapeForGroup(t,e,i);break;case n.c.e_polygonShape:case n.c.e_circleShape:this.CreateParticlesFillShapeForGroup(t,e,i)}}CreateParticlesWithShapesForGroup(t,e,i,s){const o=new ParticleSystemCompositeShape(t,e);this.CreateParticlesFillShapeForGroup(o,i,s)}CloneParticle(t,e){const i=new c.b;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;const s=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){const e=this.m_handleIndexBuffer.data[t];e&&e.SetIndex(s),this.m_handleIndexBuffer.data[s]=e,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[s]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[s]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[s]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[s].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[s]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[s]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[s]=this.m_expirationTimeBuffer.data[t]),s}DestroyParticlesInGroup(t,e=!1){for(let i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)}DestroyParticleGroup(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(let e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}UpdatePairsAndTriads(t,e,i){const s=ParticleSystem.UpdatePairsAndTriads_s_dab,o=ParticleSystem.UpdatePairsAndTriads_s_dbc,n=ParticleSystem.UpdatePairsAndTriads_s_dca;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const r=this.m_positionBuffer.data;let h=0;for(let i=t;i<e;i++)h|=this.m_flagsBuffer.data[i];if(h&ParticleSystem.k_pairFlags)for(let s=0;s<this.m_contactBuffer.count;s++){const o=this.m_contactBuffer.data[s],n=o.indexA,l=o.indexB,h=this.m_flagsBuffer.data[n],m=this.m_flagsBuffer.data[l],_=this.m_groupBuffer[n],u=this.m_groupBuffer[l];if(n>=t&&n<e&&l>=t&&l<e&&!((h|m)&c.c.zombieParticle)&&(h|m)&ParticleSystem.k_pairFlags&&(i.IsNecessary(n)||i.IsNecessary(l))&&ParticleSystem.ParticleCanBeConnected(h,_)&&ParticleSystem.ParticleCanBeConnected(m,u)&&i.ShouldCreatePair(n,l)){const t=this.m_pairBuffer.data[this.m_pairBuffer.Append()];t.indexA=n,t.indexB=l,t.flags=o.flags,t.strength=Object(a.i)(_?_.m_strength:1,u?u.m_strength:1),t.distance=a.p.DistanceVV(r[n],r[l])}std_stable_sort(this.m_pairBuffer.data,0,this.m_pairBuffer.count,ParticleSystem.ComparePairIndices),this.m_pairBuffer.Unique(ParticleSystem.MatchPairIndices)}if(h&ParticleSystem.k_triadFlags){const h=new u.a(e-t);for(let s=t;s<e;s++){const t=this.m_flagsBuffer.data[s],e=this.m_groupBuffer[s];t&c.c.zombieParticle||!ParticleSystem.ParticleCanBeConnected(t,e)||h.AddGenerator(r[s],s,i.IsNecessary(s))}const m=this.GetParticleStride();h.Generate(m/2,2*m);const _=(t,e,h)=>{if(!this.m_flagsBuffer.data)throw new Error;const m=this.m_flagsBuffer.data[t],c=this.m_flagsBuffer.data[e],_=this.m_flagsBuffer.data[h];if((m|c|_)&ParticleSystem.k_triadFlags&&i.ShouldCreateTriad(t,e,h)){const i=r[t],u=r[e],p=r[h],d=a.p.SubVV(i,u,s),f=a.p.SubVV(u,p,o),y=a.p.SubVV(p,i,n),S=l.B*this.m_squaredDiameter;if(a.p.DotVV(d,d)>S||a.p.DotVV(f,f)>S||a.p.DotVV(y,y)>S)return;const x=this.m_groupBuffer[t],C=this.m_groupBuffer[e],B=this.m_groupBuffer[h],w=this.m_triadBuffer.data[this.m_triadBuffer.Append()];w.indexA=t,w.indexB=e,w.indexC=h,w.flags=m|c|_,w.strength=Object(a.i)(Object(a.i)(x?x.m_strength:1,C?C.m_strength:1),B?B.m_strength:1);const g=(i.x+u.x+p.x)/3,v=(i.y+u.y+p.y)/3;w.pa.x=i.x-g,w.pa.y=i.y-v,w.pb.x=u.x-g,w.pb.y=u.y-v,w.pc.x=p.x-g,w.pc.y=p.y-v,w.ka=-a.p.DotVV(y,d),w.kb=-a.p.DotVV(d,f),w.kc=-a.p.DotVV(f,y),w.s=a.p.CrossVV(i,u)+a.p.CrossVV(u,p)+a.p.CrossVV(p,i)}};h.GetNodes(_),std_stable_sort(this.m_triadBuffer.data,0,this.m_triadBuffer.count,ParticleSystem.CompareTriadIndices),this.m_triadBuffer.Unique(ParticleSystem.MatchTriadIndices)}}UpdatePairsAndTriadsWithReactiveParticles(){const t=new ParticleSystemReactiveFilter(this.m_flagsBuffer);if(this.UpdatePairsAndTriads(0,this.m_count,t),!this.m_flagsBuffer.data)throw new Error;for(let t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&=~c.c.reactiveParticle;this.m_allParticleFlags&=~c.c.reactiveParticle}MergeParticleListsInContact(t,e){const i=t.GetBufferIndex();for(let s=0;s<this.m_contactBuffer.count;s++){const o=this.m_contactBuffer.data[s],n=o.indexA,r=o.indexB;if(!t.ContainsParticle(n)||!t.ContainsParticle(r))continue;let a=e[n-i].list,l=e[r-i].list;if(a!==l){if(a.count<l.count){const t=a;a=l,l=t}ParticleSystem.MergeParticleLists(a,l)}}}MergeZombieParticleListNodes(t,e,i){if(!this.m_flagsBuffer.data)throw new Error;const s=t.GetParticleCount();for(let t=0;t<s;t++){const s=e[t];s!==i&&this.m_flagsBuffer.data[s.index]&c.c.zombieParticle&&ParticleSystem.MergeParticleListAndNode(i,s)}}CreateParticleGroupsFromParticleList(t,e,i){if(!this.m_flagsBuffer.data)throw new Error;const s=t.GetParticleCount(),o=new _.b;o.groupFlags=t.GetGroupFlags(),o.userData=t.GetUserData();for(let t=0;t<s;t++){const s=e[t];if(!s.count||s===i)continue;const n=this.CreateParticleGroup(o);for(let t=s;t;t=t.next){const e=t.index,i=this.CloneParticle(e,n);this.m_flagsBuffer.data[e]|=c.c.zombieParticle,t.index=i}}}UpdatePairsAndTriadsWithParticleList(t,e){const i=t.GetBufferIndex();for(let s=0;s<this.m_pairBuffer.count;s++){const o=this.m_pairBuffer.data[s],n=o.indexA,r=o.indexB;t.ContainsParticle(n)&&(o.indexA=e[n-i].index),t.ContainsParticle(r)&&(o.indexB=e[r-i].index)}for(let s=0;s<this.m_triadBuffer.count;s++){const o=this.m_triadBuffer.data[s],n=o.indexA,r=o.indexB,a=o.indexC;t.ContainsParticle(n)&&(o.indexA=e[n-i].index),t.ContainsParticle(r)&&(o.indexB=e[r-i].index),t.ContainsParticle(a)&&(o.indexC=e[a-i].index)}}ComputeDepth(){const t=[];let e=0;for(let i=0;i<this.m_contactBuffer.count;i++){const s=this.m_contactBuffer.data[i],o=s.indexA,n=s.indexB,r=this.m_groupBuffer[o],a=this.m_groupBuffer[n];r&&r===a&&r.m_groupFlags&_.c.particleGroupNeedsUpdateDepth&&(t[e++]=s)}const i=[];let s=0;for(let t=this.m_groupList;t;t=t.GetNext())if(t.m_groupFlags&_.c.particleGroupNeedsUpdateDepth){i[s++]=t,this.SetGroupFlags(t,t.m_groupFlags&~_.c.particleGroupNeedsUpdateDepth);for(let e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_accumulationBuffer[e]=0}for(let i=0;i<e;i++){const e=t[i],s=e.indexA,o=e.indexB,n=e.weight;this.m_accumulationBuffer[s]+=n,this.m_accumulationBuffer[o]+=n}for(let t=0;t<s;t++){const e=i[t];for(let t=e.m_firstIndex;t<e.m_lastIndex;t++){const e=this.m_accumulationBuffer[t];this.m_depthBuffer[t]=e<.8?0:l.p}}const o=Object(a.m)(this.m_count)>>0;for(let i=0;i<o;i++){let i=!1;for(let s=0;s<e;s++){const e=t[s],o=e.indexA,n=e.indexB,r=1-e.weight,a=this.m_depthBuffer[o],l=this.m_depthBuffer[n],h=l+r,m=a+r;a>h&&(this.m_depthBuffer[o]=h,i=!0),l>m&&(this.m_depthBuffer[n]=m,i=!0)}if(!i)break}for(let t=0;t<s;t++){const e=i[t];for(let t=e.m_firstIndex;t<e.m_lastIndex;t++)this.m_depthBuffer[t]<l.p?this.m_depthBuffer[t]*=this.m_particleDiameter:this.m_depthBuffer[t]=0}}GetInsideBoundsEnumerator(t){const e=ParticleSystem.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),i=ParticleSystem.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),s=this.m_proxyBuffer.count,o=std_lower_bound(this.m_proxyBuffer.data,0,s,e,ParticleSystemProxy.CompareProxyTag),n=std_upper_bound(this.m_proxyBuffer.data,0,s,i,ParticleSystemProxy.CompareTagProxy);return new ParticleSystemInsideBoundsEnumerator(this,e,i,o,n)}UpdateAllParticleFlags(){if(!this.m_flagsBuffer.data)throw new Error;this.m_allParticleFlags=0;for(let t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}UpdateAllGroupFlags(){this.m_allGroupFlags=0;for(let t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}AddContact(t,e,i){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;const s=ParticleSystem.AddContact_s_d,o=this.m_positionBuffer.data,n=a.p.SubVV(o[e],o[t],s),r=a.p.DotVV(n,n);if(r<this.m_squaredDiameter){let i=Object(a.e)(r);isFinite(i)||(i=198177537e11);const s=this.m_contactBuffer.data[this.m_contactBuffer.Append()];s.indexA=t,s.indexB=e,s.flags=this.m_flagsBuffer.data[t]|this.m_flagsBuffer.data[e],s.weight=1-r*i*this.m_inverseDiameter,a.p.MulSV(i,n,s.normal)}}FindContacts_Reference(t){const e=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(let t=0,i=0;t<e;t++){const s=ParticleSystem.computeRelativeTag(this.m_proxyBuffer.data[t].tag,1,0);for(let i=t+1;i<e&&!(s<this.m_proxyBuffer.data[i].tag);i++)this.AddContact(this.m_proxyBuffer.data[t].index,this.m_proxyBuffer.data[i].index,this.m_contactBuffer);const o=ParticleSystem.computeRelativeTag(this.m_proxyBuffer.data[t].tag,-1,1);for(;i<e&&!(o<=this.m_proxyBuffer.data[i].tag);i++);const n=ParticleSystem.computeRelativeTag(this.m_proxyBuffer.data[t].tag,1,1);for(let s=i;s<e&&!(n<this.m_proxyBuffer.data[s].tag);s++)this.AddContact(this.m_proxyBuffer.data[t].index,this.m_proxyBuffer.data[s].index,this.m_contactBuffer)}}FindContacts(t){this.FindContacts_Reference(t)}UpdateProxies_Reference(t){if(!this.m_positionBuffer.data)throw new Error;const e=this.m_positionBuffer.data,i=this.m_inverseDiameter;for(let t=0;t<this.m_proxyBuffer.count;++t){const s=this.m_proxyBuffer.data[t],o=e[s.index];s.tag=ParticleSystem.computeTag(i*o.x,i*o.y)}}UpdateProxies(t){this.UpdateProxies_Reference(t)}SortProxies(t){std_sort(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,ParticleSystemProxy.CompareProxyProxy)}FilterContacts(t){const e=this.GetParticleContactFilter();if(null===e)return;this.m_contactBuffer.RemoveIf(t=>0!=(t.flags&c.c.particleContactFilterParticle)&&!e.ShouldCollideParticleParticle(this,t.indexA,t.indexB))}NotifyContactListenerPreContact(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}NotifyContactListenerPostContact(t){const e=this.GetParticleContactListener();if(null!==e){for(let i=0;i<this.m_contactBuffer.count;++i){const s=this.m_contactBuffer.data[i],o=-1;o>=0?t.Invalidate(o):e.BeginContactParticleParticle(this,s)}throw new Error}}UpdateContacts(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);const e=new ParticlePairSet;this.NotifyContactListenerPreContact(e),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(e),t&&this.m_contactBuffer.RemoveIf(ParticleSystem.ParticleContactIsZombie)}NotifyBodyContactListenerPreContact(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}NotifyBodyContactListenerPostContact(t){const e=this.GetFixtureContactListener();if(null!==e){for(let i=0;i<this.m_bodyContactBuffer.count;i++){const s=this.m_bodyContactBuffer.data[i],o=-1;o>=0?t.Invalidate(o):e.BeginContactFixtureParticle(this,s)}throw new Error}}UpdateBodyContacts(){const t=ParticleSystem.UpdateBodyContacts_s_aabb,e=new ParticleSystemFixtureParticleSet;if(this.NotifyBodyContactListenerPreContact(e),this.m_stuckThreshold>0){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;const t=this.GetParticleCount();for(let e=0;e<t;e++)this.m_bodyContactCountBuffer.data[e]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[e]+1&&(this.m_consecutiveContactStepsBuffer.data[e]=0)}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);const i=t;this.ComputeAABB(i);const s=new ParticleSystemUpdateBodyContactsCallback(this,this.GetFixtureContactFilter());this.m_world.QueryAABB(s,i),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(e)}Solve(t){const e=ParticleSystem.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(t),this.m_allParticleFlags&c.c.zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<t.particleIterations;this.m_iterationIndex++){++this.m_timestamp;const i=e.Copy(t);if(i.dt/=t.particleIterations,i.inv_dt*=t.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&_.c.particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&c.c.reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(i),this.m_allParticleFlags&c.c.viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&c.c.repulsiveParticle&&this.SolveRepulsive(i),this.m_allParticleFlags&c.c.powderParticle&&this.SolvePowder(i),this.m_allParticleFlags&c.c.tensileParticle&&this.SolveTensile(i),this.m_allGroupFlags&_.c.solidParticleGroup&&this.SolveSolid(i),this.m_allParticleFlags&c.c.colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(i),this.m_allParticleFlags&c.c.staticPressureParticle&&this.SolveStaticPressure(i),this.SolvePressure(i),this.SolveDamping(i),this.m_allParticleFlags&ParticleSystem.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&c.c.elasticParticle&&this.SolveElastic(i),this.m_allParticleFlags&c.c.springParticle&&this.SolveSpring(i),this.LimitVelocity(i),this.m_allGroupFlags&_.c.rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&c.c.barrierParticle&&this.SolveBarrier(i),this.SolveCollision(i),this.m_allGroupFlags&_.c.rigidParticleGroup&&this.SolveRigid(i),this.m_allParticleFlags&c.c.wallParticle&&this.SolveWall(),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(let t=0;t<this.m_count;t++)this.m_positionBuffer.data[t].SelfMulAdd(i.dt,this.m_velocityBuffer.data[t])}}SolveCollision(t){const e=ParticleSystem.SolveCollision_s_aabb;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=e;o.lowerBound.x=+l.p,o.lowerBound.y=+l.p,o.upperBound.x=-l.p,o.upperBound.y=-l.p;for(let e=0;e<this.m_count;e++){const n=s[e],r=i[e],l=r.x+t.dt*n.x,h=r.y+t.dt*n.y;o.lowerBound.x=Object(a.i)(o.lowerBound.x,Object(a.i)(r.x,l)),o.lowerBound.y=Object(a.i)(o.lowerBound.y,Object(a.i)(r.y,h)),o.upperBound.x=Object(a.h)(o.upperBound.x,Object(a.h)(r.x,l)),o.upperBound.y=Object(a.h)(o.upperBound.y,Object(a.h)(r.y,h))}const n=new ParticleSystemSolveCollisionCallback(this,t);this.m_world.QueryAABB(n,o)}LimitVelocity(t){if(!this.m_velocityBuffer.data)throw new Error;const e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t);for(let t=0;t<this.m_count;t++){const s=e[t],o=a.p.DotVV(s,s);o>i&&s.SelfMul(Object(a.m)(i/o))}}SolveGravity(t){if(!this.m_velocityBuffer.data)throw new Error;const e=ParticleSystem.SolveGravity_s_gravity,i=this.m_velocityBuffer.data,s=a.p.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),e);for(let t=0;t<this.m_count;t++)i[t].SelfAdd(s)}SolveBarrier(t){const e=ParticleSystem.SolveBarrier_s_aabb,i=ParticleSystem.SolveBarrier_s_va,s=ParticleSystem.SolveBarrier_s_vb,o=ParticleSystem.SolveBarrier_s_pba,n=ParticleSystem.SolveBarrier_s_vba,r=ParticleSystem.SolveBarrier_s_vc,h=ParticleSystem.SolveBarrier_s_pca,m=ParticleSystem.SolveBarrier_s_vca,_=ParticleSystem.SolveBarrier_s_qba,u=ParticleSystem.SolveBarrier_s_qca,p=ParticleSystem.SolveBarrier_s_dv,d=ParticleSystem.SolveBarrier_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const f=this.m_positionBuffer.data,y=this.m_velocityBuffer.data;for(let t=0;t<this.m_count;t++){0!=(this.m_flagsBuffer.data[t]&ParticleSystem.k_barrierWallFlags)&&y[t].SetZero()}const S=l.h*t.dt,x=this.GetParticleMass();for(let l=0;l<this.m_pairBuffer.count;l++){const C=this.m_pairBuffer.data[l];if(C.flags&c.c.barrierParticle){const l=C.indexA,c=C.indexB,B=f[l],w=f[c],g=e;a.p.MinV(B,w,g.lowerBound),a.p.MaxV(B,w,g.upperBound);const v=this.m_groupBuffer[l],A=this.m_groupBuffer[c],V=this.GetLinearVelocity(v,l,B,i),b=this.GetLinearVelocity(A,c,w,s),P=a.p.SubVV(w,B,o),M=a.p.SubVV(b,V,n),I=this.GetInsideBoundsEnumerator(g);let G=I.GetNext();for(;G>=0;){const e=f[G],i=this.m_groupBuffer[G];if(v!==i&&A!==i){const s=this.GetLinearVelocity(i,G,e,r),o=a.p.SubVV(e,B,h),n=a.p.SubVV(s,V,m),l=a.p.CrossVV(M,n),c=a.p.CrossVV(P,n)-a.p.CrossVV(o,M),f=a.p.CrossVV(P,o);let C,w;const g=_,v=u;if(0===l){if(0===c)continue;if(!((w=-f/c)>=0&&w<S))continue;if(a.p.AddVMulSV(P,w,M,g),a.p.AddVMulSV(o,w,n,v),!((C=a.p.DotVV(g,v)/a.p.DotVV(g,g))>=0&&C<=1))continue}else{const t=c*c-4*f*l;if(t<0)continue;const e=Object(a.m)(t);let i=(-c-e)/(2*l),s=(-c+e)/(2*l);if(i>s){const t=i;i=s,s=t}if(w=i,a.p.AddVMulSV(P,w,M,g),a.p.AddVMulSV(o,w,n,v),C=a.p.DotVV(g,v)/a.p.DotVV(g,g),!(w>=0&&w<S&&C>=0&&C<=1)){if(!((w=s)>=0&&w<S))continue;if(a.p.AddVMulSV(P,w,M,g),a.p.AddVMulSV(o,w,n,v),!((C=a.p.DotVV(g,v)/a.p.DotVV(g,g))>=0&&C<=1))continue}}const A=p;A.x=V.x+C*M.x-s.x,A.y=V.y+C*M.y-s.y;const b=a.p.MulSV(x,A,d);if(i&&this.IsRigidGroup(i)){const t=i.GetMass(),s=i.GetInertia();t>0&&i.m_linearVelocity.SelfMulAdd(1/t,b),s>0&&(i.m_angularVelocity+=a.p.CrossVV(a.p.SubVV(e,i.GetCenter(),a.p.s_t0),b)/s)}else y[G].SelfAdd(A);this.ParticleApplyForce(G,b.SelfMul(-t.inv_dt))}G=I.GetNext()}}}}SolveStaticPressure(t){if(!this.m_flagsBuffer.data)throw new Error;this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);const e=this.GetCriticalPressure(t),i=this.m_def.staticPressureStrength*e,s=l.t*e,o=this.m_def.staticPressureRelaxation;for(let t=0;t<this.m_def.staticPressureIterations;t++){for(let t=0;t<this.m_count;t++)this.m_accumulationBuffer[t]=0;for(let t=0;t<this.m_contactBuffer.count;t++){const e=this.m_contactBuffer.data[t];if(e.flags&c.c.staticPressureParticle){const t=e.indexA,i=e.indexB,s=e.weight;this.m_accumulationBuffer[t]+=s*this.m_staticPressureBuffer[i],this.m_accumulationBuffer[i]+=s*this.m_staticPressureBuffer[t]}}for(let t=0;t<this.m_count;t++){const e=this.m_weightBuffer[t];if(this.m_flagsBuffer.data[t]&c.c.staticPressureParticle){const n=(this.m_accumulationBuffer[t]+i*(e-l.D))/(e+o);this.m_staticPressureBuffer[t]=Object(a.d)(n,0,s)}else this.m_staticPressureBuffer[t]=0}}}ComputeWeight(){for(let t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(let t=0;t<this.m_bodyContactBuffer.count;t++){const e=this.m_bodyContactBuffer.data[t],i=e.index,s=e.weight;this.m_weightBuffer[i]+=s}for(let t=0;t<this.m_contactBuffer.count;t++){const e=this.m_contactBuffer.data[t],i=e.indexA,s=e.indexB,o=e.weight;this.m_weightBuffer[i]+=o,this.m_weightBuffer[s]+=o}}SolvePressure(t){const e=ParticleSystem.SolvePressure_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.GetCriticalPressure(t),n=this.m_def.pressureStrength*o,r=l.t*o;for(let t=0;t<this.m_count;t++){const e=this.m_weightBuffer[t],i=n*Object(a.h)(0,e-l.D);this.m_accumulationBuffer[t]=Object(a.i)(i,r)}if(this.m_allParticleFlags&ParticleSystem.k_noPressureFlags)for(let t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&ParticleSystem.k_noPressureFlags&&(this.m_accumulationBuffer[t]=0);if(this.m_allParticleFlags&c.c.staticPressureParticle)for(let t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&c.c.staticPressureParticle&&(this.m_accumulationBuffer[t]+=this.m_staticPressureBuffer[t]);const h=t.dt/(this.m_def.density*this.m_particleDiameter),m=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){const o=this.m_bodyContactBuffer.data[t],r=o.index,l=o.body,c=o.weight,_=o.mass,u=o.normal,p=i[r],d=this.m_accumulationBuffer[r]+n*c,f=a.p.MulSV(h*c*_*d,u,e);s[r].SelfMulSub(m,f),l.ApplyLinearImpulse(f,p,!0)}for(let t=0;t<this.m_contactBuffer.count;t++){const i=this.m_contactBuffer.data[t],o=i.indexA,n=i.indexB,r=i.weight,l=i.normal,m=this.m_accumulationBuffer[o]+this.m_accumulationBuffer[n],c=a.p.MulSV(h*r*m,l,e);s[o].SelfSub(c),s[n].SelfAdd(c)}}SolveDamping(t){const e=ParticleSystem.SolveDamping_s_v,i=ParticleSystem.SolveDamping_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const s=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,n=this.m_def.dampingStrength,r=1/this.GetCriticalVelocity(t),l=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){const h=this.m_bodyContactBuffer.data[t],m=h.index,c=h.body,_=h.weight,u=h.mass,p=h.normal,d=s[m],f=a.p.SubVV(c.GetLinearVelocityFromWorldPoint(d,a.p.s_t0),o[m],e),y=a.p.DotVV(f,p);if(y<0){const t=Object(a.h)(n*_,Object(a.i)(-r*y,.5)),e=a.p.MulSV(t*u*y,p,i);o[m].SelfMulAdd(l,e),c.ApplyLinearImpulse(e.SelfNeg(),d,!0)}}for(let t=0;t<this.m_contactBuffer.count;t++){const s=this.m_contactBuffer.data[t],l=s.indexA,h=s.indexB,m=s.weight,c=s.normal,_=a.p.SubVV(o[h],o[l],e),u=a.p.DotVV(_,c);if(u<0){const t=Object(a.h)(n*m,Object(a.i)(-r*u,.5)),e=a.p.MulSV(t*u,c,i);o[l].SelfAdd(e),o[h].SelfSub(e)}}}SolveRigidDamping(){const t=ParticleSystem.SolveRigidDamping_s_t0,e=ParticleSystem.SolveRigidDamping_s_t1,i=ParticleSystem.SolveRigidDamping_s_p,s=ParticleSystem.SolveRigidDamping_s_v,o=[0],n=[0],r=[0],l=[0],h=[0],m=[0];if(!this.m_positionBuffer.data)throw new Error;const c=this.m_positionBuffer.data,_=this.m_def.dampingStrength;for(let i=0;i<this.m_bodyContactBuffer.count;i++){const u=this.m_bodyContactBuffer.data[i],p=u.index,d=this.m_groupBuffer[p];if(d&&this.IsRigidGroup(d)){const i=u.body,f=u.normal,y=u.weight,S=c[p],x=a.p.SubVV(i.GetLinearVelocityFromWorldPoint(S,t),d.GetLinearVelocityFromWorldPoint(S,e),s),C=a.p.DotVV(x,f);if(C<0){this.InitDampingParameterWithRigidGroupOrParticle(o,n,r,!0,d,p,S,f),this.InitDampingParameter(l,h,m,i.GetMass(),i.GetInertia()-i.GetMass()*i.GetLocalCenter().LengthSquared(),i.GetWorldCenter(),S,f);const t=_*Object(a.i)(y,1)*this.ComputeDampingImpulse(o[0],n[0],r[0],l[0],h[0],m[0],C);this.ApplyDamping(o[0],n[0],r[0],!0,d,p,t,f),i.ApplyLinearImpulse(a.p.MulSV(-t,f,a.p.s_t0),S,!0)}}}for(let u=0;u<this.m_contactBuffer.count;u++){const p=this.m_contactBuffer.data[u],d=p.indexA,f=p.indexB,y=p.normal,S=p.weight,x=this.m_groupBuffer[d],C=this.m_groupBuffer[f],B=this.IsRigidGroup(x),w=this.IsRigidGroup(C);if(x!==C&&(B||w)){const u=a.p.MidVV(c[d],c[f],i),p=a.p.SubVV(this.GetLinearVelocity(C,f,u,t),this.GetLinearVelocity(x,d,u,e),s),g=a.p.DotVV(p,y);if(g<0){this.InitDampingParameterWithRigidGroupOrParticle(o,n,r,B,x,d,u,y),this.InitDampingParameterWithRigidGroupOrParticle(l,h,m,w,C,f,u,y);const t=_*S*this.ComputeDampingImpulse(o[0],n[0],r[0],l[0],h[0],m[0],g);this.ApplyDamping(o[0],n[0],r[0],B,x,d,t,y),this.ApplyDamping(l[0],h[0],m[0],w,C,f,-t,y)}}}}SolveExtraDamping(){const t=ParticleSystem.SolveExtraDamping_s_v,e=ParticleSystem.SolveExtraDamping_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_velocityBuffer.data,s=this.m_positionBuffer.data,o=this.GetParticleInvMass();for(let n=0;n<this.m_bodyContactBuffer.count;n++){const r=this.m_bodyContactBuffer.data[n],l=r.index;if(this.m_flagsBuffer.data[l]&ParticleSystem.k_extraDampingFlags){const n=r.body,h=r.mass,m=r.normal,c=s[l],_=a.p.SubVV(n.GetLinearVelocityFromWorldPoint(c,a.p.s_t0),i[l],t),u=a.p.DotVV(_,m);if(u<0){const t=a.p.MulSV(.5*h*u,m,e);i[l].SelfMulAdd(o,t),n.ApplyLinearImpulse(t.SelfNeg(),c,!0)}}}}SolveWall(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const t=this.m_velocityBuffer.data;for(let e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&c.c.wallParticle&&t[e].SetZero()}SolveRigid(t){const e=ParticleSystem.SolveRigid_s_position,i=ParticleSystem.SolveRigid_s_rotation,s=ParticleSystem.SolveRigid_s_transform,o=ParticleSystem.SolveRigid_s_velocityTransform;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const n=this.m_positionBuffer.data,r=this.m_velocityBuffer.data;for(let l=this.m_groupList;l;l=l.GetNext())if(l.m_groupFlags&_.c.rigidParticleGroup){l.UpdateStatistics();const h=i;h.SetAngle(t.dt*l.m_angularVelocity);const m=a.p.AddVV(l.m_center,a.p.SubVV(a.p.MulSV(t.dt,l.m_linearVelocity,a.p.s_t0),a.k.MulRV(h,l.m_center,a.p.s_t1),a.p.s_t0),e),c=s;c.SetPositionRotation(m,h),a.o.MulXX(c,l.m_transform,l.m_transform);const _=o;_.p.x=t.inv_dt*c.p.x,_.p.y=t.inv_dt*c.p.y,_.q.s=t.inv_dt*c.q.s,_.q.c=t.inv_dt*(c.q.c-1);for(let t=l.m_firstIndex;t<l.m_lastIndex;t++)a.o.MulXV(_,n[t],r[t])}}SolveElastic(t){const e=ParticleSystem.SolveElastic_s_pa,i=ParticleSystem.SolveElastic_s_pb,s=ParticleSystem.SolveElastic_s_pc,o=ParticleSystem.SolveElastic_s_r,n=ParticleSystem.SolveElastic_s_t0;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const r=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,h=t.inv_dt*this.m_def.elasticStrength;for(let m=0;m<this.m_triadBuffer.count;m++){const _=this.m_triadBuffer.data[m];if(_.flags&c.c.elasticParticle){const m=_.indexA,c=_.indexB,u=_.indexC,p=_.pa,d=_.pb,f=_.pc,y=e.Copy(r[m]),S=i.Copy(r[c]),x=s.Copy(r[u]),C=l[m],B=l[c],w=l[u];y.SelfMulAdd(t.dt,C),S.SelfMulAdd(t.dt,B),x.SelfMulAdd(t.dt,w);const g=(y.x+S.x+x.x)/3,v=(y.y+S.y+x.y)/3;y.x-=g,y.y-=v,S.x-=g,S.y-=v,x.x-=g,x.y-=v;const A=o;A.s=a.p.CrossVV(p,y)+a.p.CrossVV(d,S)+a.p.CrossVV(f,x),A.c=a.p.DotVV(p,y)+a.p.DotVV(d,S)+a.p.DotVV(f,x);const V=A.s*A.s+A.c*A.c;let b=Object(a.e)(V);isFinite(b)||(b=198177537e11),A.s*=b,A.c*=b;const P=h*_.strength;a.k.MulRV(A,p,n),a.p.SubVV(n,y,n),a.p.MulSV(P,n,n),C.SelfAdd(n),a.k.MulRV(A,d,n),a.p.SubVV(n,S,n),a.p.MulSV(P,n,n),B.SelfAdd(n),a.k.MulRV(A,f,n),a.p.SubVV(n,x,n),a.p.MulSV(P,n,n),w.SelfAdd(n)}}}SolveSpring(t){const e=ParticleSystem.SolveSpring_s_pa,i=ParticleSystem.SolveSpring_s_pb,s=ParticleSystem.SolveSpring_s_d,o=ParticleSystem.SolveSpring_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const n=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,l=t.inv_dt*this.m_def.springStrength;for(let h=0;h<this.m_pairBuffer.count;h++){const m=this.m_pairBuffer.data[h];if(m.flags&c.c.springParticle){const h=m.indexA,c=m.indexB,_=e.Copy(n[h]),u=i.Copy(n[c]),p=r[h],d=r[c];_.SelfMulAdd(t.dt,p),u.SelfMulAdd(t.dt,d);const f=a.p.SubVV(u,_,s),y=m.distance,S=f.Length(),x=l*m.strength,C=a.p.MulSV(x*(y-S)/S,f,o);p.SelfSub(C),d.SelfAdd(C)}}}SolveTensile(t){const e=ParticleSystem.SolveTensile_s_weightedNormal,i=ParticleSystem.SolveTensile_s_s,s=ParticleSystem.SolveTensile_s_f;if(!this.m_velocityBuffer.data)throw new Error;const o=this.m_velocityBuffer.data;for(let t=0;t<this.m_count;t++)this.m_accumulation2Buffer[t]=new a.p,this.m_accumulation2Buffer[t].SetZero();for(let t=0;t<this.m_contactBuffer.count;t++){const i=this.m_contactBuffer.data[t];if(i.flags&c.c.tensileParticle){const t=i.indexA,s=i.indexB,o=i.weight,n=i.normal,r=a.p.MulSV((1-o)*o,n,e);this.m_accumulation2Buffer[t].SelfSub(r),this.m_accumulation2Buffer[s].SelfAdd(r)}}const n=this.GetCriticalVelocity(t),r=this.m_def.surfaceTensionPressureStrength*n,h=this.m_def.surfaceTensionNormalStrength*n,m=l.s*n;for(let t=0;t<this.m_contactBuffer.count;t++){const e=this.m_contactBuffer.data[t];if(e.flags&c.c.tensileParticle){const t=e.indexA,n=e.indexB,l=e.weight,c=e.normal,_=this.m_weightBuffer[t]+this.m_weightBuffer[n],u=a.p.SubVV(this.m_accumulation2Buffer[n],this.m_accumulation2Buffer[t],i),p=Object(a.i)(r*(_-2)+h*a.p.DotVV(u,c),m)*l,d=a.p.MulSV(p,c,s);o[t].SelfSub(d),o[n].SelfAdd(d)}}}SolveViscous(){const t=ParticleSystem.SolveViscous_s_v,e=ParticleSystem.SolveViscous_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.m_def.viscousStrength,n=this.GetParticleInvMass();for(let r=0;r<this.m_bodyContactBuffer.count;r++){const l=this.m_bodyContactBuffer.data[r],h=l.index;if(this.m_flagsBuffer.data[h]&c.c.viscousParticle){const r=l.body,m=l.weight,c=l.mass,_=i[h],u=a.p.SubVV(r.GetLinearVelocityFromWorldPoint(_,a.p.s_t0),s[h],t),p=a.p.MulSV(o*c*m,u,e);s[h].SelfMulAdd(n,p),r.ApplyLinearImpulse(p.SelfNeg(),_,!0)}}for(let i=0;i<this.m_contactBuffer.count;i++){const n=this.m_contactBuffer.data[i];if(n.flags&c.c.viscousParticle){const i=n.indexA,r=n.indexB,l=n.weight,h=a.p.SubVV(s[r],s[i],t),m=a.p.MulSV(o*l,h,e);s[i].SelfAdd(m),s[r].SelfSub(m)}}}SolveRepulsive(t){const e=ParticleSystem.SolveRepulsive_s_f;if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_velocityBuffer.data,s=this.m_def.repulsiveStrength*this.GetCriticalVelocity(t);for(let t=0;t<this.m_contactBuffer.count;t++){const o=this.m_contactBuffer.data[t];if(o.flags&c.c.repulsiveParticle){const t=o.indexA,n=o.indexB;if(this.m_groupBuffer[t]!==this.m_groupBuffer[n]){const r=o.weight,l=o.normal,h=a.p.MulSV(s*r,l,e);i[t].SelfSub(h),i[n].SelfAdd(h)}}}}SolvePowder(t){const e=ParticleSystem.SolvePowder_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.m_def.powderStrength*this.GetCriticalVelocity(t),n=1-l.E,r=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){const l=this.m_bodyContactBuffer.data[t],h=l.index;if(this.m_flagsBuffer.data[h]&c.c.powderParticle){const t=l.weight;if(t>n){const m=l.body,c=l.mass,_=i[h],u=l.normal,p=a.p.MulSV(o*c*(t-n),u,e);s[h].SelfMulSub(r,p),m.ApplyLinearImpulse(p,_,!0)}}}for(let t=0;t<this.m_contactBuffer.count;t++){const i=this.m_contactBuffer.data[t];if(i.flags&c.c.powderParticle){const t=i.weight;if(t>n){const r=i.indexA,l=i.indexB,h=i.normal,m=a.p.MulSV(o*(t-n),h,e);s[r].SelfSub(m),s[l].SelfAdd(m)}}}}SolveSolid(t){const e=ParticleSystem.SolveSolid_s_f;if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);const s=t.inv_dt*this.m_def.ejectionStrength;for(let t=0;t<this.m_contactBuffer.count;t++){const o=this.m_contactBuffer.data[t],n=o.indexA,r=o.indexB;if(this.m_groupBuffer[n]!==this.m_groupBuffer[r]){const t=o.weight,l=o.normal,h=this.m_depthBuffer[n]+this.m_depthBuffer[r],m=a.p.MulSV(s*h*t,l,e);i[n].SelfSub(m),i[r].SelfAdd(m)}}}SolveForce(t){if(!this.m_velocityBuffer.data)throw new Error;const e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass();for(let t=0;t<this.m_count;t++)e[t].SelfMulAdd(i,this.m_forceBuffer[t]);this.m_hasForce=!1}SolveColorMixing(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_colorBuffer.data)throw new Error;const t=.5*this.m_def.colorMixingStrength;if(t)for(let e=0;e<this.m_contactBuffer.count;e++){const i=this.m_contactBuffer.data[e],s=i.indexA,o=i.indexB;if(this.m_flagsBuffer.data[s]&this.m_flagsBuffer.data[o]&c.c.colorMixingParticle){const e=this.m_colorBuffer.data[s],i=this.m_colorBuffer.data[o];r.a.MixColors(e,i,t)}}}SolveZombie(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;let t=0;const e=[];for(let t=0;t<this.m_count;t++)e[t]=l.l;let i=0;for(let s=0;s<this.m_count;s++){const o=this.m_flagsBuffer.data[s];if(o&c.c.zombieParticle){const t=this.m_world.m_destructionListener;if(o&c.c.destructionListenerParticle&&t&&t.SayGoodbyeParticle(this,s),this.m_handleIndexBuffer.data){const t=this.m_handleIndexBuffer.data[s];t&&(t.SetIndex(l.l),this.m_handleIndexBuffer.data[s]=null)}e[s]=l.l}else{if(e[s]=t,s!==t){if(this.m_handleIndexBuffer.data){const e=this.m_handleIndexBuffer.data[s];e&&e.SetIndex(t),this.m_handleIndexBuffer.data[t]=e}this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[s],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[s]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[s]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[s]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[s]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[s]),this.m_groupBuffer[t]=this.m_groupBuffer[s],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[s]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[s]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[s]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[s]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[s]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[s])}t++,i|=o}}const s=t=>t.index<0,o=t=>t.indexA<0||t.indexB<0,n=t=>t.index<0,r=t=>t.indexA<0||t.indexB<0,h=t=>t.indexA<0||t.indexB<0||t.indexC<0;for(let t=0;t<this.m_proxyBuffer.count;t++){const i=this.m_proxyBuffer.data[t];i.index=e[i.index]}this.m_proxyBuffer.RemoveIf(s);for(let t=0;t<this.m_contactBuffer.count;t++){const i=this.m_contactBuffer.data[t];i.indexA=e[i.indexA],i.indexB=e[i.indexB]}this.m_contactBuffer.RemoveIf(o);for(let t=0;t<this.m_bodyContactBuffer.count;t++){const i=this.m_bodyContactBuffer.data[t];i.index=e[i.index]}this.m_bodyContactBuffer.RemoveIf(n);for(let t=0;t<this.m_pairBuffer.count;t++){const i=this.m_pairBuffer.data[t];i.indexA=e[i.indexA],i.indexB=e[i.indexB]}this.m_pairBuffer.RemoveIf(r);for(let t=0;t<this.m_triadBuffer.count;t++){const i=this.m_triadBuffer.data[t];i.indexA=e[i.indexA],i.indexB=e[i.indexB],i.indexC=e[i.indexC]}if(this.m_triadBuffer.RemoveIf(h),this.m_indexByExpirationTimeBuffer.data){let t=0;for(let i=0;i<this.m_count;i++){const s=e[this.m_indexByExpirationTimeBuffer.data[i]];s!==l.l&&(this.m_indexByExpirationTimeBuffer.data[t++]=s)}}for(let i=this.m_groupList;i;i=i.GetNext()){let s=t,o=0,n=!1;for(let t=i.m_firstIndex;t<i.m_lastIndex;t++){const i=e[t];i>=0?(s=Object(a.i)(s,i),o=Object(a.h)(o,i+1)):n=!0}s<o?(i.m_firstIndex=s,i.m_lastIndex=o,n&&i.m_groupFlags&_.c.solidParticleGroup&&this.SetGroupFlags(i,i.m_groupFlags|_.c.particleGroupNeedsUpdateDepth)):(i.m_firstIndex=0,i.m_lastIndex=0,i.m_groupFlags&_.c.particleGroupCanBeEmpty||this.SetGroupFlags(i,i.m_groupFlags|_.c.particleGroupWillBeDestroyed))}this.m_count=t,this.m_allParticleFlags=i,this.m_needsUpdateAllParticleFlags=!1;for(let t=this.m_groupList;t;){const e=t.GetNext();t.m_groupFlags&_.c.particleGroupWillBeDestroyed&&this.DestroyParticleGroup(t),t=e}}SolveLifetimes(t){if(!this.m_expirationTimeBuffer.data)throw new Error;if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);const e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,s=this.m_indexByExpirationTimeBuffer.data,o=this.GetParticleCount();if(this.m_expirationTimeBufferRequiresSorting){std_sort(s,0,o,(t,e)=>{const s=i[t],o=i[e],n=s<=0;return n===o<=0?s>o:n}),this.m_expirationTimeBufferRequiresSorting=!1}for(let t=o-1;t>=0;--t){const o=s[t],n=i[o];if(e<n||n<=0)break;this.DestroyParticle(o)}}RotateBuffer(t,e,i){if(t!==e&&e!==i){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;if(std_rotate(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&std_rotate(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&std_rotate(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&std_rotate(this.m_consecutiveContactStepsBuffer.data,t,e,i),std_rotate(this.m_positionBuffer.data,t,e,i),std_rotate(this.m_velocityBuffer.data,t,e,i),std_rotate(this.m_groupBuffer,t,e,i),this.m_hasForce&&std_rotate(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&std_rotate(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&std_rotate(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&std_rotate(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&std_rotate(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){std_rotate(this.m_handleIndexBuffer.data,t,e,i);for(let e=t;e<i;++e){const t=this.m_handleIndexBuffer.data[e];t&&t.SetIndex(newIndices(t.GetIndex()))}}if(this.m_expirationTimeBuffer.data){std_rotate(this.m_expirationTimeBuffer.data,t,e,i);const s=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;const o=this.m_indexByExpirationTimeBuffer.data;for(let t=0;t<s;++t)o[t]=newIndices(o[t])}for(let t=0;t<this.m_proxyBuffer.count;t++){const e=this.m_proxyBuffer.data[t];e.index=newIndices(e.index)}for(let t=0;t<this.m_contactBuffer.count;t++){const e=this.m_contactBuffer.data[t];e.indexA=newIndices(e.indexA),e.indexB=newIndices(e.indexB)}for(let t=0;t<this.m_bodyContactBuffer.count;t++){const e=this.m_bodyContactBuffer.data[t];e.index=newIndices(e.index)}for(let t=0;t<this.m_pairBuffer.count;t++){const e=this.m_pairBuffer.data[t];e.indexA=newIndices(e.indexA),e.indexB=newIndices(e.indexB)}for(let t=0;t<this.m_triadBuffer.count;t++){const e=this.m_triadBuffer.data[t];e.indexA=newIndices(e.indexA),e.indexB=newIndices(e.indexB),e.indexC=newIndices(e.indexC)}for(let t=this.m_groupList;t;t=t.GetNext())t.m_firstIndex=newIndices(t.m_firstIndex),t.m_lastIndex=newIndices(t.m_lastIndex-1)+1}function newIndices(s){return s<t?s:s<e?s+i-e:s<i?s+t-e:s}}GetCriticalVelocity(t){return this.m_particleDiameter*t.inv_dt}GetCriticalVelocitySquared(t){const e=this.GetCriticalVelocity(t);return e*e}GetCriticalPressure(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}GetParticleStride(){return l.E*this.m_particleDiameter}GetParticleMass(){const t=this.GetParticleStride();return this.m_def.density*t*t}GetParticleInvMass(){const t=this.m_inverseDiameter*(1/l.E);return this.m_inverseDensity*t*t}GetFixtureContactFilter(){return this.m_allParticleFlags&c.c.fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}GetParticleContactFilter(){return this.m_allParticleFlags&c.c.particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}GetFixtureContactListener(){return this.m_allParticleFlags&c.c.fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}GetParticleContactListener(){return this.m_allParticleFlags&c.c.particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}SetUserOverridableBuffer(t,e,i){t.data=e,t.userSuppliedCapacity=i}SetGroupFlags(t,e){const i=t.m_groupFlags;(i^e)&_.c.solidParticleGroup&&(e|=_.c.particleGroupNeedsUpdateDepth),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(e&_.c.solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e}RemoveSpuriousBodyContacts(){std_sort(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,ParticleSystem.BodyContactCompare);const t=ParticleSystem.RemoveSpuriousBodyContacts_s_n,e=ParticleSystem.RemoveSpuriousBodyContacts_s_pos,i=ParticleSystem.RemoveSpuriousBodyContacts_s_normal;let s=-1,o=0;this.m_bodyContactBuffer.count=std_remove_if(this.m_bodyContactBuffer.data,n=>{if(n.index!==s&&(o=0,s=n.index),o++>3)return!0;const r=t.Copy(n.normal);if(r.SelfMul(this.m_particleDiameter*(1-n.weight)),!this.m_positionBuffer.data)throw new Error;const h=a.p.AddVV(this.m_positionBuffer.data[n.index],r,e);if(!n.fixture.TestPoint(h)){const t=n.fixture.GetShape().GetChildCount();for(let e=0;e<t;e++){const t=i;if(n.fixture.ComputeDistance(h,t,e)<l.n)return!1}return!0}return!1},this.m_bodyContactBuffer.count)}DetectStuckParticle(t){if(!(this.m_stuckThreshold<=0)){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp}}ValidateParticleIndex(t){return t>=0&&t<this.GetParticleCount()&&t!==l.l}GetQuantizedTimeElapsed(){return Math.floor(this.m_timeElapsed/4294967296)}LifetimeToExpirationTime(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}ForceCanBeApplied(t){return!(t&c.c.wallParticle)}PrepareForceBuffer(){if(!this.m_hasForce){for(let t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}IsRigidGroup(t){return null!==t&&0!=(t.m_groupFlags&_.c.rigidParticleGroup)}GetLinearVelocity(t,e,i,s){if(t&&this.IsRigidGroup(t))return t.GetLinearVelocityFromWorldPoint(i,s);if(!this.m_velocityBuffer.data)throw new Error;return s.Copy(this.m_velocityBuffer.data[e])}InitDampingParameter(t,e,i,s,o,n,r,l){t[0]=s>0?1/s:0,e[0]=o>0?1/o:0,i[0]=a.p.CrossVV(a.p.SubVV(r,n,a.p.s_t0),l)}InitDampingParameterWithRigidGroupOrParticle(t,e,i,s,o,n,r,a){if(o&&s)this.InitDampingParameter(t,e,i,o.GetMass(),o.GetInertia(),o.GetCenter(),r,a);else{if(!this.m_flagsBuffer.data)throw new Error;const s=this.m_flagsBuffer.data[n];this.InitDampingParameter(t,e,i,s&c.c.wallParticle?0:this.GetParticleMass(),0,r,r,a)}}ComputeDampingImpulse(t,e,i,s,o,n,r){const a=t+e*i*i+s+o*n*n;return a>0?r/a:0}ApplyDamping(t,e,i,s,o,n,r,a){if(o&&s)o.m_linearVelocity.SelfMulAdd(r*t,a),o.m_angularVelocity+=r*i*e;else{if(!this.m_velocityBuffer.data)throw new Error;this.m_velocityBuffer.data[n].SelfMulAdd(r*t,a)}}}ParticleSystem.xTruncBits=12,ParticleSystem.yTruncBits=12,ParticleSystem.tagBits=32,ParticleSystem.yOffset=1<<ParticleSystem.yTruncBits-1,ParticleSystem.yShift=ParticleSystem.tagBits-ParticleSystem.yTruncBits,ParticleSystem.xShift=ParticleSystem.tagBits-ParticleSystem.yTruncBits-ParticleSystem.xTruncBits,ParticleSystem.xScale=1<<ParticleSystem.xShift,ParticleSystem.xOffset=ParticleSystem.xScale*(1<<ParticleSystem.xTruncBits-1),ParticleSystem.yMask=(1<<ParticleSystem.yTruncBits)-1<<ParticleSystem.yShift,ParticleSystem.xMask=~ParticleSystem.yMask,ParticleSystem.DestroyParticlesInShape_s_aabb=new s.a,ParticleSystem.CreateParticleGroup_s_transform=new a.o,ParticleSystem.ComputeCollisionEnergy_s_v=new a.p,ParticleSystem.QueryShapeAABB_s_aabb=new s.a,ParticleSystem.QueryPointAABB_s_aabb=new s.a,ParticleSystem.RayCast_s_aabb=new s.a,ParticleSystem.RayCast_s_p=new a.p,ParticleSystem.RayCast_s_v=new a.p,ParticleSystem.RayCast_s_n=new a.p,ParticleSystem.RayCast_s_point=new a.p,ParticleSystem.k_pairFlags=c.c.springParticle,ParticleSystem.k_triadFlags=c.c.elasticParticle,ParticleSystem.k_noPressureFlags=c.c.powderParticle|c.c.tensileParticle,ParticleSystem.k_extraDampingFlags=c.c.staticPressureParticle,ParticleSystem.k_barrierWallFlags=c.c.barrierParticle|c.c.wallParticle,ParticleSystem.CreateParticlesStrokeShapeForGroup_s_edge=new o.a,ParticleSystem.CreateParticlesStrokeShapeForGroup_s_d=new a.p,ParticleSystem.CreateParticlesStrokeShapeForGroup_s_p=new a.p,ParticleSystem.CreateParticlesFillShapeForGroup_s_aabb=new s.a,ParticleSystem.CreateParticlesFillShapeForGroup_s_p=new a.p,ParticleSystem.AddContact_s_d=new a.p,ParticleSystem.UpdateBodyContacts_s_aabb=new s.a,ParticleSystem.Solve_s_subStep=new h.d,ParticleSystem.SolveCollision_s_aabb=new s.a,ParticleSystem.SolveGravity_s_gravity=new a.p,ParticleSystem.SolveBarrier_s_aabb=new s.a,ParticleSystem.SolveBarrier_s_va=new a.p,ParticleSystem.SolveBarrier_s_vb=new a.p,ParticleSystem.SolveBarrier_s_pba=new a.p,ParticleSystem.SolveBarrier_s_vba=new a.p,ParticleSystem.SolveBarrier_s_vc=new a.p,ParticleSystem.SolveBarrier_s_pca=new a.p,ParticleSystem.SolveBarrier_s_vca=new a.p,ParticleSystem.SolveBarrier_s_qba=new a.p,ParticleSystem.SolveBarrier_s_qca=new a.p,ParticleSystem.SolveBarrier_s_dv=new a.p,ParticleSystem.SolveBarrier_s_f=new a.p,ParticleSystem.SolvePressure_s_f=new a.p,ParticleSystem.SolveDamping_s_v=new a.p,ParticleSystem.SolveDamping_s_f=new a.p,ParticleSystem.SolveRigidDamping_s_t0=new a.p,ParticleSystem.SolveRigidDamping_s_t1=new a.p,ParticleSystem.SolveRigidDamping_s_p=new a.p,ParticleSystem.SolveRigidDamping_s_v=new a.p,ParticleSystem.SolveExtraDamping_s_v=new a.p,ParticleSystem.SolveExtraDamping_s_f=new a.p,ParticleSystem.SolveRigid_s_position=new a.p,ParticleSystem.SolveRigid_s_rotation=new a.k,ParticleSystem.SolveRigid_s_transform=new a.o,ParticleSystem.SolveRigid_s_velocityTransform=new a.o,ParticleSystem.SolveElastic_s_pa=new a.p,ParticleSystem.SolveElastic_s_pb=new a.p,ParticleSystem.SolveElastic_s_pc=new a.p,ParticleSystem.SolveElastic_s_r=new a.k,ParticleSystem.SolveElastic_s_t0=new a.p,ParticleSystem.SolveSpring_s_pa=new a.p,ParticleSystem.SolveSpring_s_pb=new a.p,ParticleSystem.SolveSpring_s_d=new a.p,ParticleSystem.SolveSpring_s_f=new a.p,ParticleSystem.SolveTensile_s_weightedNormal=new a.p,ParticleSystem.SolveTensile_s_s=new a.p,ParticleSystem.SolveTensile_s_f=new a.p,ParticleSystem.SolveViscous_s_v=new a.p,ParticleSystem.SolveViscous_s_f=new a.p,ParticleSystem.SolveRepulsive_s_f=new a.p,ParticleSystem.SolvePowder_s_f=new a.p,ParticleSystem.SolveSolid_s_f=new a.p,ParticleSystem.UpdatePairsAndTriads_s_dab=new a.p,ParticleSystem.UpdatePairsAndTriads_s_dbc=new a.p,ParticleSystem.UpdatePairsAndTriads_s_dca=new a.p,ParticleSystem.RemoveSpuriousBodyContacts_s_n=new a.p,ParticleSystem.RemoveSpuriousBodyContacts_s_pos=new a.p,ParticleSystem.RemoveSpuriousBodyContacts_s_normal=new a.p;class ParticleSystemUserOverridableBuffer{constructor(){this.data=null,this.userSuppliedCapacity=0}}class ParticleSystemProxy{constructor(){this.index=l.l,this.tag=0}static CompareProxyProxy(t,e){return t.tag<e.tag}static CompareTagProxy(t,e){return t<e.tag}static CompareProxyTag(t,e){return t.tag<e}}class ParticleSystemInsideBoundsEnumerator{constructor(t,e,i,s,o){this.m_system=t,this.m_xLower=(e&ParticleSystem.xMask)>>>0,this.m_xUpper=(i&ParticleSystem.xMask)>>>0,this.m_yLower=(e&ParticleSystem.yMask)>>>0,this.m_yUpper=(i&ParticleSystem.yMask)>>>0,this.m_first=s,this.m_last=o}GetNext(){for(;this.m_first<this.m_last;){const t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&ParticleSystem.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return l.l}}class ParticleSystemParticleListNode{constructor(){this.next=null,this.count=0,this.index=0}}class ParticleSystemFixedSetAllocator{Allocate(t,e){return e}Clear(){}GetCount(){return 0}Invalidate(t){}GetValidBuffer(){return[]}GetBuffer(){return[]}SetCount(t){}}class ParticleSystemFixtureParticleSet extends ParticleSystemFixedSetAllocator{Initialize(t,e){}Find(t){return l.l}}class ParticlePairSet extends ParticleSystemFixedSetAllocator{Initialize(t,e){}Find(t){return l.l}}class ParticleSystemConnectionFilter{IsNecessary(t){return!0}ShouldCreatePair(t,e){return!0}ShouldCreateTriad(t,e,i){return!0}}class ParticleSystemDestroyParticlesInShapeCallback extends m.d{constructor(t,e,i,s){super(),this.m_callDestructionListener=!1,this.m_destroyed=0,this.m_system=t,this.m_shape=e,this.m_xf=i,this.m_callDestructionListener=s,this.m_destroyed=0}ReportFixture(t){return!1}ReportParticle(t,e){if(t!==this.m_system)return!1;if(!this.m_system.m_positionBuffer.data)throw new Error;return this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0}Destroyed(){return this.m_destroyed}}class ParticleSystemJoinParticleGroupsFilter extends ParticleSystemConnectionFilter{constructor(t){super(),this.m_threshold=0,this.m_threshold=t}ShouldCreatePair(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t}ShouldCreateTriad(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)}}class ParticleSystemCompositeShape extends n.b{constructor(t,e=t.length){super(n.c.e_unknown,0),this.m_shapeCount=0,this.m_shapes=t,this.m_shapeCount=e}Clone(){throw new Error}GetChildCount(){return 1}TestPoint(t,e){for(let i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1}ComputeDistance(t,e,i,s){return 0}RayCast(t,e,i,s){return!1}ComputeAABB(t,e,i){const o=new s.a;t.lowerBound.x=+l.p,t.lowerBound.y=+l.p,t.upperBound.x=-l.p,t.upperBound.y=-l.p;for(let i=0;i<this.m_shapeCount;i++){const s=this.m_shapes[i].GetChildCount();for(let n=0;n<s;n++){const s=o;this.m_shapes[i].ComputeAABB(s,e,n),t.Combine1(s)}}}ComputeMass(t,e){}SetupDistanceProxy(t,e){}ComputeSubmergedArea(t,e,i,s){return 0}Dump(t){}}class ParticleSystemReactiveFilter extends ParticleSystemConnectionFilter{constructor(t){super(),this.m_flagsBuffer=t}IsNecessary(t){if(!this.m_flagsBuffer.data)throw new Error;return 0!=(this.m_flagsBuffer.data[t]&c.c.reactiveParticle)}}class ParticleSystemUpdateBodyContactsCallback extends FixtureParticleQueryCallback{constructor(t,e){super(t),this.m_contactFilter=e}ShouldCollideFixtureParticle(t,e,i){if(this.m_contactFilter){if(this.m_system.GetFlagsBuffer()[i]&c.c.fixtureContactFilterParticle)return this.m_contactFilter.ShouldCollideFixtureParticle(t,this.m_system,i)}return!0}ReportFixtureAndParticle(t,e,i){const s=ParticleSystemUpdateBodyContactsCallback.ReportFixtureAndParticle_s_n,o=ParticleSystemUpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp;if(!this.m_system.m_flagsBuffer.data)throw new Error;if(!this.m_system.m_positionBuffer.data)throw new Error;const n=this.m_system.m_positionBuffer.data[i],r=s,l=t.ComputeDistance(n,r,e);if(l<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(t,this.m_system,i)){const e=t.GetBody(),s=e.GetWorldCenter(),h=e.GetMass(),m=e.GetInertia()-h*e.GetLocalCenter().LengthSquared(),_=h>0?1/h:0,u=m>0?1/m:0,p=this.m_system.m_flagsBuffer.data[i]&c.c.wallParticle?0:this.m_system.GetParticleInvMass(),d=a.p.SubVV(n,s,o),f=a.p.CrossVV(d,r),y=p+_+u*f*f,S=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];S.index=i,S.body=e,S.fixture=t,S.weight=1-l*this.m_system.m_inverseDiameter,S.normal.Copy(r.SelfNeg()),S.mass=y>0?1/y:0,this.m_system.DetectStuckParticle(i)}}}ParticleSystemUpdateBodyContactsCallback.ReportFixtureAndParticle_s_n=new a.p,ParticleSystemUpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp=new a.p;class ParticleSystemSolveCollisionCallback extends FixtureParticleQueryCallback{constructor(t,e){super(t),this.m_step=e}ReportFixtureAndParticle(t,e,i){const s=ParticleSystemSolveCollisionCallback.ReportFixtureAndParticle_s_p1,o=ParticleSystemSolveCollisionCallback.ReportFixtureAndParticle_s_output,r=ParticleSystemSolveCollisionCallback.ReportFixtureAndParticle_s_input,h=ParticleSystemSolveCollisionCallback.ReportFixtureAndParticle_s_p,m=ParticleSystemSolveCollisionCallback.ReportFixtureAndParticle_s_v,c=ParticleSystemSolveCollisionCallback.ReportFixtureAndParticle_s_f,_=t.GetBody();if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;const u=this.m_system.m_positionBuffer.data[i],p=this.m_system.m_velocityBuffer.data[i],d=o,f=r;if(0===this.m_system.m_iterationIndex){const e=a.o.MulTXV(_.m_xf0,u,s);t.GetShape().GetType()===n.c.e_circleShape&&(e.SelfSub(_.GetLocalCenter()),a.k.MulRV(_.m_xf0.q,e,e),a.k.MulTRV(_.m_xf.q,e,e),e.SelfAdd(_.GetLocalCenter())),a.o.MulXV(_.m_xf,e,f.p1)}else f.p1.Copy(u);if(a.p.AddVMulSV(u,this.m_step.dt,p,f.p2),f.maxFraction=1,t.RayCast(d,f,e)){const t=d.normal,e=h;e.x=(1-d.fraction)*f.p1.x+d.fraction*f.p2.x+l.n*t.x,e.y=(1-d.fraction)*f.p1.y+d.fraction*f.p2.y+l.n*t.y;const s=m;s.x=this.m_step.inv_dt*(e.x-u.x),s.y=this.m_step.inv_dt*(e.y-u.y),this.m_system.m_velocityBuffer.data[i].Copy(s);const o=c;o.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(p.x-s.x),o.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(p.y-s.y),this.m_system.ParticleApplyForce(i,o)}}ReportParticle(t,e){return!1}}ParticleSystemSolveCollisionCallback.ReportFixtureAndParticle_s_p1=new a.p,ParticleSystemSolveCollisionCallback.ReportFixtureAndParticle_s_output=new s.i,ParticleSystemSolveCollisionCallback.ReportFixtureAndParticle_s_input=new s.h,ParticleSystemSolveCollisionCallback.ReportFixtureAndParticle_s_p=new a.p,ParticleSystemSolveCollisionCallback.ReportFixtureAndParticle_s_v=new a.p,ParticleSystemSolveCollisionCallback.ReportFixtureAndParticle_s_f=new a.p},function(t,e,i){"use strict";i.d(e,"a",function(){return ContactManager});var s=i(59),o=i(4),n=i(12),r=i(64),a=i(19);class ContactManager{constructor(){this.m_broadPhase=new s.a,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=a.a.defaultFilter,this.m_contactListener=a.c.defaultListener,this.m_allocator=null,this.m_contactFactory=new r.a(this.m_allocator)}AddPair(t,e){let i=t.fixture,s=e.fixture,o=t.childIndex,n=e.childIndex,r=i.GetBody(),a=s.GetBody();if(r===a)return;let l=a.GetContactList();for(;l;){if(l.other===r){const t=l.contact.GetFixtureA(),e=l.contact.GetFixtureB(),r=l.contact.GetChildIndexA(),a=l.contact.GetChildIndexB();if(t===i&&e===s&&r===o&&a===n)return;if(t===s&&e===i&&r===n&&a===o)return}l=l.next}if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,s))return;const h=this.m_contactFactory.Create(i,o,s,n);null!==h&&(i=h.GetFixtureA(),s=h.GetFixtureB(),o=h.GetChildIndexA(),n=h.GetChildIndexB(),r=i.m_body,a=s.m_body,h.m_prev=null,h.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=h),this.m_contactList=h,h.m_nodeA.contact=h,h.m_nodeA.other=a,h.m_nodeA.prev=null,h.m_nodeA.next=r.m_contactList,null!==r.m_contactList&&(r.m_contactList.prev=h.m_nodeA),r.m_contactList=h.m_nodeA,h.m_nodeB.contact=h,h.m_nodeB.other=r,h.m_nodeB.prev=null,h.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=h.m_nodeB),a.m_contactList=h.m_nodeB,i.IsSensor()||s.IsSensor()||(r.SetAwake(!0),a.SetAwake(!0)),++this.m_contactCount)}FindNewContacts(){this.m_broadPhase.UpdatePairs((t,e)=>{this.AddPair(t,e)})}Destroy(t){const e=t.GetFixtureA(),i=t.GetFixtureB(),s=e.GetBody(),o=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===s.m_contactList&&(s.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===o.m_contactList&&(o.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount}Collide(){let t=this.m_contactList;for(;t;){const e=t.GetFixtureA(),i=t.GetFixtureB(),s=t.GetChildIndexA(),r=t.GetChildIndexB(),a=e.GetBody(),l=i.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){const e=t;t=e.m_next,this.Destroy(e);continue}t.m_filterFlag=!1}const h=a.IsAwake()&&a.m_type!==n.c.staticBody,m=l.IsAwake()&&l.m_type!==n.c.staticBody;if(!h&&!m){t=t.m_next;continue}const c=e.m_proxies[s].treeNode,_=i.m_proxies[r].treeNode;if(Object(o.j)(c.aabb,_.aabb))t.Update(this.m_contactListener),t=t.m_next;else{const e=t;t=e.m_next,this.Destroy(e)}}}}},function(t,e,i){"use strict";i.d(e,"a",function(){return ContactFactory});var s=i(6),o=i(1),n=i(46),r=i(47),a=i(48),l=i(49),h=i(50),m=i(51),c=i(52);class ContactRegister{constructor(){this.createFcn=null,this.destroyFcn=null,this.primary=!1}}class ContactFactory{constructor(t){this.m_allocator=null,this.m_allocator=t,this.InitializeRegisters()}Create(t,e,i,s){const o=t.GetType(),n=i.GetType(),r=this.m_registers[o][n];if(r.createFcn){const o=r.createFcn(this.m_allocator);return r.primary?o.Reset(t,e,i,s):o.Reset(i,s,t,e),o}return null}Destroy(t){const e=t.m_fixtureA,i=t.m_fixtureB;t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0));const s=e.GetType(),o=i.GetType(),n=this.m_registers[s][o];n.destroyFcn&&n.destroyFcn(t,this.m_allocator)}AddType(t,e,i,s){const n=Object(o.a)(256,e=>t(this.m_allocator));function poolCreateFcn(e){return n.pop()||t(e)}function poolDestroyFcn(t,e){n.push(t)}this.m_registers[i][s].createFcn=poolCreateFcn,this.m_registers[i][s].destroyFcn=poolDestroyFcn,this.m_registers[i][s].primary=!0,i!==s&&(this.m_registers[s][i].createFcn=poolCreateFcn,this.m_registers[s][i].destroyFcn=poolDestroyFcn,this.m_registers[s][i].primary=!1)}InitializeRegisters(){this.m_registers=[];for(let t=0;t<s.c.e_shapeTypeCount;t++){this.m_registers[t]=[];for(let e=0;e<s.c.e_shapeTypeCount;e++)this.m_registers[t][e]=new ContactRegister}this.AddType(a.a.Create,a.a.Destroy,s.c.e_circleShape,s.c.e_circleShape),this.AddType(m.a.Create,m.a.Destroy,s.c.e_polygonShape,s.c.e_circleShape),this.AddType(c.a.Create,c.a.Destroy,s.c.e_polygonShape,s.c.e_polygonShape),this.AddType(l.a.Create,l.a.Destroy,s.c.e_edgeShape,s.c.e_circleShape),this.AddType(h.a.Create,h.a.Destroy,s.c.e_edgeShape,s.c.e_polygonShape),this.AddType(n.a.Create,n.a.Destroy,s.c.e_chainShape,s.c.e_circleShape),this.AddType(r.a.Create,r.a.Destroy,s.c.e_chainShape,s.c.e_polygonShape)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return Island});var s=i(0),o=i(1),n=i(27),r=i(12),a=i(53),l=i(15),h=i(19);class Island{constructor(){this.m_allocator=null,this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=l.a.MakeArray(1024),this.m_velocities=l.e.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}Initialize(t,e,i,o,n){if(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=o,this.m_listener=n,this.m_positions.length<t){const e=Object(s.h)(2*this.m_positions.length,t);for(;this.m_positions.length<e;)this.m_positions[this.m_positions.length]=new l.a}if(this.m_velocities.length<t){const e=Object(s.h)(2*this.m_velocities.length,t);for(;this.m_velocities.length<e;)this.m_velocities[this.m_velocities.length]=new l.e}}Clear(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}AddBody(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}AddContact(t){this.m_contacts[this.m_contactCount++]=t}AddJoint(t){this.m_joints[this.m_jointCount++]=t}Solve(t,e,i,n){const a=Island.s_timer.Reset(),l=e.dt;for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];this.m_positions[t].c.Copy(e.m_sweep.c);const s=e.m_sweep.a,o=this.m_velocities[t].v.Copy(e.m_linearVelocity);let n=e.m_angularVelocity;e.m_sweep.c0.Copy(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_type===r.c.dynamicBody&&(o.x+=l*(e.m_gravityScale*i.x+e.m_invMass*e.m_force.x),o.y+=l*(e.m_gravityScale*i.y+e.m_invMass*e.m_force.y),n+=l*e.m_invI*e.m_torque,o.SelfMul(1/(1+l*e.m_linearDamping)),n*=1/(1+l*e.m_angularDamping)),this.m_positions[t].a=s,this.m_velocities[t].w=n}a.Reset();const h=Island.s_solverData;h.step.Copy(e),h.positions=this.m_positions,h.velocities=this.m_velocities;const m=Island.s_contactSolverDef;m.step.Copy(e),m.contacts=this.m_contacts,m.count=this.m_contactCount,m.positions=this.m_positions,m.velocities=this.m_velocities,m.allocator=this.m_allocator;const c=Island.s_contactSolver.Initialize(m);c.InitializeVelocityConstraints(),e.warmStarting&&c.WarmStart();for(let t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(h);t.solveInit=a.GetMilliseconds(),a.Reset();for(let t=0;t<e.velocityIterations;++t){for(let t=0;t<this.m_jointCount;++t)this.m_joints[t].SolveVelocityConstraints(h);c.SolveVelocityConstraints()}c.StoreImpulses(),t.solveVelocity=a.GetMilliseconds();for(let t=0;t<this.m_bodyCount;++t){const e=this.m_positions[t].c;let i=this.m_positions[t].a;const n=this.m_velocities[t].v;let r=this.m_velocities[t].w;const a=s.p.MulSV(l,n,Island.s_translation);if(s.p.DotVV(a,a)>o.A){const t=o.z/a.Length();n.SelfMul(t)}const h=l*r;if(h*h>o.w){r*=o.v/Object(s.a)(h)}e.x+=l*n.x,e.y+=l*n.y,i+=l*r,this.m_positions[t].a=i,this.m_velocities[t].w=r}a.Reset();let _=!1;for(let t=0;t<e.positionIterations;++t){const t=c.SolvePositionConstraints();let e=!0;for(let t=0;t<this.m_jointCount;++t){const i=this.m_joints[t].SolvePositionConstraints(h);e=e&&i}if(t&&e){_=!0;break}}for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];e.m_sweep.c.Copy(this.m_positions[t].c),e.m_sweep.a=this.m_positions[t].a,e.m_linearVelocity.Copy(this.m_velocities[t].v),e.m_angularVelocity=this.m_velocities[t].w,e.SynchronizeTransform()}if(t.solvePosition=a.GetMilliseconds(),this.Report(c.m_velocityConstraints),n){let t=o.p;const e=o.m*o.m,i=o.f*o.f;for(let o=0;o<this.m_bodyCount;++o){const n=this.m_bodies[o];n.GetType()!==r.c.staticBody&&(!n.m_autoSleepFlag||n.m_angularVelocity*n.m_angularVelocity>i||s.p.DotVV(n.m_linearVelocity,n.m_linearVelocity)>e?(n.m_sleepTime=0,t=0):(n.m_sleepTime+=l,t=Object(s.i)(t,n.m_sleepTime)))}if(t>=o.H&&_)for(let t=0;t<this.m_bodyCount;++t){this.m_bodies[t].SetAwake(!1)}}}SolveTOI(t,e,i){for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];this.m_positions[t].c.Copy(e.m_sweep.c),this.m_positions[t].a=e.m_sweep.a,this.m_velocities[t].v.Copy(e.m_linearVelocity),this.m_velocities[t].w=e.m_angularVelocity}const n=Island.s_contactSolverDef;n.contacts=this.m_contacts,n.count=this.m_contactCount,n.allocator=this.m_allocator,n.step.Copy(t),n.positions=this.m_positions,n.velocities=this.m_velocities;const r=Island.s_contactSolver.Initialize(n);for(let s=0;s<t.positionIterations;++s){if(r.SolveTOIPositionConstraints(e,i))break}this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,r.InitializeVelocityConstraints();for(let e=0;e<t.velocityIterations;++e)r.SolveVelocityConstraints();const a=t.dt;for(let t=0;t<this.m_bodyCount;++t){const e=this.m_positions[t].c;let i=this.m_positions[t].a;const n=this.m_velocities[t].v;let r=this.m_velocities[t].w;const l=s.p.MulSV(a,n,Island.s_translation);if(s.p.DotVV(l,l)>o.A){const t=o.z/l.Length();n.SelfMul(t)}const h=a*r;if(h*h>o.w){r*=o.v/Object(s.a)(h)}e.SelfMulAdd(a,n),i+=a*r,this.m_positions[t].a=i,this.m_velocities[t].w=r;const m=this.m_bodies[t];m.m_sweep.c.Copy(e),m.m_sweep.a=i,m.m_linearVelocity.Copy(n),m.m_angularVelocity=r,m.SynchronizeTransform()}this.Report(r.m_velocityConstraints)}Report(t){if(null!==this.m_listener)for(let e=0;e<this.m_contactCount;++e){const i=this.m_contacts[e];if(!i)continue;const s=t[e],o=Island.s_impulse;o.count=s.pointCount;for(let t=0;t<s.pointCount;++t)o.normalImpulses[t]=s.points[t].normalImpulse,o.tangentImpulses[t]=s.points[t].tangentImpulse;this.m_listener.PostSolve(i,o)}}}Island.s_timer=new n.a,Island.s_solverData=new l.c,Island.s_contactSolverDef=new a.b,Island.s_contactSolver=new a.a,Island.s_translation=new s.p,Island.s_impulse=new h.b},function(t,e,i){"use strict";i.d(e,"a",function(){return AreaJoint});var s=i(0),o=i(1),n=i(38),r=i(3);class AreaJoint extends r.a{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_impulse=0,this.m_targetArea=0,this.m_bodies=t.bodies,this.m_frequencyHz=Object(o.c)(t.frequencyHz,0),this.m_dampingRatio=Object(o.c)(t.dampingRatio,0),this.m_targetLengths=Object(o.b)(t.bodies.length),this.m_normals=s.p.MakeArray(t.bodies.length),this.m_joints=[],this.m_deltas=s.p.MakeArray(t.bodies.length),this.m_delta=new s.p;const e=new n.b;e.frequencyHz=this.m_frequencyHz,e.dampingRatio=this.m_dampingRatio,this.m_targetArea=0;for(let t=0;t<this.m_bodies.length;++t){const i=this.m_bodies[t],o=this.m_bodies[(t+1)%this.m_bodies.length],n=i.GetWorldCenter(),r=o.GetWorldCenter();this.m_targetLengths[t]=s.p.DistanceVV(n,r),this.m_targetArea+=s.p.CrossVV(n,r),e.Initialize(i,o,n,r),this.m_joints[t]=i.GetWorld().CreateJoint(e)}this.m_targetArea*=.5}GetAnchorA(t){return t}GetAnchorB(t){return t}GetReactionForce(t,e){return e}GetReactionTorque(t){return 0}SetFrequency(t){this.m_frequencyHz=t;for(const e of this.m_joints)e.SetFrequency(t)}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t;for(const e of this.m_joints)e.SetDampingRatio(t)}GetDampingRatio(){return this.m_dampingRatio}Dump(t){t("Area joint dumping is not supported.\n")}InitVelocityConstraints(t){for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],o=this.m_bodies[(e+1)%this.m_bodies.length],n=t.positions[i.m_islandIndex].c,r=t.positions[o.m_islandIndex].c,a=this.m_deltas[e];s.p.SubVV(r,n,a)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],s=t.velocities[i.m_islandIndex].v,o=this.m_deltas[e];s.x+=i.m_invMass*o.y*.5*this.m_impulse,s.y+=i.m_invMass*-o.x*.5*this.m_impulse}}else this.m_impulse=0}SolveVelocityConstraints(t){let e=0,i=0;for(let o=0;o<this.m_bodies.length;++o){const n=this.m_bodies[o],r=t.velocities[n.m_islandIndex].v,a=this.m_deltas[o];e+=a.LengthSquared()/n.GetMass(),i+=s.p.CrossVV(r,a)}const o=-2*i/e;this.m_impulse+=o;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],s=t.velocities[i.m_islandIndex].v,n=this.m_deltas[e];s.x+=i.m_invMass*n.y*.5*o,s.y+=i.m_invMass*-n.x*.5*o}}SolvePositionConstraints(t){let e=0,i=0;for(let n=0;n<this.m_bodies.length;++n){const r=this.m_bodies[n],a=this.m_bodies[(n+1)%this.m_bodies.length],l=t.positions[r.m_islandIndex].c,h=t.positions[a.m_islandIndex].c,m=s.p.SubVV(h,l,this.m_delta);let c=m.Length();c<o.j&&(c=1),this.m_normals[n].x=m.y/c,this.m_normals[n].y=-m.x/c,e+=c,i+=s.p.CrossVV(l,h)}i*=.5;const n=.5*(this.m_targetArea-i)/e;let r=!0;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],a=t.positions[i.m_islandIndex].c,l=(e+1)%this.m_bodies.length,h=s.p.AddVV(this.m_normals[e],this.m_normals[l],this.m_delta);h.SelfMul(n);const m=h.LengthSquared();m>Object(s.l)(o.q)&&h.SelfMul(o.q/Object(s.m)(m)),m>Object(s.l)(o.n)&&(r=!1),a.x+=h.x,a.y+=h.y}return r}}},function(t,e,i){"use strict";i.d(e,"a",function(){return FrictionJoint});var s=i(0),o=i(1),n=i(3);class FrictionJoint extends n.a{constructor(t){super(t),this.m_localAnchorA=new s.p,this.m_localAnchorB=new s.p,this.m_linearImpulse=new s.p,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new s.p,this.m_rB=new s.p,this.m_localCenterA=new s.p,this.m_localCenterB=new s.p,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new s.f,this.m_angularMass=0,this.m_qA=new s.k,this.m_qB=new s.k,this.m_lalcA=new s.p,this.m_lalcB=new s.p,this.m_K=new s.f,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_linearImpulse.SetZero(),this.m_maxForce=Object(o.c)(t.maxForce,0),this.m_maxTorque=Object(o.c)(t.maxTorque,0),this.m_linearMass.SetZero()}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let o=t.velocities[this.m_indexA].w;const n=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v;let a=t.velocities[this.m_indexB].w;const l=this.m_qA.SetAngle(e),h=this.m_qB.SetAngle(n);s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const m=s.k.MulRV(l,this.m_lalcA,this.m_rA);s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const c=s.k.MulRV(h,this.m_lalcB,this.m_rB),_=this.m_invMassA,u=this.m_invMassB,p=this.m_invIA,d=this.m_invIB,f=this.m_K;if(f.ex.x=_+u+p*m.y*m.y+d*c.y*c.y,f.ex.y=-p*m.x*m.y-d*c.x*c.y,f.ey.x=f.ex.y,f.ey.y=_+u+p*m.x*m.x+d*c.x*c.x,f.GetInverse(this.m_linearMass),this.m_angularMass=p+d,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const e=this.m_linearImpulse;i.SelfMulSub(_,e),o-=p*(s.p.CrossVV(this.m_rA,e)+this.m_angularImpulse),r.SelfMulAdd(u,e),a+=d*(s.p.CrossVV(this.m_rB,e)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=a}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const o=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,h=this.m_invIB,m=t.step.dt;{const t=n-i;let e=-this.m_angularMass*t;const o=this.m_angularImpulse,r=m*this.m_maxTorque;this.m_angularImpulse=Object(s.d)(this.m_angularImpulse+e,-r,r),i-=l*(e=this.m_angularImpulse-o),n+=h*e}{const t=s.p.SubVV(s.p.AddVCrossSV(o,n,this.m_rB,s.p.s_t0),s.p.AddVCrossSV(e,i,this.m_rA,s.p.s_t1),FrictionJoint.SolveVelocityConstraints_s_Cdot_v2),c=s.f.MulMV(this.m_linearMass,t,FrictionJoint.SolveVelocityConstraints_s_impulseV).SelfNeg(),_=FrictionJoint.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(c);const u=m*this.m_maxForce;this.m_linearImpulse.LengthSquared()>u*u&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(u)),s.p.SubVV(this.m_linearImpulse,_,c),e.SelfMulSub(r,c),i-=l*s.p.CrossVV(this.m_rA,c),o.SelfMulAdd(a,c),n+=h*s.p.CrossVV(this.m_rB,c)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){return!0}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e}GetReactionTorque(t){return t*this.m_angularImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: FrictionJointDef = new FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}FrictionJoint.SolveVelocityConstraints_s_Cdot_v2=new s.p,FrictionJoint.SolveVelocityConstraints_s_impulseV=new s.p,FrictionJoint.SolveVelocityConstraints_s_oldImpulseV=new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return GearJoint});var s=i(0),o=i(1),n=i(3);class GearJoint extends n.a{constructor(t){let e,i;super(t),this.m_typeA=n.c.e_unknownJoint,this.m_typeB=n.c.e_unknownJoint,this.m_localAnchorA=new s.p,this.m_localAnchorB=new s.p,this.m_localAnchorC=new s.p,this.m_localAnchorD=new s.p,this.m_localAxisC=new s.p,this.m_localAxisD=new s.p,this.m_referenceAngleA=0,this.m_referenceAngleB=0,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_indexC=0,this.m_indexD=0,this.m_lcA=new s.p,this.m_lcB=new s.p,this.m_lcC=new s.p,this.m_lcD=new s.p,this.m_mA=0,this.m_mB=0,this.m_mC=0,this.m_mD=0,this.m_iA=0,this.m_iB=0,this.m_iC=0,this.m_iD=0,this.m_JvAC=new s.p,this.m_JvBD=new s.p,this.m_JwA=0,this.m_JwB=0,this.m_JwC=0,this.m_JwD=0,this.m_mass=0,this.m_qA=new s.k,this.m_qB=new s.k,this.m_qC=new s.k,this.m_qD=new s.k,this.m_lalcA=new s.p,this.m_lalcB=new s.p,this.m_lalcC=new s.p,this.m_lalcD=new s.p,this.m_joint1=t.joint1,this.m_joint2=t.joint2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType(),this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();const r=this.m_bodyA.m_xf,a=this.m_bodyA.m_sweep.a,l=this.m_bodyC.m_xf,h=this.m_bodyC.m_sweep.a;if(this.m_typeA===n.c.e_revoluteJoint){const i=t.joint1;this.m_localAnchorC.Copy(i.m_localAnchorA),this.m_localAnchorA.Copy(i.m_localAnchorB),this.m_referenceAngleA=i.m_referenceAngle,this.m_localAxisC.SetZero(),e=a-h-this.m_referenceAngleA}else{const i=t.joint1;this.m_localAnchorC.Copy(i.m_localAnchorA),this.m_localAnchorA.Copy(i.m_localAnchorB),this.m_referenceAngleA=i.m_referenceAngle,this.m_localAxisC.Copy(i.m_localXAxisA);const o=this.m_localAnchorC,n=s.k.MulTRV(l.q,s.p.AddVV(s.k.MulRV(r.q,this.m_localAnchorA,s.p.s_t0),s.p.SubVV(r.p,l.p,s.p.s_t1),s.p.s_t0),s.p.s_t0);e=s.p.DotVV(s.p.SubVV(n,o,s.p.s_t0),this.m_localAxisC)}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();const m=this.m_bodyB.m_xf,c=this.m_bodyB.m_sweep.a,_=this.m_bodyD.m_xf,u=this.m_bodyD.m_sweep.a;if(this.m_typeB===n.c.e_revoluteJoint){const e=t.joint2;this.m_localAnchorD.Copy(e.m_localAnchorA),this.m_localAnchorB.Copy(e.m_localAnchorB),this.m_referenceAngleB=e.m_referenceAngle,this.m_localAxisD.SetZero(),i=c-u-this.m_referenceAngleB}else{const e=t.joint2;this.m_localAnchorD.Copy(e.m_localAnchorA),this.m_localAnchorB.Copy(e.m_localAnchorB),this.m_referenceAngleB=e.m_referenceAngle,this.m_localAxisD.Copy(e.m_localXAxisA);const o=this.m_localAnchorD,n=s.k.MulTRV(_.q,s.p.AddVV(s.k.MulRV(m.q,this.m_localAnchorB,s.p.s_t0),s.p.SubVV(m.p,_.p,s.p.s_t1),s.p.s_t0),s.p.s_t0);i=s.p.DotVV(s.p.SubVV(n,o,s.p.s_t0),this.m_localAxisD)}this.m_ratio=Object(o.c)(t.ratio,1),this.m_constant=e+this.m_ratio*i,this.m_impulse=0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let o=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let l=t.velocities[this.m_indexB].w;const h=t.positions[this.m_indexC].a,m=t.velocities[this.m_indexC].v;let c=t.velocities[this.m_indexC].w;const _=t.positions[this.m_indexD].a,u=t.velocities[this.m_indexD].v;let p=t.velocities[this.m_indexD].w;const d=this.m_qA.SetAngle(e),f=this.m_qB.SetAngle(r),y=this.m_qC.SetAngle(h),S=this.m_qD.SetAngle(_);if(this.m_mass=0,this.m_typeA===n.c.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{const t=s.k.MulRV(y,this.m_localAxisC,GearJoint.InitVelocityConstraints_s_u);s.p.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);const e=s.k.MulRV(y,this.m_lalcC,GearJoint.InitVelocityConstraints_s_rC);s.p.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);const i=s.k.MulRV(d,this.m_lalcA,GearJoint.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(t),this.m_JwC=s.p.CrossVV(e,t),this.m_JwA=s.p.CrossVV(i,t),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===n.c.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{const t=s.k.MulRV(S,this.m_localAxisD,GearJoint.InitVelocityConstraints_s_u);s.p.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);const e=s.k.MulRV(S,this.m_lalcD,GearJoint.InitVelocityConstraints_s_rD);s.p.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);const i=s.k.MulRV(f,this.m_lalcB,GearJoint.InitVelocityConstraints_s_rB);s.p.MulSV(this.m_ratio,t,this.m_JvBD),this.m_JwD=this.m_ratio*s.p.CrossVV(e,t),this.m_JwB=this.m_ratio*s.p.CrossVV(i,t),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(i.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),o+=this.m_iA*this.m_impulse*this.m_JwA,a.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),l+=this.m_iB*this.m_impulse*this.m_JwB,m.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),c-=this.m_iC*this.m_impulse*this.m_JwC,u.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),p-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=l,t.velocities[this.m_indexC].w=c,t.velocities[this.m_indexD].w=p}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const o=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=t.velocities[this.m_indexC].v;let a=t.velocities[this.m_indexC].w;const l=t.velocities[this.m_indexD].v;let h=t.velocities[this.m_indexD].w,m=s.p.DotVV(this.m_JvAC,s.p.SubVV(e,r,s.p.s_t0))+s.p.DotVV(this.m_JvBD,s.p.SubVV(o,l,s.p.s_t0));m+=this.m_JwA*i-this.m_JwC*a+(this.m_JwB*n-this.m_JwD*h);const c=-this.m_mass*m;this.m_impulse+=c,e.SelfMulAdd(this.m_mA*c,this.m_JvAC),i+=this.m_iA*c*this.m_JwA,o.SelfMulAdd(this.m_mB*c,this.m_JvBD),n+=this.m_iB*c*this.m_JwB,r.SelfMulSub(this.m_mC*c,this.m_JvAC),a-=this.m_iC*c*this.m_JwC,l.SelfMulSub(this.m_mD*c,this.m_JvBD),h-=this.m_iD*c*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=a,t.velocities[this.m_indexD].w=h}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const r=t.positions[this.m_indexB].c;let a=t.positions[this.m_indexB].a;const l=t.positions[this.m_indexC].c;let h=t.positions[this.m_indexC].a;const m=t.positions[this.m_indexD].c;let c=t.positions[this.m_indexD].a;const _=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(a),p=this.m_qC.SetAngle(h),d=this.m_qD.SetAngle(c);let f,y;const S=this.m_JvAC,x=this.m_JvBD;let C,B,w,g,v=0;if(this.m_typeA===n.c.e_revoluteJoint)S.SetZero(),C=1,w=1,v+=this.m_iA+this.m_iC,f=i-h-this.m_referenceAngleA;else{const t=s.k.MulRV(p,this.m_localAxisC,GearJoint.SolvePositionConstraints_s_u),i=s.k.MulRV(p,this.m_lalcC,GearJoint.SolvePositionConstraints_s_rC),o=s.k.MulRV(_,this.m_lalcA,GearJoint.SolvePositionConstraints_s_rA);S.Copy(t),w=s.p.CrossVV(i,t),C=s.p.CrossVV(o,t),v+=this.m_mC+this.m_mA+this.m_iC*w*w+this.m_iA*C*C;const n=this.m_lalcC,r=s.k.MulTRV(p,s.p.AddVV(o,s.p.SubVV(e,l,s.p.s_t0),s.p.s_t0),s.p.s_t0);f=s.p.DotVV(s.p.SubVV(r,n,s.p.s_t0),this.m_localAxisC)}if(this.m_typeB===n.c.e_revoluteJoint)x.SetZero(),B=this.m_ratio,g=this.m_ratio,v+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),y=a-c-this.m_referenceAngleB;else{const t=s.k.MulRV(d,this.m_localAxisD,GearJoint.SolvePositionConstraints_s_u),e=s.k.MulRV(d,this.m_lalcD,GearJoint.SolvePositionConstraints_s_rD),i=s.k.MulRV(u,this.m_lalcB,GearJoint.SolvePositionConstraints_s_rB);s.p.MulSV(this.m_ratio,t,x),g=this.m_ratio*s.p.CrossVV(e,t),B=this.m_ratio*s.p.CrossVV(i,t),v+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*g*g+this.m_iB*B*B;const o=this.m_lalcD,n=s.k.MulTRV(d,s.p.AddVV(i,s.p.SubVV(r,m,s.p.s_t0),s.p.s_t0),s.p.s_t0);y=s.p.DotVV(s.p.SubVV(n,o,s.p.s_t0),this.m_localAxisD)}const A=f+this.m_ratio*y-this.m_constant;let V=0;return v>0&&(V=-A/v),e.SelfMulAdd(this.m_mA*V,S),i+=this.m_iA*V*C,r.SelfMulAdd(this.m_mB*V,x),a+=this.m_iB*V*B,l.SelfMulSub(this.m_mC*V,S),h-=this.m_iC*V*w,m.SelfMulSub(this.m_mD*V,x),c-=this.m_iD*V*g,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=a,t.positions[this.m_indexC].a=h,t.positions[this.m_indexD].a=c,0<o.n}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return s.p.MulSV(t*this.m_impulse,this.m_JvAC,e)}GetReactionTorque(t){return t*this.m_impulse*this.m_JwA}GetJoint1(){return this.m_joint1}GetJoint2(){return this.m_joint2}GetRatio(){return this.m_ratio}SetRatio(t){this.m_ratio=t}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,s=this.m_joint1.m_index,o=this.m_joint2.m_index;t("  const jd: GearJointDef = new GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",s),t("  jd.joint2 = joints[%d];\n",o),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}GearJoint.InitVelocityConstraints_s_u=new s.p,GearJoint.InitVelocityConstraints_s_rA=new s.p,GearJoint.InitVelocityConstraints_s_rB=new s.p,GearJoint.InitVelocityConstraints_s_rC=new s.p,GearJoint.InitVelocityConstraints_s_rD=new s.p,GearJoint.SolvePositionConstraints_s_u=new s.p,GearJoint.SolvePositionConstraints_s_rA=new s.p,GearJoint.SolvePositionConstraints_s_rB=new s.p,GearJoint.SolvePositionConstraints_s_rC=new s.p,GearJoint.SolvePositionConstraints_s_rD=new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return MotorJoint});var s=i(0),o=i(1),n=i(3);class MotorJoint extends n.a{constructor(t){super(t),this.m_linearOffset=new s.p,this.m_angularOffset=0,this.m_linearImpulse=new s.p,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_correctionFactor=.3,this.m_indexA=0,this.m_indexB=0,this.m_rA=new s.p,this.m_rB=new s.p,this.m_localCenterA=new s.p,this.m_localCenterB=new s.p,this.m_linearError=new s.p,this.m_angularError=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new s.f,this.m_angularMass=0,this.m_qA=new s.k,this.m_qB=new s.k,this.m_K=new s.f,this.m_linearOffset.Copy(Object(o.c)(t.linearOffset,s.p.ZERO)),this.m_linearImpulse.SetZero(),this.m_maxForce=Object(o.c)(t.maxForce,0),this.m_maxTorque=Object(o.c)(t.maxTorque,0),this.m_correctionFactor=Object(o.c)(t.correctionFactor,.3)}GetAnchorA(t){const e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t}GetAnchorB(t){const e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t}GetReactionForce(t,e){return s.p.MulSV(t,this.m_linearImpulse,e)}GetReactionTorque(t){return t*this.m_angularImpulse}SetLinearOffset(t){s.p.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}GetLinearOffset(){return this.m_linearOffset}SetAngularOffset(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}GetAngularOffset(){return this.m_angularOffset}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,o=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v;let h=t.velocities[this.m_indexB].w;const m=this.m_qA.SetAngle(i),c=this.m_qB.SetAngle(a),_=s.k.MulRV(m,s.p.SubVV(this.m_linearOffset,this.m_localCenterA,s.p.s_t0),this.m_rA),u=s.k.MulRV(c,s.p.NegV(this.m_localCenterB,s.p.s_t0),this.m_rB),p=this.m_invMassA,d=this.m_invMassB,f=this.m_invIA,y=this.m_invIB,S=this.m_K;if(S.ex.x=p+d+f*_.y*_.y+y*u.y*u.y,S.ex.y=-f*_.x*_.y-y*u.x*u.y,S.ey.x=S.ex.y,S.ey.y=p+d+f*_.x*_.x+y*u.x*u.x,S.GetInverse(this.m_linearMass),this.m_angularMass=f+y,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),s.p.SubVV(s.p.AddVV(r,u,s.p.s_t0),s.p.AddVV(e,_,s.p.s_t1),this.m_linearError),this.m_angularError=a-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const e=this.m_linearImpulse;o.SelfMulSub(p,e),n-=f*(s.p.CrossVV(_,e)+this.m_angularImpulse),l.SelfMulAdd(d,e),h+=y*(s.p.CrossVV(u,e)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=h}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const o=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,h=this.m_invIB,m=t.step.dt,c=t.step.inv_dt;{const t=n-i+c*this.m_correctionFactor*this.m_angularError;let e=-this.m_angularMass*t;const o=this.m_angularImpulse,r=m*this.m_maxTorque;this.m_angularImpulse=Object(s.d)(this.m_angularImpulse+e,-r,r),i-=l*(e=this.m_angularImpulse-o),n+=h*e}{const t=this.m_rA,_=this.m_rB,u=s.p.AddVV(s.p.SubVV(s.p.AddVV(o,s.p.CrossSV(n,_,s.p.s_t0),s.p.s_t0),s.p.AddVV(e,s.p.CrossSV(i,t,s.p.s_t1),s.p.s_t1),s.p.s_t2),s.p.MulSV(c*this.m_correctionFactor,this.m_linearError,s.p.s_t3),MotorJoint.SolveVelocityConstraints_s_Cdot_v2),p=s.f.MulMV(this.m_linearMass,u,MotorJoint.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),d=MotorJoint.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(p);const f=m*this.m_maxForce;this.m_linearImpulse.LengthSquared()>f*f&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(f)),s.p.SubVV(this.m_linearImpulse,d,p),e.SelfMulSub(r,p),i-=l*s.p.CrossVV(t,p),o.SelfMulAdd(a,p),n+=h*s.p.CrossVV(_,p)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){return!0}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: MotorJointDef = new MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}MotorJoint.SolveVelocityConstraints_s_Cdot_v2=new s.p,MotorJoint.SolveVelocityConstraints_s_impulse_v2=new s.p,MotorJoint.SolveVelocityConstraints_s_oldImpulse_v2=new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return MouseJoint});var s=i(0),o=i(1),n=i(3);class MouseJoint extends n.a{constructor(t){super(t),this.m_localAnchorB=new s.p,this.m_targetA=new s.p,this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_beta=0,this.m_impulse=new s.p,this.m_maxForce=0,this.m_gamma=0,this.m_indexA=0,this.m_indexB=0,this.m_rB=new s.p,this.m_localCenterB=new s.p,this.m_invMassB=0,this.m_invIB=0,this.m_mass=new s.f,this.m_C=new s.p,this.m_qB=new s.k,this.m_lalcB=new s.p,this.m_K=new s.f,this.m_targetA.Copy(Object(o.c)(t.target,s.p.ZERO)),s.o.MulTXV(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=Object(o.c)(t.maxForce,0),this.m_impulse.SetZero(),this.m_frequencyHz=Object(o.c)(t.frequencyHz,0),this.m_dampingRatio=Object(o.c)(t.dampingRatio,0),this.m_beta=0,this.m_gamma=0}SetTarget(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}GetTarget(){return this.m_targetA}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetFrequency(t){this.m_frequencyHz=t}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t}GetDampingRatio(){return this.m_dampingRatio}InitVelocityConstraints(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const a=this.m_qB.SetAngle(i),l=this.m_bodyB.GetMass(),h=2*o.F*this.m_frequencyHz,m=2*l*this.m_dampingRatio*h,c=l*(h*h),_=t.step.dt;this.m_gamma=_*(m+_*c),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=_*c*this.m_gamma,s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),s.k.MulRV(a,this.m_lalcB,this.m_rB);const u=this.m_K;u.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,u.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,u.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),r*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),n.x+=this.m_invMassB*this.m_impulse.x,n.y+=this.m_invMassB*this.m_impulse.y,r+=this.m_invIB*s.p.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=r}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexB].v;let i=t.velocities[this.m_indexB].w;const o=s.p.AddVCrossSV(e,i,this.m_rB,MouseJoint.SolveVelocityConstraints_s_Cdot),n=s.f.MulMV(this.m_mass,s.p.AddVV(o,s.p.AddVV(this.m_C,s.p.MulSV(this.m_gamma,this.m_impulse,s.p.s_t0),s.p.s_t0),s.p.s_t0).SelfNeg(),MouseJoint.SolveVelocityConstraints_s_impulse),r=MouseJoint.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(n);const a=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.Length()),s.p.SubVV(this.m_impulse,r,n),e.SelfMulAdd(this.m_invMassB,n),i+=this.m_invIB*s.p.CrossVV(this.m_rB,n),t.velocities[this.m_indexB].w=i}SolvePositionConstraints(t){return!0}GetAnchorA(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return s.p.MulSV(t,this.m_impulse,e)}GetReactionTorque(t){return 0}Dump(t){t("Mouse joint dumping is not supported.\n")}ShiftOrigin(t){this.m_targetA.SelfSub(t)}}MouseJoint.SolveVelocityConstraints_s_Cdot=new s.p,MouseJoint.SolveVelocityConstraints_s_impulse=new s.p,MouseJoint.SolveVelocityConstraints_s_oldImpulse=new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return PrismaticJoint});var s=i(0),o=i(1),n=i(3);class PrismaticJoint extends n.a{constructor(t){super(t),this.m_localAnchorA=new s.p,this.m_localAnchorB=new s.p,this.m_localXAxisA=new s.p,this.m_localYAxisA=new s.p,this.m_referenceAngle=0,this.m_impulse=new s.q(0,0,0),this.m_motorImpulse=0,this.m_lowerTranslation=0,this.m_upperTranslation=0,this.m_maxMotorForce=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_enableMotor=!1,this.m_limitState=n.d.e_inactiveLimit,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new s.p,this.m_localCenterB=new s.p,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_axis=new s.p(0,0),this.m_perp=new s.p(0,0),this.m_s1=0,this.m_s2=0,this.m_a1=0,this.m_a2=0,this.m_K=new s.g,this.m_K3=new s.g,this.m_K2=new s.f,this.m_motorMass=0,this.m_qA=new s.k,this.m_qB=new s.k,this.m_lalcA=new s.p,this.m_lalcB=new s.p,this.m_rA=new s.p,this.m_rB=new s.p,this.m_localAnchorA.Copy(Object(o.c)(t.localAnchorA,s.p.ZERO)),this.m_localAnchorB.Copy(Object(o.c)(t.localAnchorB,s.p.ZERO)),this.m_localXAxisA.Copy(Object(o.c)(t.localAxisA,new s.p(1,0))).SelfNormalize(),s.p.CrossOneV(this.m_localXAxisA,this.m_localYAxisA),this.m_referenceAngle=Object(o.c)(t.referenceAngle,0),this.m_lowerTranslation=Object(o.c)(t.lowerTranslation,0),this.m_upperTranslation=Object(o.c)(t.upperTranslation,0),this.m_maxMotorForce=Object(o.c)(t.maxMotorForce,0),this.m_motorSpeed=Object(o.c)(t.motorSpeed,0),this.m_enableLimit=Object(o.c)(t.enableLimit,!1),this.m_enableMotor=Object(o.c)(t.enableMotor,!1)}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v;let a=t.velocities[this.m_indexA].w;const l=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v;let c=t.velocities[this.m_indexB].w;const _=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(h);s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const p=s.k.MulRV(_,this.m_lalcA,this.m_rA);s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const d=s.k.MulRV(u,this.m_lalcB,this.m_rB),f=s.p.AddVV(s.p.SubVV(l,e,s.p.s_t0),s.p.SubVV(d,p,s.p.s_t1),PrismaticJoint.InitVelocityConstraints_s_d),y=this.m_invMassA,S=this.m_invMassB,x=this.m_invIA,C=this.m_invIB;if(s.k.MulRV(_,this.m_localXAxisA,this.m_axis),this.m_a1=s.p.CrossVV(s.p.AddVV(f,p,s.p.s_t0),this.m_axis),this.m_a2=s.p.CrossVV(d,this.m_axis),this.m_motorMass=y+S+x*this.m_a1*this.m_a1+C*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),s.k.MulRV(_,this.m_localYAxisA,this.m_perp),this.m_s1=s.p.CrossVV(s.p.AddVV(f,p,s.p.s_t0),this.m_perp),this.m_s2=s.p.CrossVV(d,this.m_perp),this.m_K.ex.x=y+S+x*this.m_s1*this.m_s1+C*this.m_s2*this.m_s2,this.m_K.ex.y=x*this.m_s1+C*this.m_s2,this.m_K.ex.z=x*this.m_s1*this.m_a1+C*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=x+C,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=x*this.m_a1+C*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=y+S+x*this.m_a1*this.m_a1+C*this.m_a2*this.m_a2,this.m_enableLimit){const t=s.p.DotVV(this.m_axis,f);Object(s.a)(this.m_upperTranslation-this.m_lowerTranslation)<2*o.n?this.m_limitState=n.d.e_equalLimits:t<=this.m_lowerTranslation?this.m_limitState!==n.d.e_atLowerLimit&&(this.m_limitState=n.d.e_atLowerLimit,this.m_impulse.z=0):t>=this.m_upperTranslation?this.m_limitState!==n.d.e_atUpperLimit&&(this.m_limitState=n.d.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=n.d.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=n.d.e_inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;const e=s.p.AddVV(s.p.MulSV(this.m_impulse.x,this.m_perp,s.p.s_t0),s.p.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,s.p.s_t1),PrismaticJoint.InitVelocityConstraints_s_P),i=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,o=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;r.SelfMulSub(y,e),a-=x*i,m.SelfMulAdd(S,e),c+=C*o}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=c}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const o=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const a=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,m=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==n.d.e_equalLimits){const n=s.p.DotVV(this.m_axis,s.p.SubVV(o,e,s.p.s_t0))+this.m_a2*r-this.m_a1*i;let c=this.m_motorMass*(this.m_motorSpeed-n);const _=this.m_motorImpulse,u=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=Object(s.d)(this.m_motorImpulse+c,-u,u),c=this.m_motorImpulse-_;const p=s.p.MulSV(c,this.m_axis,PrismaticJoint.SolveVelocityConstraints_s_P),d=c*this.m_a1,f=c*this.m_a2;e.SelfMulSub(a,p),i-=h*d,o.SelfMulAdd(l,p),r+=m*f}const c=s.p.DotVV(this.m_perp,s.p.SubVV(o,e,s.p.s_t0))+this.m_s2*r-this.m_s1*i,_=r-i;if(this.m_enableLimit&&this.m_limitState!==n.d.e_inactiveLimit){const t=s.p.DotVV(this.m_axis,s.p.SubVV(o,e,s.p.s_t0))+this.m_a2*r-this.m_a1*i,u=PrismaticJoint.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),p=this.m_K.Solve33(-c,-_,-t,PrismaticJoint.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(p),this.m_limitState===n.d.e_atLowerLimit?this.m_impulse.z=Object(s.h)(this.m_impulse.z,0):this.m_limitState===n.d.e_atUpperLimit&&(this.m_impulse.z=Object(s.i)(this.m_impulse.z,0));const d=-c-(this.m_impulse.z-u.z)*this.m_K.ez.x,f=-_-(this.m_impulse.z-u.z)*this.m_K.ez.y,y=this.m_K.Solve22(d,f,PrismaticJoint.SolveVelocityConstraints_s_f2r);y.x+=u.x,y.y+=u.y,this.m_impulse.x=y.x,this.m_impulse.y=y.y,p.x=this.m_impulse.x-u.x,p.y=this.m_impulse.y-u.y,p.z=this.m_impulse.z-u.z;const S=s.p.AddVV(s.p.MulSV(p.x,this.m_perp,s.p.s_t0),s.p.MulSV(p.z,this.m_axis,s.p.s_t1),PrismaticJoint.SolveVelocityConstraints_s_P),x=p.x*this.m_s1+p.y+p.z*this.m_a1,C=p.x*this.m_s2+p.y+p.z*this.m_a2;e.SelfMulSub(a,S),i-=h*x,o.SelfMulAdd(l,S),r+=m*C}else{const t=this.m_K.Solve22(-c,-_,PrismaticJoint.SolveVelocityConstraints_s_df2);this.m_impulse.x+=t.x,this.m_impulse.y+=t.y;const n=s.p.MulSV(t.x,this.m_perp,PrismaticJoint.SolveVelocityConstraints_s_P),u=t.x*this.m_s1+t.y,p=t.x*this.m_s2+t.y;e.SelfMulSub(a,n),i-=h*u,o.SelfMulAdd(l,n),r+=m*p}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r),h=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,_=this.m_invIB,u=s.k.MulRV(a,this.m_lalcA,this.m_rA),p=s.k.MulRV(l,this.m_lalcB,this.m_rB),d=s.p.SubVV(s.p.AddVV(n,p,s.p.s_t0),s.p.AddVV(e,u,s.p.s_t1),PrismaticJoint.SolvePositionConstraints_s_d),f=s.k.MulRV(a,this.m_localXAxisA,this.m_axis),y=s.p.CrossVV(s.p.AddVV(d,u,s.p.s_t0),f),S=s.p.CrossVV(p,f),x=s.k.MulRV(a,this.m_localYAxisA,this.m_perp),C=s.p.CrossVV(s.p.AddVV(d,u,s.p.s_t0),x),B=s.p.CrossVV(p,x);let w=PrismaticJoint.SolvePositionConstraints_s_impulse;const g=s.p.DotVV(x,d),v=r-i-this.m_referenceAngle;let A=Object(s.a)(g);const V=Object(s.a)(v);let b=!1,P=0;if(this.m_enableLimit){const t=s.p.DotVV(f,d);Object(s.a)(this.m_upperTranslation-this.m_lowerTranslation)<2*o.n?(P=Object(s.d)(t,-o.q,o.q),A=Object(s.h)(A,Object(s.a)(t)),b=!0):t<=this.m_lowerTranslation?(P=Object(s.d)(t-this.m_lowerTranslation+o.n,-o.q,0),A=Object(s.h)(A,this.m_lowerTranslation-t),b=!0):t>=this.m_upperTranslation&&(P=Object(s.d)(t-this.m_upperTranslation-o.n,0,o.q),A=Object(s.h)(A,t-this.m_upperTranslation),b=!0)}if(b){const t=h+m+c*C*C+_*B*B,e=c*C+_*B,i=c*C*y+_*B*S;let s=c+_;0===s&&(s=1);const o=c*y+_*S,n=h+m+c*y*y+_*S*S,r=this.m_K3;r.ex.SetXYZ(t,e,i),r.ey.SetXYZ(e,s,o),r.ez.SetXYZ(i,o,n),w=r.Solve33(-g,-v,-P,w)}else{const t=h+m+c*C*C+_*B*B,e=c*C+_*B;let i=c+_;0===i&&(i=1);const s=this.m_K2;s.ex.Set(t,e),s.ey.Set(e,i);const o=s.Solve(-g,-v,PrismaticJoint.SolvePositionConstraints_s_impulse1);w.x=o.x,w.y=o.y,w.z=0}const M=s.p.AddVV(s.p.MulSV(w.x,x,s.p.s_t0),s.p.MulSV(w.z,f,s.p.s_t1),PrismaticJoint.SolvePositionConstraints_s_P),I=w.x*C+w.y+w.z*y,G=w.x*B+w.y+w.z*S;return e.SelfMulSub(h,M),i-=c*I,n.SelfMulAdd(m,M),r+=_*G,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,A<=o.n&&V<=o.g}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),e}GetReactionTorque(t){return t*this.m_impulse.y}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetReferenceAngle(){return this.m_referenceAngle}GetJointTranslation(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,PrismaticJoint.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,PrismaticJoint.GetJointTranslation_s_pB),i=s.p.SubVV(e,t,PrismaticJoint.GetJointTranslation_s_d),o=this.m_bodyA.GetWorldVector(this.m_localXAxisA,PrismaticJoint.GetJointTranslation_s_axis);return s.p.DotVV(i,o)}GetJointSpeed(){const t=this.m_bodyA,e=this.m_bodyB;s.p.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);const i=s.k.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);s.p.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);const o=s.k.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=s.p.AddVV(t.m_sweep.c,i,s.p.s_t0),r=s.p.AddVV(e.m_sweep.c,o,s.p.s_t1),a=s.p.SubVV(r,n,s.p.s_t2),l=t.GetWorldVector(this.m_localXAxisA,this.m_axis),h=t.m_linearVelocity,m=e.m_linearVelocity,c=t.m_angularVelocity,_=e.m_angularVelocity;return s.p.DotVV(a,s.p.CrossSV(c,l,s.p.s_t0))+s.p.DotVV(l,s.p.SubVV(s.p.AddVCrossSV(m,_,o,s.p.s_t0),s.p.AddVCrossSV(h,c,i,s.p.s_t1),s.p.s_t0))}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}SetMotorSpeed(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorForce(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)}GetMaxMotorForce(){return this.m_maxMotorForce}GetMotorForce(t){return t*this.m_motorImpulse}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: PrismaticJointDef = new PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}PrismaticJoint.InitVelocityConstraints_s_d=new s.p,PrismaticJoint.InitVelocityConstraints_s_P=new s.p,PrismaticJoint.SolveVelocityConstraints_s_P=new s.p,PrismaticJoint.SolveVelocityConstraints_s_f2r=new s.p,PrismaticJoint.SolveVelocityConstraints_s_f1=new s.q,PrismaticJoint.SolveVelocityConstraints_s_df3=new s.q,PrismaticJoint.SolveVelocityConstraints_s_df2=new s.p,PrismaticJoint.SolvePositionConstraints_s_d=new s.p,PrismaticJoint.SolvePositionConstraints_s_impulse=new s.q,PrismaticJoint.SolvePositionConstraints_s_impulse1=new s.p,PrismaticJoint.SolvePositionConstraints_s_P=new s.p,PrismaticJoint.GetJointTranslation_s_pA=new s.p,PrismaticJoint.GetJointTranslation_s_pB=new s.p,PrismaticJoint.GetJointTranslation_s_d=new s.p,PrismaticJoint.GetJointTranslation_s_axis=new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return PulleyJoint});var s=i(0),o=i(1),n=i(3);class PulleyJoint extends n.a{constructor(t){super(t),this.m_groundAnchorA=new s.p,this.m_groundAnchorB=new s.p,this.m_lengthA=0,this.m_lengthB=0,this.m_localAnchorA=new s.p,this.m_localAnchorB=new s.p,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_uA=new s.p,this.m_uB=new s.p,this.m_rA=new s.p,this.m_rB=new s.p,this.m_localCenterA=new s.p,this.m_localCenterB=new s.p,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_qA=new s.k,this.m_qB=new s.k,this.m_lalcA=new s.p,this.m_lalcB=new s.p,this.m_groundAnchorA.Copy(Object(o.c)(t.groundAnchorA,new s.p(-1,1))),this.m_groundAnchorB.Copy(Object(o.c)(t.groundAnchorB,new s.p(1,0))),this.m_localAnchorA.Copy(Object(o.c)(t.localAnchorA,new s.p(-1,0))),this.m_localAnchorB.Copy(Object(o.c)(t.localAnchorB,new s.p(1,0))),this.m_lengthA=Object(o.c)(t.lengthA,0),this.m_lengthB=Object(o.c)(t.lengthB,0),this.m_ratio=Object(o.c)(t.ratio,1),this.m_constant=Object(o.c)(t.lengthA,0)+this.m_ratio*Object(o.c)(t.lengthB,0),this.m_impulse=0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v;let m=t.velocities[this.m_indexB].w;const c=this.m_qA.SetAngle(i),_=this.m_qB.SetAngle(l);s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),s.k.MulRV(c,this.m_lalcA,this.m_rA),s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),s.k.MulRV(_,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(a).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);const u=this.m_uA.Length(),p=this.m_uB.Length();u>10*o.n?this.m_uA.SelfMul(1/u):this.m_uA.SetZero(),p>10*o.n?this.m_uB.SelfMul(1/p):this.m_uB.SetZero();const d=s.p.CrossVV(this.m_rA,this.m_uA),f=s.p.CrossVV(this.m_rB,this.m_uB),y=this.m_invMassA+this.m_invIA*d*d,S=this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=y+this.m_ratio*this.m_ratio*S,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const e=s.p.MulSV(-this.m_impulse,this.m_uA,PulleyJoint.InitVelocityConstraints_s_PA),i=s.p.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,PulleyJoint.InitVelocityConstraints_s_PB);n.SelfMulAdd(this.m_invMassA,e),r+=this.m_invIA*s.p.CrossVV(this.m_rA,e),h.SelfMulAdd(this.m_invMassB,i),m+=this.m_invIB*s.p.CrossVV(this.m_rB,i)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=m}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const o=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=s.p.AddVCrossSV(e,i,this.m_rA,PulleyJoint.SolveVelocityConstraints_s_vpA),a=s.p.AddVCrossSV(o,n,this.m_rB,PulleyJoint.SolveVelocityConstraints_s_vpB),l=-s.p.DotVV(this.m_uA,r)-this.m_ratio*s.p.DotVV(this.m_uB,a),h=-this.m_mass*l;this.m_impulse+=h;const m=s.p.MulSV(-h,this.m_uA,PulleyJoint.SolveVelocityConstraints_s_PA),c=s.p.MulSV(-this.m_ratio*h,this.m_uB,PulleyJoint.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,m),i+=this.m_invIA*s.p.CrossVV(this.m_rA,m),o.SelfMulAdd(this.m_invMassB,c),n+=this.m_invIB*s.p.CrossVV(this.m_rB,c),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r);s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const h=s.k.MulRV(a,this.m_lalcA,this.m_rA);s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const m=s.k.MulRV(l,this.m_lalcB,this.m_rB),c=this.m_uA.Copy(e).SelfAdd(h).SelfSub(this.m_groundAnchorA),_=this.m_uB.Copy(n).SelfAdd(m).SelfSub(this.m_groundAnchorB),u=c.Length(),p=_.Length();u>10*o.n?c.SelfMul(1/u):c.SetZero(),p>10*o.n?_.SelfMul(1/p):_.SetZero();const d=s.p.CrossVV(h,c),f=s.p.CrossVV(m,_),y=this.m_invMassA+this.m_invIA*d*d,S=this.m_invMassB+this.m_invIB*f*f;let x=y+this.m_ratio*this.m_ratio*S;x>0&&(x=1/x);const C=this.m_constant-u-this.m_ratio*p,B=Object(s.a)(C),w=-x*C,g=s.p.MulSV(-w,c,PulleyJoint.SolvePositionConstraints_s_PA),v=s.p.MulSV(-this.m_ratio*w,_,PulleyJoint.SolvePositionConstraints_s_PB);return e.SelfMulAdd(this.m_invMassA,g),i+=this.m_invIA*s.p.CrossVV(h,g),n.SelfMulAdd(this.m_invMassB,v),r+=this.m_invIB*s.p.CrossVV(m,v),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,B<o.n}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e}GetReactionTorque(t){return 0}GetGroundAnchorA(){return this.m_groundAnchorA}GetGroundAnchorB(){return this.m_groundAnchorB}GetLengthA(){return this.m_lengthA}GetLengthB(){return this.m_lengthB}GetRatio(){return this.m_ratio}GetCurrentLengthA(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,PulleyJoint.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return s.p.DistanceVV(t,e)}GetCurrentLengthB(){const t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,PulleyJoint.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return s.p.DistanceVV(t,e)}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: PulleyJointDef = new PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}ShiftOrigin(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}PulleyJoint.InitVelocityConstraints_s_PA=new s.p,PulleyJoint.InitVelocityConstraints_s_PB=new s.p,PulleyJoint.SolveVelocityConstraints_s_vpA=new s.p,PulleyJoint.SolveVelocityConstraints_s_vpB=new s.p,PulleyJoint.SolveVelocityConstraints_s_PA=new s.p,PulleyJoint.SolveVelocityConstraints_s_PB=new s.p,PulleyJoint.SolvePositionConstraints_s_PA=new s.p,PulleyJoint.SolvePositionConstraints_s_PB=new s.p,PulleyJoint.GetCurrentLengthA_s_p=new s.p,PulleyJoint.GetCurrentLengthB_s_p=new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return RevoluteJoint});var s=i(0),o=i(1),n=i(3);class RevoluteJoint extends n.a{constructor(t){super(t),this.m_localAnchorA=new s.p,this.m_localAnchorB=new s.p,this.m_impulse=new s.q,this.m_motorImpulse=0,this.m_enableMotor=!1,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_referenceAngle=0,this.m_lowerAngle=0,this.m_upperAngle=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new s.p,this.m_rB=new s.p,this.m_localCenterA=new s.p,this.m_localCenterB=new s.p,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new s.g,this.m_motorMass=0,this.m_limitState=n.d.e_inactiveLimit,this.m_qA=new s.k,this.m_qB=new s.k,this.m_lalcA=new s.p,this.m_lalcB=new s.p,this.m_K=new s.f,this.m_localAnchorA.Copy(Object(o.c)(t.localAnchorA,s.p.ZERO)),this.m_localAnchorB.Copy(Object(o.c)(t.localAnchorB,s.p.ZERO)),this.m_referenceAngle=Object(o.c)(t.referenceAngle,0),this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=Object(o.c)(t.lowerAngle,0),this.m_upperAngle=Object(o.c)(t.upperAngle,0),this.m_maxMotorTorque=Object(o.c)(t.maxMotorTorque,0),this.m_motorSpeed=Object(o.c)(t.motorSpeed,0),this.m_enableLimit=Object(o.c)(t.enableLimit,!1),this.m_enableMotor=Object(o.c)(t.enableMotor,!1),this.m_limitState=n.d.e_inactiveLimit}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v;let h=t.velocities[this.m_indexB].w;const m=this.m_qA.SetAngle(e),c=this.m_qB.SetAngle(a);s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),s.k.MulRV(m,this.m_lalcA,this.m_rA),s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),s.k.MulRV(c,this.m_lalcB,this.m_rB);const _=this.m_invMassA,u=this.m_invMassB,p=this.m_invIA,d=this.m_invIB,f=p+d===0;if(this.m_mass.ex.x=_+u+this.m_rA.y*this.m_rA.y*p+this.m_rB.y*this.m_rB.y*d,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*p-this.m_rB.y*this.m_rB.x*d,this.m_mass.ez.x=-this.m_rA.y*p-this.m_rB.y*d,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=_+u+this.m_rA.x*this.m_rA.x*p+this.m_rB.x*this.m_rB.x*d,this.m_mass.ez.y=this.m_rA.x*p+this.m_rB.x*d,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=p+d,this.m_motorMass=p+d,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!f||(this.m_motorImpulse=0),this.m_enableLimit&&!f){const t=a-e-this.m_referenceAngle;Object(s.a)(this.m_upperAngle-this.m_lowerAngle)<2*o.g?this.m_limitState=n.d.e_equalLimits:t<=this.m_lowerAngle?(this.m_limitState!==n.d.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=n.d.e_atLowerLimit):t>=this.m_upperAngle?(this.m_limitState!==n.d.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=n.d.e_atUpperLimit):(this.m_limitState=n.d.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=n.d.e_inactiveLimit;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;const e=RevoluteJoint.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(_,e),r-=p*(s.p.CrossVV(this.m_rA,e)+this.m_motorImpulse+this.m_impulse.z),l.SelfMulAdd(u,e),h+=d*(s.p.CrossVV(this.m_rB,e)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=h}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const o=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const a=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,m=this.m_invIB,c=h+m===0;if(this.m_enableMotor&&this.m_limitState!==n.d.e_equalLimits&&!c){const e=r-i-this.m_motorSpeed;let o=-this.m_motorMass*e;const n=this.m_motorImpulse,a=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=Object(s.d)(this.m_motorImpulse+o,-a,a),i-=h*(o=this.m_motorImpulse-n),r+=m*o}if(this.m_enableLimit&&this.m_limitState!==n.d.e_inactiveLimit&&!c){const t=s.p.SubVV(s.p.AddVCrossSV(o,r,this.m_rB,s.p.s_t0),s.p.AddVCrossSV(e,i,this.m_rA,s.p.s_t1),RevoluteJoint.SolveVelocityConstraints_s_Cdot1),c=r-i,_=this.m_mass.Solve33(t.x,t.y,c,RevoluteJoint.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState===n.d.e_equalLimits)this.m_impulse.SelfAdd(_);else if(this.m_limitState===n.d.e_atLowerLimit){if(this.m_impulse.z+_.z<0){const e=-t.x+this.m_impulse.z*this.m_mass.ez.x,i=-t.y+this.m_impulse.z*this.m_mass.ez.y,s=this.m_mass.Solve22(e,i,RevoluteJoint.SolveVelocityConstraints_s_reduced_v2);_.x=s.x,_.y=s.y,_.z=-this.m_impulse.z,this.m_impulse.x+=s.x,this.m_impulse.y+=s.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(_)}else if(this.m_limitState===n.d.e_atUpperLimit){if(this.m_impulse.z+_.z>0){const e=-t.x+this.m_impulse.z*this.m_mass.ez.x,i=-t.y+this.m_impulse.z*this.m_mass.ez.y,s=this.m_mass.Solve22(e,i,RevoluteJoint.SolveVelocityConstraints_s_reduced_v2);_.x=s.x,_.y=s.y,_.z=-this.m_impulse.z,this.m_impulse.x+=s.x,this.m_impulse.y+=s.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(_)}const u=RevoluteJoint.SolveVelocityConstraints_s_P.Set(_.x,_.y);e.SelfMulSub(a,u),i-=h*(s.p.CrossVV(this.m_rA,u)+_.z),o.SelfMulAdd(l,u),r+=m*(s.p.CrossVV(this.m_rB,u)+_.z)}else{const t=s.p.SubVV(s.p.AddVCrossSV(o,r,this.m_rB,s.p.s_t0),s.p.AddVCrossSV(e,i,this.m_rA,s.p.s_t1),RevoluteJoint.SolveVelocityConstraints_s_Cdot_v2),n=this.m_mass.Solve22(-t.x,-t.y,RevoluteJoint.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=n.x,this.m_impulse.y+=n.y,e.SelfMulSub(a,n),i-=h*s.p.CrossVV(this.m_rA,n),o.SelfMulAdd(l,n),r+=m*s.p.CrossVV(this.m_rB,n)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const r=t.positions[this.m_indexB].c;let a=t.positions[this.m_indexB].a;const l=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(a);let m=0,c=0;const _=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&this.m_limitState!==n.d.e_inactiveLimit&&!_){const t=a-i-this.m_referenceAngle;let e=0;if(this.m_limitState===n.d.e_equalLimits){const i=Object(s.d)(t-this.m_lowerAngle,-o.o,o.o);e=-this.m_motorMass*i,m=Object(s.a)(i)}else if(this.m_limitState===n.d.e_atLowerLimit){let i=t-this.m_lowerAngle;m=-i,i=Object(s.d)(i+o.g,-o.o,0),e=-this.m_motorMass*i}else if(this.m_limitState===n.d.e_atUpperLimit){let i=t-this.m_upperAngle;m=i,i=Object(s.d)(i-o.g,0,o.o),e=-this.m_motorMass*i}i-=this.m_invIA*e,a+=this.m_invIB*e}{l.SetAngle(i),h.SetAngle(a),s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const t=s.k.MulRV(l,this.m_lalcA,this.m_rA);s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const o=s.k.MulRV(h,this.m_lalcB,this.m_rB),n=s.p.SubVV(s.p.AddVV(r,o,s.p.s_t0),s.p.AddVV(e,t,s.p.s_t1),RevoluteJoint.SolvePositionConstraints_s_C_v2);c=n.Length();const m=this.m_invMassA,_=this.m_invMassB,u=this.m_invIA,p=this.m_invIB,d=this.m_K;d.ex.x=m+_+u*t.y*t.y+p*o.y*o.y,d.ex.y=-u*t.x*t.y-p*o.x*o.y,d.ey.x=d.ex.y,d.ey.y=m+_+u*t.x*t.x+p*o.x*o.x;const f=d.Solve(n.x,n.y,RevoluteJoint.SolvePositionConstraints_s_impulse).SelfNeg();e.SelfMulSub(m,f),i-=u*s.p.CrossVV(t,f),r.SelfMulAdd(_,f),a+=p*s.p.CrossVV(o,f)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=a,c<=o.n&&m<=o.g}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}GetReactionTorque(t){return t*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}GetJointSpeed(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}GetMotorTorque(t){return t*this.m_motorImpulse}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorTorque(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}GetMaxMotorTorque(){return this.m_maxMotorTorque}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}GetLowerLimit(){return this.m_lowerAngle}GetUpperLimit(){return this.m_upperAngle}SetLimits(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)}SetMotorSpeed(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: RevoluteJointDef = new RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}RevoluteJoint.InitVelocityConstraints_s_P=new s.p,RevoluteJoint.SolveVelocityConstraints_s_P=new s.p,RevoluteJoint.SolveVelocityConstraints_s_Cdot_v2=new s.p,RevoluteJoint.SolveVelocityConstraints_s_Cdot1=new s.p,RevoluteJoint.SolveVelocityConstraints_s_impulse_v3=new s.q,RevoluteJoint.SolveVelocityConstraints_s_reduced_v2=new s.p,RevoluteJoint.SolveVelocityConstraints_s_impulse_v2=new s.p,RevoluteJoint.SolvePositionConstraints_s_C_v2=new s.p,RevoluteJoint.SolvePositionConstraints_s_impulse=new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return RopeJoint});var s=i(0),o=i(1),n=i(3);class RopeJoint extends n.a{constructor(t){super(t),this.m_localAnchorA=new s.p,this.m_localAnchorB=new s.p,this.m_maxLength=0,this.m_length=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new s.p,this.m_rA=new s.p,this.m_rB=new s.p,this.m_localCenterA=new s.p,this.m_localCenterB=new s.p,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_state=n.d.e_inactiveLimit,this.m_qA=new s.k,this.m_qB=new s.k,this.m_lalcA=new s.p,this.m_lalcB=new s.p,this.m_localAnchorA.Copy(Object(o.c)(t.localAnchorA,new s.p(-1,0))),this.m_localAnchorB.Copy(Object(o.c)(t.localAnchorB,new s.p(1,0))),this.m_maxLength=Object(o.c)(t.maxLength,0)}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v;let a=t.velocities[this.m_indexA].w;const l=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v;let c=t.velocities[this.m_indexB].w;const _=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(h);s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),s.k.MulRV(_,this.m_lalcA,this.m_rA),s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),s.k.MulRV(u,this.m_lalcB,this.m_rB),this.m_u.Copy(l).SelfAdd(this.m_rB).SelfSub(e).SelfSub(this.m_rA),this.m_length=this.m_u.Length();const p=this.m_length-this.m_maxLength;if(this.m_state=p>0?n.d.e_atUpperLimit:n.d.e_inactiveLimit,!(this.m_length>o.n))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);const d=s.p.CrossVV(this.m_rA,this.m_u),f=s.p.CrossVV(this.m_rB,this.m_u),y=this.m_invMassA+this.m_invIA*d*d+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!==y?1/y:0,t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const e=s.p.MulSV(this.m_impulse,this.m_u,RopeJoint.InitVelocityConstraints_s_P);r.SelfMulSub(this.m_invMassA,e),a-=this.m_invIA*s.p.CrossVV(this.m_rA,e),m.SelfMulAdd(this.m_invMassB,e),c+=this.m_invIB*s.p.CrossVV(this.m_rB,e)}else this.m_impulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=c}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const o=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=s.p.AddVCrossSV(e,i,this.m_rA,RopeJoint.SolveVelocityConstraints_s_vpA),a=s.p.AddVCrossSV(o,n,this.m_rB,RopeJoint.SolveVelocityConstraints_s_vpB),l=this.m_length-this.m_maxLength;let h=s.p.DotVV(this.m_u,s.p.SubVV(a,r,s.p.s_t0));l<0&&(h+=t.step.inv_dt*l);let m=-this.m_mass*h;const c=this.m_impulse;this.m_impulse=Object(s.i)(0,this.m_impulse+m),m=this.m_impulse-c;const _=s.p.MulSV(m,this.m_u,RopeJoint.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,_),i-=this.m_invIA*s.p.CrossVV(this.m_rA,_),o.SelfMulAdd(this.m_invMassB,_),n+=this.m_invIB*s.p.CrossVV(this.m_rB,_),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r);s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const h=s.k.MulRV(a,this.m_lalcA,this.m_rA);s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const m=s.k.MulRV(l,this.m_lalcB,this.m_rB),c=this.m_u.Copy(n).SelfAdd(m).SelfSub(e).SelfSub(h),_=c.Normalize();let u=_-this.m_maxLength;u=Object(s.d)(u,0,o.q);const p=-this.m_mass*u,d=s.p.MulSV(p,c,RopeJoint.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,d),i-=this.m_invIA*s.p.CrossVV(h,d),n.SelfMulAdd(this.m_invMassB,d),r+=this.m_invIB*s.p.CrossVV(m,d),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,_-this.m_maxLength<o.n}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return s.p.MulSV(t*this.m_impulse,this.m_u,e)}GetReactionTorque(t){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxLength(t){this.m_maxLength=t}GetMaxLength(){return this.m_maxLength}GetLimitState(){return this.m_state}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: RopeJointDef = new RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}RopeJoint.InitVelocityConstraints_s_P=new s.p,RopeJoint.SolveVelocityConstraints_s_vpA=new s.p,RopeJoint.SolveVelocityConstraints_s_vpB=new s.p,RopeJoint.SolveVelocityConstraints_s_P=new s.p,RopeJoint.SolvePositionConstraints_s_P=new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return WeldJoint});var s=i(0),o=i(1),n=i(3);class WeldJoint extends n.a{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_bias=0,this.m_localAnchorA=new s.p,this.m_localAnchorB=new s.p,this.m_referenceAngle=0,this.m_gamma=0,this.m_impulse=new s.q(0,0,0),this.m_indexA=0,this.m_indexB=0,this.m_rA=new s.p,this.m_rB=new s.p,this.m_localCenterA=new s.p,this.m_localCenterB=new s.p,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new s.g,this.m_qA=new s.k,this.m_qB=new s.k,this.m_lalcA=new s.p,this.m_lalcB=new s.p,this.m_K=new s.g,this.m_frequencyHz=Object(o.c)(t.frequencyHz,0),this.m_dampingRatio=Object(o.c)(t.dampingRatio,0),this.m_localAnchorA.Copy(Object(o.c)(t.localAnchorA,s.p.ZERO)),this.m_localAnchorB.Copy(Object(o.c)(t.localAnchorB,s.p.ZERO)),this.m_referenceAngle=Object(o.c)(t.referenceAngle,0),this.m_impulse.SetZero()}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let l=t.velocities[this.m_indexB].w;const h=this.m_qA.SetAngle(e),m=this.m_qB.SetAngle(r);s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),s.k.MulRV(h,this.m_lalcA,this.m_rA),s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),s.k.MulRV(m,this.m_lalcB,this.m_rB);const c=this.m_invMassA,_=this.m_invMassB,u=this.m_invIA,p=this.m_invIB,d=this.m_K;if(d.ex.x=c+_+this.m_rA.y*this.m_rA.y*u+this.m_rB.y*this.m_rB.y*p,d.ey.x=-this.m_rA.y*this.m_rA.x*u-this.m_rB.y*this.m_rB.x*p,d.ez.x=-this.m_rA.y*u-this.m_rB.y*p,d.ex.y=d.ey.x,d.ey.y=c+_+this.m_rA.x*this.m_rA.x*u+this.m_rB.x*this.m_rB.x*p,d.ez.y=this.m_rA.x*u+this.m_rB.x*p,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=u+p,this.m_frequencyHz>0){d.GetInverse22(this.m_mass);let i=u+p;const s=i>0?1/i:0,n=r-e-this.m_referenceAngle,a=2*o.F*this.m_frequencyHz,l=2*s*this.m_dampingRatio*a,h=s*a*a,m=t.step.dt;this.m_gamma=m*(l+m*h),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=n*m*h*this.m_gamma,i+=this.m_gamma,this.m_mass.ez.z=0!==i?1/i:0}else d.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);const e=WeldJoint.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(c,e),n-=u*(s.p.CrossVV(this.m_rA,e)+this.m_impulse.z),a.SelfMulAdd(_,e),l+=p*(s.p.CrossVV(this.m_rB,e)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const o=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,h=this.m_invIB;if(this.m_frequencyHz>0){const t=n-i,m=-this.m_mass.ez.z*(t+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=m,i-=l*m,n+=h*m;const c=s.p.SubVV(s.p.AddVCrossSV(o,n,this.m_rB,s.p.s_t0),s.p.AddVCrossSV(e,i,this.m_rA,s.p.s_t1),WeldJoint.SolveVelocityConstraints_s_Cdot1),_=s.g.MulM33XY(this.m_mass,c.x,c.y,WeldJoint.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=_.x,this.m_impulse.y+=_.y;const u=_;e.SelfMulSub(r,u),i-=l*s.p.CrossVV(this.m_rA,u),o.SelfMulAdd(a,u),n+=h*s.p.CrossVV(this.m_rB,u)}else{const t=s.p.SubVV(s.p.AddVCrossSV(o,n,this.m_rB,s.p.s_t0),s.p.AddVCrossSV(e,i,this.m_rA,s.p.s_t1),WeldJoint.SolveVelocityConstraints_s_Cdot1),m=n-i,c=s.g.MulM33XYZ(this.m_mass,t.x,t.y,m,WeldJoint.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(c);const _=WeldJoint.SolveVelocityConstraints_s_P.Set(c.x,c.y);e.SelfMulSub(r,_),i-=l*(s.p.CrossVV(this.m_rA,_)+c.z),o.SelfMulAdd(a,_),n+=h*(s.p.CrossVV(this.m_rB,_)+c.z)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r),h=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,_=this.m_invIB;s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const u=s.k.MulRV(a,this.m_lalcA,this.m_rA);s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const p=s.k.MulRV(l,this.m_lalcB,this.m_rB);let d,f;const y=this.m_K;if(y.ex.x=h+m+u.y*u.y*c+p.y*p.y*_,y.ey.x=-u.y*u.x*c-p.y*p.x*_,y.ez.x=-u.y*c-p.y*_,y.ex.y=y.ey.x,y.ey.y=h+m+u.x*u.x*c+p.x*p.x*_,y.ez.y=u.x*c+p.x*_,y.ex.z=y.ez.x,y.ey.z=y.ez.y,y.ez.z=c+_,this.m_frequencyHz>0){const t=s.p.SubVV(s.p.AddVV(n,p,s.p.s_t0),s.p.AddVV(e,u,s.p.s_t1),WeldJoint.SolvePositionConstraints_s_C1);d=t.Length(),f=0;const o=y.Solve22(t.x,t.y,WeldJoint.SolvePositionConstraints_s_P).SelfNeg();e.SelfMulSub(h,o),i-=c*s.p.CrossVV(u,o),n.SelfMulAdd(m,o),r+=_*s.p.CrossVV(p,o)}else{const t=s.p.SubVV(s.p.AddVV(n,p,s.p.s_t0),s.p.AddVV(e,u,s.p.s_t1),WeldJoint.SolvePositionConstraints_s_C1),o=r-i-this.m_referenceAngle;d=t.Length(),f=Object(s.a)(o);const a=y.Solve33(t.x,t.y,o,WeldJoint.SolvePositionConstraints_s_impulse).SelfNeg(),l=WeldJoint.SolvePositionConstraints_s_P.Set(a.x,a.y);e.SelfMulSub(h,l),i-=c*(s.p.CrossVV(this.m_rA,l)+a.z),n.SelfMulAdd(m,l),r+=_*(s.p.CrossVV(this.m_rB,l)+a.z)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,d<=o.n&&f<=o.g}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}GetReactionTorque(t){return t*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}SetFrequency(t){this.m_frequencyHz=t}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t}GetDampingRatio(){return this.m_dampingRatio}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: WeldJointDef = new WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}WeldJoint.InitVelocityConstraints_s_P=new s.p,WeldJoint.SolveVelocityConstraints_s_Cdot1=new s.p,WeldJoint.SolveVelocityConstraints_s_impulse1=new s.p,WeldJoint.SolveVelocityConstraints_s_impulse=new s.q,WeldJoint.SolveVelocityConstraints_s_P=new s.p,WeldJoint.SolvePositionConstraints_s_C1=new s.p,WeldJoint.SolvePositionConstraints_s_P=new s.p,WeldJoint.SolvePositionConstraints_s_impulse=new s.q},function(t,e,i){"use strict";i.d(e,"a",function(){return WheelJoint});var s=i(0),o=i(1),n=i(3);class WheelJoint extends n.a{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_localAnchorA=new s.p,this.m_localAnchorB=new s.p,this.m_localXAxisA=new s.p,this.m_localYAxisA=new s.p,this.m_impulse=0,this.m_motorImpulse=0,this.m_springImpulse=0,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableMotor=!1,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new s.p,this.m_localCenterB=new s.p,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_ax=new s.p,this.m_ay=new s.p,this.m_sAx=0,this.m_sBx=0,this.m_sAy=0,this.m_sBy=0,this.m_mass=0,this.m_motorMass=0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_qA=new s.k,this.m_qB=new s.k,this.m_lalcA=new s.p,this.m_lalcB=new s.p,this.m_rA=new s.p,this.m_rB=new s.p,this.m_frequencyHz=Object(o.c)(t.frequencyHz,2),this.m_dampingRatio=Object(o.c)(t.dampingRatio,.7),this.m_localAnchorA.Copy(Object(o.c)(t.localAnchorA,s.p.ZERO)),this.m_localAnchorB.Copy(Object(o.c)(t.localAnchorB,s.p.ZERO)),this.m_localXAxisA.Copy(Object(o.c)(t.localAxisA,s.p.UNITX)),s.p.CrossOneV(this.m_localXAxisA,this.m_localYAxisA),this.m_maxMotorTorque=Object(o.c)(t.maxMotorTorque,0),this.m_motorSpeed=Object(o.c)(t.motorSpeed,0),this.m_enableMotor=Object(o.c)(t.enableMotor,!1),this.m_ax.SetZero(),this.m_ay.SetZero()}GetMotorSpeed(){return this.m_motorSpeed}GetMaxMotorTorque(){return this.m_maxMotorTorque}SetSpringFrequencyHz(t){this.m_frequencyHz=t}GetSpringFrequencyHz(){return this.m_frequencyHz}SetSpringDampingRatio(t){this.m_dampingRatio=t}GetSpringDampingRatio(){return this.m_dampingRatio}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,r=this.m_invIB,a=t.positions[this.m_indexA].c,l=t.positions[this.m_indexA].a,h=t.velocities[this.m_indexA].v;let m=t.velocities[this.m_indexA].w;const c=t.positions[this.m_indexB].c,_=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v;let p=t.velocities[this.m_indexB].w;const d=this.m_qA.SetAngle(l),f=this.m_qB.SetAngle(_);s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const y=s.k.MulRV(d,this.m_lalcA,this.m_rA);s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const S=s.k.MulRV(f,this.m_lalcB,this.m_rB),x=s.p.SubVV(s.p.AddVV(c,S,s.p.s_t0),s.p.AddVV(a,y,s.p.s_t1),WheelJoint.InitVelocityConstraints_s_d);if(s.k.MulRV(d,this.m_localYAxisA,this.m_ay),this.m_sAy=s.p.CrossVV(s.p.AddVV(x,y,s.p.s_t0),this.m_ay),this.m_sBy=s.p.CrossVV(S,this.m_ay),this.m_mass=e+i+n*this.m_sAy*this.m_sAy+r*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){s.k.MulRV(d,this.m_localXAxisA,this.m_ax),this.m_sAx=s.p.CrossVV(s.p.AddVV(x,y,s.p.s_t0),this.m_ax),this.m_sBx=s.p.CrossVV(S,this.m_ax);const a=e+i+n*this.m_sAx*this.m_sAx+r*this.m_sBx*this.m_sBx;if(a>0){this.m_springMass=1/a;const e=s.p.DotVV(x,this.m_ax),i=2*o.F*this.m_frequencyHz,n=2*this.m_springMass*this.m_dampingRatio*i,r=this.m_springMass*i*i,l=t.step.dt;this.m_gamma=l*(n+l*r),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=e*l*r*this.m_gamma,this.m_springMass=a+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+r,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;const e=s.p.AddVV(s.p.MulSV(this.m_impulse,this.m_ay,s.p.s_t0),s.p.MulSV(this.m_springImpulse,this.m_ax,s.p.s_t1),WheelJoint.InitVelocityConstraints_s_P),i=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,o=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;h.SelfMulSub(this.m_invMassA,e),m-=this.m_invIA*i,u.SelfMulAdd(this.m_invMassB,e),p+=this.m_invIB*o}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=m,t.velocities[this.m_indexB].w=p}SolveVelocityConstraints(t){const e=this.m_invMassA,i=this.m_invMassB,o=this.m_invIA,n=this.m_invIB,r=t.velocities[this.m_indexA].v;let a=t.velocities[this.m_indexA].w;const l=t.velocities[this.m_indexB].v;let h=t.velocities[this.m_indexB].w;{const t=s.p.DotVV(this.m_ax,s.p.SubVV(l,r,s.p.s_t0))+this.m_sBx*h-this.m_sAx*a,m=-this.m_springMass*(t+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=m;const c=s.p.MulSV(m,this.m_ax,WheelJoint.SolveVelocityConstraints_s_P),_=m*this.m_sAx,u=m*this.m_sBx;r.SelfMulSub(e,c),a-=o*_,l.SelfMulAdd(i,c),h+=n*u}{const e=h-a-this.m_motorSpeed;let i=-this.m_motorMass*e;const r=this.m_motorImpulse,l=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=Object(s.d)(this.m_motorImpulse+i,-l,l),a-=o*(i=this.m_motorImpulse-r),h+=n*i}{const t=s.p.DotVV(this.m_ay,s.p.SubVV(l,r,s.p.s_t0))+this.m_sBy*h-this.m_sAy*a,m=-this.m_mass*t;this.m_impulse+=m;const c=s.p.MulSV(m,this.m_ay,WheelJoint.SolveVelocityConstraints_s_P),_=m*this.m_sAy,u=m*this.m_sBy;r.SelfMulSub(e,c),a-=o*_,l.SelfMulAdd(i,c),h+=n*u}t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=h}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r);s.p.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const h=s.k.MulRV(a,this.m_lalcA,this.m_rA);s.p.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const m=s.k.MulRV(l,this.m_lalcB,this.m_rB),c=s.p.AddVV(s.p.SubVV(n,e,s.p.s_t0),s.p.SubVV(m,h,s.p.s_t1),WheelJoint.SolvePositionConstraints_s_d),_=s.k.MulRV(a,this.m_localYAxisA,this.m_ay),u=s.p.CrossVV(s.p.AddVV(c,h,s.p.s_t0),_),p=s.p.CrossVV(m,_),d=s.p.DotVV(c,this.m_ay),f=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,y=0!==f?-d/f:0,S=s.p.MulSV(y,_,WheelJoint.SolvePositionConstraints_s_P),x=y*u,C=y*p;return e.SelfMulSub(this.m_invMassA,S),i-=this.m_invIA*x,n.SelfMulAdd(this.m_invMassB,S),r+=this.m_invIB*C,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,Object(s.a)(d)<=o.n}GetDefinition(t){return t}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e}GetReactionTorque(t){return t*this.m_motorImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetJointTranslation(){return this.GetPrismaticJointTranslation()}GetJointLinearSpeed(){return this.GetPrismaticJointSpeed()}GetJointAngle(){return this.GetRevoluteJointAngle()}GetJointAngularSpeed(){return this.GetRevoluteJointSpeed()}GetPrismaticJointTranslation(){const t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new s.p),o=e.GetWorldPoint(this.m_localAnchorB,new s.p),n=s.p.SubVV(o,i,new s.p),r=t.GetWorldVector(this.m_localXAxisA,new s.p);return s.p.DotVV(n,r)}GetPrismaticJointSpeed(){const t=this.m_bodyA,e=this.m_bodyB;s.p.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);const i=s.k.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);s.p.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);const o=s.k.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=s.p.AddVV(t.m_sweep.c,i,s.p.s_t0),r=s.p.AddVV(e.m_sweep.c,o,s.p.s_t1),a=s.p.SubVV(r,n,s.p.s_t2),l=t.GetWorldVector(this.m_localXAxisA,new s.p),h=t.m_linearVelocity,m=e.m_linearVelocity,c=t.m_angularVelocity,_=e.m_angularVelocity;return s.p.DotVV(a,s.p.CrossSV(c,l,s.p.s_t0))+s.p.DotVV(l,s.p.SubVV(s.p.AddVCrossSV(m,_,o,s.p.s_t0),s.p.AddVCrossSV(h,c,i,s.p.s_t1),s.p.s_t0))}GetRevoluteJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}GetRevoluteJointSpeed(){const t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}SetMotorSpeed(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}SetMaxMotorTorque(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}GetMotorTorque(t){return t*this.m_motorImpulse}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: WheelJointDef = new WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}WheelJoint.InitVelocityConstraints_s_d=new s.p,WheelJoint.InitVelocityConstraints_s_P=new s.p,WheelJoint.SolveVelocityConstraints_s_P=new s.p,WheelJoint.SolvePositionConstraints_s_d=new s.p,WheelJoint.SolvePositionConstraints_s_P=new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return CharacterMesh});var s=i(2),o=i(123),n=i(17),r=i(23);class CharacterMesh extends s.Mesh{constructor(t,e){super(Object(r.a)(t,e,t,.001),n.a.keyboardPlasticKey);const i=t-.004,a=new s.SphereBufferGeometry(.0045,16,8),l=a.attributes.position.array;for(let t=1;t<l.length;t+=3)l[t]<0&&(l[t]=0);const h=new s.Mesh(a,n.a.keyboardPlasticKeyUnderside);h.receiveShadow=!0,h.renderOrder=13,h.position.y=.5*-e-1e-4,h.rotation.y=2*Math.PI/32,this.add(h),Object(o.a)(h);const m=Object(r.a)(t,.005,i-.001,5e-4);new s.Mesh(m,n.a.keyboardPlasticKeyMouth).renderOrder=11,this.castShadow=!0,this.receiveShadow=!0}}},function(t,e,i){"use strict";i.d(e,"a",function(){return CharacterPhysics});var s=i(39),o=i(9),n=i(18),r=i(7),a=i(29),l=i(8);const h=new class ContactPair{set(t,e){return this.characterPart=t,this.level=e,this}};function getContactBetweenLegZoneAndLevel(t){const e=t.GetFixtureA(),i=t.GetFixtureB();if(e.m_isSensor!==i.m_isSensor)return e.m_isSensor?h.set(e,i):h.set(i,e)}class CharacterContactListener extends l.d{constructor(t){super(),this.contactPairs=new Map,this.world=t}BeginContact(t){const e=getContactBetweenLegZoneAndLevel(t);e&&Object(n.b)(this.contactPairs,e.characterPart,e.level)}EndContact(t){const e=getContactBetweenLegZoneAndLevel(t);e&&e&&Object(n.a)(this.contactPairs,e.characterPart,e.level)}}const m=.2,c=Math.PI*-m,_=Math.PI*m,u=.45;class CharacterPhysics{constructor(t){this.autoJump=!1,this.autoThrash=!1,this.jump=!1,this.jumpEnergy=0,this.recoil=0,this.tucked=!1,this.autoJumpCooldown=3,this.autoThrashCooldown=.5,this.onKeyCodeEvent=(t,e)=>{"Space"===t&&(this.bellyFixture.m_userData.enabled=!e,this.tucked=e,e||(this.jump=!0),e?this.setTorsoShape(.01,.005,0,-.002):this.recoil=1)},CharacterPhysics.initContactListener(t);const e=new l.h(.008,.007),i=new l.h(0,.002),n=Object(a.a)(t,i.x,i.y,e.x,e.y,!1,1.5,1.5);n.m_linearDamping=1,this.torsoFixture=n.m_fixtureList,this.torsoShape=this.torsoFixture.m_shape;const r=new l.e,h=new l.c(.0025*o.a);h.m_p.Set(0,-.015*o.a),r.shape=h,r.isSensor=!0,r.userData={type:"legs"},this.legsFixture=n.CreateFixture(r);const m=new l.c(.0025*o.a);m.m_p.Set(0,-.008*o.a),r.shape=m,r.userData={type:"belly",enabled:!0},this.bellyFixture=n.CreateFixture(r);const c=new l.c(.0085*o.a);c.m_p.Set(0,.003*o.a),r.shape=c,r.userData={type:"arms"},this.armsFixture=n.CreateFixture(r),n.SetAngularDamping(5),this.body=n,this.bodySize=e.Clone(),this.bodyOffset=i.Clone(),this.defaultBodySize=e,this.defaultBodyOffset=i,this.characterContacts=CharacterPhysics.contactListener.contactPairs,(new s.a).addListener(this.onKeyCodeEvent)}static initContactListener(t){if(!CharacterPhysics.contactListener){const e=new CharacterContactListener(t);t.SetContactListener(e),CharacterPhysics.contactListener=e}}setTorsoShape(t,e,i,s){this.bodySize.Set(t,e),this.bodyOffset.Set(i,s),this.torsoShape.SetAsBox(.5*t*o.a,.5*e*o.a,new l.h(i*o.a,s*o.a))}update(t){if(this.tucked)this.jumpEnergy+=t;else if(this.recoil>0){this.recoil-=3*t,this.recoil<0&&(this.recoil=0);const e=Object(r.d)(.008,.006,this.recoil),i=Object(r.d)(.007,.009,this.recoil);this.setTorsoShape(e,i,0,Object(r.d)(0,.002,this.recoil))}const e=this.body;this.autoJumpCooldown-=t,this.autoThrashCooldown-=t;const i=e.GetLinearVelocity();if(this.characterContacts.size>0){const t=Object(r.e)(e.GetAngle(),0),s=Math.abs(t)<m;if(this.characterContacts.has(this.legsFixture)&&s){const t=i.x<0?.6*i.x:i.x;i.y<0&&e.SetLinearVelocity(new l.h(t,0)),e.ApplyForceToCenter(new l.h(.025,0))}if(!this.tucked&&this.characterContacts.has(this.bellyFixture)&&e.ApplyLinearImpulseToCenter(new l.h(0,.0015),!0),Math.abs(t)>u&&(this.autoThrash&&this.autoThrashCooldown<=0||this.jump)&&this.characterContacts.has(this.armsFixture)&&(this.jump=!1,this.jumpEnergy=0,this.autoThrashCooldown=.5,e.ApplyLinearImpulseToCenter(new l.h(0,Object(r.b)(.05*this.jumpEnergy+.002,0,.01)),!0),t<0?e.ApplyAngularImpulse(1e-4):t>0&&e.ApplyAngularImpulse(-1e-4)),(this.autoJump&&this.autoJumpCooldown<=0||this.jump)&&this.characterContacts.has(this.legsFixture)){this.autoJumpCooldown=2;const t=e.GetLinearVelocity();e.SetLinearVelocity(new l.h(t.x,100*Object(r.b)(.1*this.jumpEnergy+.01,0,.04))),this.jumpEnergy=0}}this.jump=!1;const s=Object(r.e)(e.GetAngle(),0);s<c?e.ApplyAngularImpulse(1e-5):s>_&&e.ApplyAngularImpulse(-1e-5),e.GetPosition().y<-3&&(e.SetLinearVelocity(new l.h(0,0)),e.SetPositionXY(0*o.a,.05*o.a),this.autoThrashCooldown=.5,this.autoJumpCooldown=3)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return hexColor});var s=i(2);i(7);new s.Color(1,1,1),new s.Color;function hexColor(t){const e=/^\#([A-Fa-f0-9]+)$/.exec(t);if(e){const t=e[1],i=t.length;if(3===i){const e=new s.Color;return e.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,e.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,e.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,e}if(6===i){const e=new s.Color;return e.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,e.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,e.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,e}}return new s.Color(1,0,1)}},function(t,e,i){"use strict";i.d(e,"a",function(){return TestGraphicsLevelScene});var s=i(2),o=i(39),n=i(17),r=i(81),a=i(82),l=i(9),h=i(23),m=i(13),c=i(29),_=i(8),u=i(83),p=i(30);class TestGraphicsLevelScene extends p.a{constructor(t="test-layout"){super(!1,!1);const e=new _.i(new _.h(0,-9.8));if(this.myB2World=e,Object(m.b)("debugPhysics")){const t=new r.a(e);this.b2Preview=t,this.scene.add(t)}new a.a(Object(m.e)("level")||t,(t,i,o,r)=>{Object(c.b)(e,t,i,o,r);const a=.5*(o+r)*l.b;i+r>=32&&(r+=100);const m=new s.Mesh(Object(h.a)(o*l.b,r*l.b,a,.001),n.a.levelMaterial);m.receiveShadow=!0,m.castShadow=!0,m.position.set((t-.5*o)*l.b-.2,.2-(i+.5*r)*l.b,0),this.scene.add(m)},()=>{const t=new u.a,e=new o.a;e.addListener(t.onKeyCodeEvent),t.position.set(-0,.162,-.1),this.scene.add(t),this.keyboardInput=e,this.keyboardMesh=t})}update(t){super.update(t),this.myB2World.Step(t,10,4),this.b2Preview&&this.b2Preview.update(t)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return Box2DPreviewMesh});var s=i(2),o=i(10),n=i(126),r=i(13),a=i(7),l=i(8);const h=1,m=16,c=(new s.Matrix4).compose(new s.Vector3(.5,.5,.5),new s.Quaternion,new s.Vector3(.5,.5,.5)),_=new s.Quaternion,u=new s.Vector3(.5,.5,.5),p=Object(r.b)("debugPhysicsPolygon");class DebugColors{constructor(){this.fixtureColors=new Map,this.bodyMatrices=new Map}getFixtureColor(t){if(!this.fixtureColors.has(t)){const e=new s.Vector3(Object(a.g)(),Object(a.g)(),Object(a.g)()).applyMatrix4(this.getBodyMatrix(t.m_body)).applyMatrix4(c);return this.fixtureColors.set(t,e),e}return this.fixtureColors.get(t)}getBodyMatrix(t){if(!this.bodyMatrices.has(t)){const e=(new s.Matrix4).compose(new s.Vector3(Object(a.g)(),Object(a.g)(),Object(a.g)()),_,u);return this.bodyMatrices.set(t,e),e}return this.bodyMatrices.get(t)}}function getShapeWorldVerts(t,e){switch(t.m_type){case l.g.e_polygonShape:return p?function getPolygonShapeWorldVerts(t,e){return t.m_vertices.map(t=>{const i=new l.h;return e.GetWorldPoint(t,i),i.x/=o.a.aspect,i})}(t,e):void 0;case l.g.e_circleShape:return function getCircleShapeWorldVerts(t,e){const i=[],s=t.m_radius,n=t.m_p;for(let t=0;t<m;t++){const r=t/m*Math.PI*2,a=new l.h(Math.cos(r)*s,Math.sin(r)*s).SelfAdd(n),h=new l.h;e.GetWorldPoint(a,h),h.x/=o.a.aspect,i.push(h)}return i}(t,e);default:return void console.error("unsupported box2d shape type for debug view")}}function getShapeWorldVertsCount(t){switch(t.m_type){case l.g.e_polygonShape:return p?t.m_vertices.length:0;case l.g.e_circleShape:return m;default:return 0}}function createGeometry(t,e,i){let o=0,n=t.m_bodyList;for(;n;){let t=n.m_fixtureList;for(;t;)o+=getShapeWorldVertsCount(t.m_shape)+3,t=t.m_next;n=n.m_next}const r=new s.BufferGeometry;r.boundingSphere=new s.Sphere(void 0,1/0);const a=new Float32Array(2*o),l=new Float32Array(4*o);let m=0,c=0;function writeVert(t,e,i=1){a[m]=t.x,a[m+1]=t.y,m+=2,e.toArray(l,c),l[c+3]=i,c+=4}for(n=t.m_bodyList;n;){let t=n.m_fixtureList;for(;t;){const s=getShapeWorldVerts(t.m_shape,n);if(s){if(0!==i.x||0!==i.y)for(const t of s)t.SelfSub(i);if(1!==h)for(const t of s)t.SelfMul(h);const o=e.getFixtureColor(t),n=s[0];writeVert(n,o,0);for(const t of s)writeVert(t,o,1);writeVert(n,o,1),writeVert(n,o,0)}t=t.m_next}n=n.m_next}return r.addAttribute("position",new s.Float32BufferAttribute(a,2)),r.addAttribute("color",new s.Float32BufferAttribute(l,4)),r}class Box2DPreviewMesh extends s.Line{constructor(t){const e=new DebugColors,i=new l.h;super(createGeometry(t,e,i),new n.a,s.LineStrip),this.debugColors=e,this.myB2World=t,this.offset=i,this.renderOrder=1e5}update(t){this.geometry.dispose(),this.geometry=createGeometry(this.myB2World,this.debugColors,this.offset)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return PNGLevel});class BlocksRecipes{constructor(){this.blocks=new Map}register(t,e,i,s){this.blocks.has(t)||this.blocks.set(t,new Map);const o=this.blocks.get(t);o.has(i)||o.set(i,new Map);const n=o.get(i);let r=!1;for(const[t,i]of n.entries())t+i===e&&(n.set(t,i+1),r=!0);r||n.set(e,s)}process(t){this.blocks.forEach((e,i)=>{e.forEach((e,s)=>{e.forEach((e,o)=>{t(i,o,s,e)})})})}}class PNGLevel{constructor(t,e,i,s){const o=new Image;o.crossOrigin="Anonymous",o.onload=t=>{const s=new BlocksRecipes,n=document.createElement("canvas"),r=o.width,a=o.height;n.width=r,n.height=a;const l=n.getContext("2d");l.drawImage(o,0,0,r,a);const h=l.getImageData(0,0,n.width,n.height).data;let m=0;for(let t=0;t<h.length;t++){let e=!1;if(h[4*t+3]>128?m++:e=!0,(t+1)%r==0&&(e=!0),e&&m>0){const e=t%r,i=Math.floor(t/r);s.register(e,i,m,1),m=0}}s.process(e),i()},o.onerror=t=>{console.error("image not found: "+t)},o.src=`game/levels/${t}.png`}}},function(t,e,i){"use strict";i.d(e,"a",function(){return ProceduralKeyboardMesh});var s=i(2),o=i(17),n=i(23),r=i(129),a=i(130);const l=.015;class KeyInfo{constructor(t,e,i){this.label=t,this.width=e,this.eventCode=i,this.width*=l}}class KeySpace extends KeyInfo{constructor(t){super("",t,void 0)}}const h=[[new KeyInfo("ESC",1,"Escape"),new KeySpace(2),new KeyInfo("F1",1,"F1"),new KeyInfo("F2",1,"F2"),new KeyInfo("F3",1,"F3"),new KeyInfo("F4",1,"F4"),new KeyInfo("F5",1,"F5"),new KeyInfo("F6",1,"F6"),new KeyInfo("F7",1,"F7"),new KeyInfo("F8",1,"F8"),new KeyInfo("F9",1,"F9"),new KeyInfo("F10",1,"F10"),new KeyInfo("F11",1,"F11"),new KeyInfo("F12",1,"F12"),new KeySpace(.5),new KeyInfo("PRNT SCRN",1,"F13"),new KeyInfo("SCR LK",1,"F14"),new KeyInfo("PAUSE",1,"F15")],[new KeyInfo("~",1,"Backquote"),new KeyInfo("!\n1",1,"Digit1"),new KeyInfo("@\n2",1,"Digit2"),new KeyInfo("#\n3",1,"Digit3"),new KeyInfo("$\n4",1,"Digit4"),new KeyInfo("%\n5",1,"Digit5"),new KeyInfo("^\n6",1,"Digit6"),new KeyInfo("&\n7",1,"Digit7"),new KeyInfo("*\n8",1,"Digit8"),new KeyInfo("(\n9",1,"Digit9"),new KeyInfo(")\n0",1,"Digit0"),new KeyInfo("_\n-",1,"Minus"),new KeyInfo("+\n=",1,"Equal"),new KeyInfo("BACKSPACE",2,"Backspace"),new KeySpace(.5),new KeyInfo("INS",1,"Insert"),new KeyInfo("HOME",1,"Home"),new KeyInfo("PAGE UP",1,"PageUp")],[new KeyInfo("TAB",1.55,"Tab"),new KeyInfo("Q",1,"KeyQ"),new KeyInfo("W",1,"KeyW"),new KeyInfo("E",1,"KeyE"),new KeyInfo("R",1,"KeyR"),new KeyInfo("T",1,"KeyT"),new KeyInfo("Y",1,"KeyY"),new KeyInfo("U",1,"KeyU"),new KeyInfo("I",1,"KeyI"),new KeyInfo("O",1,"KeyO"),new KeyInfo("P",1,"KeyP"),new KeyInfo("{\n[",1,"BracketLeft"),new KeyInfo("}\n]",1,"BracketRight"),new KeyInfo("|\n\\",1.45,"Backslash"),new KeySpace(.5),new KeyInfo("DEL",1,"Delete"),new KeyInfo("END",1,"End"),new KeyInfo("PAGE DOWN",1,"PageDown")],[new KeyInfo("CAPS LCK",1.9,"CapsLock"),new KeyInfo("A",1,"KeyA"),new KeyInfo("S",1,"KeyS"),new KeyInfo("D",1,"KeyD"),new KeyInfo("F",1,"KeyF"),new KeyInfo("G",1,"KeyG"),new KeyInfo("H",1,"KeyH"),new KeyInfo("J",1,"KeyJ"),new KeyInfo("K",1,"KeyK"),new KeyInfo("L",1,"KeyL"),new KeyInfo(":\n;",1,"Semicolon"),new KeyInfo("\"\n'",1,"Quote"),new KeyInfo("ENTER",2.25,"Enter")],[new KeyInfo("",2.65,"ShiftLeft"),new KeyInfo("Z",1,"KeyZ"),new KeyInfo("X",1,"KeyX"),new KeyInfo("C",1,"KeyC"),new KeyInfo("V",1,"KeyV"),new KeyInfo("B",1,"KeyB"),new KeyInfo("N",1,"KeyN"),new KeyInfo("M",1,"KeyM"),new KeyInfo("<\n,",1,"Comma"),new KeyInfo(">\n.",1,"Period"),new KeyInfo("?\n/",1,"Slash"),new KeyInfo("",2.65,"ShiftRight"),new KeySpace(.5),new KeySpace(1),new KeyInfo("",1,"ArrowUp")],[new KeyInfo("CTRL",1.5,"ControlLeft"),new KeyInfo("FN",1,void 0),new KeyInfo("CMD",1.5,"MetaLeft"),new KeyInfo("ALT",1.5,"AltLeft"),new KeyInfo(" ",5.9,"Space"),new KeyInfo("ALT",1.5,"AltRight"),new KeyInfo("MENU",1.5,"ContextMenu"),new KeyInfo("CTRL",1.5,"ControlRight"),new KeySpace(.5),new KeyInfo("",1,"ArrowLeft"),new KeyInfo("",1,"ArrowDown"),new KeyInfo("",1,"ArrowRight")]],m=.34,c=.015,_=.13;class ProceduralKeyboardMesh extends s.Mesh{constructor(){super(Object(n.b)(m,c,_),o.a.keyboardPlastic),this.onKeyCodeEvent=(t,e)=>{this.buttonsByEventCode.has(t)&&(this.buttonsByEventCode.get(t).position.y=e?c-.012:c-.0075)},this.castShadow=!0,this.receiveShadow=!0,this.renderOrder=-2;const t=new Map,e=.15*l;let i=.5*-_+.01,s=0;for(const o of h){1===s&&(i+=.5*(l+e)),s++,i+=.5*(l+e);let n=.5*-m+.01;for(const s of o){if(n+=.5*(s.width+e),""!==s.label){const e=new r.a(s.width+.004,.012,l+.004,.001);this.add(e),e.position.set(n,c-.005,i);const o=new a.a(s.width,.01,l,s.label,.0015);void 0===s.eventCode||t.has(s.eventCode)||t.set(s.eventCode,o),this.add(o),o.position.set(n,c-.0075,i)}n+=.5*(s.width+e)}i+=.5*(l+e)}this.buttonsByEventCode=t,this.position.y+=c}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});const s=1/.0254*72},function(t,e,i){"use strict";i.d(e,"a",function(){return nextFrameUpdate}),i.d(e,"b",function(){return onNextFrame});const s=[];function nextFrameUpdate(){s.length>0&&(s.forEach(t=>t()),s.length=0)}function onNextFrame(t){s.push(t)}},function(t,e,i){"use strict";i.d(e,"a",function(){return FPSControls});var s=i(2),o=i(136),n=i.n(o),r=i(55),a=i(41),l=i(13),h=i(7),m=i(87);const c=Object(l.c)("camDamping",0,0,.999),_=1-Object(h.b)(c,0,1);class FPSControls{constructor(t){this._camera=t,this._active=!1,this._fpsController=void 0}toggle(t){void 0===t&&(t=!this._active),this._fpsController||(this._cameraLocal=new s.PerspectiveCamera,function copyCam(t,e){t.position.copy(e.position),t.scale.copy(e.scale),t.quaternion.copy(e.quaternion),t.fov=e.fov}(this._cameraLocal,this._camera),this._camera.parent.add(this._cameraLocal),this._fpsController=new n.a(this._cameraLocal,r.a.domElement,{movementSpeed:.01}),m.a.register(this));const e=this._fpsController.onPointerLockAttainSignal,i=e._bindings[0]._listener;e._bindings[0]._listener=()=>{this._active&&i()},t||this._fpsController.onPointerLockReleaseSignal.dispatch(),this._active=t}update(){this._active&&this._fpsController&&(this._fpsController.update(),this._camera.position.lerp(this._cameraLocal.position,_),this._camera.quaternion.slerp(this._cameraLocal.quaternion,_),this._camera.scale.lerp(this._cameraLocal.scale,_),this._camera.fov=Object(h.d)(this._camera.fov,this._cameraLocal.fov,_),a.a.updateProjection())}}new FPSControls(a.a.camera)},function(t,e,i){"use strict";var s=i(18);const o=[],n={update:t=>{for(const e of o)e.update(t)},register:t=>{o.push(t)},unregister:t=>{Object(s.c)(o,t)}};e.a=n},function(t,e,i){"use strict";i.d(e,"a",function(){return TestPhysicsScene});var s=i(81),o=i(9),n=i(7),r=i(29),a=i(8),l=i(40);class TestPhysicsScene extends l.a{constructor(t=!0,e=20){super(),this.circleBodies=[];const i=new a.i(new a.h(0,-9.8)),o=new s.a(i);this.scene.add(o),this.myB2World=i,this.b2Preview=o;for(let t=0;t<e;t++){const t=Object(r.c)(this.myB2World,Object(n.f)(-.1,.1),.1+Object(n.f)(-.02,.02),.005);this.circleBodies.push(t)}t&&Object(r.a)(this.myB2World,0,0,.1,.1,!0)}update(t){super.update(t),this.myB2World.Step(t,10,4),this.b2Preview.update(t);for(const t of this.circleBodies){t.GetPosition().y<-1&&(t.SetLinearVelocity(new a.h(0,0)),t.SetPositionXY(Object(n.f)(-.1,.1)*o.a,(.1+Object(n.f)(-.02,.02))*o.a))}}render(t,e){super.render(t,e)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return TestPhysicsPNGScene});var s=i(82),o=i(13),n=i(29),r=i(88);class TestPhysicsPNGScene extends r.a{constructor(t="test",e=20,i){super(!1,e),new s.a(Object(o.e)("level")||t,n.b.bind(this,this.myB2World),i)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o}),i.d(e,"b",function(){return n});var s=i(2);const o=new s.Color(0),n=new s.Color(16777215);new s.Color(6750054),new s.Color(2273279),new s.Color(6750054),new s.Color(16711680),new s.Color(16050242)},,,function(t,e,i){"use strict";function getHorizontalBias(t){switch(t){case"left":return 0;case"center":return-.5;case"right":return-1;default:return 0}}function getVerticalBias(t){switch(t){case"top":return 1;case"center":return.5;case"bottom":default:return 0}}i.d(e,"a",function(){return getHorizontalBias}),i.d(e,"b",function(){return getVerticalBias})},function(t,e,i){"use strict";i.d(e,"a",function(){return loadJson}),i.d(e,"b",function(){return loadTexture});var s=i(2);const o=new s.LoadingManager;let n,r;async function loadJson(t){return new Promise((e,i)=>(function getFileLoader(){return n||(n=new s.FileLoader(o)),n})().load(t,t=>e(JSON.parse(t)),void 0,i))}const a=new Map;async function loadTexture(t,e){let i;return i=a.has(t)?new Promise((e,i)=>{a.get(t).push(e)}):new Promise((i,n)=>{a.set(t,[i]);(function getTextureLoader(){return r||(r=new s.TextureLoader(o)),r})().load(t,i=>{i.name=t,void 0!==e&&(i.flipY=e),a.get(t).forEach(t=>t(i)),a.delete(t)},void 0,n)})}},function(t,e,i){"use strict"},function(t,e,i){"use strict"},function(t,e,i){"use strict";i.d(e,"a",function(){return CircleShape});var s=i(0),o=i(1),n=i(6);class CircleShape extends n.b{constructor(t=0){super(n.c.e_circleShape,t),this.m_p=new s.p}Set(t,e=this.m_radius){return this.m_p.Copy(t),this.m_radius=e,this}Clone(){return(new CircleShape).Copy(this)}Copy(t){return super.Copy(t),this.m_p.Copy(t.m_p),this}GetChildCount(){return 1}TestPoint(t,e){const i=s.o.MulXV(t,this.m_p,CircleShape.TestPoint_s_center),o=s.p.SubVV(e,i,CircleShape.TestPoint_s_d);return s.p.DotVV(o,o)<=Object(s.l)(this.m_radius)}ComputeDistance(t,e,i,o){const n=s.o.MulXV(t,this.m_p,CircleShape.ComputeDistance_s_center);return s.p.SubVV(e,n,i),i.Normalize()-this.m_radius}RayCast(t,e,i,n){const r=s.o.MulXV(i,this.m_p,CircleShape.RayCast_s_position),a=s.p.SubVV(e.p1,r,CircleShape.RayCast_s_s),l=s.p.DotVV(a,a)-Object(s.l)(this.m_radius),h=s.p.SubVV(e.p2,e.p1,CircleShape.RayCast_s_r),m=s.p.DotVV(a,h),c=s.p.DotVV(h,h),_=m*m-c*l;if(_<0||c<o.j)return!1;let u=-(m+Object(s.m)(_));return 0<=u&&u<=e.maxFraction*c&&(u/=c,t.fraction=u,s.p.AddVMulSV(a,u,h,t.normal).SelfNormalize(),!0)}ComputeAABB(t,e,i){const o=s.o.MulXV(e,this.m_p,CircleShape.ComputeAABB_s_p);t.lowerBound.Set(o.x-this.m_radius,o.y-this.m_radius),t.upperBound.Set(o.x+this.m_radius,o.y+this.m_radius)}ComputeMass(t,e){const i=Object(s.l)(this.m_radius);t.mass=e*o.F*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+s.p.DotVV(this.m_p,this.m_p))}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,n){const r=s.o.MulXV(i,this.m_p,new s.p),a=-(s.p.DotVV(t,r)-e);if(a<-this.m_radius+o.j)return 0;if(a>this.m_radius)return n.Copy(r),o.F*this.m_radius*this.m_radius;const l=this.m_radius*this.m_radius,h=a*a,m=l*(Object(s.b)(a/this.m_radius)+o.F/2)+a*Object(s.m)(l-h),c=-2/3*Object(s.j)(l-h,1.5)/m;return n.x=r.x+t.x*c,n.y=r.y+t.y*c,m}Dump(t){t("    const shape: CircleShape = new CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)}}CircleShape.TestPoint_s_center=new s.p,CircleShape.TestPoint_s_d=new s.p,CircleShape.ComputeDistance_s_center=new s.p,CircleShape.RayCast_s_position=new s.p,CircleShape.RayCast_s_s=new s.p,CircleShape.RayCast_s_r=new s.p,CircleShape.ComputeAABB_s_p=new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return PolygonShape});var s=i(0),o=i(1),n=i(6);class PolygonShape extends n.b{constructor(){super(n.c.e_polygonShape,o.G),this.m_centroid=new s.p(0,0),this.m_vertices=[],this.m_normals=[],this.m_count=0}static ComputeCentroid(t,e,i){const o=i;o.SetZero();let n=0;const r=PolygonShape.ComputeCentroid_s_pRef.SetZero();for(let i=0;i<e;++i){const a=r,l=t[i],h=t[(i+1)%e],m=s.p.SubVV(l,a,PolygonShape.ComputeCentroid_s_e1),c=s.p.SubVV(h,a,PolygonShape.ComputeCentroid_s_e2),_=.5*s.p.CrossVV(m,c);n+=_,o.x+=_*(1/3)*(a.x+l.x+h.x),o.y+=_*(1/3)*(a.y+l.y+h.y)}return o.SelfMul(1/n),o}Clone(){return(new PolygonShape).Copy(this)}Copy(t){super.Copy(t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=s.p.MakeArray(this.m_count),this.m_normals=s.p.MakeArray(this.m_count);for(let e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this}GetChildCount(){return 1}Set(t,e=t.length,i=0){if(e<3)return this.SetAsBox(1,1);let n=e;const r=[];for(let e=0;e<n;++e){const n=t[i+e];let a=!0;for(const t of r)if(s.p.DistanceSquaredVV(n,t)<.5*o.n*(.5*o.n)){a=!1;break}a&&r.push(n)}if((n=r.length)<3)return this.SetAsBox(1,1);let a=0,l=r[0].x;for(let t=1;t<n;++t){const e=r[t].x;(e>l||e===l&&r[t].y<r[a].y)&&(a=t,l=e)}const h=[];let m=0,c=a;for(;;){h[m]=c;let t=0;for(let e=1;e<n;++e){if(t===c){t=e;continue}const i=s.p.SubVV(r[t],r[h[m]],PolygonShape.Set_s_r),o=s.p.SubVV(r[e],r[h[m]],PolygonShape.Set_s_v),n=s.p.CrossVV(i,o);n<0&&(t=e),0===n&&o.LengthSquared()>i.LengthSquared()&&(t=e)}if(++m,c=t,t===a)break}this.m_count=m,this.m_vertices=s.p.MakeArray(this.m_count),this.m_normals=s.p.MakeArray(this.m_count);for(let t=0;t<m;++t)this.m_vertices[t].Copy(r[h[t]]);for(let t=0;t<m;++t){const e=this.m_vertices[t],i=this.m_vertices[(t+1)%m],o=s.p.SubVV(i,e,s.p.s_t0);s.p.CrossVOne(o,this.m_normals[t]).SelfNormalize()}return PolygonShape.ComputeCentroid(this.m_vertices,m,this.m_centroid),this}SetAsArray(t,e=t.length){return this.Set(t,e)}SetAsBox(t,e,i,o=0){if(this.m_count=4,this.m_vertices=s.p.MakeArray(this.m_count),this.m_normals=s.p.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);const t=new s.o;t.SetPosition(i),t.SetRotationAngle(o);for(let e=0;e<this.m_count;++e)s.o.MulXV(t,this.m_vertices[e],this.m_vertices[e]),s.k.MulRV(t.q,this.m_normals[e],this.m_normals[e])}return this}TestPoint(t,e){const i=s.o.MulTXV(t,e,PolygonShape.TestPoint_s_pLocal);for(let t=0;t<this.m_count;++t){if(s.p.DotVV(this.m_normals[t],s.p.SubVV(i,this.m_vertices[t],s.p.s_t0))>0)return!1}return!0}ComputeDistance(t,e,i,n){const r=s.o.MulTXV(t,e,PolygonShape.ComputeDistance_s_pLocal);let a=-o.p;const l=PolygonShape.ComputeDistance_s_normalForMaxDistance.Copy(r);for(let t=0;t<this.m_count;++t){const e=s.p.DotVV(this.m_normals[t],s.p.SubVV(r,this.m_vertices[t],s.p.s_t0));e>a&&(a=e,l.Copy(this.m_normals[t]))}if(a>0){const e=PolygonShape.ComputeDistance_s_minDistance.Copy(l);let o=a*a;for(let t=0;t<this.m_count;++t){const i=s.p.SubVV(r,this.m_vertices[t],PolygonShape.ComputeDistance_s_distance),n=i.LengthSquared();o>n&&(e.Copy(i),o=n)}return s.k.MulRV(t.q,e,i),i.Normalize(),Math.sqrt(o)}return s.k.MulRV(t.q,l,i),a}RayCast(t,e,i,o){const n=s.o.MulTXV(i,e.p1,PolygonShape.RayCast_s_p1),r=s.o.MulTXV(i,e.p2,PolygonShape.RayCast_s_p2),a=s.p.SubVV(r,n,PolygonShape.RayCast_s_d);let l=0,h=e.maxFraction,m=-1;for(let t=0;t<this.m_count;++t){const e=s.p.DotVV(this.m_normals[t],s.p.SubVV(this.m_vertices[t],n,s.p.s_t0)),i=s.p.DotVV(this.m_normals[t],a);if(0===i){if(e<0)return!1}else i<0&&e<l*i?(l=e/i,m=t):i>0&&e<h*i&&(h=e/i);if(h<l)return!1}return m>=0&&(t.fraction=l,s.k.MulRV(i.q,this.m_normals[m],t.normal),!0)}ComputeAABB(t,e,i){const o=s.o.MulXV(e,this.m_vertices[0],t.lowerBound),n=t.upperBound.Copy(o);for(let t=0;t<this.m_count;++t){const i=s.o.MulXV(e,this.m_vertices[t],PolygonShape.ComputeAABB_s_v);s.p.MinV(i,o,o),s.p.MaxV(i,n,n)}const r=this.m_radius;o.SelfSubXY(r,r),n.SelfAddXY(r,r)}ComputeMass(t,e){const i=PolygonShape.ComputeMass_s_center.SetZero();let o=0,n=0;const r=PolygonShape.ComputeMass_s_s.SetZero();for(let t=0;t<this.m_count;++t)r.SelfAdd(this.m_vertices[t]);r.SelfMul(1/this.m_count);for(let t=0;t<this.m_count;++t){const e=s.p.SubVV(this.m_vertices[t],r,PolygonShape.ComputeMass_s_e1),a=s.p.SubVV(this.m_vertices[(t+1)%this.m_count],r,PolygonShape.ComputeMass_s_e2),l=s.p.CrossVV(e,a),h=.5*l;o+=h,i.SelfAdd(s.p.MulSV(h*(1/3),s.p.AddVV(e,a,s.p.s_t0),s.p.s_t1));const m=e.x,c=e.y,_=a.x,u=a.y;n+=1/3*.25*l*(m*m+_*m+_*_+(c*c+u*c+u*u))}t.mass=e*o,i.SelfMul(1/o),s.p.AddVV(i,r,t.center),t.I=e*n,t.I+=t.mass*(s.p.DotVV(t.center,t.center)-s.p.DotVV(i,i))}Validate(){for(let t=0;t<this.m_count;++t){const e=t,i=(t+1)%this.m_count,o=this.m_vertices[e],n=s.p.SubVV(this.m_vertices[i],o,PolygonShape.Validate_s_e);for(let t=0;t<this.m_count;++t){if(t===e||t===i)continue;const r=s.p.SubVV(this.m_vertices[t],o,PolygonShape.Validate_s_v);if(s.p.CrossVV(n,r)<0)return!1}}return!0}SetupDistanceProxy(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,n){const r=s.k.MulTRV(i.q,t,PolygonShape.ComputeSubmergedArea_s_normalL),a=e-s.p.DotVV(t,i.p),l=[];let h=0,m=-1,c=-1,_=!1;for(let t=0;t<this.m_count;++t){l[t]=s.p.DotVV(r,this.m_vertices[t])-a;const e=l[t]<-o.j;t>0&&(e?_||(m=t-1,h++):_&&(c=t-1,h++)),_=e}switch(h){case 0:if(_){const t=PolygonShape.ComputeSubmergedArea_s_md;return this.ComputeMass(t,1),s.o.MulXV(i,t.center,n),t.mass}return 0;case 1:-1===m?m=this.m_count-1:c=this.m_count-1}const u=(m+1)%this.m_count,p=(c+1)%this.m_count,d=(0-l[m])/(l[u]-l[m]),f=(0-l[c])/(l[p]-l[c]),y=PolygonShape.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[m].x*(1-d)+this.m_vertices[u].x*d,this.m_vertices[m].y*(1-d)+this.m_vertices[u].y*d),S=PolygonShape.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[c].x*(1-f)+this.m_vertices[p].x*f,this.m_vertices[c].y*(1-f)+this.m_vertices[p].y*f);let x=0;const C=PolygonShape.ComputeSubmergedArea_s_center.SetZero();let B,w=this.m_vertices[u],g=u;for(;g!==p;){B=(g=(g+1)%this.m_count)===p?S:this.m_vertices[g];const t=.5*((w.x-y.x)*(B.y-y.y)-(w.y-y.y)*(B.x-y.x));x+=t,C.x+=t*(y.x+w.x+B.x)/3,C.y+=t*(y.y+w.y+B.y)/3,w=B}return C.SelfMul(1/x),s.o.MulXV(i,C,n),x}Dump(t){t("    const shape: PolygonShape = new PolygonShape();\n"),t("    const vs: Vec2[] = [];\n");for(let e=0;e<this.m_count;++e)t("    vs[%d] = new Vec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)}}PolygonShape.Set_s_r=new s.p,PolygonShape.Set_s_v=new s.p,PolygonShape.TestPoint_s_pLocal=new s.p,PolygonShape.ComputeDistance_s_pLocal=new s.p,PolygonShape.ComputeDistance_s_normalForMaxDistance=new s.p,PolygonShape.ComputeDistance_s_minDistance=new s.p,PolygonShape.ComputeDistance_s_distance=new s.p,PolygonShape.RayCast_s_p1=new s.p,PolygonShape.RayCast_s_p2=new s.p,PolygonShape.RayCast_s_d=new s.p,PolygonShape.ComputeAABB_s_v=new s.p,PolygonShape.ComputeMass_s_center=new s.p,PolygonShape.ComputeMass_s_s=new s.p,PolygonShape.ComputeMass_s_e1=new s.p,PolygonShape.ComputeMass_s_e2=new s.p,PolygonShape.Validate_s_e=new s.p,PolygonShape.Validate_s_v=new s.p,PolygonShape.ComputeSubmergedArea_s_normalL=new s.p,PolygonShape.ComputeSubmergedArea_s_md=new n.a,PolygonShape.ComputeSubmergedArea_s_intoVec=new s.p,PolygonShape.ComputeSubmergedArea_s_outoVec=new s.p,PolygonShape.ComputeSubmergedArea_s_center=new s.p,PolygonShape.ComputeCentroid_s_pRef=new s.p,PolygonShape.ComputeCentroid_s_e1=new s.p,PolygonShape.ComputeCentroid_s_e2=new s.p},function(t,e,i){"use strict";var s=i(0),o=i(1),n=i(22),r=i(6);class ChainShape extends r.b{constructor(){super(r.c.e_chainShape,o.G),this.m_vertices=[],this.m_count=0,this.m_prevVertex=new s.p,this.m_nextVertex=new s.p,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1}CreateLoop(t,e=t.length,i=0){if(e<3)return this;this.m_count=e+1,this.m_vertices=s.p.MakeArray(this.m_count);for(let s=0;s<e;++s)this.m_vertices[s].Copy(t[i+s]);return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}CreateChain(t,e=t.length,i=0){this.m_count=e,this.m_vertices=s.p.MakeArray(e);for(let s=0;s<e;++s)this.m_vertices[s].Copy(t[i+s]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this}SetPrevVertex(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this}SetNextVertex(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this}Clone(){return(new ChainShape).Copy(this)}Copy(t){return super.Copy(t),this.CreateChain(t.m_vertices,t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this}GetChildCount(){return this.m_count-1}GetChildEdge(t,e){t.m_type=r.c.e_edgeShape,t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),e>0?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)}TestPoint(t,e){return!1}ComputeDistance(t,e,i,s){const o=ChainShape.ComputeDistance_s_edgeShape;return this.GetChildEdge(o,s),o.ComputeDistance(t,e,i,0)}RayCast(t,e,i,s){const o=ChainShape.RayCast_s_edgeShape;return o.m_vertex1.Copy(this.m_vertices[s]),o.m_vertex2.Copy(this.m_vertices[(s+1)%this.m_count]),o.RayCast(t,e,i,0)}ComputeAABB(t,e,i){const o=this.m_vertices[i],n=this.m_vertices[(i+1)%this.m_count],r=s.o.MulXV(e,o,ChainShape.ComputeAABB_s_v1),a=s.o.MulXV(e,n,ChainShape.ComputeAABB_s_v2);s.p.MinV(r,a,t.lowerBound),s.p.MaxV(r,a,t.upperBound)}ComputeMass(t,e){t.mass=0,t.center.SetZero(),t.I=0}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,s){return s.SetZero(),0}Dump(t){t("    const shape: ChainShape = new ChainShape();\n"),t("    const vs: Vec2[] = [];\n");for(let e=0;e<this.m_count;++e)t("    vs[%d] = new bVec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")}}ChainShape.ComputeDistance_s_edgeShape=new n.a,ChainShape.RayCast_s_edgeShape=new n.a,ChainShape.ComputeAABB_s_v1=new s.p,ChainShape.ComputeAABB_s_v2=new s.p},function(t,e,i){"use strict";i.d(e,"a",function(){return World});var s=i(4),o=i(6),n=i(24),r=i(11),a=i(0),l=i(1),h=i(27),m=i(5),c=i(62),_=i(12),u=i(63),p=i(65),d=i(66),f=i(38),y=i(67),S=i(68),x=i(3),C=i(69),B=i(70),w=i(71),g=i(72),v=i(73),A=i(74),V=i(75),b=i(76),P=i(15),M=i(19);class World{constructor(t){this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new u.a,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new a.p,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new P.b,this.m_island=new p.a,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t)}static _Joint_Create(t,e){switch(t.type){case x.c.e_distanceJoint:return new f.a(t);case x.c.e_mouseJoint:return new B.a(t);case x.c.e_prismaticJoint:return new w.a(t);case x.c.e_revoluteJoint:return new v.a(t);case x.c.e_pulleyJoint:return new g.a(t);case x.c.e_gearJoint:return new S.a(t);case x.c.e_wheelJoint:return new b.a(t);case x.c.e_weldJoint:return new V.a(t);case x.c.e_frictionJoint:return new y.a(t);case x.c.e_ropeJoint:return new A.a(t);case x.c.e_motorJoint:return new C.a(t);case x.c.e_areaJoint:return new d.a(t)}throw new Error}static _Joint_Destroy(t,e){}SetDestructionListener(t){this.m_destructionListener=t}SetContactFilter(t){this.m_contactManager.m_contactFilter=t}SetContactListener(t){this.m_contactManager.m_contactListener=t}SetDebugDraw(t){this.m_debugDraw=t}CreateBody(t={}){if(this.IsLocked())throw new Error;const e=new _.a(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}DestroyBody(t){if(this.IsLocked())throw new Error;let e=t.m_jointList;for(;e;){const i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;let i=t.m_controllerList;for(;i;){const e=i;i=i.nextController,e.controller.RemoveBody(t)}let s=t.m_contactList;for(;s;){const t=s;s=s.next,this.m_contactManager.Destroy(t.contact)}t.m_contactList=null;let o=t.m_fixtureList;for(;o;){const e=o;o=o.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(e),e.DestroyProxies(),e.Destroy(),t.m_fixtureList=o,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}CreateJoint(t){if(this.IsLocked())throw new Error;const e=World._Joint_Create(t,null);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;const i=t.bodyA,s=t.bodyB;if(!t.collideConnected){let t=s.GetContactList();for(;t;)t.other===i&&t.contact.FlagForFiltering(),t=t.next}return e}DestroyJoint(t){if(this.IsLocked())throw new Error;const e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);const i=t.m_bodyA,s=t.m_bodyB;if(i.SetAwake(!0),s.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===s.m_jointList&&(s.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,World._Joint_Destroy(t,null),--this.m_jointCount,!e){let t=s.GetContactList();for(;t;)t.other===i&&t.contact.FlagForFiltering(),t=t.next}}CreateParticleSystem(t){if(this.IsLocked())throw new Error;const e=new c.a(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e}DestroyParticleSystem(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)}CalculateReasonableParticleIterations(t){if(null===this.m_particleSystemList)return 1;return Object(m.a)(this.m_gravity.Length(),function GetSmallestRadius(t){let e=l.p;for(let i=t.GetParticleSystemList();null!==i;i=i.m_next)e=Object(a.i)(e,i.GetRadius());return e}(this),t)}Step(t,e,i,s=this.CalculateReasonableParticleIterations(t)){const o=World.Step_s_stepTimer.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;const n=World.Step_s_step;n.dt=t,n.velocityIterations=e,n.positionIterations=i,n.particleIterations=s,n.inv_dt=t>0?1/t:0,n.dtRatio=this.m_inv_dt0*t,n.warmStarting=this.m_warmStarting;const r=World.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=r.GetMilliseconds(),this.m_stepComplete&&n.dt>0){const t=World.Step_s_timer.Reset();for(let t=this.m_particleSystemList;t;t=t.m_next)t.Solve(n);this.Solve(n),this.m_profile.solve=t.GetMilliseconds()}if(this.m_continuousPhysics&&n.dt>0){const t=World.Step_s_timer.Reset();this.SolveTOI(n),this.m_profile.solveTOI=t.GetMilliseconds()}n.dt>0&&(this.m_inv_dt0=n.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=o.GetMilliseconds()}ClearForces(){for(let t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}DrawParticleSystem(t){if(null===this.m_debugDraw)return;const e=t.GetParticleCount();if(e){const i=t.GetRadius(),s=t.GetPositionBuffer();if(t.m_colorBuffer.data){const o=t.GetColorBuffer();this.m_debugDraw.DrawParticles(s,i,o,e)}else this.m_debugDraw.DrawParticles(s,i,null,e)}}DrawDebugData(){if(null===this.m_debugDraw)return;const t=this.m_debugDraw.GetFlags(),e=World.DrawDebugData_s_color.SetRGB(0,0,0);if(t&r.b.e_shapeBit)for(let t=this.m_bodyList;t;t=t.m_next){const i=t.m_xf;this.m_debugDraw.PushTransform(i);for(let i=t.GetFixtureList();i;i=i.m_next)t.IsActive()?t.GetType()===_.c.staticBody?(e.SetRGB(.5,.9,.5),this.DrawShape(i,e)):t.GetType()===_.c.kinematicBody?(e.SetRGB(.5,.5,.9),this.DrawShape(i,e)):t.IsAwake()?(e.SetRGB(.9,.7,.7),this.DrawShape(i,e)):(e.SetRGB(.6,.6,.6),this.DrawShape(i,e)):(e.SetRGB(.5,.5,.3),this.DrawShape(i,e));this.m_debugDraw.PopTransform(i)}if(t&r.b.e_particleBit)for(let t=this.m_particleSystemList;t;t=t.m_next)this.DrawParticleSystem(t);if(t&r.b.e_jointBit)for(let t=this.m_jointList;t;t=t.m_next)this.DrawJoint(t);if(t&r.b.e_aabbBit){e.SetRGB(.9,.3,.9);const t=World.DrawDebugData_s_vs;for(let i=this.m_bodyList;i;i=i.m_next)if(i.IsActive())for(let s=i.GetFixtureList();s;s=s.m_next)for(let i=0;i<s.m_proxyCount;++i){const o=s.m_proxies[i].treeNode.aabb;t[0].Set(o.lowerBound.x,o.lowerBound.y),t[1].Set(o.upperBound.x,o.lowerBound.y),t[2].Set(o.upperBound.x,o.upperBound.y),t[3].Set(o.lowerBound.x,o.upperBound.y),this.m_debugDraw.DrawPolygon(t,4,e)}}if(t&r.b.e_centerOfMassBit)for(let t=this.m_bodyList;t;t=t.m_next){const e=World.DrawDebugData_s_xf;e.q.Copy(t.m_xf.q),e.p.Copy(t.GetWorldCenter()),this.m_debugDraw.DrawTransform(e)}if(t&r.b.e_controllerBit)for(let t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw)}QueryAABB(t,e,i){if(this.m_contactManager.m_broadPhase.Query(e,e=>{const s=e.userData.fixture;return t?t.ReportFixture(s):!i||i(s)}),t instanceof M.d)for(let i=this.m_particleSystemList;i;i=i.m_next)t.ShouldQueryParticleSystem(i)&&i.QueryAABB(t,e)}QueryAllAABB(t,e=[]){return this.QueryAABB(null,t,t=>(e.push(t),!0)),e}QueryPointAABB(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,e=>{const s=e.userData.fixture;return t?t.ReportFixture(s):!i||i(s)}),t instanceof M.d)for(let i=this.m_particleSystemList;i;i=i.m_next)t.ShouldQueryParticleSystem(i)&&i.QueryPointAABB(t,e)}QueryAllPointAABB(t,e=[]){return this.QueryPointAABB(null,t,t=>(e.push(t),!0)),e}QueryFixtureShape(t,e,i,o,n){const r=World.QueryFixtureShape_s_aabb;if(e.ComputeAABB(r,o,i),this.m_contactManager.m_broadPhase.Query(r,r=>{const a=r.userData,l=a.fixture;if(Object(s.k)(e,i,l.GetShape(),a.childIndex,o,l.GetBody().GetTransform())){if(t)return t.ReportFixture(l);if(n)return n(l)}return!0}),t instanceof M.d)for(let e=this.m_particleSystemList;e;e=e.m_next)t.ShouldQueryParticleSystem(e)&&e.QueryAABB(t,r)}QueryAllFixtureShape(t,e,i,s=[]){return this.QueryFixtureShape(null,t,e,i,t=>(s.push(t),!0)),s}QueryFixturePoint(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,s=>{const o=s.userData.fixture;if(o.TestPoint(e)){if(t)return t.ReportFixture(o);if(i)return i(o)}return!0}),t)for(let i=this.m_particleSystemList;i;i=i.m_next)t.ShouldQueryParticleSystem(i)&&i.QueryPointAABB(t,e)}QueryAllFixturePoint(t,e=[]){return this.QueryFixturePoint(null,t,t=>(e.push(t),!0)),e}RayCast(t,e,i,s){const o=World.RayCast_s_input;if(o.maxFraction=1,o.p1.Copy(e),o.p2.Copy(i),this.m_contactManager.m_broadPhase.RayCast(o,(o,n)=>{const r=n.userData,a=r.fixture,l=r.childIndex,h=World.RayCast_s_output;if(a.RayCast(h,o,l)){const o=h.fraction,n=World.RayCast_s_point;if(n.Set((1-o)*e.x+o*i.x,(1-o)*e.y+o*i.y),t)return t.ReportFixture(a,n,h.normal,o);if(s)return s(a,n,h.normal,o)}return o.maxFraction}),t)for(let s=this.m_particleSystemList;s;s=s.m_next)t.ShouldQueryParticleSystem(s)&&s.RayCast(t,e,i)}RayCastOne(t,e){let i=null,s=1;return this.RayCast(null,t,e,(t,e,o,n)=>(n<s&&(s=n,i=t),s)),i}RayCastAll(t,e,i=[]){return this.RayCast(null,t,e,(t,e,s,o)=>(i.push(t),1)),i}GetBodyList(){return this.m_bodyList}GetJointList(){return this.m_jointList}GetParticleSystemList(){return this.m_particleSystemList}GetContactList(){return this.m_contactManager.m_contactList}SetAllowSleeping(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(let t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)}GetAllowSleeping(){return this.m_allowSleep}SetWarmStarting(t){this.m_warmStarting=t}GetWarmStarting(){return this.m_warmStarting}SetContinuousPhysics(t){this.m_continuousPhysics=t}GetContinuousPhysics(){return this.m_continuousPhysics}SetSubStepping(t){this.m_subStepping=t}GetSubStepping(){return this.m_subStepping}GetProxyCount(){return this.m_contactManager.m_broadPhase.GetProxyCount()}GetBodyCount(){return this.m_bodyCount}GetJointCount(){return this.m_jointCount}GetContactCount(){return this.m_contactManager.m_contactCount}GetTreeHeight(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}GetTreeBalance(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}GetTreeQuality(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}SetGravity(t,e=!0){if(!a.p.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(let t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)}GetGravity(){return this.m_gravity}IsLocked(){return this.m_locked}SetAutoClearForces(t){this.m_clearForces=t}GetAutoClearForces(){return this.m_clearForces}ShiftOrigin(t){if(this.IsLocked())throw new Error;for(let e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(let e=this.m_jointList;e;e=e.m_next)e.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}GetContactManager(){return this.m_contactManager}GetProfile(){return this.m_profile}Dump(t){if(this.m_locked)return;t("const g: Vec2 = new Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),t("this.m_world.SetGravity(g);\n"),t("const bodies: Body[] = [];\n"),t("const joints: Joint[] = [];\n");let e=0;for(let i=this.m_bodyList;i;i=i.m_next)i.m_islandIndex=e,i.Dump(t),++e;e=0;for(let t=this.m_jointList;t;t=t.m_next)t.m_index=e,++e;for(let e=this.m_jointList;e;e=e.m_next)e.m_type!==x.c.e_gearJoint&&(t("{\n"),e.Dump(t),t("}\n"));for(let e=this.m_jointList;e;e=e.m_next)e.m_type===x.c.e_gearJoint&&(t("{\n"),e.Dump(t),t("}\n"))}DrawJoint(t){if(null===this.m_debugDraw)return;const e=t.GetBodyA(),i=t.GetBodyB(),s=e.m_xf,o=i.m_xf,n=s.p,r=o.p,a=t.GetAnchorA(World.DrawJoint_s_p1),l=t.GetAnchorB(World.DrawJoint_s_p2),h=World.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(t.m_type){case x.c.e_distanceJoint:this.m_debugDraw.DrawSegment(a,l,h);break;case x.c.e_pulleyJoint:{const e=t,i=e.GetGroundAnchorA(),s=e.GetGroundAnchorB();this.m_debugDraw.DrawSegment(i,a,h),this.m_debugDraw.DrawSegment(s,l,h),this.m_debugDraw.DrawSegment(i,s,h);break}case x.c.e_mouseJoint:{const t=World.DrawJoint_s_c;t.Set(0,1,0),this.m_debugDraw.DrawPoint(a,4,t),this.m_debugDraw.DrawPoint(l,4,t),t.Set(.8,.8,.8),this.m_debugDraw.DrawSegment(a,l,t);break}default:this.m_debugDraw.DrawSegment(n,a,h),this.m_debugDraw.DrawSegment(a,l,h),this.m_debugDraw.DrawSegment(r,l,h)}}DrawShape(t,e){if(null===this.m_debugDraw)return;const i=t.GetShape();switch(i.m_type){case o.c.e_circleShape:{const t=i,s=t.m_p,o=t.m_radius,n=a.p.UNITX;this.m_debugDraw.DrawSolidCircle(s,o,n,e);break}case o.c.e_edgeShape:{const t=i,s=t.m_vertex1,o=t.m_vertex2;this.m_debugDraw.DrawSegment(s,o,e);break}case o.c.e_chainShape:{const t=i,s=t.m_count,o=t.m_vertices,n=World.DrawShape_s_ghostColor.SetRGBA(.75*e.r,.75*e.g,.75*e.b,e.a);let r=o[0];if(this.m_debugDraw.DrawPoint(r,4,e),t.m_hasPrevVertex){const e=t.m_prevVertex;this.m_debugDraw.DrawSegment(e,r,n),this.m_debugDraw.DrawCircle(e,.1,n)}for(let t=1;t<s;++t){const i=o[t];this.m_debugDraw.DrawSegment(r,i,e),this.m_debugDraw.DrawPoint(i,4,e),r=i}if(t.m_hasNextVertex){const e=t.m_nextVertex;this.m_debugDraw.DrawSegment(e,r,n),this.m_debugDraw.DrawCircle(e,.1,n)}break}case o.c.e_polygonShape:{const t=i,s=t.m_count,o=t.m_vertices;this.m_debugDraw.DrawSolidPolygon(o,s,e);break}}}Solve(t){for(let t=this.m_bodyList;t;t=t.m_next)t.m_xf0.Copy(t.m_xf);for(let e=this.m_controllerList;e;e=e.m_next)e.Step(t);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;const e=this.m_island;e.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=this.m_jointList;t;t=t.m_next)t.m_islandFlag=!1;const i=this.s_stack;for(let s=this.m_bodyList;s;s=s.m_next){if(s.m_islandFlag)continue;if(!s.IsAwake()||!s.IsActive())continue;if(s.GetType()===_.c.staticBody)continue;e.Clear();let o=0;for(i[o++]=s,s.m_islandFlag=!0;o>0;){const t=i[--o];if(!t)throw new Error;if(e.AddBody(t),t.m_awakeFlag=!0,t.GetType()!==_.c.staticBody){for(let s=t.m_contactList;s;s=s.next){const t=s.contact;if(t.m_islandFlag)continue;if(!t.IsEnabled()||!t.IsTouching())continue;const n=t.m_fixtureA.m_isSensor,r=t.m_fixtureB.m_isSensor;if(n||r)continue;e.AddContact(t),t.m_islandFlag=!0;const a=s.other;if(!a)throw new Error;a.m_islandFlag||(i[o++]=a,a.m_islandFlag=!0)}for(let s=t.m_jointList;s;s=s.next){if(s.joint.m_islandFlag)continue;const t=s.other;t.IsActive()&&(e.AddJoint(s.joint),s.joint.m_islandFlag=!0,t.m_islandFlag||(i[o++]=t,t.m_islandFlag=!0))}}}const n=new P.b;e.Solve(n,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=n.solveInit,this.m_profile.solveVelocity+=n.solveVelocity,this.m_profile.solvePosition+=n.solvePosition;for(let t=0;t<e.m_bodyCount;++t){const i=e.m_bodies[t];i.GetType()===_.c.staticBody&&(i.m_islandFlag=!1)}}for(let t=0;t<i.length&&i[t];++t)i[t]=null;const s=new h.a;for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag&&t.GetType()!==_.c.staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=s.GetMilliseconds()}SolveTOI(t){const e=this.m_island;if(e.Initialize(2*l.y,l.y,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1,t.m_sweep.alpha0=0;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next)t.m_toiFlag=!1,t.m_islandFlag=!1,t.m_toiCount=0,t.m_toi=1}for(;;){let i=null,s=1;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next){if(!t.IsEnabled())continue;if(t.m_toiCount>l.x)continue;let e=1;if(t.m_toiFlag)e=t.m_toi;else{const i=t.GetFixtureA(),s=t.GetFixtureB();if(i.IsSensor()||s.IsSensor())continue;const o=i.GetBody(),r=s.GetBody(),l=o.m_type,h=r.m_type,m=o.IsAwake()&&l!==_.c.staticBody,c=r.IsAwake()&&h!==_.c.staticBody;if(!m&&!c)continue;const u=o.IsBullet()||l!==_.c.dynamicBody,p=r.IsBullet()||h!==_.c.dynamicBody;if(!u&&!p)continue;let d=o.m_sweep.alpha0;o.m_sweep.alpha0<r.m_sweep.alpha0?(d=r.m_sweep.alpha0,o.m_sweep.Advance(d)):r.m_sweep.alpha0<o.m_sweep.alpha0&&(d=o.m_sweep.alpha0,r.m_sweep.Advance(d));const f=t.GetChildIndexA(),y=t.GetChildIndexB(),S=World.SolveTOI_s_toi_input;S.proxyA.SetShape(i.GetShape(),f),S.proxyB.SetShape(s.GetShape(),y),S.sweepA.Copy(o.m_sweep),S.sweepB.Copy(r.m_sweep),S.tMax=1;const x=World.SolveTOI_s_toi_output;Object(n.d)(x,S);const C=x.t;e=x.state===n.c.e_touching?Object(a.i)(d+(1-d)*C,1):e=1,t.m_toi=e,t.m_toiFlag=!0}e<s&&(i=t,s=e)}if(null===i||1-10*l.j<s){this.m_stepComplete=!0;break}const o=i.GetFixtureA(),r=i.GetFixtureB(),h=o.GetBody(),m=r.GetBody(),c=World.SolveTOI_s_backup1.Copy(h.m_sweep),u=World.SolveTOI_s_backup2.Copy(m.m_sweep);if(h.Advance(s),m.Advance(s),i.Update(this.m_contactManager.m_contactListener),i.m_toiFlag=!1,++i.m_toiCount,!i.IsEnabled()||!i.IsTouching()){i.SetEnabled(!1),h.m_sweep.Copy(c),m.m_sweep.Copy(u),h.SynchronizeTransform(),m.SynchronizeTransform();continue}h.SetAwake(!0),m.SetAwake(!0),e.Clear(),e.AddBody(h),e.AddBody(m),e.AddContact(i),h.m_islandFlag=!0,m.m_islandFlag=!0,i.m_islandFlag=!0;for(let t=0;t<2;++t){const i=0===t?h:m;if(i.m_type===_.c.dynamicBody)for(let t=i.m_contactList;t&&e.m_bodyCount!==e.m_bodyCapacity&&e.m_contactCount!==e.m_contactCapacity;t=t.next){const o=t.contact;if(o.m_islandFlag)continue;const n=t.other;if(n.m_type===_.c.dynamicBody&&!i.IsBullet()&&!n.IsBullet())continue;const r=o.m_fixtureA.m_isSensor,a=o.m_fixtureB.m_isSensor;if(r||a)continue;const l=World.SolveTOI_s_backup.Copy(n.m_sweep);n.m_islandFlag||n.Advance(s),o.Update(this.m_contactManager.m_contactListener),o.IsEnabled()&&o.IsTouching()?(o.m_islandFlag=!0,e.AddContact(o),n.m_islandFlag||(n.m_islandFlag=!0,n.m_type!==_.c.staticBody&&n.SetAwake(!0),e.AddBody(n))):(n.m_sweep.Copy(l),n.SynchronizeTransform())}}const p=World.SolveTOI_s_subStep;p.dt=(1-s)*t.dt,p.inv_dt=1/p.dt,p.dtRatio=1,p.positionIterations=20,p.velocityIterations=t.velocityIterations,p.particleIterations=t.particleIterations,p.warmStarting=!1,e.SolveTOI(p,h.m_islandIndex,m.m_islandIndex);for(let t=0;t<e.m_bodyCount;++t){const i=e.m_bodies[t];if(i.m_islandFlag=!1,i.m_type===_.c.dynamicBody){i.SynchronizeFixtures();for(let t=i.m_contactList;t;t=t.next)t.contact.m_toiFlag=!1,t.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}}AddController(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t}RemoveController(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t}}World.Step_s_step=new P.d,World.Step_s_stepTimer=new h.a,World.Step_s_timer=new h.a,World.DrawDebugData_s_color=new r.a(0,0,0),World.DrawDebugData_s_vs=a.p.MakeArray(4),World.DrawDebugData_s_xf=new a.o,World.QueryFixtureShape_s_aabb=new s.a,World.RayCast_s_input=new s.h,World.RayCast_s_output=new s.i,World.RayCast_s_point=new a.p,World.DrawJoint_s_p1=new a.p,World.DrawJoint_s_p2=new a.p,World.DrawJoint_s_color=new r.a(.5,.8,.8),World.DrawJoint_s_c=new r.a,World.DrawShape_s_ghostColor=new r.a,World.SolveTOI_s_subStep=new P.d,World.SolveTOI_s_backup=new a.n,World.SolveTOI_s_backup1=new a.n,World.SolveTOI_s_backup2=new a.n,World.SolveTOI_s_toi_input=new n.a,World.SolveTOI_s_toi_output=new n.b},function(t,e,i){"use strict";i(11),i(0),i(1),i(21)},function(t,e,i){"use strict";var s=i(0),o=i(21);class ConstantAccelController extends o.a{constructor(){super(...arguments),this.A=new s.p(0,0)}Step(t){const e=s.p.MulSV(t.dt,this.A,ConstantAccelController.Step_s_dtA);for(let t=this.m_bodyList;t;t=t.nextBody){const i=t.body;i.IsAwake()&&i.SetLinearVelocity(s.p.AddVV(i.GetLinearVelocity(),e,s.p.s_t0))}}Draw(t){}}ConstantAccelController.Step_s_dtA=new s.p},function(t,e,i){"use strict";i(0),i(21)},function(t,e,i){"use strict";var s=i(0),o=i(1),n=i(21);class GravityController extends n.a{constructor(){super(...arguments),this.G=1,this.invSqr=!0}Step(t){if(this.invSqr)for(let t=this.m_bodyList;t;t=t.nextBody){const e=t.body,i=e.GetWorldCenter(),n=e.GetMass();for(let r=this.m_bodyList;r&&r!==t;r=r.nextBody){const t=r.body,a=t.GetWorldCenter(),l=t.GetMass(),h=a.x-i.x,m=a.y-i.y,c=h*h+m*m;if(c<o.j)continue;const _=GravityController.Step_s_f.Set(h,m);_.SelfMul(this.G/c/Object(s.m)(c)*n*l),e.IsAwake()&&e.ApplyForce(_,i),t.IsAwake()&&t.ApplyForce(_.SelfMul(-1),a)}}else for(let t=this.m_bodyList;t;t=t.nextBody){const e=t.body,i=e.GetWorldCenter(),s=e.GetMass();for(let n=this.m_bodyList;n&&n!==t;n=n.nextBody){const t=n.body,r=t.GetWorldCenter(),a=t.GetMass(),l=r.x-i.x,h=r.y-i.y,m=l*l+h*h;if(m<o.j)continue;const c=GravityController.Step_s_f.Set(l,h);c.SelfMul(this.G/m*s*a),e.IsAwake()&&e.ApplyForce(c,i),t.IsAwake()&&t.ApplyForce(c.SelfMul(-1),r)}}}Draw(t){}}GravityController.Step_s_f=new s.p},function(t,e,i){"use strict";var s=i(0),o=i(1),n=i(21);class TensorDampingController extends n.a{constructor(){super(...arguments),this.T=new s.f,this.maxTimestep=0}Step(t){let e=t.dt;if(!(e<=o.j)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);for(let t=this.m_bodyList;t;t=t.nextBody){const i=t.body;if(!i.IsAwake())continue;const o=i.GetWorldVector(s.f.MulMV(this.T,i.GetLocalVector(i.GetLinearVelocity(),s.p.s_t0),s.p.s_t1),TensorDampingController.Step_s_damping);i.SetLinearVelocity(s.p.AddVV(i.GetLinearVelocity(),s.p.MulSV(e,o,s.p.s_t0),s.p.s_t1))}}}Draw(t){}SetAxisAligned(t,e){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-e,this.maxTimestep=t>0||e>0?1/Object(s.h)(t,e):this.maxTimestep=0}}TensorDampingController.Step_s_damping=new s.p},function(t,e,i){"use strict";var s=i(11),o=i(0),n=i(1);class Rope{constructor(){this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new o.p,this.m_damping=0,this.m_k2=1,this.m_k3=.1}GetVertexCount(){return this.m_count}GetVertices(){return this.m_ps}Initialize(t){this.m_count=t.count,this.m_ps=o.p.MakeArray(this.m_count),this.m_p0s=o.p.MakeArray(this.m_count),this.m_vs=o.p.MakeArray(this.m_count),this.m_ims=Object(n.b)(this.m_count);for(let e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();const i=t.masses[e];this.m_ims[e]=i>0?1/i:0}const e=this.m_count-1,i=this.m_count-2;this.m_Ls=Object(n.b)(e),this.m_as=Object(n.b)(i);for(let t=0;t<e;++t){const e=this.m_ps[t],i=this.m_ps[t+1];this.m_Ls[t]=o.p.DistanceVV(e,i)}for(let t=0;t<i;++t){const e=this.m_ps[t],i=this.m_ps[t+1],s=this.m_ps[t+2],n=o.p.SubVV(i,e,o.p.s_t0),r=o.p.SubVV(s,i,o.p.s_t1),a=o.p.CrossVV(n,r),l=o.p.DotVV(n,r);this.m_as[t]=Object(o.c)(a,l)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3}Step(t,e){if(0===t)return;const i=Math.exp(-t*this.m_damping);for(let e=0;e<this.m_count;++e)this.m_p0s[e].Copy(this.m_ps[e]),this.m_ims[e]>0&&this.m_vs[e].SelfMulAdd(t,this.m_gravity),this.m_vs[e].SelfMul(i),this.m_ps[e].SelfMulAdd(t,this.m_vs[e]);for(let t=0;t<e;++t)this.SolveC2(),this.SolveC3(),this.SolveC2();const s=1/t;for(let t=0;t<this.m_count;++t)o.p.MulSV(s,o.p.SubVV(this.m_ps[t],this.m_p0s[t],o.p.s_t0),this.m_vs[t])}SolveC2(){const t=this.m_count-1;for(let e=0;e<t;++e){const t=this.m_ps[e],i=this.m_ps[e+1],s=o.p.SubVV(i,t,Rope.s_d),n=s.Normalize(),r=this.m_ims[e],a=this.m_ims[e+1];if(r+a===0)continue;const l=r/(r+a),h=a/(r+a);t.SelfMulSub(this.m_k2*l*(this.m_Ls[e]-n),s),i.SelfMulAdd(this.m_k2*h*(this.m_Ls[e]-n),s)}}SetAngle(t){const e=this.m_count-2;for(let i=0;i<e;++i)this.m_as[i]=t}SolveC3(){const t=this.m_count-2;for(let e=0;e<t;++e){const t=this.m_ps[e],i=this.m_ps[e+1],s=this.m_ps[e+2],r=this.m_ims[e],a=this.m_ims[e+1],l=this.m_ims[e+2],h=o.p.SubVV(i,t,Rope.s_d1),m=o.p.SubVV(s,i,Rope.s_d2),c=h.LengthSquared(),_=m.LengthSquared();if(c*_==0)continue;const u=o.p.CrossVV(h,m),p=o.p.DotVV(h,m);let d=Object(o.c)(u,p);const f=o.p.MulSV(-1/c,h.SelfSkew(),Rope.s_Jd1),y=o.p.MulSV(1/_,m.SelfSkew(),Rope.s_Jd2),S=o.p.NegV(f,Rope.s_J1),x=o.p.SubVV(f,y,Rope.s_J2),C=y;let B=r*o.p.DotVV(S,S)+a*o.p.DotVV(x,x)+l*o.p.DotVV(C,C);if(0===B)continue;B=1/B;let w=d-this.m_as[e];for(;w>n.F;)w=(d-=2*n.F)-this.m_as[e];for(;w<-n.F;)w=(d+=2*n.F)-this.m_as[e];const g=-this.m_k3*B*w;t.SelfMulAdd(r*g,S),i.SelfMulAdd(a*g,x),s.SelfMulAdd(l*g,C)}}Draw(t){const e=new s.a(.4,.5,.7);for(let i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)}}Rope.s_d=new o.p,Rope.s_d1=new o.p,Rope.s_d2=new o.p,Rope.s_Jd1=new o.p,Rope.s_Jd2=new o.p,Rope.s_J1=new o.p,Rope.s_J2=new o.p},,,,,,,,,,,function(t,e,i){"use strict";i.d(e,"a",function(){return RafTweener});var s=i(118);class RafTweener extends s.a{constructor(t=0,e=!0){super(),this.discreteStepDuration=t,this.speed=1,this.requestStop=!1,this.paused=!1,this.ticking=!1,this.timeSnapshot=0,this.update=t>0?this.discreteStepTick:this.tick,this.rafTick=this._rafTick.bind(this),e&&this.start()}discreteStepTick(t){t*=this.speed;const e=this._now+t;for(;this._now<e;)this.tick(this.discreteStepDuration)}start(){this.timeSnapshot=performance.now(),this.discreteStepDuration>0&&(this.timeSnapshot-=this.timeSnapshot%this.discreteStepDuration),this._now=this.timeSnapshot,this.ticking||(this.ticking=!0,window.requestAnimationFrame(this.rafTick))}stop(){this.ticking&&!this.requestStop&&(this.requestStop=!0,this.ticking=!1)}pause(){this.paused=!0}unpause(){this.paused=!1}_rafTick(){if(this.requestStop)return void(this.requestStop=!1);const t=performance.now();let e=(t-this.timeSnapshot)*this.speed;if(this.paused)e=0;else{const t=this._now;this.update(e),e-=this._now-t}this.timeSnapshot=t-e,this.ticking&&window.requestAnimationFrame(this.rafTick)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return RawTweener});var s=i(119),o=i(7);const n={delay:0,duration:1e3,easing:i(120).a.Linear};class AnimatedProperty{constructor(t,e,i){this.key=t,this.valueStart=e,this.valueEnd=i}}class AnimatedObject{constructor(t,e,i,s,o,n,r,a){this.tweener=t,this.target=e,this.easing=i,this.startTime=s,this.endTime=o,this.animatedProperties=n,this.onUpdate=r,this.duration=o-s,this.finished=new Promise(t=>{this.onComplete=()=>{a&&a(),t()}})}kill(){this.tweener.kill(this)}}class RawTweener{constructor(){this._now=0,this._processingTick=!1,this._animations=[],this._animationsToComplete=[]}to(t){if(this.killTweensOf(t.target),Object(s.a)(t,n),"function"!=typeof t.easing)throw new Error("ease must be an easing function that takes in a number (0..1) and returns a number (0..1)");const e=t.target,i=t.propertyGoals,o=Object.keys(i).map(t=>{const s=e[t],o=i[t];if(isNaN(s)||isNaN(o))throw new Error("values must be numbers");return new AnimatedProperty(t,s,o)}),r=this._now+t.delay,a=r+t.duration,l=new AnimatedObject(this,e,t.easing,r,a,o,t.onUpdate,t.onComplete);return this._animations.push(l),l}tick(t){this._now+=t;const e=this._now,i=this._animations;this._processingTick=!0;for(const t of i)if(e>t.startTime){const i=t.target,s=Math.min((e-t.startTime)/t.duration,1);if(s<1){const e=t.easing(s);for(const s of t.animatedProperties)i[s.key]=Object(o.d)(s.valueStart,s.valueEnd,e);t.onUpdate&&t.onUpdate()}else this._animationsToComplete.push(t)}if(this._processingTick=!1,this._animationsToComplete.length>0){this._animationsToComplete.sort((t,e)=>t.endTime-e.endTime);for(const t of this._animationsToComplete)this.kill(t);this._animationsToComplete.length=0}}killTweensOf(t){if(this._processingTick)throw new Error("Not allowed during processing of tick");const e=this._animations;for(let i=e.length-1;i>=0;i--){const s=e[i];s.target===t&&this.kill(s,i)}}kill(t,e=-1){if(this._processingTick)throw new Error("Not allowed during processing of tick");if(-1===e&&(e=this._animations.indexOf(t)),-1!==e){for(const e of t.animatedProperties)t.target[e.key]=e.valueEnd;t.onUpdate&&t.onUpdate(),t.onComplete&&t.onComplete(),this._animations.splice(e,1)}}}},function(t,e,i){"use strict";function copyDefaults(t,e){for(const i of Object.keys(e))t.hasOwnProperty(i)||(t[i]=e[i])}i.d(e,"a",function(){return copyDefaults})},function(t,e,i){"use strict";i.d(e,"a",function(){return s});const s={Linear:t=>t,Quadratic:{In:t=>t*t,Out:t=>t*(2-t),InOut:t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Cubic:{In:t=>t*t*t,Out:t=>--t*t*t+1,InOut:t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},Quartic:{In:t=>t*t*t*t,Out:t=>1- --t*t*t*t,InOut:t=>(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},Quintic:{In:t=>t*t*t*t*t,Out:t=>--t*t*t*t*t+1,InOut:t=>(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},Sinusoidal:{In:t=>1-Math.cos(t*Math.PI/2),Out:t=>Math.sin(t*Math.PI/2),InOut:t=>.5*(1-Math.cos(Math.PI*t))},Exponential:{In:t=>0===t?0:Math.pow(1024,t-1),Out:t=>1===t?1:1-Math.pow(2,-10*t),InOut:t=>0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},Circular:{In:t=>1-Math.sqrt(1-t*t),Out:t=>Math.sqrt(1- --t*t),InOut:t=>(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},Elastic:{In(t){let e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},Out(t){let e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},InOut(t){let e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)}},Back:{In(t){const e=1.70158;return t*t*((e+1)*t-e)},Out(t){const e=1.70158;return--t*t*((e+1)*t+e)+1},InOut(t){const e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:t=>1-s.Bounce.Out(1-t),Out:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,InOut:t=>t<.5?.5*s.Bounce.In(2*t):.5*s.Bounce.Out(2*t-1)+.5}}},function(t,e,i){"use strict";i.d(e,"a",function(){return TestGraphicsCharacterScene});var s=i(2),o=i(122),n=i(13),r=i(7),a=i(80);class TestGraphicsCharacterScene extends a.a{constructor(){super("test-layout"),this.characters=[];for(let t=0;t<Object(n.d)("characters",1,1,40);t++){const t=new o.a(this.myB2World);this.characters.push(t),this.scene.add(t.visuals)}}update(t){const e=this.characters.length?this.getCharactersPosition():this.keyboardMesh.position;super.update(t);for(const e of this.characters)e.update(t);const i=this.camera.position,s=e.clone();s.x+=.04*.7,s.y+=.105,s.z+=.35*.7,s.y=Math.max(0,s.y),this.camera.position.x=Object(r.d)(i.x,s.x,.1),this.camera.position.y=Object(r.d)(i.y,s.y,.01),this.camera.position.z=s.z;const o=this.camera.quaternion.clone(),n=e.clone();n.x+=.04,this.camera.lookAt(n),this.camera.quaternion.slerp(o,.99),this.sunLight.position.x=this.camera.position.x+.2,this.sunLight.target.position.x=this.camera.position.x,this.sunLight.target.updateMatrixWorld(!0),this.sunLight.updateMatrixWorld(!0)}getCharactersPosition(){const t=new s.Vector3;for(const e of this.characters)t.add(e.visuals.position);return t.multiplyScalar(1/this.characters.length),t}}},function(t,e,i){"use strict";i.d(e,"a",function(){return Character});var s=i(2),o=i(77),n=i(78),r=i(9);class Character{constructor(t){this.physics=new n.a(t);const e=this.physics.bodySize,i=this.physics.bodyOffset,r=new s.Object3D,a=e.x+.003,l=e.y+.003,h=new o.a(a,l);h.position.set(i.x,i.y,0),r.add(h),this.torsoMesh=h,this.visuals=r}update(t){const e=this.physics;e.update(t);let i=e.body.GetPosition();i=e.body.GetPosition(),this.visuals.position.set(i.x/r.a,i.y/r.a,0),this.visuals.position.x-=.12,this.visuals.position.y+=.158,this.visuals.rotation.z=this.physics.body.GetAngle();const s=this.physics.bodySize,o=this.physics.defaultBodySize,n=s.x/o.x,a=s.y/o.y;this.torsoMesh.scale.set(n,a,n);const l=this.physics.bodyOffset;this.torsoMesh.position.set(l.x,l.y,0)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return makeScoopMesh});var s=i(2),o=i(17);function makeScoopMesh(t){const e=new s.Mesh(t.geometry,o.a.scoopMask);e.renderOrder=t.renderOrder-1,t.add(e),e.onBeforeRender=(t,e,i,s,o,n)=>{!function maskPreRender(t,e){e.setTest(!0),e.setClear(1),e.setMask(255),e.setOp(t.KEEP,t.KEEP,t.REPLACE),e.setFunc(t.ALWAYS,2,255)}(t.context,t.state.buffers.stencil)},e.onAfterRender=(t,e,i,s,o,n)=>{t.context,t.state.buffers.stencil},t.onBeforeRender=(t,e,i,s,o,n)=>{!function meshPreRender(t,e){e.setFunc(t.EQUAL,2,255),e.setMask(0)}(t.context,t.state.buffers.stencil)},t.onAfterRender=(t,e,i,s,o,n)=>{!function meshPostRender(t,e){e.setTest(!1)}(t.context,t.state.buffers.stencil)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return VoronoiDiagram});var s=i(0),o=i(1),n=i(125);class VoronoiDiagram{constructor(t){this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=Object(o.a)(t,t=>new VoronoiDiagramGenerator),this.m_generatorCapacity=t}AddGenerator(t,e,i){const s=this.m_generatorBuffer[this.m_generatorCount++];s.center.Copy(t),s.tag=e,s.necessary=i}Generate(t,e){const i=1/t,r=new s.p(+o.p,+o.p),a=new s.p(-o.p,-o.p);let l=0;for(let t=0;t<this.m_generatorCount;t++){const e=this.m_generatorBuffer[t];e.necessary&&(s.p.MinV(r,e.center,r),s.p.MaxV(a,e.center,a),++l)}if(0===l)return this.m_countX=0,void(this.m_countY=0);r.x-=e,r.y-=e,a.x+=e,a.y+=e,this.m_countX=1+Math.floor(i*(a.x-r.x)),this.m_countY=1+Math.floor(i*(a.y-r.y)),this.m_diagram=[];const h=new n.a(4*this.m_countX*this.m_countY);for(let t=0;t<this.m_generatorCount;t++){const e=this.m_generatorBuffer[t];e.center.SelfSub(r).SelfMul(i);const s=Math.floor(e.center.x),o=Math.floor(e.center.y);s>=0&&o>=0&&s<this.m_countX&&o<this.m_countY&&h.Push(new VoronoiDiagramTask(s,o,s+o*this.m_countX,e))}for(;!h.Empty();){const t=h.Front(),e=t.m_x,i=t.m_y,s=t.m_i,o=t.m_generator;h.Pop(),this.m_diagram[s]||(this.m_diagram[s]=o,e>0&&h.Push(new VoronoiDiagramTask(e-1,i,s-1,o)),i>0&&h.Push(new VoronoiDiagramTask(e,i-1,s-this.m_countX,o)),e<this.m_countX-1&&h.Push(new VoronoiDiagramTask(e+1,i,s+1,o)),i<this.m_countY-1&&h.Push(new VoronoiDiagramTask(e,i+1,s+this.m_countX,o)))}for(let t=0;t<this.m_countY;t++)for(let e=0;e<this.m_countX-1;e++){const i=e+t*this.m_countX,s=this.m_diagram[i],o=this.m_diagram[i+1];s!==o&&(h.Push(new VoronoiDiagramTask(e,t,i,o)),h.Push(new VoronoiDiagramTask(e+1,t,i+1,s)))}for(let t=0;t<this.m_countY-1;t++)for(let e=0;e<this.m_countX;e++){const i=e+t*this.m_countX,s=this.m_diagram[i],o=this.m_diagram[i+this.m_countX];s!==o&&(h.Push(new VoronoiDiagramTask(e,t,i,o)),h.Push(new VoronoiDiagramTask(e,t+1,i+this.m_countX,s)))}for(;!h.Empty();){const t=h.Front(),e=t.m_x,i=t.m_y,s=t.m_i,o=t.m_generator;h.Pop();const n=this.m_diagram[s],r=o;if(n!==r){const t=n.center.x-e,o=n.center.y-i,a=r.center.x-e,l=r.center.y-i;t*t+o*o>a*a+l*l&&(this.m_diagram[s]=r,e>0&&h.Push(new VoronoiDiagramTask(e-1,i,s-1,r)),i>0&&h.Push(new VoronoiDiagramTask(e,i-1,s-this.m_countX,r)),e<this.m_countX-1&&h.Push(new VoronoiDiagramTask(e+1,i,s+1,r)),i<this.m_countY-1&&h.Push(new VoronoiDiagramTask(e,i+1,s+this.m_countX,r)))}}}GetNodes(t){for(let e=0;e<this.m_countY-1;e++)for(let i=0;i<this.m_countX-1;i++){const s=i+e*this.m_countX,o=this.m_diagram[s],n=this.m_diagram[s+1],r=this.m_diagram[s+this.m_countX],a=this.m_diagram[s+1+this.m_countX];n!==r&&(o!==n&&o!==r&&(o.necessary||n.necessary||r.necessary)&&t(o.tag,n.tag,r.tag),a!==n&&a!==r&&(o.necessary||n.necessary||r.necessary)&&t(n.tag,a.tag,r.tag))}}}class VoronoiDiagramGenerator{constructor(){this.center=new s.p,this.tag=0,this.necessary=!1}}class VoronoiDiagramTask{constructor(t,e,i,s){this.m_x=t,this.m_y=e,this.m_i=i,this.m_generator=s}}},function(t,e,i){"use strict";i.d(e,"a",function(){return StackQueue});var s=i(1);class StackQueue{constructor(t){this.m_front=0,this.m_back=0,this.m_capacity=0,this.m_buffer=Object(s.a)(t,t=>null),this.m_capacity=t}Push(t){if(this.m_back>=this.m_capacity){for(let t=this.m_front;t<this.m_back;t++)this.m_buffer[t-this.m_front]=this.m_buffer[t];this.m_back-=this.m_front,this.m_front=0,this.m_back>=this.m_capacity&&(this.m_capacity>0?(this.m_buffer.concat(Object(s.a)(this.m_capacity,t=>null)),this.m_capacity*=2):(this.m_buffer.concat(Object(s.a)(1,t=>null)),this.m_capacity=1))}this.m_buffer[this.m_back]=t,this.m_back++}Pop(){this.m_buffer[this.m_front]=null,this.m_front++}Empty(){return this.m_front===this.m_back}Front(){const t=this.m_buffer[this.m_front];if(!t)throw new Error;return t}}},function(t,e,i){"use strict";i.d(e,"a",function(){return Box2DPreviewMaterial});var s=i(2),o=i(127),n=i.n(o),r=i(128),a=i.n(r);class Box2DPreviewMaterial extends s.RawShaderMaterial{constructor(){super({vertexShader:a(),fragmentShader:n(),transparent:!0,depthWrite:!1,depthTest:!1})}}},function(t,e){t.exports="precision lowp float;\n#define GLSLIFY 1\n\nvarying vec4 vColor;\n\nvoid main() {\n\tgl_FragColor = vColor;\n}\n"},function(t,e){t.exports="precision lowp float;\n#define GLSLIFY 1\n\nattribute vec2 position;\nattribute vec4 color;\n\nvarying vec4 vColor;\n\nvoid main() {\n    gl_Position = vec4(position, 0.0, 1.0);\n    vColor = color;\n}"},function(t,e,i){"use strict";i.d(e,"a",function(){return KeyButtonHoleMesh});var s=i(2),o=i(17),n=i(23);class KeyButtonHoleMesh extends s.Mesh{constructor(t,e,i,s=.005){super(Object(n.a)(t+.001,e,i+.001,2*s),o.a.keyboardPlasticHole),this.renderOrder=-1,this.receiveShadow=!0}}},function(t,e,i){"use strict";i.d(e,"a",function(){return KeyButtonMesh});var s=i(2),o=i(131),n=i(17),r=i(34),a=i(28),l=i(23),h=i(84);const m=a.a.keyLabel,c=a.a.keyLabelDouble,_=a.a.keyLabelSmall;class KeyButtonMesh extends s.Mesh{constructor(t,e,i,s="",a=.005){if(super(Object(l.a)(t,e,i,a),n.a.keyboardPlasticKey),""!==s){const e=new r.a(s,Object.assign({},function getFont(t){if(t.length>1&&t.length<=3&&"F"==t[0]){const e=t.split("F");if(Object(o.isNumber)(e[1]))return c}switch(t.length){case 1:return m;case 2:return _;case 3:return t.includes("\n")?c:_;default:return _}}(s),{width:(t-.003)*h.a}));e.position.y+=.0052,e.rotation.x=.5*-Math.PI,this.add(e)}this.renderOrder=200,this.castShadow=!0,this.receiveShadow=!0}}},,,function(t,e){t.exports="#ifdef GL_OES_standard_derivatives\n  #extension GL_OES_standard_derivatives : enable\n#endif\n\nprecision highp float;\n#define GLSLIFY 1\n\n#ifdef USE_ALPHATEST\nuniform float alphaTest;\n#endif\n\nuniform sampler2D msdf;\nuniform vec2 msdfSize;\n//uniform vec3 color;\nuniform float opacity;\n\n#ifdef USE_STROKE\nuniform float strokeWidth;\nuniform float strokeBias;\nuniform vec3 strokeColor;\n#endif\n\nvarying vec2 vUv;\nvarying vec3 vColor;\nvarying float vWeight;\n\nfloat median(float r, float g, float b) {\n  return max(min(r, g), min(max(r, g), b));\n}\n\n#ifdef USE_SHADOW\nconst vec2 shadowVector = vec2(-0.00025, 0.0005);\nconst float shadowSoftness = 0.5;\nconst float shadowShrink = 0.2;\nconst float shadowOpacity = 0.5;\n#endif\n\nconst float contrastMultiplier = 80.0;\n\nvoid main() {\n  vec3 color = vColor;\n\n  vec3 sample = texture2D(msdf, vUv + vec2(0.0, -0.5/512.0)).rgb;\n  float unsignedDistance = median(sample.r, sample.g, sample.b);\n\n  float signedDistance = unsignedDistance - (1.0 - 0.5 * vWeight);\n\n  if ( unsignedDistance == 0.0 ) discard;\n  float contrast = (dFdx(vUv.x) + dFdy(vUv.y)) * contrastMultiplier;\n\n  #ifdef USE_STROKE\n    float distanceOpacity = signedDistance + (strokeWidth * strokeBias);\n    float sigDistSrokeInner = signedDistance - (strokeWidth * (1.0 - strokeBias));\n    float colorMix = 1.0 - smoothstep(0.0, 1.0, sigDistSrokeInner / contrast + 0.5);\n    vec3 finalColor = mix(color, strokeColor, colorMix);\n  #else\n    float distanceOpacity = signedDistance;\n    vec3 finalColor = color;\n  #endif\n  \n  float alpha = smoothstep(0.0, 1.0, distanceOpacity / contrast + 0.5);\n  \n  #ifdef USE_SHADOW\n    //compute shadows\n    //shadow color is the same as stroke color for now\n    sample = texture2D(msdf, vUv + shadowVector).rgb;\n    unsignedDistance = median(sample.r, sample.g, sample.b);\n    float shadow = clamp(((unsignedDistance - shadowShrink) / shadowSoftness + shadowShrink), 0.0, 1.0) * shadowOpacity;\n    alpha = max(alpha, shadow);\n  #else \n    #ifdef USE_ALPHATEST\n      if ( alpha < alphaTest ) discard;\n    #endif\n  #endif\n  gl_FragColor = vec4(finalColor, alpha * opacity);\n}"},function(t,e,i){"use strict";i.d(e,"a",function(){return o});const s={align:"center",vAlign:"center"},o={centered:s,left:Object.assign({},s,{align:"left"}),right:Object.assign({},s,{align:"right"}),title:Object.assign({},s,{width:300})}},function(t,e){t.exports="#define GLSLIFY 1\nattribute vec2 uv;\nattribute vec4 position;\nattribute vec3 color;\nattribute float weight;\n\n#ifdef USE_SCREENSPACE\nuniform vec2 offset;\nuniform float prescale;\nuniform vec4 clipSpacePosition;\nuniform vec2 pixelSizeInClipSpace;\n#else\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n#endif\nvarying vec2 vUv;\nvarying vec3 vColor;\nvarying float vWeight;\n\nvoid main() {\n  vUv = uv;\n  vColor = color;\n  vWeight = weight;\n\n  #ifdef USE_SCREENSPACE\n    vec2 finalOffset = (offset + position.xy) * pixelSizeInClipSpace * prescale;\n    #ifdef CONSTANT_SIZE_ON_SCREEN\n     finalOffset *= clipSpacePosition.w;\n    #endif\n    gl_Position = clipSpacePosition;\n    gl_Position.xy += finalOffset;\n  #else\n    gl_Position = projectionMatrix * modelViewMatrix * position;\n  #endif\n}"},,function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(13);const o=Object(s.b)("resetSettings")},function(t,e,i){"use strict";i.d(e,"a",function(){return NiceParameter});var s=i(18),o=i(139),n=i(13),r=i(7);const a=[];class NiceParameter{constructor(t,e,i,s,r,l,h,m,c=!1,_=.01,u=0){this.name=t,this.label=e,this.defaultValue=i,this.minValue=s,this.maxValue=r,this.step=_,this.distribution=l,this.valueTextConverter=h,this._availableToUserMethod=!0===m||!1===m?()=>m:m,this._listeners=[],c&&(this.value=this.defaultValue),this._value=Object(o.a)("nice-param-"+t,i,s,r);const p=Object(n.c)(t,this._value,s,r);p!==this._value&&(this.value=p),a.push(this),0===u&&(u=a.length),this.sliderOrderPriority=u}listen(t){this._listeners.push(t),t(this.value)}stopListening(t){Object(s.c)(this._listeners,t)}set value(t){t!==this._value&&(t=Object(r.b)(t,this.minValue,this.maxValue))!==this._value&&(this._value=t,localStorage.setItem("nice-param-"+this.name,String(t)),this._listeners.forEach(e=>e(t)))}get value(){return this._value}get availableToUser(){return this._availableToUserMethod()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return getLocalStorageFloat});i(79);var s=i(7);function getLocalStorageParam(t){return localStorage.getItem(t)}function __getLocalStorageNumber(t,e,i,o=-1/0,n=1/0){return Object(s.b)(i(getLocalStorageParam(t)||e.toString()),o,n)}function getLocalStorageFloat(t,e,i=-1/0,s=1/0){return __getLocalStorageNumber(t,e,parseFloat,i,s)}},function(t,e,i){"use strict";i.d(e,"a",function(){return addPrettyLights});var s=i(2),o=i(13);const n=new s.Color(5193519),r=new s.Color(11517935),a=new s.Vector3(.8,.2,.6),l=new s.Vector3(0,.05,.04),h=new s.Vector3;function addPrettyLights(t,e){const i=new s.HemisphereLight(r,n);t.add(i);const m=new s.DirectionalLight(16777135,.75);t.add(m),m.name="sunlight",m.castShadow=!0,m.shadow.camera.near=.01,m.shadow.camera.far=1,m.shadow.camera.left=-.5,m.shadow.camera.right=.5,m.shadow.camera.top=-.3,m.shadow.camera.bottom=.3,m.shadow.camera.updateProjectionMatrix(),m.shadow.mapSize.width=m.shadow.mapSize.height=1024;m.position.set(.5*Math.cos(.6),.5*Math.sin(.6),0),m.lookAt(h),m.updateMatrix(),m.updateMatrixWorld(!0);const c=m.shadow.camera;c.updateMatrix(),c.updateMatrixWorld(!0),c.top=-1/0,c.bottom=1/0,c.left=1/0,c.right=-1/0,c.near=1/0,c.far=-1/0;const _=new s.Vector3;for(let t=0;t<8;t++)_.x=t%2-.5,_.y=-(~~(t/2)%2-.5),_.z=~~(t/4)%2-.5,_.multiply(a),_.sub(l),m.worldToLocal(_),c.top=Math.max(c.top,-_.y),c.bottom=Math.min(c.bottom,-_.y),c.left=Math.min(c.left,_.x),c.right=Math.max(c.right,_.x),c.near=Math.min(c.near,_.z+1),c.far=Math.max(c.far,_.z+1);if(c.updateProjectionMatrix(),Object(o.b)("debugLights")){const e=new s.DirectionalLightHelper(m),i=new s.CameraHelper(m.shadow.camera);t.add(e),t.add(i),e.update(),i.update()}return t.fog=new s.Fog(e.getHex(),0,3),{sunLight:m,ambientLight:i}}},function(t,e,i){"use strict";i.d(e,"a",function(){return TestKeyboardInputScene});var s=i(39),o=i(83),n=i(30);class TestKeyboardInputScene extends n.a{constructor(){super(!1);const t=new o.a;(new s.a).addListener(t.onKeyCodeEvent),this.scene.add(t)}update(t){super.update(t)}render(t,e){super.render(t,e)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return TestPhysicsCharacterScene});var s=i(10),o=i(78),n=i(89);class TestPhysicsCharacterScene extends n.a{constructor(){super("test-run",0,()=>{console.log("level ready")}),this.character=new o.a(this.myB2World)}update(t){const e=this.character;e.update(t);const i=e.body.GetPosition();this.b2Preview.offset.Set(i.x/s.a.aspect,i.y),super.update(t)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return TestStencilsScene});var s=i(77),o=i(30);class TestStencilsScene extends o.a{constructor(){super();const t=new s.a(.013,.012);t.rotation.y+=-.15*Math.PI,t.position.set(0,.15,.3),this.scene.add(t)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return TestTextScene});var s=i(34),o=i(28),n=i(86),r=i(13),a=i(40);class TestTextScene extends a.a{constructor(){super();const t=new n.a(this.camera);Object(r.b)("fpsCam")&&t.toggle(!0),this.scene.add(new s.a("Hello World!"));const e=new s.a("ANY KEY",o.a.title);this.scene.add(e);const i=new s.a("Q W E R T Y",o.a.keyLabel);i.position.y=-.04,this.scene.add(i);const a=new s.a("    ",o.a.keyLabel);a.position.y=-.05,this.scene.add(a);(async()=>{})()}update(t){super.update(t)}render(t,e){super.render(t,e)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(54),o=i(18);class TimedTask{constructor(t,e){this.expireTime=t,this._task=e}task(){this._task?(this._task(),this._task=void 0):console.warn("timed task asked to fire twice??")}}const n=new class Timer{constructor(){this.time=0,this.tasks=[]}update(t){for(this.time+=t;this.tasks.length>0&&this.tasks[0].expireTime<=this.time;)this.tasks.shift().task()}add(t,e,i=!1){i&&(e*=s.a.speed);const o=new TimedTask(this.time+e,t);return this.tasks.push(o),this.tasks.sort((t,e)=>t.expireTime-e.expireTime),o}runPrematurely(t){Object(o.c)(this.tasks,t),t.task()}cancel(t){Object(o.c)(this.tasks,t)}}},function(t,e,i){"use strict";i.r(e);var s=i(2),o=i(54),n=i(121),r=i(80),a=i(141),l=i(30),h=i(88),m=i(142),c=i(89),_=i(143),u=i(144),p=i(55),d=i(31),f=i(41),y=i(13),S=i(85),x=i(145),C=i(87);document.addEventListener("gesturestart",t=>t.preventDefault());const B=new s.Clock;p.a.setClearColor(new s.Color(3425622),1),f.a.camera.position.set(0,.5,.5),f.a.camera.lookAt(new s.Vector3);const w={lighting:l.a,physics:h.a,physicsPNG:c.a,physicsCharacter:m.a,keyboard:a.a,graphicsLevel:r.a,graphicsCharacter:n.a,text:u.a,stencils:_.a};let g=l.a;const v=Object(y.e)("test")||"graphicsCharacter";w.hasOwnProperty(v)&&(g=w[v]);const A=new g,V=()=>{const t=Math.min(B.getDelta(),.1)*o.a.speed;Object(S.a)(),o.a.rafTick(),C.a.update(t),x.a.update(t),d.c.value+=t,A.update(t),A.render(p.a,t),requestAnimationFrame(V)};requestAnimationFrame(V)},,,,,,,,,,,,,,,,,,,,,function(t,e){},,function(t,e){}]);